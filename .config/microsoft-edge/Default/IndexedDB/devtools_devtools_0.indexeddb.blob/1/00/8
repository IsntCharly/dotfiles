ÿÿo"key"^behaviors-5ea334119a52.js.map:99e7b71cc1b7e037fb90862a3cd42dd40b819385c58666383ca74383cd3669b9"	sourcemapo"versionI"sourcesAÀ"3app/assets/modules/github/behaviors/ajax-loading.ts"6app/assets/modules/github/behaviors/ajax-pagination.ts"7app/assets/modules/github/behaviors/analytics-events.ts"5app/assets/modules/github/behaviors/animated-image.ts"<app/assets/modules/github/behaviors/announce-pjax-loading.ts"0app/assets/modules/github/behaviors/autocheck.ts"3app/assets/modules/github/behaviors/autocomplete.ts"6app/assets/modules/github/behaviors/autosearch-form.ts"1app/assets/modules/github/behaviors/autoselect.ts"1app/assets/modules/github/behaviors/autosubmit.ts"8app/assets/modules/github/behaviors/avatar-reset-text.ts"5app/assets/modules/github/behaviors/billing-addons.ts"/app/assets/modules/github/behaviors/blob-csv.ts"5app/assets/modules/github/repositories/blob-header.ts"Kapp/assets/modules/github/behaviors/branch-protection-integration-select.ts"3app/assets/modules/github/behaviors/bulk-actions.ts"<app/assets/modules/github/behaviors/bundle-download-stats.ts".app/assets/modules/github/behaviors/buttons.ts"0app/assets/modules/github/behaviors/check-all.ts";app/assets/modules/github/behaviors/clear-data-on-logout.ts"5app/assets/modules/github/behaviors/clipboard-copy.ts"/app/assets/modules/github/behaviors/code-nav.ts"6app/assets/modules/github/behaviors/commenting/ajax.ts"7app/assets/modules/github/behaviors/commenting/close.ts"7app/assets/modules/github/behaviors/commenting/focus.ts"(app/assets/modules/github/png-scanner.ts"-app/assets/modules/github/image-dimensions.ts"Aapp/assets/modules/github/behaviors/commenting/caret-placement.ts":app/assets/modules/github/behaviors/commenting/markdown.ts"9app/assets/modules/github/behaviors/commenting/preview.ts"Eapp/assets/modules/github/behaviors/commenting/reaction-suggestion.ts".app/assets/modules/github/behaviors/commits.ts"9app/assets/modules/github/behaviors/company-name-input.ts"4app/assets/modules/github/behaviors/company-owned.ts"6app/assets/modules/github/behaviors/details-element.ts"3app/assets/modules/github/behaviors/details-menu.ts"3app/assets/modules/github/behaviors/disable-with.ts"8app/assets/modules/github/behaviors/document-dropzone.ts".app/assets/modules/github/behaviors/encrypt.ts".app/assets/modules/github/behaviors/favicon.ts"@app/assets/modules/github/behaviors/feature-preview-indicator.ts">app/assets/modules/github/behaviors/feature-preview-trigger.ts"5app/assets/modules/github/upload/attachment-upload.ts"0app/assets/modules/github/upload/batch-upload.ts")app/assets/modules/github/upload/batch.ts"6app/assets/modules/github/behaviors/file-attachment.ts"3app/assets/modules/github/behaviors/filter-input.ts"(app/assets/modules/github/filter-list.ts"-app/assets/modules/github/filter-sort-list.ts"9app/assets/modules/github/substring-memory-filter-list.ts"1app/assets/modules/github/behaviors/filterable.ts":app/assets/modules/github/behaviors/firefox-label-hacks.ts"Papp/assets/modules/github/behaviors/fixed-offset-fragment-navigation-observer.ts",app/assets/modules/github/behaviors/flash.ts""app/assets/modules/github/flash.ts"5app/assets/modules/github/behaviors/flash-observer.ts"2app/assets/modules/github/behaviors/focus-delay.ts"2app/assets/modules/github/behaviors/form-toggle.ts"1app/assets/modules/github/behaviors/fuzzy-list.ts"*app/assets/modules/github/behaviors/gfm.ts",app/assets/modules/github/behaviors/hooks.ts"1app/assets/modules/github/behaviors/hotkey-map.ts"1app/assets/modules/github/behaviors/hovercards.ts"?app/assets/modules/github/behaviors/hydro-analytics-pageview.ts"?app/assets/modules/github/behaviors/hydro-analytics-tracking.ts";app/assets/modules/github/behaviors/hydro-click-tracking.ts"8app/assets/modules/github/behaviors/immediate-updates.ts"<app/assets/modules/github/behaviors/image-metric-tracking.ts"4app/assets/modules/github/behaviors/indeterminate.ts"5app/assets/modules/github/behaviors/jump-to-loader.ts"9app/assets/modules/github/behaviors/keyboard-shortcuts.ts"Happ/assets/modules/github/behaviors/length-limited-input-with-warning.ts";app/assets/modules/github/behaviors/member-search-filter.ts"<app/assets/modules/github/behaviors/new-organization-name.ts"-app/assets/modules/github/behaviors/notice.ts"9app/assets/modules/github/behaviors/open-in-github-dev.ts"8app/assets/modules/github/behaviors/open-in-blackbird.ts"0app/assets/modules/github/behaviors/permalink.ts";app/assets/modules/github/behaviors/permission-menu-form.ts"2app/assets/modules/github/behaviors/pjax-loader.ts"2app/assets/modules/github/behaviors/pjax-timing.ts"3app/assets/modules/github/behaviors/turbo-timing.ts"6app/assets/modules/github/behaviors/pjax/exceptions.ts"<app/assets/modules/github/behaviors/pjax/history-navigate.ts"1app/assets/modules/github/behaviors/pjax/utils.ts"6app/assets/modules/github/behaviors/pjax/navigation.ts"2app/assets/modules/github/behaviors/pjax/submit.ts"2app/assets/modules/github/behaviors/print-popup.ts"<app/assets/modules/github/behaviors/poll-include-fragment.ts";app/assets/modules/github/behaviors/proxy-site-reporting.ts"3app/assets/modules/github/behaviors/quick-submit.ts"6app/assets/modules/github/behaviors/quote-selection.ts"0app/assets/modules/github/behaviors/reactions.ts"2app/assets/modules/github/behaviors/remote-form.ts"7app/assets/modules/github/behaviors/removed-contents.ts"Aapp/assets/modules/github/behaviors/enrichable-markdown-render.ts"4app/assets/modules/github/behaviors/render-editor.ts":app/assets/modules/github/behaviors/replace-remote-form.ts"8app/assets/modules/github/behaviors/report-long-tasks.ts"Bapp/assets/modules/github/behaviors/responsive-markdown-toolbar.ts"4app/assets/modules/github/behaviors/saved-replies.ts"/app/assets/modules/github/behaviors/scanning.ts"4app/assets/modules/github/behaviors/segmented-nav.ts"5app/assets/modules/github/behaviors/session-resume.ts"6app/assets/modules/github/behaviors/side-navigation.ts"Papp/assets/modules/github/notifications/v2/notification-shelf-referrer-params.ts"Happ/assets/modules/github/notifications/v2/notification-shelf-helpers.ts"9app/assets/modules/github/behaviors/site-notifications.ts"2app/assets/modules/github/behaviors/site-search.ts"2app/assets/modules/github/behaviors/size-to-fit.ts";app/assets/modules/github/behaviors/smooth-scroll-anchor.ts"=app/assets/modules/github/behaviors/snippet-clipboard-copy.ts"-app/assets/modules/github/behaviors/social.ts"*app/assets/modules/github/alive-session.ts"-app/assets/modules/github/alive/idle-state.ts"5app/assets/modules/github/behaviors/socket-channel.ts";app/assets/modules/github/behaviors/socket-channel-cache.ts"6app/assets/modules/github/behaviors/sso-auto-replay.ts"/app/assets/modules/github/behaviors/statuses.ts"4app/assets/modules/github/behaviors/sudo-required.ts"Eapp/assets/modules/github/behaviors/suggesters/audit-log-suggester.ts"Aapp/assets/modules/github/behaviors/suggesters/emoji-suggester.ts"Aapp/assets/modules/github/behaviors/suggesters/issue-suggester.ts"Capp/assets/modules/github/behaviors/suggesters/mention-suggester.ts"-app/assets/modules/github/behaviors/survey.ts"8app/assets/modules/github/behaviors/sync-details-text.ts"4app/assets/modules/github/behaviors/tab-container.ts":app/assets/modules/github/behaviors/targetable-elements.ts"3app/assets/modules/github/behaviors/team-members.ts"6app/assets/modules/github/behaviors/timeline/marker.ts";app/assets/modules/github/behaviors/timeline/progressive.ts"Fapp/assets/modules/github/behaviors/timeline/timeline-accessibility.ts"3app/assets/modules/github/behaviors/timing-stats.ts".app/assets/modules/github/behaviors/toggler.ts">app/assets/modules/github/behaviors/register-service-worker.ts",app/assets/modules/github/behaviors/turbo.ts"2app/assets/modules/github/behaviors/turbo-frame.ts"%app/assets/modules/github/timezone.ts"0app/assets/modules/github/behaviors/tz-cookie.ts"3app/assets/modules/github/behaviors/webauthn-get.ts"6app/assets/modules/github/behaviors/unread-comments.ts":app/assets/modules/github/behaviors/unread-item-counter.ts"Aapp/assets/modules/github/behaviors/updatable-content-observer.ts"Eapp/assets/modules/github/behaviors/updatable-content-stale-object.ts"4app/assets/modules/github/behaviors/upload-avatar.ts"3app/assets/modules/github/behaviors/user-content.ts"9app/assets/modules/github/behaviors/user-status-loader.ts"1app/assets/modules/github/behaviors/user-lists.ts";app/assets/modules/github/behaviors/warn-unsaved-changes.ts";app/assets/modules/github/behaviors/will-transition-once.ts".app/assets/modules/github/issues/issue-link.ts"*app/assets/modules/github/issues/labels.ts"Oapp/assets/modules/github/notifications/configure-thread-subscription-dialog.ts"2app/assets/modules/github/issues/sidebar-widget.ts"7app/assets/modules/github/issues/sidebar-memex-input.ts"+app/assets/modules/github/issues/sidebar.ts"&app/assets/modules/github/aria-live.ts"Japp/assets/modules/github/behaviors/batch-deferred-content/batch-loader.ts"=app/assets/modules/github/behaviors/batch-deferred-content.ts"5app/assets/modules/github/behaviors/button-outline.ts";app/assets/modules/github/behaviors/characters-remaining.ts"6app/assets/modules/github/behaviors/commenting/edit.ts".app/assets/modules/github/behaviors/confirm.ts"2app/assets/modules/github/behaviors/hash-change.ts"6app/assets/modules/github/behaviors/html-validation.ts"8app/assets/modules/github/behaviors/pjax/beforeunload.ts">app/assets/modules/github/behaviors/responsive-underlinenav.ts"4app/assets/modules/github/behaviors/stale-session.ts"0app/assets/modules/github/behaviors/tag-input.ts"Capp/assets/modules/github/behaviors/user-select-contain-polyfill.ts"(app/assets/modules/github/blob-anchor.ts"(app/assets/modules/github/code-editor.ts"$app/assets/modules/github/cookies.ts"'app/assets/modules/github/dimensions.ts",app/assets/modules/github/eventloop-tasks.ts"$app/assets/modules/github/failbot.ts"&app/assets/modules/github/iterables.ts"(app/assets/modules/github/filter-sort.ts")app/assets/modules/github/fuzzy-filter.ts"/app/assets/modules/github/fuzzy-list-element.ts",app/assets/modules/github/hydro-analytics.ts"+app/assets/modules/github/hydro-tracking.ts",app/assets/modules/github/jump-to/ranking.ts"/app/assets/modules/github/jump-to/page-views.ts"Happ/assets/modules/github/notifications/v2/update-notification-states.ts""app/assets/modules/github/range.ts"3app/assets/modules/github/session-resume-helpers.ts"!app/assets/modules/github/sudo.ts"!app/assets/modules/github/text.ts",app/assets/modules/github/throttled-input.ts"$app/assets/modules/github/visible.ts"3app/assets/modules/github/webauthn-support-level.ts$ À"namesA $  "mappings"¿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"file"behaviors-xxxxxxxxxxxx.js"sourcesContentAÀ"÷// Global handler for AJAX loading indicators.
//
// Only enabled on new style `data-remote` requests.
//
// Examples
//
//   .loading-spinner { display: none; }
//   form.loading .loading-spinner { display: block; }
//

// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

on('deprecatedAjaxSend', '[data-remote]', function (event) {
  if (event.currentTarget !== event.target) {
    return
  }
  if (event.defaultPrevented) {
    return
  }
  event.currentTarget.classList.add('loading')
})

// Clear any errors when the request is tried again
on('deprecatedAjaxComplete', '[data-remote]', function (event) {
  if (event.currentTarget !== event.target) {
    return
  }
  event.currentTarget.classList.remove('loading')
})
"ì// eslint-disable-next-line no-restricted-imports
import {fire} from 'delegated-events'
import {remoteForm} from '@github/remote-form'

// Dashboard event stream ajax pagination
remoteForm('form.js-ajax-pagination, .js-ajax-pagination form', async function (form, wants) {
  const container = form.closest<HTMLElement>('.js-ajax-pagination')!
  let response
  try {
    response = await wants.html()
  } catch (err) {
    if (err.response && err.response.status === 404) {
      container.remove()
      return
    } else {
      throw err
    }
  }
  container.replaceWith(response.html)
  fire(form, 'page:loaded')
})
"÷// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {sendEvent} from '../hydro-analytics'

const GENERIC_CLICK_EVENT_NAME = 'analytics.click'

on('click', '[data-analytics-event]', event => {
  const element = event.currentTarget

  const analyticsEvent = element.getAttribute('data-analytics-event')
  if (!analyticsEvent) return

  const analyticsEventAttributes = JSON.parse(analyticsEvent)

  sendEvent(GENERIC_CLICK_EVENT_NAME, analyticsEventAttributes)
})
"Ï// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

const selector = ['system', 'disabled']
  .map(state => `html[data-a11y-animated-images="${state}"] img[data-animated-image]`)
  .join(', ')

observe(selector, el => {
  if (!(el instanceof HTMLImageElement)) return // Element is not an image
  // Element has a parent link but is not the direct child
  if (el.closest('a') && !(el.parentElement instanceof HTMLAnchorElement)) return

  let parent = el.parentElement
  let link = null
  if (parent instanceof HTMLAnchorElement) {
    if (parent.childElementCount > 1) return // Image is not the only child of link
    link = parent
    link.setAttribute('data-target', 'animated-image.originalLink')
    parent = link.parentElement
  }

  el.removeAttribute('data-animated-image')
  el.setAttribute('data-target', 'animated-image.originalImage')

  const clone = link ? link.cloneNode(true) : el.cloneNode(true)

  const container = document.createElement('animated-image')
  container.appendChild(clone)
  parent?.replaceChild(container, link ? link : el)
})
"³import {announce} from '../aria-live'

document.addEventListener('pjax:start', function () {
  // eslint-disable-next-line i18n-text/no-en
  announce('Loading page')
})

document.addEventListener('pjax:error', function () {
  // eslint-disable-next-line i18n-text/no-en
  announce('Loading failed')
})

document.addEventListener('pjax:end', function () {
  // eslint-disable-next-line i18n-text/no-en
  announce('Loading complete')
})
"$// Common behaviors associated with <auto-check>

import {announceFromElement} from '../aria-live'
// eslint-disable-next-line no-restricted-imports
import {fire} from 'delegated-events'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
import {validate} from '../behaviors/html-validation'

const notes = new WeakMap()

observe('auto-check', function (el) {
  if (el.classList.contains('js-prevent-default-behavior')) return

  const input = el.querySelector('input')
  if (!input) return

  const container = input.closest('.form-group') || el
  const form = input.form

  let id: string | null
  function generateId() {
    if (!id) id = `input-check-${(Math.random() * 10000).toFixed(0)}`
    return id
  }
  const ariaDescribedby = input.getAttribute('aria-describedby')

  input.addEventListener('focusout:delay', () => {
    input.setAttribute('aria-describedby', [id, ariaDescribedby].join(' '))
  })

  const note = container.querySelector('p.note')
  if (note) {
    if (!note.id) note.id = generateId()
    notes.set(note, note.innerHTML)
  }

  el.addEventListener('loadstart', () => {
    reset(input, container)
    container.classList.add('is-loading')
    input.classList.add('is-autocheck-loading')

    validate(form!)
  })

  el.addEventListener('loadend', () => {
    container.classList.remove('is-loading')
    input.classList.remove('is-autocheck-loading')
  })

  input.addEventListener('auto-check-success', async (event: Event) => {
    input.classList.add('is-autocheck-successful')
    container.classList.add('successed')

    validate(form!)

    const {response} = (event as CustomEvent).detail
    if (!response) return

    const message = await response.text()
    if (!message) return

    if (note instanceof HTMLElement) {
      note.innerHTML = message
      announceFromElement(note)
    } else {
      const isOk = response.status === 200
      const tagName = container.tagName === 'DL' ? 'dd' : 'div'
      const element = document.createElement(tagName)
      element.id = generateId()
      element.classList.add(isOk ? 'success' : 'warning')
      element.innerHTML = message
      container.append(element)
      container.classList.add(isOk ? 'successed' : 'warn')
      announceFromElement(element)
      if (isOk) element.hidden = document.activeElement !== input
    }

    fire(input, 'auto-check-message-updated')
  })

  input.addEventListener('auto-check-error', async event => {
    input.classList.add('is-autocheck-errored')
    container.classList.add('errored')

    validate(form!)

    const {response} = (event as CustomEvent).detail
    if (!response) return

    const message = await response.text()

    if (note instanceof HTMLElement) {
      // eslint-disable-next-line i18n-text/no-en
      note.innerHTML = message || 'Something went wrong'
      announceFromElement(note)
    } else {
      const tagName = container.tagName === 'DL' ? 'dd' : 'div'
      const error = document.createElement(tagName)
      error.id = generateId()
      error.classList.add('error')
      // eslint-disable-next-line i18n-text/no-en
      error.innerHTML = message || 'Something went wrong'
      container.append(error)
      announceFromElement(error)
    }
  })

  input.addEventListener('input', () => {
    input.removeAttribute('aria-describedby')
    if (!input.value) reset(input, container)
  })

  input.addEventListener('blur', () => {
    const successMessage = container.querySelector<HTMLElement>('.success')
    if (successMessage) successMessage.hidden = true
  })

  input.addEventListener('focus', () => {
    const successMessage = container.querySelector<HTMLElement>('.success')
    if (successMessage) successMessage.hidden = false
  })

  form!.addEventListener('reset', () => {
    reset(input, container)
  })
})

// Reset the autocheck state.
function reset(input: HTMLInputElement, container: Element) {
  container.classList.remove('is-loading', 'successed', 'errored', 'warn')
  input.classList.remove('is-autocheck-loading', 'is-autocheck-successful', 'is-autocheck-errored')

  const note = container.querySelector('p.note')
  if (note) {
    const content = notes.get(note)
    if (content) note.innerHTML = content
  }

  if (container.tagName === 'DL') {
    container.querySelector('dd.error')?.remove()
    container.querySelector('dd.warning')?.remove()
    container.querySelector('dd.success')?.remove()
  } else {
    container.querySelector('div.error')?.remove()
    container.querySelector('div.warning')?.remove()
    container.querySelector('div.success')?.remove()
  }
}
"î	// Common behaviors associated with <auto-complete>

import AutocompleteElement from '@github/auto-complete-element'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

// Display spinner during query server fetch.
observe('auto-complete', function (el) {
  el.addEventListener('loadstart', () => el.classList.add('is-auto-complete-loading'))
  el.addEventListener('loadend', () => el.classList.remove('is-auto-complete-loading'))
})

observe('auto-complete', {constructor: AutocompleteElement, initialize: toggleSubmitButton})

on('auto-complete-change', 'auto-complete', function (event) {
  toggleSubmitButton(event.currentTarget as AutocompleteElement)
})

// TODO Upstream `required` attribute to <auto-complete> so it can
// participate in data-disable-invalid form validation.
//
// Toggle the submit button disabled/enabled based on the completer.
function toggleSubmitButton(completer: AutocompleteElement) {
  const form = completer.closest('form')
  if (!form) return
  const button = form.querySelector('.js-auto-complete-button')
  if (!(button instanceof HTMLButtonElement)) return
  button.disabled = !completer.value
}
"// Autosearch form
//
// Automatically replaces the contents of a container against a search field
// in the search form.
//
// Note: Using `data-throttled-autosubmit` means that the form will autosubmit
// on input with a bit of throttle so that we don't send unnessesary requests
// to the server. See `app/assets/modules/github/behaviors/autosubmit.js`.
//
// Markup:
//
// `data-autosearch-results-container` - The ID of the container to update with results
//
// <form action="/search" data-autosearch-results-container="search-results">
//   <input type="search" placeholder="Find something" data-throttled-autosubmit>
//   <div id="search-results">
//     This content will get replaced when the input changes
//   </div>
// </form>
//
import {combineGetFormSearchParams} from '../form'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {parseHTML} from '../parse-html'
import {replaceState} from '../history'

let previousController: AbortController | null = null
on('submit', '[data-autosearch-results-container]', async function (event) {
  const form = event.currentTarget
  if (!(form instanceof HTMLFormElement)) return
  event.preventDefault()

  previousController?.abort()
  form.classList.add('is-sending')
  const url = new URL(form.action, window.location.origin)
  const method = form.method
  const formData = new FormData(form)
  const serialized = combineGetFormSearchParams(url, formData)
  let body = null
  if (method === 'get') {
    url.search = serialized
  } else {
    body = formData
  }
  const {signal} = (previousController = new AbortController())
  const request = new Request(url.toString(), {
    method,
    body,
    signal,
    headers: {Accept: 'text/html', 'X-Requested-With': 'XMLHttpRequest'}
  })
  let response
  try {
    response = await fetch(request)
  } catch {
    // Ignore network errors
  }
  form.classList.remove('is-sending')
  if (!response || !response.ok || signal.aborted) return
  const id = form.getAttribute('data-autosearch-results-container')
  const resultsContainer = id ? document.getElementById(id) : null
  if (resultsContainer) {
    resultsContainer.innerHTML = ''
    resultsContainer.appendChild(parseHTML(document, await response.text()))
  }
  replaceState(null, '', `?${serialized}`)
})
"// Click to select clone urls

import {microtask} from '../eventloop-tasks'
import {onFocus} from '../onfocus'

onFocus('input[data-autoselect], textarea[data-autoselect]', async function (input) {
  await microtask()
  ;(input as HTMLInputElement | HTMLTextAreaElement).select()
})
"³	// Form AutoSubmit Behavior
//
// Automatically submits form when one of its fields change.
//
// Examples
//
//   <form action="/subscribe" data-autosubmit>
//     <input type=radio name=state value=1> Subscribe
//     <input type=radio name=state value=0> Unsubscribe
//   </form>

import {debounce} from '@github/mini-throttle'
import {fromEvent} from '../subscription'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {requestSubmit} from '../form'

on('change', 'form[data-autosubmit]', function (event) {
  const target = event.currentTarget
  requestSubmit(target as HTMLFormElement)
})

on('change', 'input[data-autosubmit], select[data-autosubmit]', submit)

// Submit a form from a change event.
function submit(event: Event) {
  const input = event.target
  if (!(input instanceof HTMLInputElement) && !(input instanceof HTMLSelectElement)) return

  const form = input.form
  requestSubmit(form!)
}

const debouncedSubmit = debounce(submit, 300)

observe('input[data-throttled-autosubmit]', {
  subscribe: el => fromEvent(el, 'input', debouncedSubmit)
})
"É// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

// Sets the text of the avatar reset button depending on whether or not the
// user has a gravatar associated with their GitHub account.
async function detectGravatar(el: Element) {
  const gravitarUrl = el.getAttribute('data-url') || ''
  const hasGravitar = await fetchGravatarInfo(gravitarUrl)

  if (hasGravitar) {
    const gravatarText = el.getAttribute('data-gravatar-text')
    if (gravatarText != null) {
      el.textContent = gravatarText
    }
  }
}

observe('.js-detect-gravatar', function (el) {
  detectGravatar(el)
})

// Fetch the gravitarUrl, and check the `has_gravatar` property from the returning JSON.
async function fetchGravatarInfo(gravitarUrl: string): Promise<boolean> {
  const url = gravitarUrl
  if (!url) return false

  try {
    const response = await fetch(url, {headers: {Accept: 'application/json'}})
    if (!response.ok) return false
    const data = (await response.json()) as {has_gravatar: boolean}
    return data.has_gravatar
  } catch {
    return false
  }
}
"ÙHimport pjax, {getState} from './pjax'
import {isFeatureEnabled} from '../features'
import {addThrottledInputEventListener} from '../throttled-input'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {replaceState} from '../history'
import visible from '../visible'

const priceSelectors = ['.unstyled-additional-seats-price-obj', '.unstyled-base-price-obj', '.unstyled-final-price-obj']

interface PriceStruct {
  default_currency: string
  local_currency: string
}

type SelectorValue = PriceStruct | string | number

function isAPriceStruct(obj: SelectorValue): obj is PriceStruct {
  if (typeof obj === 'string') return false
  if (typeof obj === 'number') return false
  return 'default_currency' in obj && 'local_currency' in obj
}

interface UserPlan {
  free: boolean
  is_enterprise_cloud_trial: boolean
  seats: number
  no_additional_seats: boolean
  selectors: Record<string, SelectorValue>
  url: string
}

let previousController: AbortController | null = null
on('click', '.js-org-signup-duration-change', event => {
  event.preventDefault()
  const el = event.currentTarget
  const newDuration = el.getAttribute('data-plan-duration')!

  updateDurationFields(newDuration)
  updateSeatFieldURLs(newDuration)
  for (const seatsField of document.querySelectorAll<HTMLInputElement>('.js-seat-field')) {
    updateTotals(seatsField)
  }
  toggleDurationUnitPrices()
})

on('change', '.js-org-signup-duration-toggle', async function ({currentTarget}) {
  const url = new URL(currentTarget.getAttribute('data-url')!, window.location.origin)

  if (isFeatureEnabled('TURBO')) {
    const {visit} = await import('@manuelpuyol/turbo')
    visit(url)
  } else {
    const container = document.getElementById('js-pjax-container')!
    pjax({
      url: url.toString(),
      container
    })
  }
})

async function updateTotals(el: HTMLInputElement | HTMLSelectElement) {
  const itemKey = el.getAttribute('data-item-name') || 'items'
  const itemRawCount = el.value
  const url = new URL(el.getAttribute('data-url')!, window.location.origin)
  const params = new URLSearchParams(url.search.slice(1))
  const itemMinimum = parseInt(el.getAttribute('data-item-minimum')!) || 0
  const itemMaximum = parseInt(el.getAttribute('data-item-maximum')!) || 300
  const itemCount = parseInt(el.getAttribute('data-item-count')!) || 0
  const itemDelta = Math.max(itemMinimum, parseInt(itemRawCount) || 0)
  const contactUs = itemDelta > itemMaximum

  const downgradeButton = document.querySelector('.js-downgrade-button')
  const downgradeDisabledMessage = document.getElementById('downgrade-disabled-message')
  if (downgradeButton instanceof HTMLButtonElement) {
    downgradeButton.disabled = itemDelta === itemCount
  }

  if (downgradeDisabledMessage instanceof HTMLElement && downgradeButton instanceof HTMLButtonElement) {
    downgradeDisabledMessage.hidden = !downgradeButton.disabled
  }

  params.append(itemKey, itemDelta.toString())

  const transformInput = document.querySelector('.js-transform-user')
  if (transformInput) params.append('transform_user', '1')

  url.search = params.toString()

  previousController?.abort()
  const {signal} = (previousController = new AbortController())
  let data: UserPlan | null = null
  try {
    const response = await fetch(url.toString(), {signal, headers: {Accept: 'application/json'}})
    if (!response.ok) return
    data = (await response.json()) as UserPlan
  } catch {
    // ignore network errors
  }
  if (signal.aborted) return
  if (!data) return

  const contact = document.querySelector('.js-contact-us')
  /* eslint-disable-next-line github/no-d-none */
  if (contact) contact.classList.toggle('d-none', !contactUs)

  const planCost = document.querySelector('.js-cost-info') as HTMLElement
  if (planCost) planCost.hidden = contactUs

  const paymentSummary = document.querySelector('.js-payment-summary')
  /* eslint-disable-next-line github/no-d-none */
  if (paymentSummary) paymentSummary.classList.toggle('d-none', contactUs)

  const submit = document.querySelector('.js-submit-billing')
  if (submit instanceof HTMLElement) submit.hidden = contactUs

  const billing = document.querySelector('.js-billing-section')
  if (billing) billing.classList.toggle('has-removed-contents', data.free || data.is_enterprise_cloud_trial)

  const upgrade = document.querySelector('.js-upgrade-info')
  /* eslint-disable-next-line github/no-d-none */
  if (upgrade) upgrade.classList.toggle('d-none', itemDelta <= 0)

  const downgrade = document.querySelector('.js-downgrade-info')
  /* eslint-disable-next-line github/no-d-none */
  if (downgrade) downgrade.classList.toggle('d-none', itemDelta >= 0)

  const extraSeats = document.querySelector('.js-extra-seats-line-item')
  /* eslint-disable-next-line github/no-d-none */
  if (extraSeats) extraSeats.classList.toggle('d-none', data.no_additional_seats)

  const seatField = document.querySelector('.js-seat-field')
  if (seatField) updateSeatFields(itemRawCount)

  const minimumSeatsTooltip = document.querySelector('.js-minimum-seats-disclaimer')
  if (minimumSeatsTooltip) {
    minimumSeatsTooltip.classList.toggle('tooltipped', data.seats === 5)
    minimumSeatsTooltip.classList.toggle('tooltipped-nw', data.seats === 5)
  }

  const ref = data.selectors
  for (const selector in ref) {
    for (const element of document.querySelectorAll(selector)) {
      if (isPriceSelector(selector) && isAPriceStruct(ref[selector])) {
        element.textContent = ''
        element.appendChild(priceCurrencyTag('default-currency', (<PriceStruct>ref[selector]).default_currency))
        element.appendChild(priceCurrencyTag('local-currency', (<PriceStruct>ref[selector]).local_currency))
      } else {
        element.textContent = <string>ref[selector]
      }
    }
  }
  replaceState(getState(), '', data.url)
}

function isPriceSelector(selector: string): boolean {
  return priceSelectors.includes(selector)
}

function priceCurrencyTag(className: string, price: string): HTMLSpanElement {
  const span = document.createElement('span')
  span.classList.add(className)
  span.textContent = price
  return span
}

function toggleDurationUnitPrices() {
  for (const unitPrice of document.querySelectorAll<HTMLElement>('.js-unit-price')) {
    unitPrice.hidden = !unitPrice.hidden
  }
}

function updateDurationFields(newDuration: string) {
  const oldDuration = newDuration === 'year' ? 'month' : 'year'
  for (const planDurationText of document.querySelectorAll('.js-plan-duration-text')) {
    planDurationText.textContent = newDuration
  }

  for (const planDurationAdjective of document.querySelectorAll('.unstyled-available-plan-duration-adjective')) {
    planDurationAdjective.textContent = `${newDuration}ly`
  }

  for (const durationLink of document.querySelectorAll('.js-org-signup-duration-change')) {
    durationLink.setAttribute('data-plan-duration', oldDuration)
  }
  const planDurationInput = <HTMLInputElement>document.getElementById('signup-plan-duration')
  if (planDurationInput) {
    planDurationInput.value = newDuration
  }
}

function updateSeatFields(numberOfSeats: string) {
  for (const el of document.querySelectorAll<HTMLInputElement>('.js-seat-field')) {
    const maxSeatForPlan = el.getAttribute('data-item-max-seats')!
    const popover = el?.parentNode?.querySelector<HTMLElement>('.Popover')

    if (maxSeatForPlan && maxSeatForPlan.length) {
      if (parseInt(numberOfSeats, 10) > parseInt(maxSeatForPlan, 10)) {
        el.classList.add('color-border-danger-emphasis')
        popover?.removeAttribute('hidden')
      } else {
        el.classList.remove('color-border-danger-emphasis')
        popover?.setAttribute('hidden', 'true')
      }
    }
  }
}

function updateSeatFieldURLs(newDuration: string) {
  for (const el of document.querySelectorAll<HTMLInputElement>('.js-seat-field')) {
    const url = new URL(el.getAttribute('data-url')!, window.location.origin)
    const params = new URLSearchParams(url.search.slice(1))
    params.delete('plan_duration')
    params.append('plan_duration', newDuration)
    url.search = params.toString()
    el.setAttribute('data-url', url.toString())
  }
}

observe('.js-addon-purchase-field', {
  constructor: HTMLInputElement,
  add(el) {
    if (visible(el)) updateTotals(el)

    addThrottledInputEventListener(el, function () {
      updateTotals(el)
    })
  }
})

observe('.js-addon-downgrade-field', {
  constructor: HTMLSelectElement,
  add(el) {
    if (visible(el)) updateTotals(el)

    el.addEventListener('change', function () {
      updateTotals(el)
    })
  }
})

function handleOrgChange(event: Event) {
  const addonField = document.querySelector('.js-addon-purchase-field')
  const selectedRadio = (event.target as Element).querySelector('input:checked')

  if (addonField instanceof HTMLInputElement && selectedRadio instanceof HTMLInputElement) {
    const newUrl = selectedRadio.getAttribute('data-upgrade-url')

    if (newUrl) {
      addonField.setAttribute('data-url', newUrl)
      addonField.value = '0'
      updateTotals(addonField)
    }
  }
}

on('details-menu-selected', '.js-organization-container', handleOrgChange, {capture: true})
"import {onInput} from '../onfocus'

onInput('.js-csv-filter-field', function (event) {
  const query = (event.target as HTMLInputElement).value.toLowerCase()
  for (const row of document.querySelectorAll('.js-csv-data tbody tr')) {
    if (!(row instanceof HTMLElement)) continue
    if (!row.textContent) continue
    row.hidden = !!query && !row.textContent.toLowerCase().includes(query)
  }
})
"º// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

// Flip tooltip direction of child elements if an item gets .is-stuck
// so tooltips are still visible when the user scrolls down a blob and
// the button bar sticks to the top
observe('.js-blob-header.is-stuck', {
  add(el) {
    flipTooltip(el)
  },
  remove(el) {
    flipTooltip(el, true)
  }
})

function flipTooltip(element: Element, inverse = false) {
  const pairs = {
    'tooltipped-nw': 'tooltipped-sw',
    'tooltipped-n': 'tooltipped-s',
    'tooltipped-ne': 'tooltipped-se'
  }

  for (const [key, value] of Object.entries(pairs)) {
    const from = inverse ? value : key
    const to = inverse ? key : value
    for (const el of element.querySelectorAll(`.${from}`)) {
      el.classList.replace(from, to)
    }
  }
}
"// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

function changeSelection(event: Event) {
  const input = event.target as HTMLElement
  const container = input?.closest<HTMLDetailsElement>('.js-branch-protection-integration-select')
  const currentSelection = container?.querySelector<HTMLElement>('.js-branch-protection-integration-select-current')
  const item = input?.closest<HTMLElement>('.js-branch-protection-integration-select-item')
  const label = item?.querySelector<HTMLElement>('.js-branch-protection-integration-select-label')
  if (currentSelection && label && container) {
    currentSelection.innerHTML = label.innerHTML
    container.open = false
  }
}

on('change', '.js-branch-protection-integration-select-input', changeSelection)
"¥// Bulk actions
//
// Provides a way to update bulk actions buttons/menus from a fetched url
// when check boxes are updated.
//
//     <div class="js-bulk-actions-container" data-bulk-actions-url="/bulk/actions/url" data-bulk-actions-parameter="member_ids">
//       <div class="js-bulk-actions">
//         <!-- buttons/menus to be updated -->
//       </div>
//
//       <div class="js-bulk-actions-item" data-bulk-actions-id="1">
//         <input type="checkbox" class="js-bulk-actions-toggle">
//       </div>
//     </div>
//
// If [data-bulk-actions-parameter] is not assigned, `input.js-bulk-actions-toggle`'s name and value will be used instead.
//
//     <div class="js-bulk-actions-container" data-bulk-actions-url="/bulk/actions/url">
//       <div class="js-bulk-actions">
//         <!-- buttons/menus to be updated -->
//       </div>
//
//       <input type="checkbox" name="member_ids[]" value="1" class="js-bulk-actions-toggle">
//     </div>
//

// eslint-disable-next-line no-restricted-imports
import {fire, on} from 'delegated-events'
import {debounce} from '@github/mini-throttle'

// Get the bulk-actions-url from the container.
function bulkUrl(container: Element): string {
  const url = new URL(container.getAttribute('data-bulk-actions-url')!, window.location.origin)
  const params = new URLSearchParams(url.search.slice(1))
  const name = container.getAttribute('data-bulk-actions-parameter')
  const checkedItems = Array.from(container.querySelectorAll<HTMLInputElement>('.js-bulk-actions-toggle:checked'))
  if (name) {
    const ids = checkedItems
      .map(el => el.closest<HTMLElement>('.js-bulk-actions-item')!.getAttribute('data-bulk-actions-id')!)
      .sort()
    for (const id of ids) {
      params.append(`${name}[]`, id)
    }
  } else {
    for (const input of checkedItems.sort((a, b) => (a.value > b.value ? 1 : -1))) {
      params.append(input.name, input.value)
    }
  }

  url.search = params.toString()
  return url.toString()
}

let previousController: AbortController | null = null
// Update the bulk actions container with new HTML fetched from the server.
async function updateBulkActions(event: Event) {
  const container = event.target
  if (!(container instanceof HTMLElement)) return
  const actionsContainer = container.querySelector<HTMLElement>('.js-bulk-actions')!
  const isItemSelected = !!container.querySelector('.js-bulk-actions-toggle:checked')

  previousController?.abort()
  const {signal} = (previousController = new AbortController())
  let html = ''
  try {
    // TODO: Drop `X-Requested-With` header once controllers are cleaned up of `request.xhr?`
    const response = await fetch(bulkUrl(container), {signal, headers: {'X-Requested-With': 'XMLHttpRequest'}})
    if (!response.ok) return
    html = await response.text()
  } catch {
    // Ignore network errors
  }
  if (signal.aborted) return
  if (!html) return

  if (!isItemSelected) {
    actionsContainer.innerHTML = html
    toggleMembershipTabs(container)
  } else {
    toggleMembershipTabs(container)
    actionsContainer.innerHTML = html
  }

  fire(container, 'bulk-actions:updated')
}

// Toggle the membership tabs based on the amount of checked bulk-actions.
function toggleMembershipTabs(container: HTMLElement) {
  const membershipTabs = document.querySelector('.js-membership-tabs')
  if (membershipTabs) {
    const checked = container.querySelectorAll('.js-bulk-actions-toggle:checked')
    /* eslint-disable-next-line github/no-d-none */
    membershipTabs.classList.toggle('d-none', checked.length > 0)
  }
}

on('change', '.js-bulk-actions-toggle', function (event) {
  const toggle = event.currentTarget
  const container = toggle.closest<HTMLElement>('.js-bulk-actions-container')!
  fire(container, 'bulk-actions:update')
})

on('bulk-actions:update', '.js-bulk-actions-container', debounce(updateBulkActions, 100))
"Þimport {loaded} from '../document-ready'
import {sendStats} from '../stats'

type Ok<T> = {kind: 'ok'; value: T | null}
type Err<E> = {kind: 'err'; value: E}
type Result<T, E> = Ok<T> | Err<E>

function getLocalJSON<T>(key: string): Result<T, Error> {
  try {
    const text = window.localStorage.getItem(key)
    return {kind: 'ok', value: text ? JSON.parse(text) : null}
  } catch (e) {
    return {kind: 'err', value: e}
  }
}

function setLocalJSON<T>(key: string, value: T): Result<null, Error> {
  try {
    window.localStorage.setItem(key, JSON.stringify(value))
    return {kind: 'ok', value: null}
  } catch (e) {
    return {kind: 'err', value: e}
  }
}

function gatherBundleURLs() {
  const urls: {[key: string]: string} = {}
  for (const script of document.getElementsByTagName('script')) {
    const match = script.src.match(/\/([\w-]+)-[0-9a-f]{8,}\.js$/)
    if (match) urls[`${match[1]}.js`] = script.src
  }
  for (const link of document.getElementsByTagName('link')) {
    const match = link.href.match(/\/([\w-]+)-[0-9a-f]{8,}\.css$/)
    if (match) urls[`${match[1]}.css`] = link.href
  }
  return urls
}

type Bundles = Record<string, string>

function report() {
  const urls = gatherBundleURLs()
  const read = getLocalJSON<Bundles>('bundle-urls')
  if (read.kind === 'err') {
    setLocalJSON('bundle-urls', urls)
    return
  }
  const previousURLs = read.value || {}
  const downloadedBundles = Object.keys(urls).filter(bundle => previousURLs[bundle] !== urls[bundle])
  if (downloadedBundles.length) {
    const write = setLocalJSON('bundle-urls', {...previousURLs, ...urls})
    if (write.kind === 'ok') {
      sendStats({downloadedBundles})
    }
  }
}

;(async () => {
  await loaded
  window.requestIdleCallback(report)
})()
"È// Behaviors complementing buttons or minibuttons
//
// See also
//   primer/buttons.scss
//

import {fromEvent} from '../subscription'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

function cancelEvent(event: Event) {
  event.preventDefault()
  event.stopPropagation()
}

// Prevent minibutton click if target is disabled
observe('a.btn.disabled', {
  subscribe: el => fromEvent(el, 'click', cancelEvent)
})
"×// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
import subscribe from '@github/check-all'

observe('.js-check-all-container', {
  constructor: HTMLElement,
  subscribe
})
"¾import {deleteCookie, getCookies} from '../cookies'

// This module detects a logout that has just occurred and clears browser data
// for the origin that might contain sensitive things such as localstorage.

// Set by lib/github/authentication/logout_result.rb on logout
export const JustLoggedOutCookieName = 'logout-was-successful'

function clearData() {
  for (const storage of [sessionStorage, localStorage]) {
    try {
      storage.clear()
    } catch {
      // ignore failure to clear
    }
  }
}

export function clearDataIfJustLoggedOut() {
  if (getCookies(JustLoggedOutCookieName).length > 0) {
    clearData()
    deleteCookie(JustLoggedOutCookieName)
  }
}

clearDataIfJustLoggedOut()
"import {announceFromElement} from '../aria-live'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

const duration = 2000

on('clipboard-copy', '[data-copy-feedback]', event => {
  const clipboardCopyElement = event.currentTarget
  const message = clipboardCopyElement.getAttribute('data-copy-feedback')!
  const originalLabel = clipboardCopyElement.getAttribute('aria-label')
  const direction = clipboardCopyElement.getAttribute('data-tooltip-direction') || 's'

  clipboardCopyElement.setAttribute('aria-label', message)
  clipboardCopyElement.classList.add('tooltipped', `tooltipped-${direction}`)
  if (!(clipboardCopyElement instanceof HTMLElement)) return
  announceFromElement(clipboardCopyElement)

  setTimeout(() => {
    if (originalLabel) {
      clipboardCopyElement.setAttribute('aria-label', originalLabel)
    } else {
      clipboardCopyElement.removeAttribute('aria-label')
    }
    clipboardCopyElement.classList.remove('tooltipped', `tooltipped-${direction}`)
  }, duration)
})

function timerCallback(currentTarget: HTMLElement) {
  clipboardCopyElementTimers.delete(currentTarget)
  toggleCopyButton(currentTarget)
}

// Toggle a copy button.
function toggleCopyButton(button: HTMLElement) {
  const copyIcon = button.querySelector('.js-clipboard-copy-icon')
  const checkIcon = button.querySelector('.js-clipboard-check-icon')

  button.classList.toggle('ClipboardButton--success')

  if (copyIcon) {
    /* eslint-disable-next-line github/no-d-none */
    copyIcon.classList.toggle('d-none')
  }
  if (checkIcon) {
    if (checkIcon.classList.contains('d-sm-none')) {
      checkIcon.classList.toggle('d-sm-none')
    } else {
      /* eslint-disable-next-line github/no-d-none */
      checkIcon.classList.toggle('d-none')
    }
  }
}

const clipboardCopyElementTimers = new WeakMap<HTMLElement, number>()

on('clipboard-copy', '.js-clipboard-copy:not([data-view-component])', function ({currentTarget}) {
  if (!(currentTarget instanceof HTMLElement)) return

  const currentTimeout = clipboardCopyElementTimers.get(currentTarget)
  if (currentTimeout) {
    clearTimeout(currentTimeout)
  } else {
    toggleCopyButton(currentTarget)
  }

  clipboardCopyElementTimers.set(currentTarget, window.setTimeout(timerCallback, duration, currentTarget))
})
"ô// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {isFeatureEnabled} from '../features'

// When a code nav response returns precise and search-based backends,
// we allow the user to retry their code nav query with the alternative
// backend.  This observe block is responsible for handling the retry
// logic,  making the async fetch request,  and updating the
// code nav modal with the new response.
on('click', '.js-code-nav-retry', async function (event) {
  // Ignore clicks with modifier keys
  /* eslint eslint-comments/no-use: off */
  /* eslint-disable no-restricted-syntax */
  if (event.altKey || event.ctrlKey || event.metaKey || event.shiftKey) return
  /* eslint-enable no-restricted-syntax */

  const popover = document.querySelector<HTMLElement>('.js-tagsearch-popover')
  if (!popover) return

  const popoverContent = popover.querySelector<HTMLElement>('.js-tagsearch-popover-content')
  if (!popoverContent) return

  // Because the definitions endpoint is responsible for rendering
  // the code nav modal's tabs and content,  a different dom element
  // target is required for overwriting the html returned from the fetch.
  let updateTarget: HTMLElement | null
  const target = event.currentTarget as HTMLElement
  const codeNavKind = target.getAttribute('data-code-nav-kind')
  if (codeNavKind === 'definitions') {
    updateTarget = popover.querySelector<HTMLElement>('.js-tagsearch-popover-content')
  } else {
    updateTarget = popover.querySelector<HTMLElement>('.js-code-nav-references')
  }
  if (!updateTarget) return

  const retryUrl = target.getAttribute('data-code-nav-url')
  if (!retryUrl) return

  const codeNavUrl = new URL(retryUrl, window.location.origin)
  try {
    const response = await fetch(codeNavUrl.toString(), {
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
    if (!response.ok) {
      return
    }
    const html = await response.text()
    if (!html) return

    updateTarget.innerHTML = html
  } catch {
    return
  }

  // Because a user has to scroll to trigger this retry behavior,
  // the code nav modal's scroll will need to be reset.
  popoverContent.scrollTop = 0
})

observe('.js-code-nav-container', {
  constructor: HTMLElement,
  subscribe(file) {
    const repoContainer = file
    const popover = document.querySelector('.js-tagsearch-popover') as HTMLElement
    if (!(popover instanceof HTMLElement))
      return {
        unsubscribe() {
          // Used as a no operation placeholder for unsubscribing if there is no popover.
        }
      }
    const popoverContent = popover.querySelector<HTMLElement>('.js-tagsearch-popover-content')!
    const popoverHTML = new WeakMap()
    const wrapCache = new WeakMap()

    let activeToken: Element | undefined

    // initialize requires both `popover` and `activeToken` to be defined.
    initialize()

    // The code nav modal is sticky in the PR view.  When a user navigates to a location from the modal,
    // and uses the 'back' button,  the code nav modal is still present,  and the active token (click target)
    // retains the CSS classes added to it by the `onMouseOver()` event listener.
    // This function ensures regardless of the user's previous navigation actions that the code nav modal is
    // always reset to hidden on a new blob view, and any previous active token classes are removed from their elements.
    function initialize() {
      hidePopover()
      for (const el of document.getElementsByClassName('pl-token')) {
        el.classList.remove('pl-token', 'active')
      }
    }

    async function onMouseMove(event: MouseEvent) {
      const range = matchFromPoint(/\w+[!?]?/g, event.clientX, event.clientY, /* retry count */ 0) // don't retry on mouse move
      if (!range) return

      const rangeElement = range.commonAncestorContainer.parentElement
      if (!rangeElement) return
      for (const className of rangeElement.classList) {
        if (['pl-token', 'pl-c', 'pl-s', 'pl-k'].includes(className)) return
      }

      if (rangeElement.closest('.js-skip-tagsearch')) {
        return
      }

      const text = range.toString()
      if (!text || text.match(/\n|\s|[();&.=",]/)) return

      let didCheckText = wrapCache.get(rangeElement)
      if (!didCheckText) {
        didCheckText = new Set()
        wrapCache.set(rangeElement, didCheckText)
      }
      if (didCheckText.has(text)) return
      didCheckText.add(text)

      const fileContainer = rangeElement.closest('.js-tagsearch-file')
      if (!fileContainer) return

      const path = fileContainer.getAttribute('data-tagsearch-path') || ''
      let lang = fileContainer.getAttribute('data-tagsearch-lang') || ''

      // Handle Ruby embedded in ERB templates
      if (lang === 'HTML+ERB') {
        if (rangeElement.closest('.pl-sre')) {
          lang = 'Ruby'
        } else {
          return
        }
      }

      if (file.classList.contains('js-code-block-container')) {
        lang = getCodeBlockLanguage(rangeElement) || ''
        // Ignore any requests where the range element is not in a code block
        // with a supported language
        if (!lang) return
      }

      const pos = getRowAndColumn(range)
      const wrapper = document.createElement('span')
      wrapper.classList.add('pl-token')
      wrapper.addEventListener('click', onClick)

      /*
       * Blackbird FF controls code nav perf improvements by moving fetch
       * action to click instead of hover. Will also show search on click, even
       * if there are no definitions/references.
       */
      let html = undefined
      if (!isFeatureEnabled('BLACKBIRD_MONOLITH')) {
        html = await fetchPopoverContents(popover, text, lang, pos, path)
        if (!html) return

        addPopoverElement(wrapper, html)
        popoverHTML.set(wrapper, html)
      }

      range.surroundContents(wrapper)
    }

    // Ensure popover list is reset to the top.
    function resetScrollTop() {
      popoverContent.scrollTop = 0
    }

    async function onClick(event: MouseEvent) {
      // Ignore clicks with modifier keys
      // TODO: Refactor to use data-hotkey
      /* eslint eslint-comments/no-use: off */
      /* eslint-disable no-restricted-syntax */
      if (event.altKey || event.ctrlKey || event.metaKey || event.shiftKey) return
      /* eslint-enable no-restricted-syntax */

      const target = event.currentTarget as HTMLElement

      if (target === activeToken) {
        hidePopover()
      } else {
        setActivePopover(target)

        if (isFeatureEnabled('BLACKBIRD_MONOLITH')) {
          const loadingState = popover.querySelector<HTMLElement>('.js-loading-code-definitions')!
          if (loadingState) {
            popoverContent.hidden = true
            loadingState.hidden = false
            positionPopover(target)
            showPopover()
          }

          await fetchPopover(event)
          populatePopover(target)
          if (loadingState && !loadingState.hidden) loadingState.hidden = true
          popoverContent.children.length > 0 ? (popoverContent.hidden = false) : hidePopover()
        } else {
          populatePopover(target)
          showPopover()
        }
      }

      event.preventDefault()
    }

    function addPopoverElement(wrapper: Element, html: string) {
      const temp = document.createElement('span')
      temp.innerHTML = html
      const details = temp.firstElementChild
      if (!details) return

      const dataHydroClick = details.getAttribute('data-hydro-click')
      const dataHydroClickHMAC = details.getAttribute('data-hydro-click-hmac')
      if (dataHydroClickHMAC && dataHydroClick) {
        wrapper.setAttribute('data-hydro-click', dataHydroClick)
        wrapper.setAttribute('data-hydro-click-hmac', dataHydroClickHMAC)
      }
    }

    async function getPopoverHtml(event: MouseEvent, classList: string[]) {
      const range = matchFromPoint(/\w+[!?]?/g, event.clientX, event.clientY, /* retry count */ 2)
      if (!range) return

      const rangeElement = range.commonAncestorContainer.parentElement
      if (!rangeElement) return

      for (const className of rangeElement.classList) {
        if (classList.includes(className)) return
      }
      const text = range.toString()

      const fileContainer = rangeElement.closest('.js-tagsearch-file')
      if (!fileContainer) return

      const path = fileContainer.getAttribute('data-tagsearch-path') || ''
      const lang = fileContainer.getAttribute('data-tagsearch-lang') || ''

      const pos = getRowAndColumn(range)
      return await fetchPopoverContents(popover, text, lang, pos, path)
    }

    async function fetchPopover(event: MouseEvent) {
      const html = await getPopoverHtml(event, ['data-hydro-click'])
      if (!html) return

      // reuse the element that's active to place the popover, there will only be 1 active at a time
      const wrapper = document.getElementsByClassName('active')[0]
      if (!wrapper) return

      addPopoverElement(wrapper, html)
      popoverHTML.set(wrapper, html)
    }

    function setActivePopover(token: HTMLElement) {
      if (activeToken) activeToken.classList.remove('active')
      activeToken = token
      activeToken.classList.add('active')
    }

    function populatePopover(token: HTMLElement) {
      popoverContent.innerHTML = popoverHTML.get(token) || ''

      positionPopover(token)
    }

    function positionPopover(token: HTMLElement) {
      const cRect = repoContainer.getClientRects()[0]
      const rect = token.getClientRects()[0]
      popover.style.position = 'absolute'
      popover.style.zIndex = '2'
      if (repoContainer.classList.contains('position-relative')) {
        popover.style.top = `${rect.bottom - cRect.top + 7}px`
        popover.style.left = `${rect.left - cRect.left - 10}px`
      } else {
        popover.style.top = `${window.scrollY + rect.bottom}px`
        popover.style.left = `${window.scrollX + rect.left}px`
      }
    }

    function showPopover() {
      if (!popover.hidden) {
        // When existing popover is active and user clicks on different symbol, we need to still reset the navigation tabs and scrollTop for the popover's new contents.
        resetScrollTop()
        return
      }
      popover.hidden = false

      // Setting a scrollTop value only succeeds if the HTML element is visible.
      resetScrollTop()

      document.addEventListener('click', onDocumentClick)
      document.addEventListener('keyup', onKeyup)
      /* eslint-disable-next-line github/prefer-observers */
      window.addEventListener('resize', onResize)
    }

    function hidePopover() {
      if (popover.hidden) return
      popover.hidden = true

      if (activeToken) activeToken.classList.remove('active')
      activeToken = undefined

      document.removeEventListener('click', onDocumentClick)
      document.removeEventListener('keyup', onKeyup)
      window.removeEventListener('resize', onResize)
    }

    function onResize() {
      if (!(activeToken instanceof HTMLElement)) return
      positionPopover(activeToken)
    }

    function onDocumentClick(event: MouseEvent) {
      const {target} = event
      if (!(target instanceof Node)) return

      if (!popover.contains(target) && !activeToken!.contains(target)) {
        hidePopover()
      }
    }

    function onKeyup(event: KeyboardEvent) {
      // TODO: Refactor to use data-hotkey
      /* eslint eslint-comments/no-use: off */
      /* eslint-disable no-restricted-syntax */
      switch (event.key) {
        case 'Escape':
          hidePopover()
          break
      }
      /* eslint-enable no-restricted-syntax */
    }

    file.addEventListener('mousemove', onMouseMove)

    return {
      unsubscribe() {
        file.removeEventListener('mousemove', onMouseMove)
      }
    }
  }
})

async function fetchPopoverContents(
  popover: HTMLElement,
  text: string,
  lang: string,
  pos: [number, number],
  path: string
): Promise<string> {
  const urlStr = popover.getAttribute('data-tagsearch-url')
  if (!urlStr) return ''
  const ref = popover.getAttribute('data-tagsearch-ref')
  if (!ref) return ''
  let codeNavContext = popover.getAttribute('data-tagsearch-code-nav-context')
  if (!codeNavContext) {
    codeNavContext = 'UNKNOWN_VIEW'
  }

  const url = new URL(urlStr, window.location.origin)
  const params = new URLSearchParams()
  params.set('q', text)
  params.set('blob_path', path)
  params.set('ref', ref)
  params.set('language', lang)
  params.set('row', pos[0].toString())
  params.set('col', pos[1].toString())
  params.set('code_nav_context', codeNavContext)
  url.search = params.toString()

  try {
    const response = await fetch(url.toString(), {
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
    if (!response.ok) {
      return ''
    }
    const html = await response.text()

    // Ignore responses with no definitions
    if (/js-tagsearch-no-definitions/.test(html)) return ''

    return html
  } catch {
    return ''
  }
}

interface CaretPosition {
  offsetNode: Node
  offset: number
}
declare global {
  interface Document {
    caretPositionFromPoint(x: number, y: number): CaretPosition | null
  }
}

// Returns matching text range given screen offsets.
//
// Examples
//
//   // Find nearest word under mouse cursor
//   matchFromPoint(/\w+/g, event.clientX, event.clientY)
//
// Returns Range or null if nothing matches position.
function matchFromPoint(regexp: RegExp, x: number, y: number, retryCount: number): Range | undefined | null {
  let textNode: Node | undefined
  let offset: number | undefined

  if (document.caretPositionFromPoint) {
    const caret = document.caretPositionFromPoint(x, y)
    if (caret) {
      textNode = caret.offsetNode
      offset = caret.offset
    }
  } else if (document.caretRangeFromPoint) {
    const range = document.caretRangeFromPoint(x, y)
    if (range) {
      textNode = range.startContainer
      offset = range.startOffset
    }
  }

  if (
    !textNode ||
    typeof offset !== 'number' ||
    (!isFeatureEnabled('BLACKBIRD_MONOLITH') && textNode.nodeType !== Node.TEXT_NODE)
  )
    return

  const text = textNode.textContent
  const isEmpty = text?.replaceAll('\n', '').trim() === ''
  if (!text || isEmpty || textNode.nodeType !== Node.TEXT_NODE) {
    if (retryCount <= 0 || !isFeatureEnabled('BLACKBIRD_MONOLITH')) {
      return null
    } else {
      /* Retry match with a slightly different offset based on two cases:
          1. Loading state can be accidentally clicked on leaving nodeType as ELEMENT_NODE
          2. Empty text nodes can be clicked on, readjust range
         Loading state offset can be less than empty click offset
      */
      const rangeOffset = textNode.nodeType !== Node.TEXT_NODE ? 1 : 10
      return matchFromPoint(regexp, x - rangeOffset, y - rangeOffset, retryCount - 1)
    }
  }
  const match = findNearestMatch(text, regexp, offset)
  if (!match) return null

  const matchedRange = document.createRange()
  matchedRange.setStart(textNode, match[1])
  matchedRange.setEnd(textNode, match[2])

  return matchedRange
}

// Find nearest match in string given a starting offset.
//
// Similar to String#scan, but only returns one result around the given offset.
//
// Examples
//
//   findNearestMatch("The quick brown fox jumps over the lazy dog", /\w+/g, 1)
//   // ["The", 0, 3]
//
//   findNearestMatch("The quick brown fox jumps over the lazy dog", /\w+/g, 18)
//   ["fox", 16, 19]
//
// Return matching string, start and end offsets. Otherwise returns null for no match.
export function findNearestMatch(str: string, regexp: RegExp, offset: number): [string, number, number] | null {
  let m
  while ((m = regexp.exec(str))) {
    const len = m.index + m[0].length
    if (m.index <= offset && offset <= len) {
      return [m[0], m.index, len]
    }
  }
  return null
}

// Get the language name of the embedded code block that the given element is
// located in. This will be used for files such as Markdown that can contain
// nested code blocks in multiple languages.
//
// Return language name or null
function getCodeBlockLanguage(element: Element): string | null {
  // FIXME Use js- class or data attributes for the language lookup/mappings
  const codeBlockElement = element.closest('.highlight')
  if (codeBlockElement) {
    for (const className of codeBlockElement.classList) {
      switch (className) {
        case 'highlight-source-go':
          return 'Go'
        case 'highlight-source-js':
          return 'JavaScript'
        case 'highlight-source-python':
          return 'Python'
        case 'highlight-source-ruby':
          return 'Ruby'
        case 'highlight-source-ts':
          return 'TypeScript'
      }
    }
  }

  return null
}

// Returns a zero-indexed position of the range in utf16 code units.
export function getRowAndColumn(range: Range): [number, number] {
  let node = range.startContainer
  let offset = range.startOffset
  let passParent = false
  for (;;) {
    let prev = node.previousSibling
    while (!passParent && prev) {
      // Diff views include additional DOM elements like comments and buttons that
      // don't appear in the DOM for regular blob views. HTML Comment and Button nodes
      // should not be included when calculating the offset (or column position). We only
      // want to count text that appears in the repository, so that the resulting column position
      // will align with the column position indexed by the code-navigation service for the symbol
      // under the user's cursor.
      if (!['#comment', 'BUTTON'].includes(prev.nodeName)) {
        offset += (prev.textContent || '').length
      }
      prev = prev.previousSibling
    }
    const parent = node.parentElement
    if (parent) {
      if (parent.classList.contains('js-code-nav-pass')) {
        // Compared with the standard blob view, the DOM structure in diff views is slightly different.
        // To make sure we don't over count the offset for the clicked symbol, some DOM elements'
        // text content should not be considered when calculating the symbol's column offset.
        // This conditional signals to not count any additional offsets until the parent DOM
        // element containing the symbol's line number is found.
        passParent = true
      } else if (parent.classList.contains('js-file-line')) {
        const lineNumber = parent.previousElementSibling!
        if (!lineNumber.classList.contains('js-code-nav-line-number')) {
          throw new Error('invariant')
        }
        const row = parseInt(lineNumber.getAttribute('data-line-number') || '1', 10)
        return [row - 1, offset]
      }
      node = parent
    } else {
      return [0, 0]
    }
  }
}
 cÚ5/ /   C o m m e n t i n g :   A J A X   f o r m   s u b m i s s i o n 
 / / 
 / /   M a r k u p 
 / / 
 / /           < f o r m   c l a s s = " j s - n e w - c o m m e n t - f o r m " > 
 / /               < d i v   c l a s s = " j s - c o m m e n t - f o r m - e r r o r "   h i d d e n > 
 / /               < / d i v > 
 / / 
 / /               < t e x t a r e a   c l a s s = " j s - c o m m e n t - f i e l d " > < / t e x t a r e a > 
 / / 
 / /               < b u t t o n   t y p e = " s u b m i t " > 
 / /                   C o m m e n t 
 / /               < / b u t t o n > 
 / /           < / f o r m > 
 / / 
 / /   P r i m e r   V a l i d a t i o n   e x a m p l e : 
 / /   s e e :   h t t p s : / / p r i m e r . s t y l e / c s s / c o m p o n e n t s / f o r m s # f o r m - g r o u p - v a l i d a t i o n 
 / / 
 / /       < f o r m   c l a s s = " j s - n e w - c o m m e n t - f o r m " > 
 / /           < d i v   c l a s s = " f o r m - g r o u p   j s - r e m o v e - e r r o r - s t a t e - o n - c l i c k " > 
 / /               < t e x t a r e a   c l a s s = " j s - c o m m e n t - f i e l d "   a r i a - d e s c r i b e d b y = " b o d y - i n p u t - v a l i d a t i o n " , 
 / /               < / t e x t a r e a > 
 / / 
 / /               < p   c l a s s = " n o t e   e r r o r   j s - c o m m e n t - f o r m - e r r o r "   i d = " b o d y - i n p u t - v a l i d a t i o n "   h i d d e n > < / p > 
 / / 
 / /               < b u t t o n   t y p e = " s u b m i t " > 
 / /                   C o m m e n t 
 / /               < / b u t t o n > 
 / /           < / d i v > 
 / /       < / f o r m > 
 
 / /   e s l i n t - d i s a b l e - n e x t - l i n e   n o - r e s t r i c t e d - i m p o r t s 
 i m p o r t   { f i r e ,   o n }   f r o m   ' d e l e g a t e d - e v e n t s ' 
 i m p o r t   t y p e   { E r r o r W i t h R e s p o n s e }   f r o m   ' @ g i t h u b / r e m o t e - f o r m ' 
 i m p o r t   { c h a n g e V a l u e }   f r o m   ' . . / . . / f o r m ' 
 i m p o r t   { r e m o t e F o r m }   f r o m   ' @ g i t h u b / r e m o t e - f o r m ' 
 i m p o r t   { r e p l a c e C o n t e n t }   f r o m   ' . . / . . / u p d a t a b l e - c o n t e n t ' 
 
 / /   H i d e   a n y   c o m m e n t   e r r o r s   o n   r e t r y . 
 f u n c t i o n   c l e a r F o r m E r r o r ( f o r m :   E l e m e n t )   { 
     c o n s t   f o r m E r r o r   =   f o r m . q u e r y S e l e c t o r ( ' . j s - c o m m e n t - f o r m - e r r o r ' ) 
     i f   ( f o r m E r r o r   i n s t a n c e o f   H T M L E l e m e n t )   { 
         f o r m E r r o r . h i d d e n   =   t r u e 
     } 
 } 
 
 / /   R e m o v e   e r r o r   s t a t e   w h e n   P r i m e r   F o r m   V a l i d a t i o n   e n a b l e d   f i e l d   i s   c l i c k e d   o n 
 o n ( ' c l i c k ' ,   ' . e r r o r e d . j s - r e m o v e - e r r o r - s t a t e - o n - c l i c k ' ,   f u n c t i o n   ( { c u r r e n t T a r g e t } )   { 
     c u r r e n t T a r g e t . c l a s s L i s t . r e m o v e ( ' e r r o r e d ' ) 
 } ) 
 
 / /   R e s e t   f o r m   a f t e r   A J A X   r e q u e s t   i s   s u c c e s s f u l 
 r e m o t e F o r m ( ' . j s - n e w - c o m m e n t - f o r m ' ,   a s y n c   f u n c t i o n   ( f o r m ,   w a n t s )   { 
     l e t   r e s p o n s e 
     c l e a r F o r m E r r o r ( f o r m ) 
     t r y   { 
         r e s p o n s e   =   a w a i t   w a n t s . j s o n ( ) 
     }   c a t c h   ( e r r o r )   { 
         h a n d l e F o r m E r r o r ( f o r m ,   e r r o r ) 
     } 
 
     i f   ( ! r e s p o n s e )   { 
         r e t u r n 
     } 
 
     f o r m . r e s e t ( ) 
     f o r   ( c o n s t   f i e l d   o f   f o r m . q u e r y S e l e c t o r A l l < H T M L I n p u t E l e m e n t > ( ' . j s - r e s e t t a b l e - f i e l d ' ) )   { 
         c h a n g e V a l u e ( f i e l d ,   f i e l d . g e t A t t r i b u t e ( ' d a t a - r e s e t - v a l u e ' )   | |   ' ' ) 
     } 
     c o n s t   w r i t e T a b   =   f o r m . q u e r y S e l e c t o r ( ' . j s - w r i t e - t a b ' ) 
     i f   ( w r i t e T a b   i n s t a n c e o f   H T M L E l e m e n t )   { 
         w r i t e T a b . c l i c k ( ) 
     } 
     c o n s t   r e f   =   r e s p o n s e . j s o n . u p d a t e C o n t e n t 
 
     f o r   ( c o n s t   s e l e c t o r   i n   r e f )   { 
         c o n s t   h t m l   =   r e f [ s e l e c t o r ] 
         c o n s t   e l   =   d o c u m e n t . q u e r y S e l e c t o r ( s e l e c t o r ) 
         i f   ( e l   i n s t a n c e o f   H T M L E l e m e n t )   { 
             r e p l a c e C o n t e n t ( e l ,   h t m l ) 
         }   e l s e   { 
             / /   e s l i n t - d i s a b l e - n e x t - l i n e   n o - c o n s o l e 
             c o n s o l e . w a r n ( ` c o u l d n ' t   f i n d   $ { s e l e c t o r }   f o r   i m m e d i a t e   u p d a t e ` ) 
         } 
     } 
 
     f i r e ( f o r m ,   ' c o m m e n t : s u c c e s s ' ) 
 } ) 
 
 / /   S h o w   c o m m e n t   e r r o r   i f   a j a x   r e q u e s t   f a i l s . 
 f u n c t i o n   h a n d l e F o r m E r r o r ( f o r m :   E l e m e n t ,   e r r o r :   E r r o r W i t h R e s p o n s e )   { 
     / /   e s l i n t - d i s a b l e - n e x t - l i n e   i 1 8 n - t e x t / n o - e n 
     l e t   m e s s a g e   =   " Y o u   c a n ' t   c o m m e n t   a t   t h i s   t i m e " 
     i f   ( e r r o r . r e s p o n s e   & &   e r r o r . r e s p o n s e . s t a t u s   = = =   4 2 2 )   { 
         c o n s t   d a t a   =   e r r o r . r e s p o n s e . j s o n 
         i f   ( d a t a . e r r o r s )   { 
             i f   ( A r r a y . i s A r r a y ( d a t a . e r r o r s ) )   { 
                 m e s s a g e   + =   `      y o u r   c o m m e n t   $ { d a t a . e r r o r s . j o i n ( ' ,   ' ) } ` 
             }   e l s e   { 
                 m e s s a g e   =   d a t a . e r r o r s 
             } 
         } 
     } 
 
     m e s s a g e   + =   ' .   ' 
 
     c o n s t   f o r m E r r o r   =   f o r m . q u e r y S e l e c t o r ( ' . j s - c o m m e n t - f o r m - e r r o r ' ) 
     i f   ( f o r m E r r o r   i n s t a n c e o f   H T M L E l e m e n t )   { 
         f o r m E r r o r . t e x t C o n t e n t   =   m e s s a g e 
         f o r m E r r o r . h i d d e n   =   f a l s e 
 
         c o n s t   f o r m G r o u p V a l i d a t i o n F o r m W r a p p e r   =   f o r m E r r o r . c l o s e s t ( ' d i v . f o r m - g r o u p . j s - r e m o v e - e r r o r - s t a t e - o n - c l i c k ' ) 
 
         i f   ( f o r m G r o u p V a l i d a t i o n F o r m W r a p p e r )   { 
             f o r m G r o u p V a l i d a t i o n F o r m W r a p p e r . c l a s s L i s t . a d d ( ' e r r o r e d ' ) 
         } 
     } 
 } 
 "// Commenting: Close button
//
// When comment fields also have a "Close" button, update the copy of the
// button when text is present to indicate that the form will both post a
// comment and close the discussion.
//
// Markup
//
//     <form>
//       <textarea class="js-comment-field"></textarea>
//       <div>
//         <button type="submit">Comment</button>
//         <button type="submit" class="js-comment-and-button"
//           data-comment-text="Close with comment">
//           Close
//         </button>
//       </div>
//     </form>

// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

const setButtonText = (button: HTMLButtonElement, hasValue: boolean) => {
  const spanText = button.querySelector('.js-form-action-text')
  const textTarget = spanText ? spanText : button
  textTarget.textContent = hasValue
    ? button.getAttribute('data-comment-text')!
    : textTarget.getAttribute('data-default-action-text')!
}

const createInputHandler = (button: HTMLButtonElement): ((event: Event) => void) => {
  let previousHasValue: string

  // Handle input.
  return (event: Event) => {
    const target = event.currentTarget
    const newValue = (target as HTMLInputElement).value.trim()

    if (newValue !== previousHasValue) {
      previousHasValue = newValue
      setButtonText(button, Boolean(newValue))
    }
  }
}

observe('.js-comment-and-button', {
  constructor: HTMLButtonElement,
  initialize(button) {
    const commentField = button.form!.querySelector<HTMLElement>('.js-comment-field')!
    const handleInput = createInputHandler(button)

    return {
      add() {
        commentField.addEventListener('input', handleInput)
        commentField.addEventListener('change', handleInput)
      },
      remove() {
        commentField.removeEventListener('input', handleInput)
        commentField.removeEventListener('change', handleInput)
      }
    }
  }
})
"ò// Commenting: Focus CSS hacks
//
// Bubbles js-comment-field focus state up to js-write-bucket.
//
// So we can have a focused ring around the drag and drop section.
//
// TODO: `focused` class should be `is-focused`

import {onFocus} from '../../onfocus'

// Sync focused class.
function toggleFocus(el: Element, focused: boolean) {
  const container = el.closest('.js-write-bucket')
  if (container) {
    container.classList.toggle('focused', focused)
  }
}

// Clean up focused class on blur.
function blurred(event: Event) {
  const el = event.currentTarget
  if (el instanceof Element) {
    toggleFocus(el, false)
  }
}

onFocus('.js-comment-field', function (el) {
  toggleFocus(el, true)
  el.addEventListener('blur', blurred, {once: true})
})
"ü// Scan an ArrayBuffer as PNG, yielding each chunk along the way.
//
// Example:
//
//   scanner = new PNGScanner buffer
//   scanner.scan (chunkType, chunkLength) ->
//     if chunkType is "IHDR"
//       imageWidth = @readLong()
//       imageHeight = @readLong()
//
// The callback will get called for each PNG chunk as described in
// http://www.w3.org/TR/PNG/#11Chunks. During the callback, the scanner will be
// positioned on the start of chunk's data portion, where individual values are
// accessible with:
//
// - readChar(): reads 1-byte value (uint8)
// - readShort(): reads 2-byte value (uint16)
// - readLong(): reads 4-byte value (uint32)
// - readString(length): reads <length> ASCII characters as a string
// - advance(bytes): skips <bytes> bytes forward
//
// Scanning will end if the callback returns `false` at any point.

const PNG_HEADER = 0x89504e47
const CRC_WIDTH = 4

export default class PNGScanner {
  dataview: DataView
  pos: number

  static fromFile(file: Blob): Promise<PNGScanner> {
    return new Promise(function (resolve, reject) {
      const reader = new FileReader()
      reader.onload = function () {
        resolve(new PNGScanner(reader.result as ArrayBuffer))
      }
      reader.onerror = function () {
        reject(reader.error)
      }
      reader.readAsArrayBuffer(file)
    })
  }

  constructor(buffer: ArrayBuffer) {
    this.dataview = new DataView(buffer)
    this.pos = 0
  }

  advance(bytes: number) {
    this.pos += bytes
  }

  readInt(bytes: 1 | 2 | 4) {
    /* eslint-disable-next-line @typescript-eslint/no-this-alias */
    const self = this

    // I want the do { } syntax *so* bad.
    const value = (function () {
      switch (bytes) {
        case 1:
          return self.dataview.getUint8(self.pos)
        case 2:
          return self.dataview.getUint16(self.pos)
        case 4:
          return self.dataview.getUint32(self.pos)
        default:
          // I shouldn't need this, but flow can't figure out that all values of bytes are handled by the above switch
          throw new Error('bytes parameter must be 1, 2 or 4')
      }
    })()
    this.advance(bytes)
    return value
  }

  readChar() {
    return this.readInt(1)
  }

  readShort() {
    return this.readInt(2)
  }

  readLong() {
    return this.readInt(4)
  }

  readString(length: number): string {
    const buf = []
    for (let i = 0; i < length; i++) {
      buf.push(String.fromCharCode(this.readChar()))
    }
    return buf.join('')
  }

  scan(fn: (this: PNGScanner, type: string, len: number) => boolean) {
    if (this.readLong() !== PNG_HEADER) {
      throw new Error('invalid PNG')
    }

    this.advance(4)

    for (;;) {
      const len = this.readLong()
      const type = this.readString(4)
      const resumeAt = this.pos + len + CRC_WIDTH
      if (fn.call(this, type, len) === false || type === 'IEND') {
        break
      }
      this.pos = resumeAt
    }
  }
}
"èimport PNGScanner from './png-scanner'

const METERS_PER_INCH = 0.0254

export type ImageDimensions = {
  width: number
  height: number
  ppi: number
}

// Returns a Promise that resolves with an object indicating:
//
// - width: image width in pixels
// - height: image height in pixels
// - ppi: pixels-per-inch count (optional)
//
// Only PNG file uploads are supported at the moment. All other types will
// resolve with an empty metadata object.
export default async function imageDimensions(file: File): Promise<ImageDimensions | null> {
  if (file.type !== 'image/png') {
    return null
  }
  const slice = file.slice(0, 10240, file.type)
  const scanner = await PNGScanner.fromFile(slice)
  const meta = {
    width: 0,
    height: 0,
    ppi: 1
  }

  scanner.scan(function (type) {
    switch (type) {
      case 'IHDR': {
        /* eslint-disable-next-line @typescript-eslint/no-invalid-this */
        meta.width = this.readLong()
        /* eslint-disable-next-line @typescript-eslint/no-invalid-this */
        meta.height = this.readLong()
        return true
      }
      case 'pHYs': {
        /* eslint-disable-next-line @typescript-eslint/no-invalid-this */
        const ppuX = this.readLong()
        /* eslint-disable-next-line @typescript-eslint/no-invalid-this */
        const ppuY = this.readLong()
        /* eslint-disable-next-line @typescript-eslint/no-invalid-this */
        const unit = this.readChar()
        let inchesRatio
        if (unit === 1) {
          inchesRatio = METERS_PER_INCH
        }
        if (inchesRatio) {
          meta.ppi = Math.round(((ppuX + ppuY) / 2) * inchesRatio)
        }
        return false
      }
      case 'IDAT': {
        return false
      }
    }

    return true
  })

  return meta
}
"Ô7import type {CaretCoordinates} from '@koddsson/textarea-caret'
import getCaretCoordinates from '@koddsson/textarea-caret'

type CaretCache = Map<number, CaretPosition>
const inputCache = new WeakMap<HTMLElement, CaretCache>()

/**
 * Bundles together the caret coordinates and the caret's
 * index within a given textarea
 */
class CaretPosition {
  index: number
  coords: CaretCoordinates
  textArea: HTMLTextAreaElement

  constructor(index: number, coords: CaretCoordinates, textArea: HTMLTextAreaElement) {
    this.index = index
    this.coords = coords
    this.textArea = textArea
  }

  get top() {
    return this.coords.top
  }

  get left() {
    return this.coords.left
  }

  get height() {
    return this.coords.height
  }

  currentChar(lookBack = 1) {
    return this.textArea.value.substring(this.index - lookBack, this.index)
  }
  /**
   * Compare the line of the y coordinates to the caret.
   * Returns -1 if y is on a previous line
   * Returns 1 if y is on a subsequent line
   * Returns 0 if y is on the same line
   */
  checkLine(y: number): -1 | 0 | 1 {
    if (y < this.coords.top) {
      return -1
    }

    if (y > this.coords.top + this.coords.height) {
      return 1
    }

    return 0
  }

  /**
   * The absolute horizontal distance between the x position and the
   * caret's x position.
   */
  xDistance(x: number): number {
    return Math.abs(this.left - x)
  }
}

/**
 * Get the cached x/y coordinates for the given caret index and textarea.
 */
function fetchCaretCoords(textArea: HTMLTextAreaElement, caretIndex: number): CaretPosition {
  let caretCache
  if (inputCache.has(textArea)) {
    caretCache = inputCache.get(textArea)!
  } else {
    caretCache = new Map()
    inputCache.set(textArea, caretCache)
  }

  if (caretCache.has(caretIndex)) {
    return caretCache.get(caretIndex)
  } else {
    // calling getCaretCoordinates(textArea, caretIndex, {debug: true})
    // will append a div to the document showing you where `textarea-caret` thinks the caret is
    const coords = new CaretPosition(caretIndex, getCaretCoordinates(textArea, caretIndex), textArea)
    caretCache.set(caretIndex, coords)
    return coords
  }
}

/**
 * This function recursively searches for the caret index that corresponds to the given coordinates.
 * We keep track of the number of iterations purely for logging to the console during
 * this PR.
 */
const binaryCursorSearch = (
  textArea: HTMLTextAreaElement,
  lower: number,
  upper: number,
  mouseX: number,
  mouseY: number,
  iterations: number
): number => {
  if (upper === lower) {
    return upper
  }

  /**
   * Out of our final candidates, eliminate any that aren't on the same line as the mouse position.
   * Pick the one that's closest in the x direction.
   *
   * If _none_ of the candidates are on the same line, bail and arbitrarily return the upper bound
   */
  const bestPosition = (candidates: CaretPosition[]): number => {
    const sameLineCandidates = candidates
      .filter(c => c.checkLine(mouseY) === 0)
      .sort((a, b) => (a.xDistance(mouseX) > b.xDistance(mouseX) ? 1 : -1))
    if (sameLineCandidates.length === 0) {
      return upper
    } else {
      return sameLineCandidates[0].index
    }
  }
  // if we're down to two or three positions check them all
  if (upper - lower === 1) {
    const l = fetchCaretCoords(textArea, lower)
    const u = fetchCaretCoords(textArea, upper)
    return bestPosition([l, u])
  }

  if (upper - lower === 2) {
    const l = fetchCaretCoords(textArea, lower)
    const m = fetchCaretCoords(textArea, upper - 1)
    const u = fetchCaretCoords(textArea, upper)

    return bestPosition([l, m, u])
  }

  // The new midpoint is halfway between the upper and lower bounds
  // If that ends up being the same as the upper or lower, it means we've descended
  // all the way to the bottom of our search tree. We don't backtrack.
  const mid = Math.floor((upper + lower) / 2)
  if (mid === lower || mid === upper) {
    return mid
  }
  const midCoords = fetchCaretCoords(textArea, mid)

  // If the midpoint caret position is below the mouse coordinates, we need to search
  // farther along in the textarea
  if (mouseY > midCoords.top + midCoords.height) {
    return binaryCursorSearch(textArea, mid + 1, upper, mouseX, mouseY, iterations + 1)
  }

  // If the midpoint caret position is above the mouse coordinates, we need to search
  // behind the current midpoint in the textarea
  if (mouseY < midCoords.top) {
    return binaryCursorSearch(textArea, lower, mid - 1, mouseX, mouseY, iterations + 1)
  }

  // if we're within a few pixels, avoid further searching
  const ETA = 3
  if (midCoords.xDistance(mouseX) < ETA) {
    return mid
  }

  // if mid is on the same line as the cursor, we need to check the x position
  if (midCoords.left < mouseX) {
    // if iterating further will cause us to change lines, stop here
    if (fetchCaretCoords(textArea, mid + 1).checkLine(mouseY) !== 0) {
      return mid
    }
    return binaryCursorSearch(textArea, mid + 1, upper, mouseX, mouseY, iterations + 1)
  }

  if (midCoords.left > mouseX) {
    // if iterating further will cause us to change lines, stop here
    if (fetchCaretCoords(textArea, mid - 1).checkLine(mouseY) !== 0) {
      return mid
    }

    return binaryCursorSearch(textArea, lower, mid - 1, mouseX, mouseY, iterations + 1)
  }

  return mid
}

/**
 * The driver function for the binary search.
 */
const findCursorPosition = (textArea: HTMLTextAreaElement, x: number, y: number): number => {
  const startIndex = 0
  const endIndex = textArea.value.length - 1
  const iterations = 0
  return binaryCursorSearch(textArea, startIndex, endIndex, x, y, iterations)
}

/**
 * Assigns the final cursor position after finding it
 */
function setCursorPosition(textarea: HTMLTextAreaElement, x: number, y: number) {
  const newPosition = findCursorPosition(textarea, x, y)

  textarea.setSelectionRange(newPosition, newPosition)
}

/**
 * Sets the caret in a textarea based on a DragEvent within that textarea.
 * Unfortunately there's no html api to do that directly (x/y -> caret). This function uses an iterative
 * approach to find the caret position from the x/y coordinates of the drag event.
 *
 * Under the hood we use the [textarea-caret npm package](https://www.npmjs.com/package/textarea-caret)
 * to find the x/y coordinates of the caret based on the caret index, and feed those results into a binary search.
 *
 * We use a cache to speed up the search, which is reinitialized when the user drags over the textarea for the first time.
 */
export function updateCaret(textArea: HTMLTextAreaElement, dragEvent: DragEvent) {
  const rect = textArea.getBoundingClientRect()
  // We want to clear the cache when the user first drags an attachment into the textarea.
  // It's better to have to recalculate too much than to have a stale cache with wrong results.
  if (dragEvent.type === 'dragenter') {
    inputCache.delete(textArea)
  }

  const x = dragEvent.clientX - rect.left
  const y = dragEvent.clientY - rect.top + textArea.scrollTop
  setCursorPosition(textArea, x, y)
}
 c®µi m p o r t   { i n s e r t T e x t ,   r e p l a c e S e l e c t i o n ,   r e p l a c e T e x t }   f r o m   ' . . / . . / t e x t ' 
 i m p o r t   { s u b s c r i b e }   f r o m   ' @ g i t h u b / p a s t e - m a r k d o w n ' 
 i m p o r t   t y p e   { A t t a c h m e n t }   f r o m   ' @ g i t h u b / f i l e - a t t a c h m e n t - e l e m e n t ' 
 i m p o r t   t y p e   { I m a g e D i m e n s i o n s }   f r o m   ' . . / . . / i m a g e - d i m e n s i o n s ' 
 i m p o r t   { g e t C o d e E d i t o r }   f r o m   ' . . / . . / c o d e - e d i t o r ' 
 i m p o r t   i m a g e D i m e n s i o n s   f r o m   ' . . / . . / i m a g e - d i m e n s i o n s ' 
 / /   e s l i n t - d i s a b l e - n e x t - l i n e   n o - r e s t r i c t e d - i m p o r t s 
 i m p o r t   { o b s e r v e }   f r o m   ' s e l e c t o r - o b s e r v e r ' 
 / /   e s l i n t - d i s a b l e - n e x t - l i n e   n o - r e s t r i c t e d - i m p o r t s 
 i m p o r t   { o n }   f r o m   ' d e l e g a t e d - e v e n t s ' 
 i m p o r t   { u p d a t e C a r e t }   f r o m   ' . / c a r e t - p l a c e m e n t ' 
 
 / /   I n   p a s t e - m a r k d o w n   t h e   s u b s c r i b e   f u n c t i o n   l i s t e n s   f o r   a l l   o f   p a s t e   e v e n t   h a n d l e r s   a n d 
 / /   r e t u r n s   a n   u n s u b s c r i b e   f u n c t i o n   t o   r e m o v e   t h e m   f r o m   t h e   e l e m e n t . 
 o b s e r v e ( ' . j s - p a s t e - m a r k d o w n ' ,   { 
     i n i t i a l i z e ( e l )   { 
         l e t   u n s u n s c r i b e :   ( )   = >   v o i d 
 
         r e t u r n   { 
             a d d ( )   { 
                 u n s u n s c r i b e   =   s u b s c r i b e ( e l   a s   H T M L E l e m e n t ) . u n s u b s c r i b e 
             } , 
             r e m o v e ( )   { 
                 u n s u n s c r i b e ( ) 
             } 
         } 
     } 
 } ) 
 
 c o n s t   a t t a c h m e n t P l a c e h o l d e r s   =   n e w   W e a k M a p < A t t a c h m e n t ,   s t r i n g > ( ) 
 
 / * * 
   *   C a c h e s   t h e   a t t a c h m e n t ' s   p l a c e h o l d e r   t e x t   a s   i t   w a s   i n s e r t e d   i n t o   t h e   ` < t e x t a r e a > `   e l e m e n t . 
   *   T h i s   i s   i n t e n d e d   t o   m a k e   r e m o v i n g   t h e   p l a c e h o l d e r   l a t e r   e a s i e r .   T h e   s o l e   r e a s o n   w e ' r e   d o i n g   a l l 
   *   o f   t h i s   i s   b e c a u s e   ` i n s e r t T e x t `   s o m e t i m e s   a d d s   a   ` \ n `   b e f o r e   t h e   i n s e r t e d   t e x t ,   a n d   s o m e t i m e s   d o e s n ' t . 
   *   R a t h e r   t h a n   a d d i n g   m o r e   l o g i c   t o   f i g u r e   o u t   w h a t   h a p p e n e d ,   w e   m e m o i z e   t h e   r e s u l t . 
   * 
   *   T h i s   i s   e x p o r t e d   s o   w e   c a n   u s e   i t   i n   t e s t i n g 
   * / 
 e x p o r t   f u n c t i o n   c a c h e P l a c e h o l d e r ( a t t a c h m e n t :   A t t a c h m e n t ,   p l a c e h o l d e r :   s t r i n g )   { 
     a t t a c h m e n t P l a c e h o l d e r s . s e t ( a t t a c h m e n t ,   p l a c e h o l d e r ) 
 } 
 
 / * * 
   *     G e t s   t h e   c a c h e d   p l a c e h o l d e r   f o r   t h e   a t t a c h m e n t .   F a l l s   b a c k   t o   c a l c u l a t i n g   t h e   r e p l a c e m e n t   t e x t 
   *     i f   t h e r e   i s   n o   e n t r y .   T h e   w o r s t   c a s e   o u t c o m e   h e r e   i s   t h a t   w e   l e a v e   a n   e x t r a   n e w l i n e   c h a r a c t e r 
   *     i n   t h e   t e x t a r e a . 
   * 
   *     T h i s   f u n c t i o n   i s   o n l y   e x p o r t e d   f o r   t e s t i n g   p u r p o s e s 
   * / 
 e x p o r t   f u n c t i o n   g e t P l a c e h o l d e r ( a t t a c h m e n t :   A t t a c h m e n t ) :   s t r i n g   { 
     r e t u r n   a t t a c h m e n t P l a c e h o l d e r s . g e t ( a t t a c h m e n t )   | |   r e p l a c e m e n t T e x t ( a t t a c h m e n t ) 
 } 
 
 / /   B a s e d   o f f   ` i s I m a g e `   f r o m   @ g i t h u b / f i l e - a t t a c h m e n t - e l e m e n t 
 / /   E v e n t u a l l y ,   w e   s h o u l d   u p s t r e a m   t h i s 
 f u n c t i o n   i s V i d e o ( a t t a c h m e n t :   A t t a c h m e n t ) :   b o o l e a n   { 
     r e t u r n   [ ' v i d e o / m p 4 ' ,   ' v i d e o / q u i c k t i m e ' ] . i n c l u d e s ( a t t a c h m e n t . f i l e . t y p e ) 
 } 
 
 f u n c t i o n   p a r a m e t e r i z e N a m e ( n a m e :   s t r i n g ) :   s t r i n g   { 
     r e t u r n   n a m e 
         . r e p l a c e ( / [ [ \ ] \ \ " < > & ] / g ,   ' . ' )   / /   C o n v e r t   u n w a n t e d   c h a r s   t o   s e p a r a t o r 
         . r e p l a c e ( / \ . { 2 , } / g ,   ' . ' )   / /   N o   m o r e   t h a n   1   s e p a r a t o r   i n   a   r o w 
         . r e p l a c e ( / ^ \ . | \ . $ / g i ,   ' ' )   / /   R e m o v e   l e a d i n g / t r a i l i n g   s e p a r a t o r 
 } 
 
 / /   R e t u r n s   a n   u p l o a d i n g   s t a t u s   m e s s a g e   w h i l e   t h e   f i l e   i s   u p l o a d i n g .   T h e 
 / /   p l a c e h o l d e r   w i l l   b e   r e p l a c e d   w i t h   a   U R L   t o   t h e   i m a g e   o n c e   t h e   u p l o a d 
 / /   i s   c o m p l e t e . 
 f u n c t i o n   p l a c e h o l d e r T e x t ( a t t a c h m e n t :   A t t a c h m e n t ) :   s t r i n g   { 
     / /   V i d e o   u p l o a d s   d o   n o t   i n c l u d e   b r a c e s   a r o u n d   t h e   t e x t 
     i f   ( i s V i d e o ( a t t a c h m e n t ) )   r e t u r n   ` \ n U p l o a d i n g   $ { a t t a c h m e n t . f i l e . n a m e } & \ n ` 
 
     c o n s t   p r e f i x   =   a t t a c h m e n t . i s I m a g e ( )   ?   ' ! '   :   ' ' 
     r e t u r n   ` $ { p r e f i x } [ U p l o a d i n g   $ { a t t a c h m e n t . f i l e . n a m e } & ] ( ) ` 
 } 
 
 / /   S t r i p s   n o n - w o r d   c h a r a c t e r s   f r o m   a   f i l e   n a m e   s o   i t ' s   s a f e   t o   u s e   i n   a 
 / /   m a r k d o w n   i m a g e   a l t   t a g   w i t h o u t   n e e d i n g   t o   b e   e s c a p e d . 
 f u n c t i o n   a l t T e x t ( n a m e :   s t r i n g ) :   s t r i n g   { 
     r e t u r n   p a r a m e t e r i z e N a m e ( n a m e ) 
         . r e p l a c e ( / \ . [ ^ . ] + $ / ,   ' ' )   / /   S t r i p   f i l e   e x t e n s i o n 
         . r e p l a c e ( / \ . / g ,   '   ' )   / /   B r i n g   b a c k   s o m e   w h i t e   s p a c e 
 } 
 
 c o n s t   R E T I N A _ P P I   =   7 2   *   2 
 
 f u n c t i o n   d i s a b l e S u b m i t ( e v e n t :   C u s t o m E v e n t   &   { c u r r e n t T a r g e t :   E l e m e n t } )   { 
     c o n s t   c l o s e s t F o r m   =   ( e v e n t . t a r g e t   a s   H T M L E l e m e n t ) . c l o s e s t ( ' f o r m ' ) ! 
     c o n s t   s u b m i t B u t t o n   =   c l o s e s t F o r m . q u e r y S e l e c t o r < H T M L B u t t o n E l e m e n t > ( ' . b t n - p r i m a r y ' ) ! 
     s u b m i t B u t t o n . d i s a b l e d   =   t r u e 
 } 
 
 f u n c t i o n   e n a b l e S u b m i t ( e v e n t :   C u s t o m E v e n t   &   { c u r r e n t T a r g e t :   E l e m e n t } )   { 
     c o n s t   c l o s e s t F o r m   =   ( e v e n t . t a r g e t   a s   H T M L E l e m e n t ) . c l o s e s t ( ' f o r m ' ) ! 
     c o n s t   s u b m i t B u t t o n   =   c l o s e s t F o r m . q u e r y S e l e c t o r < H T M L B u t t o n E l e m e n t > ( ' . b t n - p r i m a r y ' ) ! 
     s u b m i t B u t t o n . d i s a b l e d   =   f a l s e 
 } 
 
 t y p e   C u s t o m E v e n t P a y l o a d   =   C u s t o m E v e n t   &   { c u r r e n t T a r g e t :   E l e m e n t } 
 
 / * * 
   *   T h i s   f u n c t i o n   i s   o n l y   e x p o r t e d   t o   m a k e   a s y n c   t e s t i n g   e a s i e r 
   * / 
 e x p o r t   a s y n c   f u n c t i o n   o n U p l o a d C o m p l e t e d ( e v e n t :   C u s t o m E v e n t P a y l o a d )   { 
     c o n s t   { a t t a c h m e n t }   =   e v e n t . d e t a i l 
     c o n s t   t a r g e t   =   e v e n t . c u r r e n t T a r g e t 
     l e t   t a g T e x t 
     i f   ( a t t a c h m e n t . i s I m a g e ( ) )   { 
         t a g T e x t   =   a w a i t   i m a g e T a g ( a t t a c h m e n t ) 
     }   e l s e   i f   ( i s V i d e o ( a t t a c h m e n t ) )   { 
         t a g T e x t   =   v i d e o M a r k d o w n ( a t t a c h m e n t ) 
     }   e l s e   { 
         t a g T e x t   =   m d L i n k ( a t t a c h m e n t ) 
     } 
     / /   n o t e   a t   t h i s   p o i n t   e v e n t . c u r r e n t T a r g e t   i s   p o s s i b l y   n u l l 
     / /   s e e   h t t p s : / / d e v e l o p e r . m o z i l l a . o r g / e n - U S / d o c s / W e b / A P I / E v e n t / c u r r e n t T a r g e t 
     s e t V a l i d i t y A n d L i n k T e x t ( ' ' ,   t a g T e x t ,   e v e n t ,   t a r g e t ) 
 } 
 
 f u n c t i o n   m d L i n k ( a t t a c h m e n t :   A t t a c h m e n t ) :   s t r i n g   { 
     r e t u r n   ` [ $ { a t t a c h m e n t . f i l e . n a m e } ] ( $ { a t t a c h m e n t . h r e f } ) ` 
 } 
 
 f u n c t i o n   v i d e o M a r k d o w n ( a t t a c h m e n t :   A t t a c h m e n t ) :   s t r i n g   { 
     r e t u r n   ` \ n $ { a t t a c h m e n t . h r e f ! } \ n ` 
 } 
 
 a s y n c   f u n c t i o n   i m a g e T a g ( a t t a c h m e n t :   A t t a c h m e n t ) :   P r o m i s e < s t r i n g >   { 
     c o n s t   d i m e n s i o n s   =   a w a i t   i m a g e S i z e ( a t t a c h m e n t . f i l e ) 
     c o n s t   a l t   =   a l t T e x t ( a t t a c h m e n t . f i l e . n a m e ) 
     c o n s t   s r c   =   a t t a c h m e n t . h r e f 
     i f   ( d i m e n s i o n s . p p i   = = =   R E T I N A _ P P I )   { 
         c o n s t   w i d t h   =   M a t h . r o u n d ( d i m e n s i o n s . w i d t h   /   2 ) 
         / /   e s l i n t - d i s a b l e - n e x t - l i n e   g i t h u b / u n e s c a p e d - h t m l - l i t e r a l 
         r e t u r n   ` < i m g   w i d t h = " $ { w i d t h } "   a l t = " $ { a l t } "   s r c = " $ { s r c } " > ` 
     } 
     r e t u r n   ` ! [ $ { a l t } ] ( $ { s r c } ) ` 
 } 
 
 a s y n c   f u n c t i o n   i m a g e S i z e ( f i l e :   F i l e ) :   P r o m i s e < I m a g e D i m e n s i o n s >   { 
     c o n s t   e m p t y   =   { w i d t h :   0 ,   h e i g h t :   0 ,   p p i :   0 } 
     t r y   { 
         r e t u r n   ( a w a i t   i m a g e D i m e n s i o n s ( f i l e ) )   ? ?   e m p t y 
     }   c a t c h   { 
         r e t u r n   e m p t y 
     } 
 } 
 
 / * * 
   *   W h e n   s w a p p i n g   o u t   t h e   p l a c e h o l d e r   f o r   a n   i m a g e   o r   v i d e o ,   w e   n e e d 
   *   t o   r e m e m b e r   t o   g e t   t h e   e x t r a   l e a d i n g   n e w l i n e   f o r   v i d e o   u p l o a d s 
   * / 
 f u n c t i o n   r e p l a c e m e n t T e x t ( a t t a c h m e n t :   A t t a c h m e n t )   { 
     c o n s t   p l a c e h o l d e r   =   p l a c e h o l d e r T e x t ( a t t a c h m e n t ) 
     i f   ( i s V i d e o ( a t t a c h m e n t ) )   { 
         r e t u r n   ` \ n $ { p l a c e h o l d e r } \ n ` 
     }   e l s e   { 
         r e t u r n   ` $ { p l a c e h o l d e r } \ n ` 
     } 
 } 
 
 / * * 
   *   M a k e   t h e   t e x t a r e a   v a l i d   a n d   r e m o v e   t h e   p l a c e h o l d e r .   T h e   s u b m i t   b u t t o n   w i l l 
   *   g e t   e n a b l e d   o u t s i d e   t h i s   f u n c t i o n . 
   * / 
 f u n c t i o n   r e m o v e F a i l e d U p l o a d ( e v e n t :   C u s t o m E v e n t P a y l o a d )   { 
     c o n s t   f i e l d   =   e v e n t . c u r r e n t T a r g e t . q u e r y S e l e c t o r < H T M L T e x t A r e a E l e m e n t > ( ' . j s - c o m m e n t - f i e l d ' ) 
     c o n s t   t e x t T o R e m o v e   =   g e t P l a c e h o l d e r ( e v e n t . d e t a i l . a t t a c h m e n t ) 
     i f   ( f i e l d )   { 
         / /   R e g u l a r   e d i t o r 
         f i e l d . s e t C u s t o m V a l i d i t y ( ' ' ) 
         r e p l a c e T e x t ( f i e l d ,   t e x t T o R e m o v e ,   ' ' ) 
     }   e l s e   { 
         / /   C o d e M i r r o r   ( c o d e   e d i t o r ) 
         c o n s t   e d i t o r   =   g e t C o d e E d i t o r ( e v e n t . c u r r e n t T a r g e t . q u e r y S e l e c t o r < H T M L T e x t A r e a E l e m e n t > ( ' . j s - c o d e - e d i t o r ' ) ! ) ! . e d i t o r ! 
 
         c o n s t   c u r s o r   =   e d i t o r . g e t S e a r c h C u r s o r ( t e x t T o R e m o v e ) 
         c u r s o r . f i n d N e x t ( ) 
         c u r s o r . r e p l a c e ( ' ' ) 
     } 
 } 
 
 / * * 
   *     U p d a t e s   t e x t   i n s e r t e d   i n   e d i t o r   f o r   d r o p p e d   a s s e t s ,   b e   i t   a   r e g u l a r   e d i t o r 
   *     ( t e x t a r e a )   o r   a   c o d e   e d i t o r   ( C o d e M i r r o r )   e d i t i n g   a   M a r k d o w n   f i l e 
   * 
   *     I f   v a l i d i t y   i s   ' u p l o a d i n g ' ,   i n s e r t s   " [ U p l o a d i n g   a s s e t - n a m e ] ( . . . ) "   a t   c u r s o r , 
   *     o t h e r w i s e   r e p l a c e   t h a t   p l a c e h o l d e r   w i t h   h r e f 
   * 
   *     t a r g e t   i s   o n l y   r e q u i r e d   i f   e v e n t . c u r r e n t T a r g e t   i s   l o s t   ( e . g . ,   a f t e r   a w a i t ) 
   * / 
 
 f u n c t i o n   s e t V a l i d i t y A n d L i n k T e x t ( 
     v a l i d i t y :   ' u p l o a d i n g '   |   ' ' , 
     t a g T e x t :   s t r i n g , 
     e v e n t :   C u s t o m E v e n t P a y l o a d , 
     t a r g e t ? :   E v e n t T a r g e t   &   E l e m e n t 
 )   { 
     c o n s t   f i e l d   =   ( t a r g e t   | |   e v e n t . c u r r e n t T a r g e t ) . q u e r y S e l e c t o r < H T M L T e x t A r e a E l e m e n t > ( ' . j s - c o m m e n t - f i e l d ' ) ! 
     c o n s t   f i l e U p l o a d L o a d i n g T e x t   =   ( t a r g e t   | |   e v e n t . c u r r e n t T a r g e t ) . q u e r y S e l e c t o r < H T M L S p a n E l e m e n t > ( 
         ' . j s - f i l e - u p l o a d - l o a d i n g - t e x t ' 
     ) ! 
     c o n s t   p l a c e h o l d e r   =   p l a c e h o l d e r T e x t ( e v e n t . d e t a i l . a t t a c h m e n t ) 
     c o n s t   { b a t c h }   =   e v e n t . d e t a i l 
 
     i f   ( f i e l d )   { 
         c o n s t   s e l e c t e d T e x t   =   f i e l d . v a l u e . s u b s t r i n g ( f i e l d . s e l e c t i o n S t a r t ,   f i e l d . s e l e c t i o n E n d ) 
         / /   R e g u l a r   t e x t   e d i t o r 
         i f   ( v a l i d i t y   = = =   ' u p l o a d i n g ' )   { 
             l e t   i n s e r t e d P l a c e h o l d e r 
             i f   ( s e l e c t e d T e x t . l e n g t h )   { 
                 i n s e r t e d P l a c e h o l d e r   =   r e p l a c e S e l e c t i o n ( f i e l d ,   s e l e c t e d T e x t ,   p l a c e h o l d e r ) 
             }   e l s e   { 
                 i n s e r t e d P l a c e h o l d e r   =   i n s e r t T e x t ( f i e l d ,   p l a c e h o l d e r ,   { a p p e n d N e w l i n e :   t r u e } ) 
             } 
             / /   I f   t h i n g s   g o   w r o n g ,   t h e   m o s t   r e l i a b l e   w a y   w e   c a n   r e m o v e   t h e   p l a c e h o l d e r 
             / /   f o r   a n   a t t a c h m e n t   i s   t o   c a c h e   i t .     T h i s   i s   m o s t l y   s o   w e   d o n ' t   h a v e   t o 
             / /   t r y   t o   f i g u r e   o u t   i f   ` i n s e r t T e x t `   a d d e d   a   l e a d i n g   n e w l i n e   i n t o   t h e 
             / /   t e x t a r e a 
             a t t a c h m e n t P l a c e h o l d e r s . s e t ( e v e n t . d e t a i l . a t t a c h m e n t ,   i n s e r t e d P l a c e h o l d e r ) 
         }   e l s e   { 
             r e p l a c e T e x t ( f i e l d ,   p l a c e h o l d e r ,   t a g T e x t ) 
         } 
         b a t c h . i s F i n i s h e d ( )   ?   e n a b l e S u b m i t ( e v e n t )   :   d i s a b l e S u b m i t ( e v e n t ) 
     }   e l s e   { 
         / /   C o d e M i r r o r   ( c o d e   e d i t o r ) 
         c o n s t   e d i t o r   =   g e t C o d e E d i t o r ( 
             ( t a r g e t   | |   e v e n t . c u r r e n t T a r g e t ) . q u e r y S e l e c t o r < H T M L T e x t A r e a E l e m e n t > ( ' . j s - c o d e - e d i t o r ' ) ! 
         ) ! . e d i t o r ! 
 
         i f   ( v a l i d i t y   = = =   ' u p l o a d i n g ' )   { 
             i f   ( e d i t o r . g e t S e l e c t i o n ( ) . l e n g t h )   { 
                 / /   r e p l a c e   s e l e c t e d   t e x t   w i t h   p l a c e h o l d e r 
                 e d i t o r . r e p l a c e S e l e c t i o n ( p l a c e h o l d e r ) 
             }   e l s e   { 
                 / /   i n s e r t   p l a c e h o l d e r   a t   c u r s o r 
                 c o n s t   c u r s o r   =   e d i t o r . g e t C u r s o r ( ) 
                 c o n s t   t o R e p l a c e   =   r e p l a c e m e n t T e x t ( e v e n t . d e t a i l . a t t a c h m e n t ) 
                 e d i t o r . r e p l a c e R a n g e ( t o R e p l a c e ,   c u r s o r ) 
             } 
         }   e l s e   { 
             c o n s t   c u r s o r   =   e d i t o r . g e t S e a r c h C u r s o r ( p l a c e h o l d e r ) 
             c u r s o r . f i n d N e x t ( ) 
             c u r s o r . r e p l a c e ( t a g T e x t ) 
         } 
         b a t c h . i s F i n i s h e d ( )   ?   e n a b l e S u b m i t ( e v e n t )   :   d i s a b l e S u b m i t ( e v e n t ) 
     } 
     i f   ( f i l e U p l o a d L o a d i n g T e x t )   { 
         c o n s t   f i l e U p l o a d M e s s a g e   =   f i l e U p l o a d L o a d i n g T e x t . g e t A t t r i b u t e ( ' d a t a - f i l e - u p l o a d - m e s s a g e ' ) 
         f i l e U p l o a d L o a d i n g T e x t . t e x t C o n t e n t   =   ` $ { f i l e U p l o a d M e s s a g e }   ( $ { b a t c h . u p l o a d e d ( )   +   1 } / $ { b a t c h . s i z e } ) ` 
     } 
 } 
 
 o n ( ' u p l o a d : s e t u p ' ,   ' . j s - u p l o a d - m a r k d o w n - i m a g e ' ,   f u n c t i o n   ( e v e n t )   { 
     s e t V a l i d i t y A n d L i n k T e x t ( ' u p l o a d i n g ' ,   ' ' ,   e v e n t ) 
 } ) 
 
 o n ( ' u p l o a d : c o m p l e t e ' ,   ' . j s - u p l o a d - m a r k d o w n - i m a g e ' ,   o n U p l o a d C o m p l e t e d ) 
 
 o n ( ' u p l o a d : e r r o r ' ,   ' . j s - u p l o a d - m a r k d o w n - i m a g e ' ,   f u n c t i o n   ( e v e n t )   { 
     r e m o v e F a i l e d U p l o a d ( e v e n t ) 
     c o n s t   { b a t c h }   =   e v e n t . d e t a i l 
     b a t c h . i s F i n i s h e d ( )   ?   e n a b l e S u b m i t ( e v e n t )   :   d i s a b l e S u b m i t ( e v e n t ) 
 } ) 
 
 f u n c t i o n   u p d a t e C u r s o r ( e v e n t :   D r a g E v e n t )   { 
     / /   T h e   f i l e - a t t a c h m e n t - e l e m e n t   b u b b l e s   u p   d r a g o v e r   a n d   d r a g e n t e r   e v e n t s   a f t e r   p r e v e n t i n g   t h e i r   d e f a u l t 
     / /   b e h a v i o r .   W e   w a n t   t o   m a n u a l l y   p o s i t i o n   t h e   c u r s o r   i n   t h e   t e x t a r e a   s o   t h a t   i t   r e f l e c t s   w h e r e   t h e   u s e r 
     / /   w i l l   d r o p   t h e   f i l e . 
     e v e n t . s t o p P r o p a g a t i o n ( ) 
 
     c o n s t   a t t a c h m e n t E l e m e n t   =   e v e n t . c u r r e n t T a r g e t   a s   H T M L E l e m e n t 
 
     i f   ( ! a t t a c h m e n t E l e m e n t )   r e t u r n 
 
     c o n s t   t e x t A r e a   =   a t t a c h m e n t E l e m e n t . q u e r y S e l e c t o r < H T M L T e x t A r e a E l e m e n t > ( ' . j s - c o m m e n t - f i e l d ' ) 
     i f   ( t e x t A r e a )   { 
         u p d a t e C a r e t ( t e x t A r e a ,   e v e n t ) 
     }   e l s e   { 
         c o n s t   e d i t o r   =   g e t C o d e E d i t o r ( a t t a c h m e n t E l e m e n t . q u e r y S e l e c t o r < H T M L T e x t A r e a E l e m e n t > ( ' . j s - c o d e - e d i t o r ' ) ! ) ? . e d i t o r 
         i f   ( e d i t o r )   { 
             c o n s t   c   =   e d i t o r . c o o r d s C h a r ( { l e f t :   e v e n t . p a g e X ,   t o p :   e v e n t . p a g e Y } ) 
             e d i t o r . s e t C u r s o r ( c ) 
         } 
     } 
 } 
 
 / * * 
   *   T h i s   f u n c t i o n   i s n ' t   u s e d   i n   p r o d u c t i o n ,   i t ' s   o n l y   f o r   k e e p i n g   a   f a s t   f e e d b a c k   l o o o p   i n   d e v / t r o u b l e s h o o t i n g . 
   *   T o   u s e   i n   d e v   m o d e ,   a d d 
   *   ` ` ` 
   *   o n ( ' c l i c k ' ,   ' t e x t a r e a ' ,   d e b u g U p d a t e C a r e t ) 
   *   ` ` ` 
   *   t o   t h i s   f i l e   a n d   u n c o m m e n t   t h e   ` c o n s o l e . l o g ` 
   * / 
 / /   e s l i n t - d i s a b l e - n e x t - l i n e   @ t y p e s c r i p t - e s l i n t / n o - u n u s e d - v a r s 
 c o n s t   d e b u g U p d a t e C a r e t   =   ( e v e n t :   M o u s e E v e n t )   = >   { 
     c o n s t   t e x t A r e a   =   e v e n t . c u r r e n t T a r g e t   a s   H T M L T e x t A r e a E l e m e n t 
     c o n s t   r e c t   =   t e x t A r e a . g e t B o u n d i n g C l i e n t R e c t ( ) 
     c o n s t   x   =   e v e n t . c l i e n t X   -   r e c t . l e f t 
     c o n s t   y   =   e v e n t . c l i e n t Y   -   r e c t . t o p   +   t e x t A r e a . s c r o l l T o p 
     / /   e s l i n t - d i s a b l e - n e x t - l i n e   n o - c o n s o l e 
     c o n s o l e . l o g ( { 
         x , 
         y , 
         c u r s o r :   t e x t A r e a . s e l e c t i o n S t a r t , 
         t :   t e x t A r e a . v a l u e . s u b s t r i n g ( t e x t A r e a . s e l e c t i o n S t a r t   -   1 0 ,   t e x t A r e a . s e l e c t i o n S t a r t ) 
     } ) 
     c o n s t   d   =   n e w   D r a g E v e n t ( ' d r a g e n t e r ' ,   { c l i e n t X :   e v e n t . c l i e n t X ,   c l i e n t Y :   e v e n t . c l i e n t Y } ) 
     u p d a t e C a r e t ( t e x t A r e a ,   d ) 
 } 
 
 o n ( ' d r a g e n t e r ' ,   ' f i l e - a t t a c h m e n t ' ,   u p d a t e C u r s o r ) 
 
 o n ( ' d r a g o v e r ' ,   ' f i l e - a t t a c h m e n t ' ,   u p d a t e C u r s o r ) 
 
 o n ( ' u p l o a d : i n v a l i d ' ,   ' . j s - u p l o a d - m a r k d o w n - i m a g e ' ,   f u n c t i o n   ( e v e n t )   { 
     r e m o v e F a i l e d U p l o a d ( e v e n t ) 
     c o n s t   { b a t c h }   =   e v e n t . d e t a i l 
     b a t c h . i s F i n i s h e d ( )   ?   e n a b l e S u b m i t ( e v e n t )   :   d i s a b l e S u b m i t ( e v e n t ) 
 } ) 
 "X// Commenting: Write and Preview tabs
//
// Markup
//
//     <form class="js-new-comment-form">
//       <div class="js-previewable-comment-form write-selected"
//           data-preview-url="/preview">
//
//         <ul>
//           <li><a href="#" class="js-write-tab selected">Write</a></li>
//           <li><a href="#" class="js-preview-tab">Preview</a></li>
//         </ul>
//
//         <textarea class="js-comment-field"></textarea>
//
//       </div>
//     </form>
//
// TODO: Everything should be using js- prefixed classes
// TODO: Remove all static copy

// eslint-disable-next-line no-restricted-imports
import {fire, on} from 'delegated-events'
import TabContainerElement from '@github/tab-container-element'
import memoize from '@github/memoize'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
import {onKey} from '../../onfocus'

// Finds the CSRF token value in a `js-data-preview-url-csrf` hidden input
// element in the preview div. If we don't find a token for the preview
// div, find the CSRF token value in the hidden `authenticity_token` form
// input to be used in the parent form submission (i.e. the form that this is
// previewing).
//
// Returns the CSRF token String.
function token(container: Element): string {
  const dataToken = container.querySelector('.js-data-preview-url-csrf')
  // eslint-disable-next-line github/authenticity-token
  const formTokenRef = container.closest<HTMLFormElement>('form')!.elements.namedItem('authenticity_token')
  if (dataToken instanceof HTMLInputElement) {
    return dataToken.value
  } else if (formTokenRef instanceof HTMLInputElement) {
    return formTokenRef.value
  } else {
    throw new Error('Comment preview authenticity token not found')
  }
}

// Bidirectionally switches between "Write" and "Preview" tabs.
function activateTab(tab: Element): HTMLElement {
  const container = tab.closest<HTMLElement>('.js-previewable-comment-form')!
  const isPreview = tab.classList.contains('js-preview-tab')
  if (isPreview) {
    const writeContent = container.querySelector<HTMLElement>('.js-write-bucket')!
    const previewBody = container.querySelector<HTMLElement>('.js-preview-body')!
    if (writeContent.clientHeight > 0) {
      previewBody.style.minHeight = `${writeContent.clientHeight}px`
    }
  }
  container.classList.toggle('preview-selected', isPreview)
  container.classList.toggle('write-selected', !isPreview)
  const currentSelectedTabs = container.querySelector<HTMLElement>(
    '.tabnav-tab.selected, .tabnav-tab[aria-selected="true"]'
  )!
  currentSelectedTabs.setAttribute('aria-selected', 'false')
  currentSelectedTabs.classList.remove('selected')
  tab.classList.add('selected')
  tab.setAttribute('aria-selected', 'true')
  const writeTab = container.querySelector<HTMLElement>('.js-write-tab')!
  if (isPreview) {
    // On Apple devices, the Meta (Cmd)+Shift plane is in lower case. So
    // Cmd+Shift+p is correct, while `Control+P` is also correct.
    writeTab.setAttribute('data-hotkey', 'Control+P,Meta+Shift+p')
  } else {
    writeTab.removeAttribute('data-hotkey')
  }
  return container
}

on('click', '.js-write-tab', function (event) {
  const target = event.currentTarget
  const commentForm = target.closest<HTMLElement>('.js-previewable-comment-form')!
  // <tab-container> changes are handled in the `tab-container-change` event handler
  if (commentForm instanceof TabContainerElement) {
    setTimeout(() => {
      commentForm.querySelector<HTMLElement>('.js-comment-field')!.focus()
    })
    return
  }

  const container = activateTab(target)
  fire(commentForm, 'preview:toggle:off')
  const pollForm = commentForm.querySelector('.js-discussion-poll-form-component')
  if (pollForm) {
    fire(pollForm, 'poll-preview:toggle:off')
  }
  setTimeout(() => {
    container.querySelector<HTMLElement>('.js-comment-field')!.focus()
  })
  const toolbar = commentForm.querySelector('markdown-toolbar')
  if (toolbar instanceof HTMLElement) {
    toolbar.hidden = false
  }
})

on('click', '.js-preview-tab', function (event) {
  const target = event.currentTarget
  const commentForm = target.closest<HTMLElement>('.js-previewable-comment-form')!
  // <tab-container> changes are handled in the `tab-container-change` event handler
  if (commentForm instanceof TabContainerElement) return

  const container = activateTab(target)
  fire(commentForm, 'preview:toggle:on')

  setTimeout(() => {
    renderPreview(container)
  })
  const toolbar = commentForm.querySelector('markdown-toolbar')
  if (toolbar instanceof HTMLElement) {
    toolbar.hidden = true
  }
  event.stopPropagation()
  event.preventDefault()
})

on('tab-container-change', '.js-previewable-comment-form', function (event) {
  const relatedTarget = event.detail.relatedTarget
  const isPreviewPanel = relatedTarget && relatedTarget.classList.contains('js-preview-panel')
  const container = event.currentTarget
  const writeTab = container.querySelector<HTMLElement>('.js-write-tab')!

  if (isPreviewPanel) {
    const writeContent = container.querySelector<HTMLElement>('.js-write-bucket')!
    const previewBody = container.querySelector<HTMLElement>('.js-preview-body')!
    const skipSizing = previewBody.hasAttribute('data-skip-sizing')

    if (!skipSizing && writeContent.clientHeight > 0) {
      previewBody.style.minHeight = `${writeContent.clientHeight}px`
    }

    writeTab.setAttribute('data-hotkey', 'Control+P,Meta+Shift+p')
    renderPreview(container)
    const toolbar = container.querySelector('markdown-toolbar')
    if (toolbar instanceof HTMLElement) {
      toolbar.hidden = true
    }
  } else {
    writeTab.removeAttribute('data-hotkey')
    const toolbar = container.querySelector('markdown-toolbar')
    if (toolbar instanceof HTMLElement) {
      toolbar.hidden = false
    }

    const pollForm = document.querySelector('.js-discussion-poll-form-component')
    if (pollForm) {
      fire(pollForm, 'poll-preview:toggle:off')
    }
  }

  container.classList.toggle('preview-selected', isPreviewPanel)
  container.classList.toggle('write-selected', !isPreviewPanel)
})

// Allow triggering preview rendering from outside code
// TODO Replace event with exported module function.
on('preview:render', '.js-previewable-comment-form', function (event) {
  const previewTab = (event.target as Element).querySelector<HTMLElement>('.js-preview-tab')!
  const container = activateTab(previewTab)
  setTimeout(() => {
    renderPreview(container)
    const toolbar = container.querySelector('markdown-toolbar')
    if (toolbar instanceof HTMLElement) {
      toolbar.hidden = true
    }
  })
})

function previewForm(container: Element): FormData {
  const text = container.querySelector<HTMLTextAreaElement>('.js-comment-field')!.value
  const path = container.querySelector<HTMLInputElement>('.js-path')?.value
  const lineNumber = container.querySelector<HTMLInputElement>('.js-line-number')?.value
  const startLineNumber = container.querySelector<HTMLInputElement>('.js-start-line-number')?.value
  const side = container.querySelector<HTMLInputElement>('.js-side')?.value
  const startSide = container.querySelector<HTMLInputElement>('.js-start-side')?.value
  const startCommitOid = container.querySelector<HTMLInputElement>('.js-start-commit-oid')?.value
  const endCommitOid = container.querySelector<HTMLInputElement>('.js-end-commit-oid')?.value
  const baseCommitOid = container.querySelector<HTMLInputElement>('.js-base-commit-oid')?.value
  const commentId = container.querySelector<HTMLInputElement>('.js-comment-id')?.value

  const form = new FormData()
  form.append('text', text)
  // eslint-disable-next-line github/authenticity-token
  form.append('authenticity_token', token(container))
  if (path) form.append('path', path)
  if (lineNumber) form.append('line_number', lineNumber)
  if (startLineNumber) form.append('start_line_number', startLineNumber)
  if (side) form.append('side', side)
  if (startSide) form.append('start_side', startSide)
  if (startCommitOid) form.append('start_commit_oid', startCommitOid)
  if (endCommitOid) form.append('end_commit_oid', endCommitOid)
  if (baseCommitOid) form.append('base_commit_oid', baseCommitOid)
  if (commentId) form.append('comment_id', commentId)
  return form
}

function fetchPreview(container: Element): Promise<string> {
  const url = container.getAttribute('data-preview-url')!
  const data = previewForm(container)
  fire(container, 'preview:setup', {data})
  return cachedFetch(url, data)
}

const cachedFetch = memoize(uncachedFetch, {hash})
let previousController: AbortController | null = null
async function uncachedFetch(url: string, body: FormData): Promise<string> {
  previousController?.abort()
  const {signal} = (previousController = new AbortController())
  const response = await fetch(url, {method: 'post', body, signal})
  if (!response.ok) throw new Error('something went wrong')
  return response.text()
}

function hash(url: string, body: FormData): string {
  const params = [...body.entries()].toString()
  return `${url}:${params}`
}

async function renderPreview(container: Element) {
  const commentBody = container.querySelector<HTMLElement>('.comment-body')!

  // eslint-disable-next-line github/unescaped-html-literal
  commentBody.innerHTML = '<p>Loading preview&hellip;</p>'
  try {
    const html = await fetchPreview(container)
    // eslint-disable-next-line github/unescaped-html-literal
    commentBody.innerHTML = html || '<p>Nothing to preview</p>'
    // Alert listeners that content has been fetched and written to the dom
    fire(container, 'preview:rendered')
  } catch (error) {
    if (error.name !== 'AbortError') {
      // eslint-disable-next-line github/unescaped-html-literal
      commentBody.innerHTML = '<p>Error rendering preview</p>'
    }
  }
}

observe('.js-preview-tab', function (tab) {
  tab.addEventListener('mouseenter', async () => {
    const container = tab.closest<HTMLElement>('.js-previewable-comment-form')!
    try {
      await fetchPreview(container)
    } catch (error) {
      // Ignore fetch errors on silent prefetch
    }
  })
})

onKey('keydown', '.js-comment-field', function (event: KeyboardEvent) {
  // TODO: Refactor to use data-hotkey
  /* eslint eslint-comments/no-use: off */
  /* eslint-disable no-restricted-syntax */
  const field = event.target as HTMLInputElement

  // On Apple devices, the Meta (Cmd)+Shift plane is in lower case. So
  // normalising the key toUpperCase is necessary
  if ((event.ctrlKey || event.metaKey) && event.shiftKey && event.key.toUpperCase() === 'P') {
    const container = field.closest<HTMLElement>('.js-previewable-comment-form')!
    if (container.classList.contains('write-selected')) {
      if (container instanceof TabContainerElement) {
        container.querySelector<HTMLElement>('.js-preview-tab')!.click()
      } else {
        // eslint-disable-next-line github/no-blur
        field.blur()
        container.dispatchEvent(
          new CustomEvent('preview:render', {
            bubbles: true,
            cancelable: false
          })
        )
      }
      event.preventDefault()
      event.stopImmediatePropagation()
    }
  }
  /* eslint-enable no-restricted-syntax */
})
"Å// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {onKey} from '../../onfocus'

// This regex matches a comment containing only "-1", "+1", ":-", ":-1", ":+", or ":+1"
const plusOneMarker = /^(\+1|-1|:\+1?|:-1?)$/

// Checks to see if a comment is a reaction like comment.
const isReactionLikeComment = (text: string): boolean => {
  let matched = false
  for (const line of text.split('\n')) {
    const l = line.trim()
    if (!l || l.startsWith('>')) continue
    // If a line has matched previously, but this one doesnt,
    // it means the line has more than just a reaction - so return false
    if (matched && plusOneMarker.test(l) === false) {
      return false
    }
    if (!matched && plusOneMarker.test(l)) {
      matched = true
    }
  }
  return matched
}

on('focusout', '#new_comment_field', function (event) {
  const newCommentTextField = event.currentTarget

  const suggestion = newCommentTextField.closest('.js-reaction-suggestion')
  if (suggestion) {
    clearReactionSuggestion(suggestion)
  }
})

on('focusin', '#new_comment_field', function (event) {
  toggleReactionSuggestion(event)
})

onKey('keyup', '#new_comment_field', function (event) {
  toggleReactionSuggestion(event)
})

// Toggle reaction suggestion.
function toggleReactionSuggestion(event: Event) {
  const eventTarget = event.target as HTMLTextAreaElement

  const text = eventTarget.value
  const reactionSuggestion = eventTarget.closest('.js-reaction-suggestion')

  if (!reactionSuggestion) {
    return
  }

  if (isReactionLikeComment(text)) {
    reactionSuggestion.classList.remove('hide-reaction-suggestion')
    reactionSuggestion.classList.add('reaction-suggestion')
    const suggestionText = reactionSuggestion.getAttribute('data-reaction-markup')!
    reactionSuggestion.setAttribute('data-reaction-suggestion-message', suggestionText)
  } else {
    clearReactionSuggestion(reactionSuggestion)
  }
}

// Clear reaction suggestion.
function clearReactionSuggestion(reactionSuggestion: Element) {
  reactionSuggestion.classList.remove('reaction-suggestion')
  reactionSuggestion.classList.add('hide-reaction-suggestion')
  reactionSuggestion.removeAttribute('data-reaction-suggestion-message')
}
"èimport {isShortcutAllowed} from './keyboard-shortcuts-helper'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

// Support 'c' key to open commits too
on('navigation:keydown', '.js-commits-list-item', function (event) {
  if (!isShortcutAllowed(event.detail.originalEvent)) return

  if (!(event.target instanceof Element)) return
  if (event.detail.hotkey === 'c') {
    event.target.querySelector<HTMLElement>('.js-navigation-open')!.click()
  }
})
"î	import {onInput} from '../onfocus'

onInput('.js-company-name-input', function (event) {
  const field = event.target as HTMLInputElement

  const form = field.form!

  const corpTOSLink = form.querySelector('.js-corp-tos-link')
  const regTOSLink = form.querySelector('.js-tos-link')

  if (regTOSLink) {
    // TODO Replace with hidden attribute so aria-hidden is not required.
    /* eslint-disable-next-line github/no-d-none */
    regTOSLink.classList.add('d-none')
    regTOSLink.setAttribute('aria-hidden', 'true')

    if (corpTOSLink) {
      // TODO Replace with hidden attribute so aria-hidden is not required.
      /* eslint-disable-next-line github/no-d-none */
      corpTOSLink.classList.remove('d-none')
      corpTOSLink.setAttribute('aria-hidden', 'false')
    }
  }

  const hints = form.querySelectorAll('.js-company-name-text')
  if (hints.length === 0) {
    return
  }

  for (const hint of hints) {
    if (field.value) {
      const hasWording = hint.hasAttribute('data-wording')

      if (hasWording) {
        const wording = hint.getAttribute('data-wording')!
        hint.textContent = ` ${wording} ${field.value}`
      } else {
        hint.textContent = field.value
      }
    } else {
      hint.textContent = ''
    }
  }
})
"Øimport {changeValue} from '../form'
// eslint-disable-next-line no-restricted-imports
import {fire} from 'delegated-events'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

// Update the TOS statement with company name
//   e.g. By clicking on "Create an organization" below, you are agreeing to the Terms of Service and the Privacy Policy on behalf of your company, GitHub, Inc.
observe('.js-company-owned:not(:checked)', {
  constructor: HTMLInputElement,
  add(el) {
    const form = el.form!
    const input = form.querySelector<HTMLInputElement>('.js-company-name-input')!
    const hint = document.querySelector<HTMLElement>('.js-company-name-text')!
    const corpTOSLink = document.querySelector<HTMLElement>('.js-corp-tos-link')!
    const regTOSLink = document.querySelector<HTMLElement>('.js-tos-link')!

    if (input) {
      if (el.getAttribute('data-optional')) {
        input.removeAttribute('required')
      }
      changeValue(input, '')
    }

    // TODO Replace with hidden attribute so aria-hidden is not required.
    /* eslint-disable-next-line github/no-d-none */
    regTOSLink.classList.remove('d-none')
    regTOSLink.setAttribute('aria-hidden', 'false')
    /* eslint-disable-next-line github/no-d-none */
    corpTOSLink.classList.add('d-none')
    corpTOSLink.setAttribute('aria-hidden', 'true')

    if (hint) {
      hint.textContent = ''
    }
  }
})

observe('.js-company-owned:checked', {
  constructor: HTMLInputElement,
  add(el) {
    const form = el.form!
    const input = form.querySelector('.js-company-name-input')

    if (input) {
      input.setAttribute('required', '')
      fire(input, 'focus')
      fire(input, 'input')
    }
  }
})

// Make the CorpTOS the default on the "Business Plus" AKA Business plan
// TODO Replace with delegated-events
observe('.js-company-owned-autoselect', {
  constructor: HTMLInputElement,
  add(field) {
    const planChoice = field

    function autoselect() {
      if (planChoice.checked && planChoice.form) {
        const corpTos = planChoice.form.querySelector<HTMLInputElement>('.js-company-owned')!
        changeValue(corpTos, true)
      }
    }

    planChoice.addEventListener('change', autoselect)
    autoselect()
  }
})
"Äimport {compose, fromEvent} from '../subscription'
import IncludeFragmentElement from '@github/include-fragment-element'
import hashChange from './hash-change'
import {loadDeferredContentByEvent} from './include-fragment'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

let currentlyOpenedDetailsDropdown: HTMLElement | null = null

document.addEventListener('keydown', function (event: KeyboardEvent) {
  // TODO: Refactor to use data-hotkey
  /* eslint eslint-comments/no-use: off */
  /* eslint-disable no-restricted-syntax */
  if (!event.defaultPrevented && event.key === 'Escape' && currentlyOpenedDetailsDropdown) {
    currentlyOpenedDetailsDropdown.removeAttribute('open')
  }
  /* eslint-enable no-restricted-syntax */
})

// Dismiss open <details> when activating <details> with keyboard.
observe('.js-dropdown-details', {
  subscribe: el => {
    return compose(fromEvent(el, 'toggle', closeCurrentDetailsDropdown), fromEvent(el, 'toggle', autofocus))
  }
})

function autofocus({currentTarget}: Event) {
  const target = currentTarget as HTMLElement
  if (target.hasAttribute('open')) {
    const element = target.querySelector<HTMLElement>('[autofocus]')
    if (element) element.focus()
  } else {
    const summary = target.querySelector<HTMLElement>('summary')
    if (summary) summary.focus()
  }
}

function closeCurrentDetailsDropdown({currentTarget}: Event) {
  const target = currentTarget as HTMLElement
  if (target.hasAttribute('open')) {
    if (currentlyOpenedDetailsDropdown && currentlyOpenedDetailsDropdown !== target) {
      currentlyOpenedDetailsDropdown.removeAttribute('open')
    }

    currentlyOpenedDetailsDropdown = target
  } else if (target === currentlyOpenedDetailsDropdown) {
    currentlyOpenedDetailsDropdown = null
  }
}

observe('[data-deferred-details-content-url]:not([data-details-no-preload-on-hover])', {
  subscribe: el => {
    const summary = el.querySelector<HTMLElement>('summary')!
    return fromEvent(summary, 'mouseenter', loadDeferredContentByEvent)
  }
})

observe('[data-deferred-details-content-url]', {
  subscribe: el => {
    return fromEvent(el, 'toggle', loadDeferredContentByEvent)
  }
})

// Additonal button trigger for <details id>
on('click', '[data-toggle-for]', function (event) {
  const id = event.currentTarget.getAttribute('data-toggle-for') || ''
  const details = document.getElementById(id)
  if (!details) return
  details.hasAttribute('open') ? details.removeAttribute('open') : details.setAttribute('open', 'open')
})

// Expand collapsed outdated diff if anchor points to it
//   /github/github/pull/123#discussion-diff-456
//   /github/github/pull/123#discussion-r345
hashChange(function ({target}) {
  if (!target || target.closest('summary')) return

  let node = target.parentElement
  while (node) {
    node = node.closest('details')
    if (node) {
      if (!node.hasAttribute('open')) {
        node.setAttribute('open', '')
      }
      node = node.parentElement
    }
  }
})

// The details dialog allows users to dismiss the dialog by clicking on the
// grayed-out background. This additional functionality prohibits dismissing
// the dialog in this way.
on('details-dialog-close', '[data-disable-dialog-dismiss]', function (event) {
  event.preventDefault()
})
"­4// eslint-disable-next-line no-restricted-imports
import {fire, on} from 'delegated-events'
import type IncludeFragmentElement from '@github/include-fragment-element'
import RemoteInputElement from '@github/remote-input-element'
import {fromEvent} from '../subscription'
import {microtask} from '../eventloop-tasks'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
import {onKey} from '../onfocus'

// Match deprecated .js-select-menu state classes.
observe('details.select-menu details-menu include-fragment', function (el) {
  const details = el.closest('details')
  if (!details) return
  el.addEventListener('loadstart', function () {
    details.classList.add('is-loading')
    details.classList.remove('has-error')
  })
  el.addEventListener('error', function () {
    details.classList.add('has-error')
  })
  el.addEventListener('loadend', function () {
    details.classList.remove('is-loading')
    const filter = details.querySelector('.js-filterable-field')
    if (filter) fire(filter, 'filterable:change')
  })
})

// Clear filter when menu closes.
observe('details details-menu .js-filterable-field', {
  constructor: HTMLInputElement,
  add(filter) {
    const details = filter.closest<HTMLElement>('details')!
    details.addEventListener('toggle', function () {
      if (!details.hasAttribute('open')) {
        filter.value = ''
        fire(filter, 'filterable:change')
      }
    })
  }
})

// Temporary fix for role=menu containing input
observe('details-menu[role=menu] [role=menu]', el => {
  const menu = el.closest('details-menu[role]')
  if (menu && menu !== el) menu.removeAttribute('role')
})

// Clear filter when menu closes.
observe('details details-menu remote-input input', {
  constructor: HTMLInputElement,
  add(filter) {
    const details = filter.closest<HTMLElement>('details')!
    details.addEventListener('toggle', function () {
      if (!details.hasAttribute('open')) {
        filter.value = ''
      }
    })
  }
})

// On form reset fire change on input so details-menu can apply state changes.
observe('form details-menu', menu => {
  const form = menu.closest<HTMLElement>('form')!
  form.addEventListener('reset', () => {
    setTimeout(() => resetMenus(form), 0)
  })
})

// Re-fires the `change` event for checked radios in a details-menu form.
function resetMenus(form: Element) {
  const inputs = form.querySelectorAll('details-menu [role=menuitemradio] input[type=radio]:checked')
  for (const input of inputs) {
    fire(input, 'change')
  }
}

/**
 * Auto trigger the first item on Enter when filterable field is focused.
 */
onKey('keypress', 'details-menu .js-filterable-field, details-menu filter-input input', (event: KeyboardEvent) => {
  // TODO: Refactor to use data-hotkey
  /* eslint eslint-comments/no-use: off */
  /* eslint-disable no-restricted-syntax */
  if (event.key === 'Enter') {
    const input = event.currentTarget
    const menu = (input as HTMLInputElement).closest<HTMLElement>('details-menu')!
    const firstItem = menu.querySelector('[role^="menuitem"]:not([hidden])')
    if (firstItem instanceof HTMLElement) firstItem.click()
    event.preventDefault()
  }
  /* eslint-enable no-restricted-syntax */
})

// Focus filterable field after selecting an item
on(
  'details-menu-selected',
  'details-menu',
  event => {
    const menu = event.currentTarget

    const filterableField = (menu as HTMLElement).querySelector('.js-filterable-field')
    if (filterableField instanceof HTMLInputElement && filterableField.value) filterableField.focus()
  },
  {capture: true}
)

// On selection, sync selectedItem.value to input[id=data-menu-input]
on(
  'details-menu-selected',
  '[data-menu-input]',
  event => {
    if (!(event.target instanceof Element)) return
    const id = event.target.getAttribute('data-menu-input')!
    const el = document.getElementById(id)
    if (!(el instanceof HTMLInputElement || el instanceof HTMLTextAreaElement)) return
    el.value = ((event as CustomEvent).detail.relatedTarget as HTMLButtonElement).value
  },
  {capture: true}
)

// Restore focus on the previously focused element after results have been updated
// Otherwise return focus to input
observe('details-menu remote-input', {
  constructor: RemoteInputElement,
  initialize(el) {
    const resultsContainer = document.getElementById(el.getAttribute('aria-owns') || '')
    if (!resultsContainer) return

    let activeElementId: string | null = null
    el.addEventListener('load', () => {
      if (document.activeElement && resultsContainer.contains(document.activeElement) && document.activeElement.id) {
        activeElementId = document.activeElement.id
      } else {
        activeElementId = null
      }
    })

    el.addEventListener('loadend', () => {
      if (activeElementId) {
        const focusEl =
          resultsContainer.querySelector(`#${activeElementId}`) || resultsContainer.querySelector('[role^="menu"]')
        if (focusEl instanceof HTMLElement) {
          focusEl.focus()
        } else if (el.input) {
          el.input.focus()
        }
      }
    })
  }
})

on(
  'details-menu-selected',
  'details-menu[data-menu-max-options]',
  event => {
    const max = +event.currentTarget.getAttribute('data-menu-max-options')!
    const checkedItems = event.currentTarget.querySelectorAll('[role="menuitemcheckbox"][aria-checked="true"]')
    const atLimit = max === checkedItems.length
    event.currentTarget.querySelector<HTMLElement>('[data-menu-max-options-warning]')!.hidden = !atLimit
    for (const item of event.currentTarget.querySelectorAll<HTMLInputElement>('[role="menuitemcheckbox"] input')) {
      item.disabled = atLimit && !item.checked
    }
  },
  {capture: true}
)

// Make js-select-menu & navigation behaviors work with detail select menus
observe('details > details-menu', {
  subscribe(el) {
    const details = el.closest<HTMLElement>('details')!
    return fromEvent(details, 'toggle', fireMenuToggleEvent)
  }
})

// Fire a menu:[de]activate[d] event depending on the state of the menu.
async function fireMenuToggleEvent({currentTarget}: Event) {
  const details = currentTarget as HTMLElement
  const isOpen = details.hasAttribute('open')
  fire(details, isOpen ? 'menu:activate' : 'menu:deactivate')
  await microtask()
  fire(details, isOpen ? 'menu:activated' : 'menu:deactivated')
}

observe('details > details-menu[preload]:not([src])', {
  subscribe(el) {
    return fromEvent(el.parentElement!, 'mouseover', function (event) {
      const menu = event.currentTarget as HTMLElement
      const loader = menu.querySelector<IncludeFragmentElement>('include-fragment[src]')
      loader?.load()
    })
  }
})
"Ë// Disable
//
// Disables clicked buttons with text in `data-disable-with`.
//
// `<input type=submit>` or `<button type=submit>`
//
// `data-disable-with` - Message to set `<input>` value or `<button>` innerHTML to.
//
//     <input type="submit" data-disable-with="Submitting...">

import {afterRemote} from '@github/remote-form'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

const originalText = new WeakMap()
const selector = ['input[type=submit][data-disable-with]', 'button[data-disable-with]'].join(', ')

// Get button text.
function getButtonText(el: Element) {
  if (el instanceof HTMLInputElement) {
    return el.value || 'Submit'
  } else {
    return el.innerHTML || ''
  }
}

// Sets a button text.
function setButtonText(el: Element, text: string) {
  if (el instanceof HTMLInputElement) {
    el.value = text
  } else {
    el.innerHTML = text
  }
}

on(
  'submit',
  'form',
  function (event) {
    for (const button of event.currentTarget.querySelectorAll(selector)) {
      originalText.set(button, getButtonText(button))
      const disabledText = button.getAttribute('data-disable-with')
      if (disabledText) {
        setButtonText(button, disabledText)
      }
      ;(button as HTMLInputElement | HTMLButtonElement).disabled = true
    }
  },
  {capture: true}
)

// Revert a form to it's previous state.
function revert(form: HTMLFormElement) {
  for (const button of form.querySelectorAll(selector)) {
    const text = originalText.get(button)
    if (text != null) {
      setButtonText(button, text)
      // Button doesn't have a `data-disable-invalid` property or form is valid
      if (!button.hasAttribute('data-disable-invalid') || form.checkValidity()) {
        // Enable the button
        ;(button as HTMLInputElement | HTMLButtonElement).disabled = false
      }
      originalText.delete(button)
    }
  }
}

// Enable controls when AJAX request finishes
on('deprecatedAjaxComplete', 'form', function ({currentTarget, target}) {
  if (currentTarget === target) {
    revert(currentTarget as HTMLFormElement)
  }
})

afterRemote(revert)
"Å// eslint-disable-next-line no-restricted-imports
import {fire} from 'delegated-events'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

// Entire document is drop target.
observe('.js-document-dropzone', {
  constructor: HTMLElement,
  add(el) {
    document.body.addEventListener('dragstart', onDragstart)
    document.body.addEventListener('dragend', onDragend)
    document.body.addEventListener('dragenter', onDragenter)
    document.body.addEventListener('dragover', onDragenter)
    document.body.addEventListener('dragleave', onBodyDragleave)
    el.addEventListener('drop', onDrop)
  },
  remove(el) {
    document.body.removeEventListener('dragstart', onDragstart)
    document.body.removeEventListener('dragend', onDragend)
    document.body.removeEventListener('dragenter', onDragenter)
    document.body.removeEventListener('dragover', onDragenter)
    document.body.removeEventListener('dragleave', onBodyDragleave)
    el.removeEventListener('drop', onDrop)
  }
})

function hasFile(transfer: DataTransfer): boolean {
  return Array.from(transfer.types).indexOf('Files') >= 0
}

let dragging: number | null = null

// Highlight textarea and change drop cursor. Ensure drop target styles
// are cleared after dragging back outside of window.
function onDragenter(event: DragEvent) {
  if (ignorePageElementDrag) return

  const target = event.currentTarget as Element

  if (dragging) {
    window.clearTimeout(dragging)
  }
  dragging = window.setTimeout(() => target.classList.remove('dragover'), 200)

  const transfer = event.dataTransfer
  if (!transfer || !hasFile(transfer)) return

  transfer.dropEffect = 'copy'
  target.classList.add('dragover')

  event.stopPropagation()
  event.preventDefault()
}

function onBodyDragleave(event: DragEvent) {
  // Ignore leave events from children to prevent flicker.
  if (!(event.target instanceof Element)) return
  if (event.target.classList.contains('js-document-dropzone')) {
    const currentTarget = event.currentTarget as Element
    currentTarget.classList.remove('dragover')
  }
}

function onDrop(event: DragEvent) {
  const container = event.currentTarget as Element

  container.classList.remove('dragover')
  document.body.classList.remove('dragover')

  const transfer = event.dataTransfer
  if (!transfer || !hasFile(transfer)) return

  fire(container, 'document:drop', {transfer})

  event.stopPropagation()
  event.preventDefault()
}

// Ignore image or link drags from within the page itself. Allow them to be
// dragged onto the desktop, but ignore any drops back onto the page.
let ignorePageElementDrag = false

function onDragstart() {
  ignorePageElementDrag = true
}

function onDragend() {
  ignorePageElementDrag = false
}
"½import {TemplateInstance} from '@github/template-parts'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

// Encrypt plain text with a public key.
async function encrypt(publicKey: Uint8Array, value: string): Promise<Uint8Array> {
  const encoder = new TextEncoder()
  const messageBytes = encoder.encode(value)
  const {seal} = await import('../tweetsodium')
  return seal(messageBytes, publicKey)
}

// Decode base64 data into a byte array.
function decode(encoded: string): Uint8Array {
  const bytes = atob(encoded)
    .split('')
    .map(x => x.charCodeAt(0))
  return Uint8Array.from(bytes)
}

// Encode a byte array as a base64 string.
function encode(bytes: Uint8Array): string {
  let str = ''
  for (const byte of bytes) {
    str += String.fromCharCode(byte)
  }
  return btoa(str)
}

on('submit', 'form.js-encrypt-submit', async function (event) {
  const form = event.currentTarget as HTMLFormElement

  if (event.defaultPrevented || !form.checkValidity()) return
  const plainText = form.elements.namedItem('secret_value') as HTMLTextAreaElement

  // Prevent serializing plain text value in form submission.
  plainText.disabled = true

  if (!plainText.value) return

  event.preventDefault()

  // Submit encrypted value in hidden input.
  const publicKey = decode(form.getAttribute('data-public-key')!)

  ;(form.elements.namedItem('encrypted_value') as HTMLInputElement).value = encode(
    await encrypt(publicKey, plainText.value)
  )

  form.submit()
})

// Submit multiple encrypted values in hidden inputs. If an unencrypted field is empty,
// its associated hidden encrypted field is disabled.
on('submit', 'form.js-encrypt-bulk-submit', submitBulk(true))

// Submit multiple encrypted values in hidden inputs. If an unencrypted field is empty,
// its associated hidden encrypted field is not disabled.
on('submit', 'form.js-encrypt-bulk-submit-enable-empty', submitBulk(false))

// Submit multiple encrypted values. If an unencrypted field is empty,
// its associated hidden encrypted field is enabled or disabled depending on "disableEmptyValues".
function submitBulk(disableEmptyValues: boolean) {
  return async function (event: Event) {
    const form = event.currentTarget as HTMLFormElement

    if (event.defaultPrevented || !form.checkValidity()) return

    // Submit encrypted value in hidden input.
    const publicKey = decode(form.getAttribute('data-public-key')!)

    event.preventDefault()
    for (const element of form.elements) {
      // Prevent serializing plain text value in form submission.
      const formElement = element as HTMLInputElement
      if (formElement.id.endsWith('secret')) {
        formElement.disabled = true

        if (formElement.required && !formElement.value) {
          const message = `${formElement.name} is invalid!`
          const template = document.querySelector<HTMLTemplateElement>('template.js-flash-template')!
          template.after(new TemplateInstance(template, {className: 'flash-error', message}))
          return
        }

        const encryptedValueElementName = `${formElement.name}_encrypted_value`
        if (!formElement.value) {
          ;(form.elements.namedItem(encryptedValueElementName) as HTMLInputElement).disabled = disableEmptyValues
          continue
        }

        ;(form.elements.namedItem(encryptedValueElementName) as HTMLInputElement).value = encode(
          await encrypt(publicKey, formElement.value)
        )
      }
    }
    form.submit()
  }
}
cú#/ /   F a v i c o n   m a n a g e r 
 / / 
 / /   M a n a g e s   l i g h t   a n d   d a r k   f a v i c o n   v a r i a t i o n s ,   a n d   h a n d l e s   s t a t u s , 
 / /   s h o w i n g   a   ',   c h e c k ,   o r   p e n d i n g   d o t   o v e r   d e p e n d i n g   o n   t h e   p a g e   s t a t u s 
 
 / /   e s l i n t - d i s a b l e - n e x t - l i n e   n o - r e s t r i c t e d - i m p o r t s 
 i m p o r t   { o b s e r v e }   f r o m   ' s e l e c t o r - o b s e r v e r ' 
 i m p o r t   { S O F T _ N A V _ S T A T E }   f r o m   ' . . / s o f t - n a v - h e l p e r s ' 
 
 l e t   o l d H r e f :   s t r i n g 
 
 f u n c t i o n   u p d a t e F a v i c o n ( n e w H r e f ? :   s t r i n g ,   c o l o r S c h e m e ? :   s t r i n g )   { 
     c o n s t   f a v i c o n   =   d o c u m e n t . q u e r y S e l e c t o r < H T M L L i n k E l e m e n t > ( ' . j s - s i t e - f a v i c o n [ t y p e = " i m a g e / s v g + x m l " ] ' ) 
     c o n s t   f a v i c o n F a l l b a c k   =   d o c u m e n t . q u e r y S e l e c t o r < H T M L L i n k E l e m e n t > ( ' . j s - s i t e - f a v i c o n [ t y p e = " i m a g e / p n g " ] ' ) 
 
     i f   ( ! c o l o r S c h e m e )   c o l o r S c h e m e   =   ' l i g h t ' 
     c o n s t   c o l o r S c h e m e S u f f i x   =   c o l o r S c h e m e   = = =   ' l i g h t '   ?   ' '   :   ' - d a r k ' 
 
     i f   ( f a v i c o n   & &   f a v i c o n F a l l b a c k )   { 
         i f   ( o l d H r e f   = =   n u l l )   { 
             o l d H r e f   =   f a v i c o n . h r e f 
         } 
 
         i f   ( n e w H r e f )   { 
             n e w H r e f   =   n e w H r e f . s u b s t r ( 0 ,   n e w H r e f . l a s t I n d e x O f ( ' . ' ) ) 
             n e w H r e f   =   ` $ { n e w H r e f } $ { c o l o r S c h e m e S u f f i x } . s v g ` 
             f a v i c o n . h r e f   =   n e w H r e f 
 
             c o n s t   n e w F a l l b a c k H r e f   =   f a v i c o n . h r e f . s u b s t r ( 0 ,   f a v i c o n . h r e f . l a s t I n d e x O f ( ' . ' ) ) 
             f a v i c o n F a l l b a c k . h r e f   =   ` $ { n e w F a l l b a c k H r e f } . p n g ` 
         }   e l s e   { 
             c o n s t   n   =   f a v i c o n . h r e f . i n d e x O f ( ' - d a r k . s v g ' ) 
             c o n s t   n e w F a v i c o n N a m e   =   f a v i c o n . h r e f . s u b s t r ( 0 ,   n   ! = =   - 1   ?   n   :   f a v i c o n . h r e f . l a s t I n d e x O f ( ' . ' ) ) 
 
             f a v i c o n . h r e f   =   ` $ { n e w F a v i c o n N a m e } $ { c o l o r S c h e m e S u f f i x } . s v g ` 
             f a v i c o n F a l l b a c k . h r e f   =   ` $ { n e w F a v i c o n N a m e } $ { c o l o r S c h e m e S u f f i x } . p n g ` 
         } 
     } 
 } 
 
 f u n c t i o n   p r e f e r s D a r k C o l o r S c h e m e ( )   { 
     r e t u r n   w i n d o w . m a t c h M e d i a   & &   w i n d o w . m a t c h M e d i a ( ' ( p r e f e r s - c o l o r - s c h e m e :   d a r k ) ' ) . m a t c h e s 
 } 
 
 f u n c t i o n   r e s e t I c o n ( )   { 
     i f   ( o l d H r e f   ! =   n u l l )   u p d a t e F a v i c o n ( o l d H r e f ,   p r e f e r s D a r k C o l o r S c h e m e ( )   ?   ' d a r k '   :   ' l i g h t ' ) 
 } 
 
 f u n c t i o n   u p d a t e D a r k F a v i c o n ( )   { 
     i f   ( p r e f e r s D a r k C o l o r S c h e m e ( ) )   { 
         u p d a t e F a v i c o n ( u n d e f i n e d ,   ' d a r k ' ) 
     } 
 } 
 
 o b s e r v e ( ' [ d a t a - f a v i c o n - o v e r r i d e ] ' ,   { 
     a d d ( e l )   { 
         c o n s t   h r e f   =   e l . g e t A t t r i b u t e ( ' d a t a - f a v i c o n - o v e r r i d e ' ) ! 
 
         / /   a l l o w   ` r e m o v e `   f o r   t h e   o l d   e l e m e n t   t o   f i r e   f i r s t 
         s e t T i m e o u t ( ( )   = >   u p d a t e F a v i c o n ( h r e f ,   p r e f e r s D a r k C o l o r S c h e m e ( )   ?   ' d a r k '   :   ' l i g h t ' ) ) 
     } , 
     r e m o v e ( )   { 
         r e s e t I c o n ( ) 
     } 
 } ) 
 
 u p d a t e D a r k F a v i c o n ( ) 
 
 d o c u m e n t . a d d E v e n t L i s t e n e r ( S O F T _ N A V _ S T A T E . S U C C E S S ,   u p d a t e D a r k F a v i c o n ) 
 
 w i n d o w . m a t c h M e d i a ( ' ( p r e f e r s - c o l o r - s c h e m e :   d a r k ) ' ) . a d d L i s t e n e r ( ( )   = >   { 
     u p d a t e F a v i c o n ( u n d e f i n e d ,   p r e f e r s D a r k C o l o r S c h e m e ( )   ?   ' d a r k '   :   ' l i g h t ' ) 
 } ) 
 "ß// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

observe('.js-feature-preview-indicator-container', container => {
  fetchFeaturePreviewIndicator(container)
})

type FeatureResponse = {
  show_indicator: boolean
}

// Load the indicator status and update any indicators on the page.
async function fetchFeaturePreviewIndicator(container: Element) {
  const url = container.getAttribute('data-feature-preview-indicator-src')!
  const show = await fetchIndicator(url)
  const indicators = container.querySelectorAll<HTMLElement>('.js-feature-preview-indicator')
  for (const indicator of indicators) {
    indicator.hidden = !show
  }
}

async function fetchIndicator(url: string): Promise<boolean> {
  try {
    const response = await fetch(url, {headers: {Accept: 'application/json'}})
    if (!response.ok) return false
    const json = (await response.json()) as FeatureResponse
    return json.show_indicator
  } catch {
    return false
  }
}
"È// eslint-disable-next-line no-restricted-imports
import {fire, on} from 'delegated-events'
import {dialog} from '../details-dialog'
import {fetchSafeDocumentFragment} from '../fetch'
import {remoteForm} from '@github/remote-form'
import {sendStats} from '../stats'

/*
  Opens the feature preview dialog to a given feature specified by it's slug

  <button data-feature-preview-trigger-url="<%= feature_previews_path(user_id: login, selected_slug: "my_feature") %>">
    Opt in to the feature preview for My Feature
  </button>

  You can react to a feature being enrolled/unenrolled by the user with these events:

  - `feature-preview-enroll:my_feature`
  - `feature-preview-unenroll:my_feature`

  e.g.

  document.addEventListener('feature-preview-enroll:my_feature', () => {
    optInButton.hidden = true
    optOutButton.hidden = false
  })

  document.addEventListener('feature-preview-unenroll:my_feature', () => {
    optInButton.hidden = false
    optOutButton.hidden = true
  })
*/

on('click', '[data-feature-preview-trigger-url]', async event => {
  const trigger = event.currentTarget
  const url = trigger.getAttribute('data-feature-preview-trigger-url')!

  const newDialog = await dialog({
    content: fetchSafeDocumentFragment(document, url),
    dialogClass: 'feature-preview-dialog'
  })

  const closeDetails = trigger.getAttribute('data-feature-preview-close-details')!
  const closeHmac = trigger.getAttribute('data-feature-preview-close-hmac')!

  newDialog.addEventListener('dialog:remove', () => {
    sendStats({hydroEventPayload: closeDetails, hydroEventHmac: closeHmac}, true)
  })

  const indicators = document.querySelectorAll<HTMLElement>('.js-feature-preview-indicator')
  for (const indicator of indicators) {
    indicator.hidden = true
  }
})

remoteForm('.js-feature-preview-unenroll', async (form, wants) => {
  await wants.text()
  const feature = form.querySelector<HTMLInputElement>('.js-feature-preview-slug')!.value
  fire(form, `feature-preview-unenroll:${feature}`)
})

remoteForm('.js-feature-preview-enroll', async (form, wants) => {
  await wants.text()
  const feature = form.querySelector<HTMLInputElement>('.js-feature-preview-slug')!.value
  fire(form, `feature-preview-enroll:${feature}`)
})
"ª#import type {Attachment} from '@github/file-attachment-element'
import {sendStats} from '../stats'

export type UploadError = {
  status: number
  body: string
}

// 204 No Content
type S3ResponseData = Record<string, unknown>

// 201 Created
type EnterpriseResponseData = {
  id: number
  href: string
}

type UploadResponseData = EnterpriseResponseData | S3ResponseData

type S3UploadPolicy = {
  asset_upload_url: string
  asset_upload_authenticity_token: string
  upload_authenticity_token: string
  upload_url: string
  form: Record<string, string>
  header: Record<string, string>
  same_origin: boolean
  asset: {
    id: number
    href: string
    name: string
  }
}

type EnterpriseUploadPolicy = {
  upload_authenticity_token: string
  upload_url: string
  form: {[key: string]: string}
  header: Record<string, string>
  same_origin: boolean
  asset: {
    name: string
  }
}

export type UploadPolicyData = S3UploadPolicy | EnterpriseUploadPolicy

export type AttachmentUploadDelegate = {
  attachmentUploadDidStart(attachment: Attachment, policy: UploadPolicyData): void
  attachmentUploadDidProgress(attachment: Attachment, percent: number): void
  attachmentUploadDidComplete(attachment: Attachment, policy: UploadPolicyData, data: UploadResponseData): void
  attachmentUploadDidError(attachment: Attachment, error: UploadError): void
}

export default class AttachmentUpload {
  attachment: Attachment
  policy: UploadPolicyData

  constructor(attachment: Attachment, policy: UploadPolicyData) {
    this.attachment = attachment
    this.policy = policy
  }

  async process(delegate: AttachmentUploadDelegate): Promise<void> {
    const startTime = window.performance.now()
    const headers = new Headers(this.policy.header || {})

    const xhr = new XMLHttpRequest()
    xhr.open('POST', this.policy.upload_url, true)

    for (const [key, value] of headers) {
      xhr.setRequestHeader(key, value)
    }

    xhr.onloadstart = () => {
      delegate.attachmentUploadDidStart(this.attachment, this.policy)
    }

    xhr.upload.onprogress = e => {
      if (e.lengthComputable) {
        const percent = Math.round((e.loaded / e.total) * 100)
        delegate.attachmentUploadDidProgress(this.attachment, percent)
      }
    }

    await send(xhr, uploadForm(this.attachment, this.policy))

    if (xhr.status === 204) {
      markComplete(this.policy)
      delegate.attachmentUploadDidComplete(this.attachment, this.policy, {})
    } else if (xhr.status === 201) {
      markComplete(this.policy)
      delegate.attachmentUploadDidComplete(this.attachment, this.policy, JSON.parse(xhr.responseText))
    } else {
      delegate.attachmentUploadDidError(this.attachment, {status: xhr.status, body: xhr.responseText})
    }

    const endTime = window.performance.now()
    const timeDiff = endTime - startTime
    const uploadTiming: PlatformBrowserPerformanceUploadTiming = {
      duration: timeDiff,
      size: this.attachment?.file?.size,
      fileType: this.attachment?.file?.type,
      success: xhr.status === 204 || xhr.status === 201
    }
    sendStats({uploadTiming}, true)
  }
}

function send(xhr: XMLHttpRequest, body: FormData): Promise<XMLHttpRequest> {
  return new Promise((resolve, reject) => {
    xhr.onload = () => resolve(xhr)
    xhr.onerror = reject
    xhr.send(body)
  })
}

function uploadForm(attachment: Attachment, policy: UploadPolicyData): FormData {
  const form = new FormData()
  if (policy.same_origin) {
    // eslint-disable-next-line github/authenticity-token
    form.append('authenticity_token', policy.upload_authenticity_token)
  }
  for (const key in policy.form) {
    form.append(key, policy.form[key])
  }
  form.append('file', attachment.file)
  return form
}

function markComplete(policy: UploadPolicyData) {
  /* eslint-disable-next-line @typescript-eslint/ban-ts-comment */
  // @ts-ignore
  const url = typeof policy.asset_upload_url === 'string' ? policy.asset_upload_url : null
  const token =
    /* eslint-disable-next-line @typescript-eslint/ban-ts-comment */
    // @ts-ignore
    typeof policy.asset_upload_authenticity_token == 'string' ? policy.asset_upload_authenticity_token : null

  if (!(url && token)) return

  const form = new FormData()
  // eslint-disable-next-line github/authenticity-token
  form.append('authenticity_token', token)

  fetch(url, {
    method: 'PUT',
    body: form,
    credentials: 'same-origin',
    headers: {
      Accept: 'application/json',
      'X-Requested-With': 'XMLHttpRequest'
    }
  })
}
"Ó>import type {Attachment, default as FileAttachmentElement} from '@github/file-attachment-element'
import type {AttachmentUploadDelegate, UploadError, UploadPolicyData} from './attachment-upload'

import AttachmentUpload from './attachment-upload'
import type Batch from './batch'
// eslint-disable-next-line no-restricted-imports
import {fire} from 'delegated-events'

export async function upload(batch: Batch, container: FileAttachmentElement) {
  const delegate = createDelegate(batch, container)
  for (const attachment of batch.attachments) {
    const policy = await validate(batch, attachment, container)
    if (!policy) return
    try {
      const uploader = new AttachmentUpload(attachment, policy)
      await uploader.process(delegate)
    } catch {
      fire(container, 'upload:error', {batch, attachment})
      resetState(container, 'is-failed')
      return
    }
  }
}

async function validate(batch: Batch, attachment: Attachment, container: Element): Promise<UploadPolicyData | null> {
  const form = policyForm(attachment, container)
  const preprocess: Array<Promise<unknown>> = []
  fire(container, 'upload:setup', {batch, attachment, form, preprocess})

  try {
    await Promise.all(preprocess)
    const response = await fetch(policyRequest(form, container))
    if (response.ok) {
      return await response.json()
    }
    fire(container, 'upload:invalid', {batch, attachment})
    const body = await response.text()
    const status = response.status
    const {state, messaging} = policyErrorState({status, body}, attachment.file)
    resetState(container, state, messaging)
  } catch {
    fire(container, 'upload:invalid', {batch, attachment})
    resetState(container, 'is-failed')
  }
  return null
}

function policyForm(attachment: Attachment, container: Element): FormData {
  const token = container.querySelector<HTMLInputElement>('.js-data-upload-policy-url-csrf')!.value
  const repoId = container.getAttribute('data-upload-repository-id')
  const subjectType = container.getAttribute('data-subject-type')
  const subject = container.getAttribute('data-subject-param')
  const file = attachment.file

  const form = new FormData()
  form.append('name', file.name)
  form.append('size', String(file.size))
  form.append('content_type', file.type)
  // eslint-disable-next-line github/authenticity-token
  form.append('authenticity_token', token)
  if (subjectType) form.append('subject_type', subjectType)
  if (subject) form.append('subject', subject)
  if (repoId) {
    form.append('repository_id', repoId)
  }
  if (attachment.directory) {
    form.append('directory', attachment.directory)
  }

  return form
}

function policyRequest(form: FormData, container: Element): Request {
  return new Request(container.getAttribute('data-upload-policy-url')!, {
    method: 'POST',
    body: form,
    credentials: 'same-origin',
    headers: {
      Accept: 'application/json',
      'X-Requested-With': 'XMLHttpRequest'
    }
  })
}

function createDelegate(batch: Batch, container: Element): AttachmentUploadDelegate {
  return {
    attachmentUploadDidStart(attachment, policy) {
      attachment.saving(0)
      resetState(container, 'is-uploading')
      fire(container, 'upload:start', {batch, attachment, policy})
    },
    attachmentUploadDidProgress(attachment, percent) {
      attachment.saving(percent)
      fire(container, 'upload:progress', {batch, attachment})
    },
    attachmentUploadDidComplete(attachment, policy, result) {
      attachment.saved(savedAttributes(result, policy))
      fire(container, 'upload:complete', {batch, attachment})
      if (batch.isFinished()) {
        resetState(container, 'is-default')
      }
    },
    attachmentUploadDidError(attachment, response) {
      fire(container, 'upload:error', {batch, attachment})
      const {state} = policyErrorState(response)
      resetState(container, state)
    }
  }
}

// Extracts the uploaded attachment's attributes that reference the stored
// file on the server. These can come from the upload response in the case of
// our Enterprise Alambic file server or from the initial policy creation,
// prior to file upload, in the case of Amazon S3 used by github.com.
function savedAttributes(
  /* eslint-disable-next-line @typescript-eslint/no-explicit-any */
  result: any,
  policy: UploadPolicyData
): {id: string | null; href: string | null; name: string | null} {
  const id =
    /* eslint-disable-next-line @typescript-eslint/ban-ts-comment */
    // @ts-ignore
    (result.id == null ? null : String(result.id)) || (policy.asset.id == null ? null : String(policy.asset.id))
  const href =
    (typeof result.href === 'string' ? result.href : null) ||
    /* eslint-disable-next-line @typescript-eslint/ban-ts-comment */
    // @ts-ignore
    (typeof policy.asset.href === 'string' ? policy.asset.href : null)
  return {id, href, name: policy.asset.name}
}

type PolicyErrorMessaging = {
  message: string
  target: string
}

type PolicyErrorState = {
  state: string
  messaging?: PolicyErrorMessaging
}

// Create a CSS class name that matches the errors coming from the policy
// POST. The /upload/policies/* resource returns a 422 response with a JSON
// body describing why the policy is invalid.
function policyErrorState(response: UploadError, file?: File): PolicyErrorState {
  // Amazon S3 error.
  if (response.status === 400) {
    return {state: 'is-bad-file'}
  }

  if (response.status !== 422) {
    return {state: 'is-failed'}
  }

  const hash = JSON.parse(response.body)

  // If we have the expected JSON response with errors key, try to find the right
  // error message. If there's a server-side error or user got logged out, we
  // won't have hash.errors, so skip this and return generic failure message.
  if (!hash || !hash.errors) {
    return {state: 'is-failed'}
  }

  for (const error of hash.errors) {
    switch (error.field) {
      case 'size': {
        const size = file ? file.size : null
        if (size != null && size === 0) {
          return {state: 'is-empty'}
        }
        return {
          state: 'is-too-big',
          messaging: {
            message: trimSizeErrorMessage(error.message),
            target: '.js-upload-too-big'
          }
        }
      }
      case 'file_count':
        return {state: 'is-too-many'}
      case 'width':
      case 'height':
        return {state: 'is-bad-dimensions'}
      case 'name':
        if (error.code === 'already_exists') {
          return {state: 'is-duplicate-filename'}
        }
        return {state: 'is-bad-file'}
      case 'content_type':
        return {state: 'is-bad-file'}
      case 'uploader_id':
        return {state: 'is-bad-permissions'}
      case 'repository_id':
        return {state: 'is-repository-required'}
      case 'format':
        return {state: 'is-bad-format'}
    }
  }
  return {state: 'is-failed'}
}

/**
Due to limitations on the server, size errors may be returned with the string
'size ' prepended on the error message we want from the server. If the message
starts with `size` then chop it off with its leading space and return the error
we want from the server.

Examples:

'size Yowza that's a big file' => 'Yowza that's a big file'
'Yowza that's a big file' => 'Yowza that's a big file'
 */
const trimSizeErrorMessage = (message: string) => {
  return message.startsWith('size') ? message.substring(5) : message
}

const possibleStates = [
  'is-default',
  'is-uploading',
  'is-bad-file',
  'is-duplicate-filename',
  'is-too-big',
  'is-too-many',
  'is-hidden-file',
  'is-failed',
  'is-bad-dimensions',
  'is-empty',
  'is-bad-permissions',
  'is-repository-required',
  'is-bad-format'
]

export function resetState(container: Element, state: string, messaging?: PolicyErrorMessaging) {
  if (messaging) {
    const {message, target} = messaging
    const el = container.querySelector(target)
    if (el) el.innerHTML = message
  }
  container.classList.remove(...possibleStates)
  container.classList.add(state)
}
"
import type {Attachment} from '@github/file-attachment-element'

// A collection of files to be uploaded together. A batch reports progress of
// the collection rather than each individual file.
export default class Batch {
  attachments: Attachment[]
  size: number
  total: number

  constructor(attachments: Attachment[]) {
    this.attachments = attachments

    // How many total files to upload.
    this.size = this.attachments.length

    // How many total bytes to upload.
    this.total = sum(this.attachments, a => a.file.size)
  }

  // The completion percentage of the batch as a whole.
  //
  // Returns a Number between 0 and 100.
  percent(): number {
    const bytes = (a: Attachment) => (a.file.size * a.percent) / 100
    const total = sum(this.attachments, bytes)
    return Math.round((total / this.total) * 100)
  }

  uploaded(): number {
    const value = (a: Attachment) => (a.isSaved() ? 1 : 0)
    return sum(this.attachments, value)
  }

  // The completion state of the batch.
  //
  // Returns true when all files have been uploaded.
  isFinished(): boolean {
    return this.attachments.every(attachment => attachment.isSaved())
  }
}

function sum<T>(items: T[], map: (item: T) => number): number {
  return items.reduce((total, item) => total + map(item), 0)
}
"ªimport {resetState, upload} from '../upload/batch-upload'
import Batch from '../upload/batch'
import type FileAttachmentElement from '@github/file-attachment-element'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

// Synchronize element state with primer styles. This should be replaced with CSS.
observe('file-attachment[hover]', {
  add(el) {
    el.classList.add('dragover')
  },
  remove(el) {
    el.classList.remove('dragover')
  }
})

// Cancel empty drops after filtering out hidden dot files.
on('file-attachment-accept', 'file-attachment', function (event) {
  const {attachments} = event.detail
  if (attachments.length === 0) {
    resetState(event.currentTarget, 'is-hidden-file')
    event.preventDefault()
  }
})

// Upload batched files after passing validation.
on('file-attachment-accepted', 'file-attachment', function (event) {
  // CodeEditor will hide this element if it wants to handle uploads
  const dragAndDropLabel = event.currentTarget.querySelector<HTMLElement>('.drag-and-drop')
  if (dragAndDropLabel && dragAndDropLabel.hidden) {
    return
  }

  const {attachments} = event.detail
  upload(new Batch(attachments), event.currentTarget as FileAttachmentElement)
})

let count = 0

observe('file-attachment', {
  add(el) {
    if (count++ === 0) {
      document.addEventListener('drop', onDocumentDrop)
      document.addEventListener('dragover', onDocumentDragover)
    }
    const form = el.closest('form')
    if (form) {
      form.addEventListener('reset', onFormReset)
    }
  },
  remove(el) {
    if (--count === 0) {
      document.removeEventListener('drop', onDocumentDrop)
      document.removeEventListener('dragover', onDocumentDragover)
    }

    const form = el.closest('form')
    if (form) {
      form.removeEventListener('reset', onFormReset)
    }
  }
})

function hasFile(transfer: DataTransfer): boolean {
  return Array.from(transfer.types).indexOf('Files') >= 0
}

// Ignores accidental drops that miss the textarea.
function onDocumentDrop(event: DragEvent) {
  const transfer = event.dataTransfer
  if (transfer && hasFile(transfer)) {
    event.preventDefault()
  }
}

// Prevent accidental drops until we're over a textarea.
function onDocumentDragover(event: DragEvent) {
  const transfer = event.dataTransfer
  if (transfer && hasFile(transfer)) {
    event.preventDefault()
  }
}

// Parent form has been reset. Reset uploadable state back to default.
function onFormReset({currentTarget}: Event) {
  const container = (currentTarget as Element).querySelector<HTMLElement>('file-attachment')!
  resetState(container, 'is-default')
}
"©
import FilterInputElement from '@github/filter-input-element'
import {announce} from '../aria-live'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

on('filter-input-updated', 'filter-input', event => {
  const input = (event.currentTarget as FilterInputElement).input
  if (!(document.activeElement && document.activeElement === input)) return
  const {count, total} = event.detail
  // eslint-disable-next-line i18n-text/no-en
  announce(`Found ${count} out of ${total} ${total === 1 ? 'item' : 'items'}`)
})

on(
  'toggle',
  'details',
  event => {
    // Wait for the next click to ensure that focus has left input
    setTimeout(() => resetFilter(event.target as Element), 0)
  },
  {capture: true}
)

on(
  'tab-container-changed',
  'tab-container',
  event => {
    if (!(event.target instanceof HTMLElement)) return
    const {relatedTarget: panel} = event.detail
    const filterInput = event.target.querySelector('filter-input')
    if (filterInput instanceof FilterInputElement) {
      filterInput.setAttribute('aria-owns', panel.id)
    }
  },
  {capture: true}
)

function resetFilter(target: Element) {
  const filterInput = target.querySelector<FilterInputElement>('filter-input')
  if (filterInput && !target.hasAttribute('open')) {
    filterInput.reset()
  }
}
"°type Predicate = (el: Element, query: string) => boolean | null
type Options = {limit?: number | null}

export function filterList(list: Element, query: string, isVisible: Predicate, options: Options = {}): number {
  const limit = options.limit ?? Infinity
  let visible = 0
  for (const item of list.children) {
    const show = isVisible(item, query)
    if (show == null) {
      // ignore
    } else if (show && visible < limit) {
      visible++
      toggle(item as HTMLElement, true)
    } else {
      toggle(item as HTMLElement, false)
    }
  }
  return visible
}

function toggle(el: HTMLElement, show: boolean) {
  el.style.display = show ? '' : 'none'
  el.hidden = !show
}
"Êimport type {TextScore} from './fuzzy-filter'
import {compare} from './fuzzy-filter'
import {filterSort} from './filter-sort'

const originalOrder = new WeakMap<Element, HTMLElement[]>()

interface FilterOptions {
  limit?: number | null
  sortKey: (item: HTMLElement) => TextScore | null | undefined
}

// Filters and sorts list element items against a text query. For use with lists that
// are already in the DOM, not with lists of results that are changed dynamically
// via ajax.
//
// Returns Number of visible items.
export function filterSortList(list: Element, string: string, options: FilterOptions): number {
  const query = string.toLowerCase()
  const limit = options.limit

  let allItems = originalOrder.get(list)
  const checkedInputBeforeFilter = list.querySelector('input[type="radio"]:checked')
  const children = Array.from(list.children)
  if (!allItems) {
    allItems = Array.from(list.children) as HTMLElement[]
    originalOrder.set(list, allItems)
  }
  for (const item of children) {
    list.removeChild(item)
    if (item instanceof HTMLElement) item.style.display = ''
  }

  const found = query ? filterSort(allItems, options.sortKey, compare) : allItems
  const limited = limit == null ? found : found.slice(0, limit)
  const visible = limited.length
  const results = document.createDocumentFragment()
  for (const item of limited) {
    results.appendChild(item)
  }

  // This ensures that checked input before and after filtering is the same one
  // See https://github.com/github/github/issues/88129#issuecomment-434839397
  let inputStateReset = false
  if (checkedInputBeforeFilter instanceof HTMLInputElement) {
    for (const checkedInput of results.querySelectorAll('input[type="radio"]:checked')) {
      if (checkedInput instanceof HTMLInputElement && checkedInput.value !== checkedInputBeforeFilter.value) {
        checkedInput.checked = false
        inputStateReset = true
      }
    }
  }

  list.appendChild(results)

  // Dispatch a change event after render for details-menu or any other code reacting to the input state
  if (checkedInputBeforeFilter && inputStateReset) {
    checkedInputBeforeFilter.dispatchEvent(new Event('change', {bubbles: true}))
  }

  // hide all dividers if query.length > 0
  const dividers = list.querySelectorAll('.js-divider')
  for (const divider of dividers) {
    /* eslint-disable-next-line github/no-d-none */
    divider.classList.toggle('d-none', Boolean(query && query.trim().length > 0))
  }

  return visible
}
"È`import verifySsoSession from './sso'

interface FilterOptions {
  limit?: number | null
}

// Only login, name & selected are attributes required on both server side and payload rendered elements.
// IE if we construct a user element from a .js-filterable-suggested-user HTMLElement.
interface User {
  id?: string
  type?: string
  login: string
  name: string
  selected: boolean
  disabled?: boolean
  element?: HTMLElement
  description?: string
  avatar?: string
  class?: string
  suggestion?: boolean
}

interface Data {
  suggestions: User[]
  users: User[]
}

interface TypeAheadData {
  lastSearchResult: Data
  lastSearchText?: string
  cachedSuggestions: User[]

  // Used to cache a user ID to a pre-existing rendered element (if they exist in multiple search results).
  // This is needed to persist their selected state across multiple searches.
  // Key is user.id (as a string) to the rendered element
  userResultCache: Map<string, HTMLElement>
}

// Used to abort any previous type-ahead request if not needed
let abortController = new AbortController()

const typeAheadCache = new WeakMap<Element, TypeAheadData>()
const cache = new WeakMap<Element, Data>()
const currentQueryForList = new WeakMap<Element, string>()

async function getData(
  list: Element,
  queryText: string,
  typeAhead: boolean,
  queryOnEmptyQueryString: boolean
): Promise<Data> {
  if (typeAhead && !typeAheadCache.has(list)) {
    initializeTypeAheadCache(list)
  }

  const data = await fetchQueryIfNeeded(list, queryText, typeAhead, queryOnEmptyQueryString)
  const hasPreRenderedData = list.hasAttribute('data-filterable-data-pre-rendered')

  if (hasPreRenderedData) {
    data.suggestions = getPreRenderedUsers(list, typeAhead)
  }

  return data
}

async function fetchQueryIfNeeded(
  list: Element,
  queryText: string,
  typeAhead: boolean,
  queryOnEmptyQueryString: boolean
): Promise<Data> {
  const url = new URL(list.getAttribute('data-filterable-src') || '', window.location.origin)
  if (url.pathname === '/') throw new Error('could not get data-filterable-src')

  if (typeAhead) {
    const typeAheadData = typeAheadCache.get(list)!
    const trimmedText = queryText.trim()
    if (typeAheadData.lastSearchText === trimmedText) return typeAheadData.lastSearchResult
    const isInitialLoad = typeAheadData.lastSearchText === undefined
    typeAheadData.lastSearchText = trimmedText

    const inputId = list.getAttribute('data-filterable-for') || ''
    const inputElement = document.getElementById(inputId)

    // Abort any old requests (if any)
    abortController.abort()
    if (trimmedText === '' && !queryOnEmptyQueryString) {
      typeAheadData.lastSearchResult = {suggestions: [], users: []}
    } else {
      // Abort controller needs to be re-created, there exists one per abort.
      abortController = new AbortController()
      const requestHeaders = {
        headers: {Accept: 'application/json', 'X-Requested-With': 'XMLHttpRequest'},
        signal: abortController.signal
      }

      const params = url.searchParams || new URLSearchParams()
      params.set('q', queryText)
      params.set('typeAhead', 'true')
      url.search = params.toString()

      if (!isInitialLoad) {
        inputElement?.classList.add('is-loading')
      }

      const response = await fetch(url.toString(), requestHeaders)
      typeAheadData.lastSearchResult = await response.json()
    }

    inputElement?.classList.remove('is-loading')
    return typeAheadData.lastSearchResult
  } else {
    const requestHeaders = {headers: {Accept: 'application/json', 'X-Requested-With': 'XMLHttpRequest'}}
    const response = await fetch(url.toString(), requestHeaders)
    return await response.json()
  }
}

// This function will try to find any server side rendered users through the tag `.js-filterable-suggested-user`
// If any are found, they will be added to the API returned data.
// This users are distinct from the 'suggestions' currently returned through the reviewers API call.
function getPreRenderedUsers(list: Element, typeAhead: boolean): User[] {
  const data = []
  // Add all server rendered users to the `suggestions` list (if any).
  const suggestedUsers = list.querySelectorAll<HTMLElement>('.js-filterable-suggested-user')

  // If the list has been refreshed, or first time loaded, this will be non-zero, and therefore we clear the array and re-add the new items
  if (suggestedUsers.length > 0) {
    // Read the server-side rendered elements that need to be added to suggestions.
    // This is a work-around to allow the server-side rendered elements to work with the filtering.
    for (const suggestedUser of list.querySelectorAll<HTMLElement>('.js-filterable-suggested-user')) {
      suggestedUser.classList.remove('js-filterable-suggested-user')

      // Deconstruct the element into a <User> object
      data.push({
        name: suggestedUser.querySelector('.js-description')!.textContent!,
        login: suggestedUser.querySelector('.js-username')!.textContent!,
        selected: suggestedUser.getAttribute('aria-checked') === 'true',
        element: suggestedUser,
        suggestion: true
      })
    }
  }

  // If the list has been refreshed, or first time loaded, this will be non-zero, and therefore we clear the array and re-add the new items
  if (typeAhead) {
    const typeAheadData = typeAheadCache.get(list)!
    if (suggestedUsers.length > 0) {
      typeAheadData.cachedSuggestions = data
      typeAheadData.userResultCache.clear()
    }

    return typeAheadData.cachedSuggestions
  }

  return data
}

function initializeTypeAheadCache(list: Element) {
  typeAheadCache.set(list, {
    lastSearchResult: {suggestions: [], users: []},
    cachedSuggestions: [],
    userResultCache: new Map<string, HTMLElement>()
  })
}

// This is like `substringFilterList`, but instead of filtering down direct
// children of a DOM element, obtain most data from a JSON payload and search
// within that instead, only generating actual DOM elements when they are
// "revealed" by matching the search term. Similarly, remove elements from the
// DOM when they don't match a search term and they're not selected.
//
// Also, because elements might already exist in the DOM because of their
// pre-selected state, merge those elements with the data coming from JSON.
export async function substringMemoryFilterList(
  list: Element,
  queryText: string,
  options: FilterOptions
): Promise<number> {
  currentQueryForList.set(list, queryText)

  await verifySsoSession()

  const showSuggestionsHeaderOnLoad = list.hasAttribute('data-filterable-show-suggestion-header')
  const typeAhead = list.hasAttribute('data-filterable-type-ahead')
  const queryOnEmptyQueryString = list.hasAttribute('data-filterable-type-ahead-query-on-empty')

  let data = cache.get(list)

  if (!data) {
    try {
      data = await getData(list, queryText, typeAhead, queryOnEmptyQueryString)
      if (!typeAhead) cache.set(list, data)
    } catch (error) {
      if (error.name === 'AbortError') {
        // A stale type-ahead request was aborted
        return -1
      } else {
        throw error
      }
    }
  }

  // This logic only exists when type-ahead is disabled
  if (!typeAhead && currentQueryForList.get(list) !== queryText) {
    return -1
  }

  const limit = options.limit
  const template = list.querySelector<HTMLTemplateElement>('template')!

  // an index of items already rendered into DOM due to being preselected
  const existingElements: {[key: string]: HTMLInputElement} = {}
  for (const existing of list.querySelectorAll<HTMLInputElement>('input[type=hidden]')) {
    existingElements[`${existing.name}${existing.value}`] = existing
  }

  // remove all non-selected items after the template element
  let cutoffPoint = template.nextElementSibling
  while (cutoffPoint) {
    const el = cutoffPoint
    cutoffPoint = el.nextElementSibling
    if (
      el instanceof HTMLElement &&
      (typeAhead || el.getAttribute('aria-checked') === 'true' || el.classList.contains('select-menu-divider'))
    ) {
      el.hidden = true
    } else {
      el.remove()
    }
  }

  let visible = 0

  const queryTextEmpty = queryText.trim() === ''
  const items = document.createDocumentFragment()
  const suggestionsDivider = list.querySelector<HTMLElement>('.js-divider-suggestions')
  const restDivider = list.querySelector<HTMLElement>('.js-divider-rest')
  const typeAheadData = typeAheadCache.get(list)

  function addItem(user: User) {
    const containsQueryText = `${user.login} ${user.name}`.toLowerCase().trim().includes(queryText)
    const matching = !(limit != null && visible >= limit) && containsQueryText
    const shouldGenerate = matching || user.selected || user.suggestion
    if (shouldGenerate) {
      const item = createReviewerItem(user, template, existingElements, typeAheadData)
      item.hidden = !matching
      if (matching) visible++
      items.appendChild(item)
    }
  }

  let anyVisibleNonSelectedSuggestions = false

  // We show suggestions header if we
  // 1) Actually have suggestions, or
  // 2) If we still want to show suggestions title (declared by the attribute), but don't ever have any suggestions
  // (ie data.suggestions is undefined), the criteria simply becomes whether or not there is any query text.
  if (suggestionsDivider && (data.suggestions?.length > 0 || (showSuggestionsHeaderOnLoad && data.users.length > 0))) {
    const suggestions = data.suggestions ?? []
    const selectedSuggestions = suggestions.filter(u => u.selected)
    const nonSelectedSuggestions = suggestions.filter(u => !u.selected)

    for (const u of selectedSuggestions) {
      addItem(u)
    }

    // Put the suggestions after the already assigned users
    items.appendChild(suggestionsDivider)
    const preSuggestionsVisibleCount = visible
    for (const u of nonSelectedSuggestions) {
      addItem(u)
    }
    anyVisibleNonSelectedSuggestions = visible > preSuggestionsVisibleCount

    suggestionsDivider.hidden = !anyVisibleNonSelectedSuggestions || (typeAhead && !queryTextEmpty)

    // Special case where we want to force show the suggestions header even without suggestions in the payload.
    if (showSuggestionsHeaderOnLoad && data.users.length > 0) {
      suggestionsDivider.hidden = !queryTextEmpty
    }
  }

  if (restDivider) {
    items.appendChild(restDivider)
  }

  const preUsersVisibleCount = visible
  for (const u of data.users) {
    addItem(u)
  }

  if (restDivider) {
    restDivider.hidden = preUsersVisibleCount === visible || !anyVisibleNonSelectedSuggestions
  }

  list.append(items)
  return visible
}

function createReviewerItem(
  user: User,
  template: HTMLTemplateElement,
  existingElements: Record<string, HTMLElement>,
  typeAheadData: TypeAheadData | undefined
): HTMLElement {
  if (user.element != null) {
    return user.element
  }

  if (typeAheadData?.userResultCache.has(user.id!)) {
    return typeAheadData.userResultCache.get(user.id!)!
  }

  const li = template.content.cloneNode(true) as HTMLElement
  const input = li.querySelector<HTMLInputElement>('input[type=checkbox], input[type=radio]')!

  if (user.type) {
    input.name = `reviewer_${user.type}_ids[]`
  }
  input.value = user.id!

  const inputKey = `${input.name}${user.id}`
  let selected = user.selected
  if (existingElements[inputKey]) {
    selected = true
    existingElements[inputKey].remove()
    delete existingElements[inputKey]
  }

  const item = li.querySelector<HTMLElement>('[role^=menuitem]')!
  if (selected) {
    item.setAttribute('aria-checked', 'true')
    input.checked = true
  }

  if (user.disabled) {
    item.setAttribute('aria-disabled', 'true')
  }

  const login = li.querySelector('.js-username')
  if (login) login.textContent = user.login
  const fullName = li.querySelector('.js-description')
  if (fullName) fullName.textContent = user.name
  const description = li.querySelector('.js-extended-description')
  if (description) {
    if (user.description) {
      description.textContent = user.description
    } else {
      description.remove()
    }
  }
  const avatar = li.querySelector<HTMLImageElement>('.js-avatar')!
  avatar.className = `${avatar.className} ${user.class}`
  avatar.src = user.avatar!

  user.element = item

  typeAheadData?.userResultCache.set(user.id!, item)

  return user.element
}
"7// Filterable Behavior
//
// Automatically filters and sorts a list of items against a text field.
//
// Markup
//
// * js-filterable-field  - Set on field to enable filtering.
// * data-filterable-for  - Set to ID of input field to bind too.
// * data-filterable-type - Filtering type. Either "prefix", "substring", or "fuzzy". Defaults to "prefix"
//
// <input id="file-filter-field" class="js-filterable-field" autocomplete="off">
//
// <ul data-filterable-for="file-filter-field" data-filterable-type="fuzzy">
//   <li>Foo</li>
//   <li>Bar</li>
//   <li>Baz</li>
// </ul>
//
//
// Events
//
// filterable:change
//
// * **Bubbles** Yes
// * **Cancelable** No
// * **Target** List container Element
// * **Context info**
//   * relatedTarget - Input field Element
//
// $('ul').on('filterable:change', function() {
//   console.log('order changed')
// })
//

import {addThrottledInputEventListener, removeThrottledInputEventListener} from '../throttled-input'
// eslint-disable-next-line no-restricted-imports
import {fire, on} from 'delegated-events'
import {announce} from '../aria-live'
import {filterList} from '../filter-list'
import {filterSortList} from '../filter-sort-list'
import {fuzzyScore} from '../fuzzy-filter'
import {microtask} from '../eventloop-tasks'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
import {substringMemoryFilterList} from '../substring-memory-filter-list'

observe('.js-filterable-field', {
  constructor: HTMLInputElement,
  initialize(field) {
    if (!field.autocomplete) {
      field.autocomplete = 'off'
    }

    // A null value will default to whatever is specified within `throttled-input.ts`
    const throttleWaitInMs = field.hasAttribute('type-ahead') ? 200 : null
    let value = field.value

    async function onInputChange(input: HTMLInputElement | HTMLTextAreaElement) {
      if (value === input.value) return
      value = input.value
      await microtask()
      fire(input, 'filterable:change')
    }

    async function onFocus() {
      value = field.value
      await microtask()
      fire(field, 'filterable:change')
    }

    return {
      add(el) {
        el.addEventListener('focus', onFocus)
        addThrottledInputEventListener(el, onInputChange, {wait: throttleWaitInMs})
        if (document.activeElement === el) onFocus()
      },
      remove(el) {
        el.removeEventListener('focus', onFocus)
        removeThrottledInputEventListener(el, onInputChange)
      }
    }
  }
})

// Trigger 'filterable:change' on an input after any
// direct val() calls
on('filterable:change', '.js-filterable-field', async function (event: Event) {
  const target = event.currentTarget as HTMLInputElement
  const queryString = target.value.trim().toLowerCase()
  const filterable = document.querySelectorAll(`[data-filterable-for="${target.id}"]`)
  for (const list of filterable) {
    const visible = await filter(list, queryString)
    if (visible === -1) return
    if (document.activeElement && target === document.activeElement) {
      announce(`${visible} results found.`)
    }

    list.dispatchEvent(
      new CustomEvent('filterable:change', {
        bubbles: true,
        cancelable: false,
        detail: {
          inputField: target
        }
      })
    )
  }
})

function defaultText(content: Element): string {
  return content.hasAttribute('data-filter-value')
    ? content.getAttribute('data-filter-value')!.toLowerCase().trim()
    : content.textContent!.toLowerCase().trim()
}

async function filter(list: Element, queryString: string): Promise<number> {
  const limit = parseInt(list.getAttribute('data-filterable-limit')!, 10) || null

  let visible = 0
  switch (list.getAttribute('data-filterable-type')) {
    case 'fuzzy': {
      const searchQuery = queryString.toLowerCase()
      const sortKey = (item: HTMLElement) => {
        const text = defaultText(item)
        const score = fuzzyScore(text, searchQuery)
        return score > 0 ? {score, text} : null
      }
      visible = filterSortList(list, queryString, {limit, sortKey})
      break
    }
    case 'substring':
      visible = filterList(list, queryString.toLowerCase(), substring, {limit})
      break
    case 'substring-memory':
      visible = await substringMemoryFilterList(list, queryString, {limit})
      break
    default:
      visible = filterList(list, queryString.toLowerCase(), prefix, {limit})
      break
  }

  list.classList.toggle('filterable-active', queryString.length > 0)
  list.classList.toggle('filterable-empty', visible === 0)

  return visible
}

function prefix(el: Element, queryString: string): boolean {
  return el.textContent!.toLowerCase().trim().startsWith(queryString)
}

// Does the text of the given element match the given query string?
//
// Note: you can add a `data-skip-substring-filter` attribute to exclude an
// element from substring filtering.
//
// Returns Boolean or null, if element cannot be filtered
function substring(el: Element, queryString: string): boolean | null {
  if (el.hasAttribute('data-skip-substring-filter')) return null
  if (el.classList.contains('select-menu-no-results')) return null
  const target = el.querySelector('[data-filterable-item-text]') || el
  return target.textContent!.toLowerCase().trim().includes(queryString)
}

// Toggle new create new item form when filter doesn't match any existing items
on('filterable:change', 'details-menu .select-menu-list', function (event) {
  const list = event.currentTarget
  const form = list.querySelector('.js-new-item-form')

  if (form) {
    toggleForm(list, form, event.detail.inputField.value)
  }
})

function toggleForm(list: Element, form: Element, filterText: string) {
  const show = filterText.length > 0 && !itemExists(list, filterText)
  list.classList.toggle('is-showing-new-item-form', show)

  if (!show) return

  form.querySelector<HTMLElement>('.js-new-item-name')!.textContent = filterText

  const item = form.querySelector('.js-new-item-value')
  if (item instanceof HTMLInputElement || item instanceof HTMLButtonElement) {
    item.value = filterText
  }
}

// Detect if filtered item is already present in the list.
//
// container  - filterable list element
// filterText - String value of filter field
//
// Returns true if item already exists, otherwise false.
function itemExists(container: Element, filterText: string): boolean {
  for (const item of container.querySelectorAll('[data-menu-button-text]')) {
    const text = (item as HTMLElement).textContent!.toLowerCase().trim()
    if (text === filterText.toLowerCase()) {
      return true
    }
  }
  return false
}

// Hoist empty class to parent for styling.
observe('tab-container .select-menu-list .filterable-empty, details-menu .select-menu-list .filterable-empty', {
  add(el) {
    const list = el.closest<HTMLElement>('.select-menu-list')!
    list.classList.add('filterable-empty')
  },
  remove(el) {
    const list = el.closest<HTMLElement>('.select-menu-list')!
    list.classList.remove('filterable-empty')
  }
})
"Ö/// *HACK*
//
// In Firefox label.focus() transfers focus to <input> even with tabindex
// attribute. This is a problem because <details-menu> relies on menuitem to be
// the activeElement. See: https://github.com/github/github/issues/123224
//
// This script ties in very closely with <details-menu>'s navigation logic.
// Tread with caution.
import {microtask} from '../eventloop-tasks'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {onKey} from '../onfocus'

const firefox = navigator.userAgent.match(/Firefox\/(\d+)/)

// This should be remove as the user count for Firefox > 76 grows
if (firefox && Number(firefox[1]) < 76) {
  // Rely on <input> as activeElement in Firefox instead of <label>
  observe('details-menu label[tabindex][role^="menuitem"]', el => {
    const input = el.querySelector('input')
    if (!input) return

    // Input needs to be displayed to be focused

    // .select-menu-item input { display: none; }
    const hiddenBySelectMenu = el.classList.contains('select-menu-item')
    // eslint-disable-next-line github/no-d-none
    const hiddenByDNone = input.classList.contains('d-none')
    const hidden = hiddenBySelectMenu || hiddenByDNone || input.hidden

    if (hiddenBySelectMenu) input.classList.add('d-block')
    // eslint-disable-next-line github/no-d-none
    if (hiddenByDNone) input.classList.remove('d-none')
    if (hidden) {
      input.classList.add('sr-only')
      input.hidden = false
    }

    el.removeAttribute('tabindex')
  })

  // Normally we rely on :focus for styling, but it doesn't happen on <label>
  // anymore. So instead:
  //
  // On focus/blur, toggle .navigation-focus to style label as focused
  //
  // eslint-disable-next-line delegated-events/global-on
  on(
    'focus',
    'details-menu label[role="menuitemradio"] input, details-menu label[role="menuitemcheckbox"] input',
    event => {
      const label = event.currentTarget.closest<HTMLElement>('label')!
      if (label.classList.contains('select-menu-item')) label.classList.add('navigation-focus')
      if (label.classList.contains('SelectMenu-item')) label.classList.add('hx_menuitem--focus')
      if (label.classList.contains('dropdown-item')) label.classList.add('hx_menuitem--focus')
      event.currentTarget.addEventListener(
        'blur',
        () => {
          if (label.classList.contains('select-menu-item')) label.classList.remove('navigation-focus')
          if (label.classList.contains('SelectMenu-item')) label.classList.remove('hx_menuitem--focus')
          if (label.classList.contains('dropdown-item')) label.classList.remove('hx_menuitem--focus')
        },
        {once: true}
      )
    },
    {capture: true}
  )

  // <details-menu> listens on ArrowDown/ArrowUp keydown events to navigate.
  // In Firefox it will always focus on the first/last item, because the
  // activeElement (<input>) is not a [role^=menuitem]. The workaround:
  //
  // On arrow keydown: before details-menu navigates, move [role] from <label>
  // to <input> so <details-menu> knows the current index.
  //
  // Unrelated to navigation- by default, pressing Enter while focusing on
  // <input> will submit the form. We don't want that here.
  //
  // On enter keydown: simulate click for activation and prevent default.
  onKey(
    'keydown',
    'details-menu label[role="menuitemradio"] input, details-menu label[role="menuitemcheckbox"] input',
    async function (event: KeyboardEvent) {
      // TODO: Refactor to use data-hotkey
      /* eslint eslint-comments/no-use: off */
      /* eslint-disable no-restricted-syntax */
      if (isArrowKeys(event)) {
        if (event.currentTarget instanceof Element) switchRoleToInputForNavigation(event.currentTarget)
      } else if (event.key === 'Enter') {
        const input = event.currentTarget
        event.preventDefault()
        await microtask()
        if (input instanceof HTMLInputElement) input.click()
      }
      /* eslint-enable no-restricted-syntax */
    }
  )

  // On blur: after <details-menu> moved focus away from current <input>, revert
  // role attribute back to <label>.
  //
  // eslint-disable-next-line delegated-events/global-on
  on(
    'blur',
    'details-menu label input[role="menuitemradio"], details-menu label input[role="menuitemcheckbox"]',
    event => {
      switchRoleBackToOriginalState(event.currentTarget)
    },
    {capture: true}
  )

  // On arrow keyup: if arrow keydown did not trigger blur (for example, when
  // there is only one item), revert [role] back to <label>.
  onKey(
    'keyup',
    'details-menu label[role="menuitemradio"] input, details-menu label[role="menuitemcheckbox"] input',
    event => {
      if (!isArrowKeys(event)) return
      if (event.currentTarget instanceof Element) switchRoleBackToOriginalState(event.currentTarget)
    }
  )
}

function isArrowKeys(event: KeyboardEvent): boolean {
  // TODO: Refactor to use data-hotkey
  /* eslint eslint-comments/no-use: off */
  /* eslint-disable no-restricted-syntax */
  return event.key === 'ArrowDown' || event.key === 'ArrowUp'
  /* eslint-enable no-restricted-syntax */
}

// From a nearby `<label>` tag, get the `data-role` and set it onto the input,
// removing the role from the label.
function switchRoleToInputForNavigation(input: Element) {
  const label = input.closest<HTMLElement>('label')!
  if (!label.hasAttribute('data-role')) label.setAttribute('data-role', label.getAttribute('role')!)
  input.setAttribute('role', label.getAttribute('data-role')!)
  label.removeAttribute('role')
}

// From a nearby `<label>` tag, get the `data-role` and the label to that
// data-role, removing the role from the input.
function switchRoleBackToOriginalState(input: Element) {
  const label = input.closest<HTMLElement>('label')!
  if (!label.hasAttribute('data-role')) label.setAttribute('data-role', label.getAttribute('role')!)
  label.setAttribute('role', label.getAttribute('data-role')!)
  input.removeAttribute('role')
}
"¢// Installs observer to account for sticky/fixed overlay offsets when navigating
// to a fragment.
import {computeFixedYOffset, scrollToFragmentTarget} from '../sticky-scroll-into-view'
import hashChange from './hash-change'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

function scrollTargetIntoViewIfNeeded() {
  const root = <HTMLHtmlElement>document.firstElementChild!
  if (root.classList.contains('js-skip-scroll-target-into-view')) return

  if (computeFixedYOffset(document)) {
    scrollToFragmentTarget(document)
  }
}

hashChange(scrollTargetIntoViewIfNeeded)

on('click', 'a[href^="#"]', function (event) {
  const {currentTarget} = event
  if (!(currentTarget instanceof HTMLAnchorElement)) return

  // this defers the execution of scrollTargetIntoViewIfNeeded until after all the click stuff happened, including after scroll
  setTimeout(scrollTargetIntoViewIfNeeded, 0)
})
"// Flash
//
// Fades out and removes flash element from the page on close.
//
// Markup
//
//     <div class="flash-messages">
//       <div class="flash">
//         <%= octicon('x', :class => 'flash-close js-flash-close') %>
//         Flash Message
//       </div>
//     </div>
//

// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

on('click', '.js-flash-close', function (event) {
  const container = event.currentTarget.closest('.flash-messages')

  const flash = event.currentTarget.closest('.flash')
  flash!.remove()

  if (container && !container.querySelector('.flash')) {
    container.remove()
  }
})
"import {deleteCookie, getCookies} from './cookies'
import {TemplateInstance} from '@github/template-parts'

const ALLOWED_FLASH_COOKIES = ['flash-notice', 'flash-error', 'flash-message', 'flash-warn']

// Find cookies named something like "flash-notice" and render the
// .js-flash-template template for them.
export function displayFlash(el: HTMLTemplateElement) {
  for (const {key, value} of ALLOWED_FLASH_COOKIES.flatMap(getCookies)) {
    deleteCookie(key)
    let message
    try {
      message = atob(decodeURIComponent(value))
    } catch {
      continue
    }
    el.after(new TemplateInstance(el, {className: key, message}))
  }
}
"÷import {displayFlash} from '../flash'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

observe('template.js-flash-template', {
  constructor: HTMLTemplateElement,
  add(el) {
    displayFlash(el)
  }
})
"// Delayed Focus Events
//
// Provides a family cancelable focus/blur that trigger slightly later.
// This makes it easier to build menus that only display when you are
// focused in on a field.
//
// Events
//
// `focusin:delay`
//
// Fired when field is being focused for the first time. Will not fire
// if field is blurred, and refocused in less than 200ms.
//
// * **Synchronicity** Sync
// * **Bubbles** Yes
// * **Cancelable** Yes
// * **Target** Element that is receiving focus.
//
// `focusout:delay`
//
// Fired when field has been blurred for the first time. Won't fire if
// the field is not refocused in under 200ms or the `focusout:delay` is
// canceled.
//
// * **Synchronicity** Sync
// * **Bubbles** Yes
// * **Cancelable** No
// * **Target** Element that is receiving focus.
//
// ```javascript
// on('focusin:delay', function() {
//   showAutocompletions()
// })
//
// on('focusout:delay', function() {
//   hideAutocompletions()
// })
// ```
//

// eslint-disable-next-line no-restricted-imports
import {fire} from 'delegated-events'

const focused = new WeakMap()

// We use the "focus" and "blur" event in the capture phase because Firefox
// historically had a limitation with "focusin" and "focusout" not bubbling.
document.addEventListener(
  'focus',
  function (event: Event) {
    const target = event.target
    if (target instanceof Element && !focused.get(target)) {
      fire(target, 'focusin:delay')
      focused.set(target, true)
    }
  },
  {capture: true}
)

document.addEventListener(
  'blur',
  function (event: Event) {
    setTimeout(function () {
      const target = event.target
      if (target instanceof Element && target !== document.activeElement) {
        fire(target, 'focusout:delay')
        focused.delete(target)
      }
    }, 200)
  },
  {capture: true}
)
"ìimport {remoteForm} from '@github/remote-form'

remoteForm('.js-form-toggle-target', async function (form, wants) {
  try {
    await wants.text()
  } catch {
    return
  }

  const container = form.closest<HTMLElement>('.js-form-toggle-container')!
  container.querySelector<HTMLElement>('.js-form-toggle-target[hidden]')!.hidden = false
  form.hidden = true
})
"öimport FuzzyListElement from '../fuzzy-list-element'
import {announce} from '../aria-live'
import {fromEvent} from '../subscription'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

function noticeHandler(event: Event) {
  if (!(event instanceof CustomEvent)) return
  announce(`${event.detail} results found.`)
}

observe('fuzzy-list', {
  constructor: FuzzyListElement,
  subscribe: fuzzyList => fromEvent(fuzzyList, 'fuzzy-list-sorted', noticeHandler)
})
"// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

// Behaviors related to special cases in GFM content
// Toggles quoted email reply content
on('click', '.email-hidden-toggle', function (event) {
  // assert nextElementSibling is .email-hidden-reply
  const replyContainer = event.currentTarget.nextElementSibling
  if (!(replyContainer instanceof HTMLElement)) return

  replyContainer.style.display = ''
  replyContainer.classList.toggle('expanded')

  event.preventDefault()
})
"öimport {addThrottledInputEventListener} from '../throttled-input'
import {fetchSafeDocumentFragment} from '../fetch'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {remoteForm} from '@github/remote-form'

// Toggle verify SSL visibility for https web hook URLs
observe('.js-hook-url-field', {
  constructor: HTMLInputElement,
  add(input) {
    function checkUrl() {
      const form = input.form
      if (!form) return
      let url
      try {
        // eslint-disable-next-line no-restricted-syntax
        url = new URL(input.value)
      } catch (e) {
        // Do nothing.
      }
      const invalidNotice = form.querySelector('.js-invalid-url-notice')
      if (invalidNotice instanceof HTMLElement) {
        invalidNotice.hidden = !!(input.value === '' || (url && /^https?:/.test(url.protocol)))
      }
      const insecureNotice = form.querySelector('.js-insecure-url-notice')
      if (insecureNotice instanceof HTMLElement && url && input.value) {
        insecureNotice.hidden = /^https:$/.test(url.protocol)
      }
      const sslFields = form.querySelector('.js-ssl-hook-fields')
      if (sslFields instanceof HTMLElement) {
        sslFields.hidden = !(url && 'https:' === url.protocol)
      }
    }

    addThrottledInputEventListener(input, checkUrl)
    checkUrl()
  }
})

function chooseEvents(selector: string): void {
  const events = document.querySelectorAll<HTMLInputElement>('.js-hook-event-checkbox')
  for (const eventCheckbox of events) {
    eventCheckbox.checked = eventCheckbox.matches(selector)
  }
}

on('change', '.js-hook-event-choice', function (event) {
  const checkbox = event.currentTarget as HTMLInputElement
  const customIsSelected = checkbox.checked && checkbox.value === 'custom'
  const hookEventsField = checkbox.closest('.js-hook-events-field')
  if (hookEventsField) hookEventsField.classList.toggle('is-custom', customIsSelected)

  if (checkbox.checked) {
    if (customIsSelected) {
      const hookWildcardEvent = document.querySelector<HTMLInputElement>('.js-hook-wildcard-event')!
      hookWildcardEvent.checked = false
    } else if (checkbox.value === 'push') {
      chooseEvents('[value="push"]')
    } else if (checkbox.value === 'all') {
      chooseEvents('.js-hook-wildcard-event')
    }
  }
})

// Load more delivery logs
on('click', '.js-hook-deliveries-pagination-button', async function (event) {
  const button = event.currentTarget as HTMLButtonElement
  button.disabled = true
  const wrapper = button.parentElement!

  const url = button.getAttribute('data-url')!
  wrapper.before(await fetchSafeDocumentFragment(document, url))
  wrapper.remove()
})

// Redeliver Payload Button
remoteForm('.js-redeliver-hook-form', async function (form, wants) {
  let response
  try {
    response = await wants.html()
  } catch (responseError) {
    form.classList.add('failed')
    return
  }

  // replace the whole deliveries index
  const deliveriesDetails = document.querySelector<HTMLElement>(`.js-hook-deliveries-container`)!
  deliveriesDetails.replaceWith(response.html)
})
"ë	// Hotkey Behavior
//
// See https://github.com/github/hotkey

import {areCharacterKeyShortcutsEnabled, isNonCharacterKeyShortcut} from './keyboard-shortcuts-helper'
import {install, uninstall} from '@github/hotkey'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

// Disable character key shortcuts based on user preference
observe('[data-hotkey]', {
  constructor: HTMLElement,
  add(element) {
    if (areCharacterKeyShortcutsEnabled()) {
      install(element)
    } else {
      const shortcut = element.getAttribute('data-hotkey')
      if (shortcut) {
        const validShortcuts = filterOutCharacterKeyShortcuts(shortcut)
        if (validShortcuts.length > 0) {
          element.setAttribute('data-hotkey', validShortcuts)
          install(element)
        }
      }
    }
  },
  remove(element) {
    uninstall(element)
  }
})

// This function keeps non-character key shortcuts and filters out character key shortcuts.
// See `isNonCharacterKeyShortcut` for more information.
export default function filterOutCharacterKeyShortcuts(string: string) {
  const shortcuts = string.split(',')
  return shortcuts
    .filter((s: string) => {
      return isNonCharacterKeyShortcut(s)
    })
    .join(',')
}
"Ølimport {compose, fromEvent} from '../subscription'
import {fetchSafeDocumentFragment} from '../fetch'
import memoize from '@github/memoize'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {sendEvent} from '../hydro-analytics'
import {trackView} from '../hydro-tracking'

type Position = {
  containerTop: number
  containerLeft: number
  contentClassSuffix: string
}

// The card content. Moved around the page to where the current hover is
let cardContentContainer = document.querySelector('.js-hovercard-content')
observe('.js-hovercard-content', el => {
  cardContentContainer = el
})

const cachedFetchSafeDocumentFragment = memoize(fetchSafeDocumentFragment)

let currentTarget: Element | null | undefined

let activatingElement: Element | null = null

let deactivateTimer: number | null

// Mouse position for when links wrap lines
let mouseX = 0

const caretDistanceFromTarget = 12

// For calculating position of the card when it hangs to the left
// NOTE: These need to stay in sync with certain CSS rules in order to keep the
// caret pointing at the target.
//
// caret distance from edge of card
const caretPaddingX = 24
const caretMarginY = 7
const caretPaddingY = caretPaddingX - caretMarginY

const caretHeight = 16

// The amount of extra time given to move into the content
const deactivateTimeout = 100

// The minimum time before opening the hovercard via mouseover
const activateTimeout = 250

// Get the content class of a given selector.
// (Prefixes the selector with `Popover-message--`).
function contentClass(suffix: string): string {
  const contentClassPrefix = 'Popover-message--'
  return contentClassPrefix + suffix
}

// Track a load of the hovercard in octolytics if it stays for > 500ms.
function trackLoad(cardContentBody: HTMLElement) {
  setTimeout(() => {
    if (document.body && document.body.contains(cardContentBody)) {
      // Octolytics
      const octolyticsElement = cardContentBody.querySelector('[data-hovercard-tracking]')
      if (octolyticsElement) {
        const trackingData = octolyticsElement.getAttribute('data-hovercard-tracking')
        if (trackingData) {
          sendEvent('user-hovercard-load', JSON.parse(trackingData))
        }
      }

      const trackingElement = cardContentBody.querySelector('[data-hydro-view]')
      if (trackingElement instanceof HTMLElement) {
        trackView(trackingElement)
      }
    }
  }, 500)
}

function hideCard() {
  if (!(cardContentContainer instanceof HTMLElement)) return

  cardContentContainer.style.display = 'none'
  cardContentContainer.children[0].innerHTML = ''

  activatingElement = null
  currentTarget = null
}

function selectRectNearestMouse(target: Element): ClientRect {
  const rects = target.getClientRects()
  let foundRect = rects[0] || target.getBoundingClientRect() || {top: 0, left: 0, height: 0, width: 0}

  if (rects.length > 0) {
    for (const rect of rects) {
      if (rect.left < mouseX && rect.right > mouseX) {
        foundRect = rect
        break
      }
    }
  }

  return foundRect
}

function calculatePositions(target: Element): Position {
  const {width: contentWidth, height: contentHeight} = cardContentContainer!.getBoundingClientRect()
  const {left: targetX, top: targetY, height: targetHeight, width: targetWidth} = selectRectNearestMouse(target)

  const roomAbove = targetY > contentHeight
  const hangLeft = target.classList.contains('js-hovercard-left')

  if (hangLeft) {
    // If there is room, show hovercard above hover position. Else, show it below
    const left = targetX - contentWidth - caretDistanceFromTarget
    const targetCenterY = targetY + targetHeight / 2
    const top = roomAbove
      ? targetCenterY - contentHeight + caretPaddingY + caretHeight / 2
      : targetCenterY - caretPaddingY - caretHeight / 2

    return {
      containerTop: top,
      containerLeft: left,
      contentClassSuffix: roomAbove ? 'right-bottom' : 'right-top'
    }
  } else {
    const roomRight = window.innerWidth - targetX > contentWidth
    const targetCenterX = targetX + targetWidth / 2
    const left = roomRight ? targetCenterX - caretPaddingX : targetCenterX - contentWidth + caretPaddingX
    const top = roomAbove
      ? targetY - contentHeight - caretDistanceFromTarget
      : targetY + targetHeight + caretDistanceFromTarget

    const contentClassSuffix = roomAbove
      ? roomRight
        ? 'bottom-left'
        : 'bottom-right'
      : roomRight
      ? 'top-left'
      : 'top-right'
    return {containerTop: top, containerLeft: left, contentClassSuffix}
  }
}

function positionCard(target: Element, cardContent: Element) {
  if (!(cardContentContainer instanceof HTMLElement)) return

  // Hide container, reset popover styles
  cardContentContainer.style.visibility = 'hidden'
  cardContentContainer.style.display = 'block'
  cardContent.classList.remove(
    contentClass('bottom-left'),
    contentClass('bottom-right'),
    contentClass('right-top'),
    contentClass('right-bottom'),
    contentClass('top-left'),
    contentClass('top-right')
  )

  const {containerTop, containerLeft, contentClassSuffix} = calculatePositions(target)

  // Add the class for correct caret location
  cardContent.classList.add(contentClass(contentClassSuffix))

  // Position the popover & inner message correctly
  cardContentContainer.style.top = `${containerTop + window.pageYOffset}px`
  cardContentContainer.style.left = `${containerLeft + window.pageXOffset}px`

  // Set z-index override
  setZIndexOverride(target, cardContentContainer)

  // After positioning correctly, show the popover again
  cardContentContainer.style.visibility = ''
}

function showCard(fragment: DocumentFragment, target: Element) {
  if (!(cardContentContainer instanceof HTMLElement)) return

  const cardContent = cardContentContainer.children[0]

  cardContent.innerHTML = ''

  const cardContentBody = document.createElement('div')
  for (const child of fragment.children) {
    cardContentBody.appendChild(child.cloneNode(true))
  }

  cardContent.appendChild(cardContentBody)

  positionCard(target, cardContent)
  trackLoad(cardContentBody)

  cardContentContainer.style.display = 'block'
}

function determineEnclosingSubject(target: Element): string | null {
  const tag = target.closest('[data-hovercard-subject-tag]')
  if (tag) return tag.getAttribute('data-hovercard-subject-tag')
  // Fall back to page context
  const meta = document.head && document.head.querySelector('meta[name="hovercard-subject-tag"]')
  if (meta) return meta.getAttribute('content')
  return null
}

function hovercardUrlFromTarget(target: Element): string {
  const baseHovercardUrl = target.getAttribute('data-hovercard-url')

  if (baseHovercardUrl) {
    const subjectTag = determineEnclosingSubject(target)
    if (subjectTag) {
      const url = new URL(baseHovercardUrl, window.location.origin)
      const params = new URLSearchParams(url.search.slice(1))
      params.append('subject', subjectTag)
      params.append('current_path', window.location.pathname + window.location.search)
      url.search = params.toString()
      return url.toString()
    }

    return baseHovercardUrl
  }

  return ''
}

// Determine if a hovercard is enabled for this type of element.
//
// Return boolean will be `true` if this link element has hovercard
// attributes and the link's particular kind of hovercard is enabled for the
// viewer and that part of the page.
function hovercardsAreEnabledForType(target: Element): boolean {
  const hovercardType = target.getAttribute('data-hovercard-type')

  if (hovercardType === 'pull_request' || hovercardType === 'issue') {
    return !!target.closest('[data-issue-and-pr-hovercards-enabled]')
  }

  if (hovercardType === 'team') {
    return !!target.closest('[data-team-hovercards-enabled]')
  }

  if (hovercardType === 'repository') {
    return !!target.closest('[data-repository-hovercards-enabled]')
  }

  if (hovercardType === 'commit') {
    return !!target.closest('[data-commit-hovercards-enabled]')
  }

  if (hovercardType === 'project') {
    return !!target.closest('[data-project-hovercards-enabled]')
  }

  if (hovercardType === 'discussion') {
    return !!target.closest('[data-discussion-hovercards-enabled]')
  }

  if (hovercardType === 'acv_badge') {
    return !!target.closest('[data-acv-badge-hovercards-enabled]')
  }

  if (hovercardType === 'sponsors_listing') {
    return !!target.closest('[data-sponsors-listing-hovercards-enabled]')
  }

  // User and organization hovercards are enabled everywhere
  return true
}

// When mousing over a hovercard target, load the data and show the card.
async function activateFn(event: Event, minimumTimeout?: number): Promise<void> {
  // Don't show hovercards on touch devices. Prevents mobile Safari users
  // from needing to double tap links with hovercards.
  // https://humanwhocodes.com/blog/2012/07/05/ios-has-a-hover-problem/
  const touchDevice = 'ontouchstart' in document
  if (touchDevice) return

  const target = event.currentTarget

  if (event instanceof MouseEvent) {
    mouseX = event.clientX
  }

  if (!(target instanceof Element)) return
  if (currentTarget === target) return
  if (target.closest('.js-hovercard-content')) return

  // Don't actually show issue or PR hovercards unless the link has an ancestor
  // element with data-issue-and-pr-hovercards-enabled
  if (!hovercardsAreEnabledForType(target)) return

  hideCard()

  // Set the current target as the one we're currently hovering on
  currentTarget = target
  activatingElement = document.activeElement

  const hovercardUrl = hovercardUrlFromTarget(target)

  let fragment: DocumentFragment | null | undefined
  try {
    const forcedDelay = new Promise(r => window.setTimeout(r, minimumTimeout, 0))
    fragment = await cachedFetchSafeDocumentFragment(document, hovercardUrl)
    await forcedDelay
  } catch (err) {
    const response: Response = err.response
    if (response && response.status === 404) {
      // eslint-disable-next-line i18n-text/no-en
      const notAvailableMessage = 'Hovercard is unavailable'
      target.setAttribute('aria-label', notAvailableMessage)
      target.classList.add('tooltipped', 'tooltipped-ne')
    } else if (response && response.status === 410) {
      const data: {[key: string]: string} = await response.clone().json()
      target.setAttribute('aria-label', data.message)
      target.classList.add('tooltipped', 'tooltipped-ne')
    }
    return
  }

  // Ensure that the target is still the active one
  if (target === currentTarget) {
    showCard(fragment, target)

    if (event instanceof KeyboardEvent && cardContentContainer instanceof HTMLElement) {
      cardContentContainer.focus()
    }
  }
}

// Load the data but don't show until at least `activateTimeout` Only used when
// loading via mouseover.
function activateWithTimeoutFn(event: Event) {
  activateFn(event, activateTimeout)
}

// When leaving a hovercard, deactivate unless we're moving to another child.
// This allows the user to hover into the content area without dismissing.
function deactivateFn(event: Event) {
  if (!currentTarget) return

  if (event instanceof MouseEvent && event.relatedTarget instanceof HTMLElement) {
    const relatedTarget = event.relatedTarget
    if (relatedTarget.closest('.js-hovercard-content') || relatedTarget.closest('[data-hovercard-url]')) {
      return
    }
  } else if (event instanceof KeyboardEvent && activatingElement instanceof HTMLElement) {
    // Return focus to where it was before the card was opened
    activatingElement.focus()
  }

  hideCard()
}

// Deactivate after 250 ms unless the deactivate timer is canceled as a result
// of the user entering the hovercard content area.
function deactivateWithTimeoutFn(event: Event) {
  const targetWas = currentTarget

  deactivateTimer = window.setTimeout(() => {
    if (currentTarget === targetWas) deactivateFn(event)
  }, deactivateTimeout)
}

// Triggered when a key is pressed while either a container is focused, or
// while inside of an open hovercard.
function keyupFn(event: Event) {
  // TODO: Refactor to use data-hotkey
  /* eslint eslint-comments/no-use: off */
  /* eslint-disable no-restricted-syntax */
  if (!(event instanceof KeyboardEvent)) return
  switch (event.key) {
    case 'Escape':
      deactivateFn(event)
  }
  /* eslint-enable no-restricted-syntax */
}

// Cancel the deactivation timer since the user is inside the content now
function cancelDeactivation() {
  if (deactivateTimer) clearTimeout(deactivateTimer)
}

if (cardContentContainer) {
  observe('[data-hovercard-url]', {
    subscribe: el =>
      compose(
        fromEvent(el, 'mouseover', activateWithTimeoutFn),
        fromEvent(el, 'mouseleave', deactivateWithTimeoutFn),
        fromEvent(el, 'keyup', keyupFn)
      )
  })

  observe('[data-hovercard-url]', {
    remove(el) {
      // Hide the card if we're removing the element that triggered it
      if (currentTarget === el) hideCard()
    }
  })

  observe('.js-hovercard-content', {
    subscribe: el =>
      compose(
        fromEvent(el, 'mouseover', cancelDeactivation),
        fromEvent(el, 'mouseleave', deactivateFn),
        fromEvent(el, 'keyup', keyupFn)
      )
  })

  // eslint-disable-next-line delegated-events/global-on
  on('menu:activated', 'details', hideCard)

  // hide the card when a turbo completes a new visit
  window.addEventListener('turbo:load', hideCard)

  window.addEventListener('statechange', hideCard)
}

function setZIndexOverride(target: Element, container: HTMLElement) {
  const zIndex = target.getAttribute('data-hovercard-z-index-override')
  if (zIndex) {
    container.style.zIndex = zIndex
  } else {
    // Reset to initial z-index from Popover
    container.style.zIndex = '100'
  }
}
"óimport {loaded} from '../document-ready'
import {sendPageView} from '../hydro-analytics'
;(async function () {
  // PJAX should be treated like pageloads
  document.addEventListener('pjax:complete', () =>
    sendPageView({
      pjax: 'true'
    })
  )

  // Turbo loads should be treated like pageloads
  document.addEventListener('soft-nav:success', () =>
    sendPageView({
      turbo: 'true'
    })
  )

  // Send a page view as soon as the page is loaded
  await loaded
  sendPageView()
})()
"ûimport type {Context} from '@github/hydro-analytics-client'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {sendEvent} from '../hydro-analytics'

on('click', '[data-octo-click]', function (event) {
  const targetEl = event.currentTarget
  if (!(targetEl instanceof HTMLElement)) {
    return
  }

  const eventType = targetEl.getAttribute('data-octo-click') || ''
  const context: Context = {}

  if (targetEl.hasAttribute('data-ga-click')) {
    const gaEvent = targetEl.getAttribute('data-ga-click')!
    const parts = gaEvent.split(',')
    context.category = parts[0].trim()
    context.action = parts[1].trim()
  }

  if (targetEl.hasAttribute('data-octo-dimensions')) {
    const dimensionsList = targetEl.getAttribute('data-octo-dimensions')!.split(',')

    for (const dimensionPair of dimensionsList) {
      const [key, value] = dimensionPair.split(/:(.+)/)
      if (key) {
        context[key] = value || ''
      }
    }
  }
  sendEvent(eventType, context)
})
"Ð// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {sendData} from '../hydro-tracking'
import safeStorage from '../safe-storage'

const {getItem} = safeStorage('localStorage')

declare const process: {
  env: {
    NODE_ENV: string
  }
}

function debugPayload(debugKey: string, payload: string): void {
  if (process.env.NODE_ENV === 'development') {
    if (getItem(debugKey) === 'true') {
      /* eslint eslint-comments/no-use: off */
      /* eslint-disable no-console */
      try {
        const parsed = JSON.parse(payload)
        const eventName = parsed?.payload?.event_name ?? parsed?.event_type
        console.group(`[${debugKey}] ${eventName}`)
        console.table(parsed)
        const keys = Object.keys(parsed?.payload || {})
        for (const key of keys) {
          const object = parsed.payload[key]
          if (object instanceof Object && Object.keys(object).length > 0) {
            console.group(key)
            console.table(object)
            console.groupEnd()
          }
        }
        console.groupEnd()
      } catch (e) {
        console.group(`[hydro ${debugKey}] - failed to parse payload`)
        console.log(payload)
        console.groupEnd()
      }
      /* eslint-enable no-console */
    }
  }
}

on('click', '[data-hydro-click]', function (event) {
  const el = event.currentTarget
  const payload = el.getAttribute('data-hydro-click') || ''
  const hmac = el.getAttribute('data-hydro-click-hmac') || ''
  const hydroClientContext = el.getAttribute('data-hydro-client-context') || ''
  debugPayload('hydro-debug.click', payload)
  sendData(payload, hmac, hydroClientContext)
})

on('click', '[data-optimizely-hydro-click]', function (event) {
  const el = event.currentTarget
  const payload = el.getAttribute('data-optimizely-hydro-click') || ''
  const hmac = el.getAttribute('data-optimizely-hydro-click-hmac') || ''
  debugPayload('hydro-debug.optimizely', payload)
  sendData(payload, hmac, '')
})
"// Handle immediate updates returned from the server on ajax success.
//
// See ShowPartial#render_immediate_partials

import {remoteForm} from '@github/remote-form'
import {replaceContent} from '../updatable-content'

remoteForm('.js-immediate-updates', async function (form, wants) {
  let updateContent

  try {
    const response = await wants.json()
    updateContent = response.json.updateContent
  } catch (error) {
    if (error.response.json) {
      updateContent = error.response.json.updateContent
    }
  }

  if (updateContent) {
    for (const selector in updateContent) {
      const html = updateContent[selector]
      const el = document.querySelector(selector)
      if (el instanceof HTMLElement) {
        replaceContent(el, html)
      }
    }
  }
})
"import {sendStats} from '../stats'
import {isFeatureEnabled} from '../features'

document.addEventListener('DOMContentLoaded', onDOMContentLoaded)

async function onDOMContentLoaded() {
  if (isFeatureEnabled('IMAGE_METRIC_TRACKING') === false) return

  const images = Array.from(document.querySelectorAll('img.js-img-time')).slice(0, 5)
  const startTime = Date.now()
  const stats: PlatformBrowserTransparentRedirectTiming[] = []

  await Promise.all(images.map(image => measureRedirectTiming(image, startTime, stats)))

  if (stats.length > 0) sendStats({transparentRedirectTimings: stats})
}

async function measureRedirectTiming(
  image: Element,
  startTime: number,
  stats: PlatformBrowserTransparentRedirectTiming[]
) {
  const LOCAL_STORAGE_PATH_REGEX =
    /\/assets\/storage\/user\/([0-9]+)\/files\/([{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?)/
  const PROD_STORAGE_PATH_REGEX = /assets\/([0-9]+)\/([{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?)/

  const source = image.getAttribute('src')
  if (!source) return

  const url = new URL(source, window.location.origin)
  const pathRegex = LOCAL_STORAGE_PATH_REGEX.test(url.pathname) ? LOCAL_STORAGE_PATH_REGEX : PROD_STORAGE_PATH_REGEX
  const [, userID, fileGUID] = url.pathname.match(pathRegex) || []
  if (!userID || !fileGUID) return

  await fetch(`/assets/measure/${userID}/${fileGUID}`)

  const duration = Date.now() - startTime
  const stat: PlatformBrowserTransparentRedirectTiming = {duration, fileGUID, userID}
  stats.push(stat)
}
"Ö// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

observe('[data-indeterminate]', {
  constructor: HTMLInputElement,
  initialize(el) {
    el.indeterminate = true
  }
})
"ïimport {logPageView} from '../jump-to/page-views'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

function load() {
  import('../jump-to')
}

observe('.js-jump-to-field', {
  constructor: HTMLInputElement,
  add(el) {
    el.addEventListener('focusin', load, {once: true})
    logPageView(window.location.pathname)
  }
})
 cþ$i m p o r t   { d i a l o g }   f r o m   ' . . / d e t a i l s - d i a l o g ' 
 i m p o r t   { e v e n t T o H o t k e y S t r i n g }   f r o m   ' @ g i t h u b / h o t k e y ' 
 i m p o r t   { f e t c h S a f e D o c u m e n t F r a g m e n t }   f r o m   ' . . / f e t c h ' 
 i m p o r t   { i s F o r m F i e l d }   f r o m   ' . . / f o r m ' 
 i m p o r t   { i s S h o r t c u t A l l o w e d }   f r o m   ' . / k e y b o a r d - s h o r t c u t s - h e l p e r ' 
 / /   e s l i n t - d i s a b l e - n e x t - l i n e   n o - r e s t r i c t e d - i m p o r t s 
 i m p o r t   { o b s e r v e }   f r o m   ' s e l e c t o r - o b s e r v e r ' 
 / /   e s l i n t - d i s a b l e - n e x t - l i n e   n o - r e s t r i c t e d - i m p o r t s 
 i m p o r t   { o n }   f r o m   ' d e l e g a t e d - e v e n t s ' 
 
 l e t   s h o r t c u t M o d a l S h o w n   =   f a l s e 
 
 a s y n c   f u n c t i o n   s h o w K e y b o a r d S h o r t c u t s ( )   { 
     i f   ( s h o r t c u t M o d a l S h o w n )   r e t u r n 
     s h o r t c u t M o d a l S h o w n   =   t r u e 
 
     c o n s t   m e t a K e y b o a r d S h o r t c u t s   =   d o c u m e n t . q u e r y S e l e c t o r < H T M L M e t a E l e m e n t > ( ' m e t a [ n a m e = g i t h u b - k e y b o a r d - s h o r t c u t s ] ' ) ! 
     c o n s t   o p t i o n s   =   { c o n t e x t s :   m e t a K e y b o a r d S h o r t c u t s . c o n t e n t } 
     c o n s t   u r l   =   ` / s i t e / k e y b o a r d _ s h o r t c u t s ? $ { n e w   U R L S e a r c h P a r a m s ( o p t i o n s ) . t o S t r i n g ( ) } ` 
 
     c o n s t   s h o r t c u t M o d a l   =   a w a i t   d i a l o g ( { 
         c o n t e n t :   f e t c h S a f e D o c u m e n t F r a g m e n t ( d o c u m e n t ,   u r l ) , 
         l a b e l l e d B y :   ' k e y b o a r d - s h o r t c u t s - h e a d i n g ' 
     } ) 
     s h o r t c u t M o d a l . s t y l e . w i d t h   =   ' 8 0 0 p x ' 
     s h o r t c u t M o d a l . a d d E v e n t L i s t e n e r ( 
         ' d i a l o g : r e m o v e ' , 
         f u n c t i o n   ( )   { 
             s h o r t c u t M o d a l S h o w n   =   f a l s e 
         } , 
         { o n c e :   t r u e } 
     ) 
 } 
 
 / /   T o g g l e s   a j a x   r e q u e s t   t o   d i s p l a y   k e y b o a r d   s h o r t c u t s . 
 / / 
 / /   A d d   a   c l a s s   o f   ` j s - k e y b o a r d - s h o r t c u t s `   t o   g e t   t h i s   b e h a v i o r   o n   y o u r   p a g e . 
 o n ( ' c l i c k ' ,   ' . j s - k e y b o a r d - s h o r t c u t s ' ,   s h o w K e y b o a r d S h o r t c u t s ) 
 
 d o c u m e n t . a d d E v e n t L i s t e n e r ( ' k e y d o w n ' ,   ( e v e n t :   E v e n t )   = >   { 
     i f   ( ! ( e v e n t   i n s t a n c e o f   K e y b o a r d E v e n t ) )   r e t u r n 
     i f   ( ! i s S h o r t c u t A l l o w e d ( e v e n t ) )   r e t u r n 
 
     i f   ( e v e n t . t a r g e t   i n s t a n c e o f   N o d e   & &   i s F o r m F i e l d ( e v e n t . t a r g e t ) )   r e t u r n 
     i f   ( e v e n t T o H o t k e y S t r i n g ( e v e n t )   ! = =   ' S h i f t + ? ' )   r e t u r n 
     s h o w K e y b o a r d S h o r t c u t s ( ) 
 } ) 
 
 o b s e r v e ( ' . j s - m o d i f i e r - k e y ' ,   { 
     c o n s t r u c t o r :   H T M L E l e m e n t , 
     a d d ( c o n t a i n e r )   { 
         i f   ( / M a c i n t o s h / . t e s t ( n a v i g a t o r . u s e r A g e n t ) )   { 
             l e t   s h o r t c u t   =   c o n t a i n e r . t e x t C o n t e n t 
             i f   ( s h o r t c u t )   { 
                 s h o r t c u t   =   s h o r t c u t . r e p l a c e ( / c t r l / ,   ' #' ) 
                 s h o r t c u t   =   s h o r t c u t . r e p l a c e ( / a l t / ,   ' %#' ) 
                 c o n t a i n e r . t e x t C o n t e n t   =   s h o r t c u t 
             } 
         } 
     } 
 } ) 
 
 o b s e r v e ( ' . j s - m o d i f i e r - l a b e l - k e y ' ,   { 
     a d d ( c o n t a i n e r )   { 
         l e t   s h o r t c u t L a b e l   =   c o n t a i n e r . t e x t C o n t e n t ? . r e p l a c e ( / c t r l / i ,   ' C t r l ' ) 
         i f   ( ! s h o r t c u t L a b e l )   r e t u r n 
         i f   ( / M a c i n t o s h / . t e s t ( n a v i g a t o r . u s e r A g e n t ) )   { 
             s h o r t c u t L a b e l   =   s h o r t c u t L a b e l . r e p l a c e ( / c t r l / i ,   ' C m d ' ) 
             s h o r t c u t L a b e l   =   s h o r t c u t L a b e l . r e p l a c e ( / a l t / i ,   ' O p t i o n ' ) 
         } 
         c o n t a i n e r . t e x t C o n t e n t   =   s h o r t c u t L a b e l 
     } 
 } ) 
 "Ó// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

// Length-limited input with warning.
//
// Limit the length of user input and provide a warning with a character count
// when the user approaches the length limit.
//
// Three classes must be set.
//  - js-length-limited-input.
//  - js-length-limited-input-container.
//  - js-length-limited-input-warning (probably also hidden by default).
//
// Two data attributes should be set on .js-length-limited-input:
//  - data-warning-text, a string template for the warning message.
//    Use `{{remaining}}` to interpolate the number of characters remaining.
//  - data-input-max-length.
//
// @example
// ```html
//    <dd class="js-length-limited-input-container">
//      <input type="text"
//             class="js-length-limited-input"
//             data-warning-text="You have {{remaining}} characters remaining"
//             data-input-max-length="160">
//
//      <p class="js-length-limited-input-warning d-none">
//      </p>
//    </dd>
// ```
function displayLengthWarning(event: Event) {
  // The user input field (<input>, <textarea>, etc)
  const inputField = event.currentTarget
  if (!(inputField instanceof HTMLInputElement || inputField instanceof HTMLTextAreaElement)) return

  // The character limit, set in data attribute "max-length"
  const maxLength = parseInt(inputField.getAttribute('data-input-max-length') || '', 10)

  // The remaining length to start showing the warning for, defaults to 5
  const warningLength = parseInt(inputField.getAttribute('data-warning-length') || '', 10) || 5

  // The user input field (<input>, <textarea>, etc)
  const inputValue = inputField.value

  // New lines need to be counted as two characters. They are by the server.
  const inputValueWithNewLinesFix = inputValue.replace(/(\r\n|\n|\r)/g, '\r\n')

  // Characters remaining before the limit is reached
  let remainingLength = maxLength - inputValueWithNewLinesFix.length

  // HTML maxLength attribute does not count carriage returns correctly.
  // It is also inconsistent between Chrome and Firefox
  // and therefore can't be used bugfree without browser sniffing
  // Creating our own maxLength implementation instead.
  if (remainingLength <= 0) {
    let truncatedInputValue = inputValueWithNewLinesFix.substr(0, maxLength)
    // Trim trailing \r so we don't truncate in the middle of a \r\n newline
    if (truncatedInputValue.endsWith('\r')) {
      truncatedInputValue = truncatedInputValue.substr(0, maxLength - 1)
      remainingLength = 1
    } else {
      remainingLength = 0
    }
    inputField.value = truncatedInputValue
  }

  // The warning message to display after the remaining character count
  const warningText = inputField.getAttribute('data-warning-text')!

  // The container enclosing the length-limited input field
  const inputContainer = inputField.closest<HTMLElement>('.js-length-limited-input-container')!

  // The container for the warning message
  const warningArea = inputContainer.querySelector<HTMLElement>('.js-length-limited-input-warning')!

  if (remainingLength <= warningLength) {
    warningArea.textContent = warningText.replace(new RegExp('{{remaining}}', 'g'), `${remainingLength}`)
    /* eslint-disable-next-line github/no-d-none */
    warningArea.classList.remove('d-none')
  } else {
    warningArea.textContent = ''
    /* eslint-disable-next-line github/no-d-none */
    warningArea.classList.add('d-none')
  }
}

observe('.js-length-limited-input', {
  add(el) {
    el.addEventListener('input', displayLengthWarning)
    el.addEventListener('change', displayLengthWarning)
  },
  remove(el) {
    el.removeEventListener('input', displayLengthWarning)
    el.removeEventListener('change', displayLengthWarning)
  }
})
"// eslint-disable-next-line no-restricted-imports
import {fire, on} from 'delegated-events'

on('click', '.js-member-search-filter', function (event) {
  event.preventDefault()

  const filter = event.currentTarget.getAttribute('data-filter')!
  const menu = event.currentTarget.closest<HTMLElement>('[data-filter-on]')!
  const filterOn = menu.getAttribute('data-filter-on')!
  const field = document.querySelector<HTMLInputElement>('.js-member-filter-field')!

  // Remove any existing filters on the opened dropdown.
  const currentValue = field.value

  // Regex allows a-z chars, underscores & strings wrapped in single quotes (required for custom roles)
  const regex = new RegExp(`${filterOn}:(?:[a-z]|_|((').*(')))+`)
  const currentFilters = currentValue.toString().trim().replace(regex, '')

  field.value = `${currentFilters} ${filter}`.replace(/\s\s/, ' ').trim()
  field.focus()
  fire(field, 'input')
})
"// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

on('auto-check-success', '.js-new-organization-name', function (event) {
  const field = event.target as HTMLInputElement
  const container = field.closest<HTMLElement>('dd')!
  const hint = container.querySelector('.js-field-hint-name')
  if (!hint) {
    return
  }
  hint.textContent = field.value
})
"´	// Notice Behavior
//
// Add basic data-remote success hook for hiding notice on ajax
// success.
//
// Markup
//
//     <div class="js-notice">
//       Hey!
//       <a href="/dismiss" class="js-notice-dismiss">
//         Dismiss
//       </a>
//     </div>
//

// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {remoteForm} from '@github/remote-form'
import {showGlobalError} from '../behaviors/ajax-error'

remoteForm('.js-notice-dismiss', async function (form, send) {
  await send.text()
  const notice = form.closest<HTMLElement>('.js-notice')!
  notice.remove()
})

on('submit', '.js-notice-dismiss-remote', async function (event) {
  const form = event.currentTarget as HTMLFormElement
  event.preventDefault()
  let response
  try {
    response = await fetch(form.action, {
      method: form.method,
      body: new FormData(form),
      headers: {
        Accept: 'application/json',
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
  } catch {
    showGlobalError()
    return
  }
  if (response && !response.ok) {
    showGlobalError()
  } else {
    const notice = form.closest<HTMLElement>('.js-notice')!
    notice.remove()
  }
})
"¼// If the current page is openable in github.dev, do so on click.
// This would be achievable without any custom JS by just using
// data-hotkey except for two things:
//  - PJAX and other replaceState-triggered location updates like
//    the `y` hotkey need to be respected.
//  - the editor cares about the hash of the page.
// So we'll construct the href client-side.

// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

function isVisible(el: HTMLElement) {
  try {
    const rect = el.getBoundingClientRect()
    if (rect.height === 0 && rect.width === 0) {
      return false
    }
    if (el.style.opacity === '0' || el.style.visibility === 'hidden') {
      return false
    }
  } catch {
    // fall through to return true below
  }
  return true
}

on('click', '.js-github-dev-shortcut', function (event) {
  event.preventDefault()
  // If content exists in any visble comment field, prompt before navigating to github.dev
  for (const el of document.querySelectorAll<HTMLTextAreaElement>('textarea.js-comment-field')) {
    // eslint-disable-next-line i18n-text/no-en
    if (el.value && isVisible(el) && !confirm('Are you sure you want to open github.dev?')) {
      return
    }
  }
  // Assumption: the href of the shortcut is the base URL for
  // the serverless editor, e.g. https://github.dev/
  const target = event.currentTarget as HTMLAnchorElement
  target.pathname = window.location.pathname
  target.hash = window.location.hash
  window.location.href = target.href
})

on('click', '.js-github-dev-new-tab-shortcut', function (event) {
  // Assumption: the href of the shortcut is the base URL for
  // the serverless editor, e.g. https://github.dev/
  const target = event.currentTarget as HTMLAnchorElement
  target.pathname = window.location.pathname
  target.hash = window.location.hash
})
"// If the current page is openable in blackbird, do so on click.
// This would be achievable without any custom JS by just using
// data-hotkey except for two things:
//  - PJAX and other replaceState-triggered location updates like
//    the `y` hotkey need to be respected.
//  - the editor cares about the hash of the page.
// So we'll construct the href client-side.

// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

export function getBlackbirdURL(blackbirdLink: HTMLAnchorElement, currentURL: URL, selection?: string): URL {
  const output = new URL('', window.location.origin)
  const pathComponents = currentURL.pathname.split('/')
  output.pathname = pathComponents.slice(1, 3).join('/')
  output.hash = currentURL.hash

  // If the user has currently selected something, search for that
  if (selection) {
    output.search = `?q=${encodeURIComponent(selection)}`
  }

  // If the URL contains a ?q=..., let's forward that to blackbird
  const u = new URLSearchParams(currentURL.search)
  const search = u.get('q')
  if (search) {
    output.search = `?q=${encodeURIComponent(search)}`
  }

  // If the path is a blob or tree view path, jump to the corresponding view in blackbird
  else if (pathComponents.length >= 6 && (pathComponents[3] === 'blob' || pathComponents[3] === 'tree')) {
    output.pathname = currentURL.pathname
  }

  output.host = blackbirdLink.host
  output.protocol = blackbirdLink.protocol
  output.port = blackbirdLink.port
  return output
}

on('click', '.js-blackbird-shortcut', function (event) {
  // Assumption: the href of the shortcut is the base URL for
  // the blackbird frontend, e.g. https://cs.github.com/
  const target = event.currentTarget as HTMLAnchorElement
  const blackbirdURL = getBlackbirdURL(
    target,
    new URL(window.location.href, window.location.origin),
    window.getSelection()?.toString()
  )
  target.href = blackbirdURL.href
})
"ó	// Append any window.location.hash changes to the permalink.
//
// For example, if you're viewing:
// /github/linguist/blob/master/lib/linguist/languages.yml#L12
//
// You probably want the permalink to preserve the #L12, and go to:
// /github/linguist/blob/SHA/lib/linguist/languages.yml#L12
//
//
// Also update link that we want to keep in sync with the permalink change.
//
// For example, if you `y` a Markdown file and click the "Display as source blob"
// button, probably you want its link (href) to change from:
// /github/linguist/blob/master/README.md?plain=1
//
// to:
// /github/linguist/blob/SHA/README.md?plain=1

// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {replaceState} from '../history'

on('click', '.js-permalink-shortcut', function (event) {
  const target = event.currentTarget as HTMLAnchorElement
  try {
    replaceState(null, '', target.href + window.location.hash)
  } catch (error) {
    window.location.href = target.href + window.location.hash
  }
  for (const element of document.querySelectorAll('.js-permalink-replaceable-link')) {
    if (element instanceof HTMLAnchorElement) {
      element.href = element.getAttribute('data-permalink-href')!
    }
  }
  event.preventDefault()
})
"Áimport {remoteForm} from '@github/remote-form'

remoteForm('.js-permission-menu-form', async function (form, wants) {
  const success = form.querySelector<HTMLElement>('.js-permission-success')!
  const error = form.querySelector<HTMLElement>('.js-permission-error')!

  success.hidden = true
  error.hidden = true
  form.classList.add('is-loading')

  let response
  try {
    response = await wants.json()
  } catch (e) {
    // If the request errored, we'll set the error state and return.
    form.classList.remove('is-loading')
    error.hidden = false
    return
  }

  form.classList.remove('is-loading')
  success.hidden = false

  const container = form.closest('.js-org-repo')
  if (container) {
    const data = response.json
    container.classList.toggle('with-higher-access', data['members_with_higher_access'])
  }
})
"¼import {ready} from '../document-ready'
;(async function () {
  await ready

  // loading bar at the top of the page for pjax actions
  const bar = document.querySelector('.js-pjax-loader-bar')
  if (!bar) {
    return
  }

  const progressEl = bar.firstElementChild
  if (!(progressEl instanceof HTMLElement)) {
    return
  }

  let width = 0
  let incTimer: number | null = null
  let originalTransition: string | null = null

  function initiateLoader() {
    setWidth(0)
    if (bar) bar.classList.add('is-loading')
    incTimer = window.setTimeout(increment, 0)
  }

  // Set the new width of the progress bar.
  function setWidth(newWidth: number) {
    if (!(progressEl instanceof HTMLElement)) return
    if (newWidth === 0) {
      if (originalTransition == null) originalTransition = getComputedStyle(progressEl).transition
      progressEl.style.transition = 'none'
    }

    width = newWidth
    progressEl.style.width = `${width}%`

    if (newWidth === 0) {
      progressEl.clientWidth // ensure previous style gets fully applied without transition
      progressEl.style.transition = originalTransition || ''
    }
  }

  function increment() {
    // First animation should be more
    if (width === 0) width = 12
    setWidth(Math.min(width + 3, 95))
    incTimer = window.setTimeout(increment, 500)
  }

  function finishLoader() {
    if (incTimer) {
      clearTimeout(incTimer)
    }
    setWidth(100)
    if (bar) bar.classList.remove('is-loading')
  }

  document.addEventListener('pjax:start', initiateLoader)
  document.addEventListener('pjax:end', finishLoader)
})()
"âimport {microtask} from '../eventloop-tasks'
import {sendStats} from '../stats'

let lastPjaxRequestUrl: string | null = null

// Collect User Timing metrics so we can track time-to-load on pjax actions
const pjaxMeasure = 'last_pjax_request'
const pjaxStartMark = 'pjax_start'
const pjaxEndMark = 'pjax_end'

// Mark pjax start on performance timeline and save url for last pjax request.
function markPjaxStart(event: CustomEvent<{url?: string}>) {
  if (event instanceof CustomEvent && event.detail && event.detail.url) {
    window.performance.mark(pjaxStartMark)
    lastPjaxRequestUrl = event.detail.url
  }
}

// Mark pjax end on performance timeline and report results.
async function trackPjaxTiming() {
  await microtask()

  if (!window.performance.getEntriesByName(pjaxStartMark).length) return

  window.performance.mark(pjaxEndMark)
  window.performance.measure(pjaxMeasure, pjaxStartMark, pjaxEndMark)
  const measures = window.performance.getEntriesByName(pjaxMeasure)

  const measure = measures.pop()
  const duration = measure ? measure.duration : null
  if (!duration) return

  if (lastPjaxRequestUrl) {
    sendStats({
      requestUrl: lastPjaxRequestUrl,
      pjaxDuration: Math.round(duration)
    })
  }
  clearPjaxMarks()
}

// Clear pjax marks from performance timeline.
function clearPjaxMarks() {
  window.performance.clearMarks(pjaxStartMark)
  window.performance.clearMarks(pjaxEndMark)
  window.performance.clearMeasures(pjaxMeasure)
}

if ('getEntriesByName' in window.performance) {
  document.addEventListener('pjax:start', markPjaxStart)
  document.addEventListener('pjax:end', trackPjaxTiming)
}
"þimport {microtask} from '../eventloop-tasks'
import {sendStats} from '../stats'

let lastTurboRequestUrl: string | null = null

// Collect User Timing metrics so we can track time-to-load on turbo actions
const turboMeasure = 'last_turbo_request'
const turboStartMark = 'turbo_start'
const turboEndMark = 'turbo_end'

// Mark turbo start on performance timeline and save url for last turbo request.
function markTurboStart(event: Event) {
  if (!(event instanceof CustomEvent)) return
  if (!event.detail?.url) return

  window.performance.mark(turboStartMark)
  lastTurboRequestUrl = event.detail.url
}

// Mark turbo end on performance timeline and report results.
async function trackTurboTiming() {
  await microtask()

  if (!window.performance.getEntriesByName(turboStartMark).length) return

  window.performance.mark(turboEndMark)
  window.performance.measure(turboMeasure, turboStartMark, turboEndMark)
  const measures = window.performance.getEntriesByName(turboMeasure)

  const measure = measures.pop()
  const duration = measure ? measure.duration : null
  if (!duration) return

  if (lastTurboRequestUrl) {
    sendStats({
      requestUrl: lastTurboRequestUrl,
      turboDuration: Math.round(duration)
    })
  }
  clearTurboMarks()
}

// Clear turbo marks from performance timeline.
function clearTurboMarks() {
  window.performance.clearMarks(turboStartMark)
  window.performance.clearMarks(turboEndMark)
  window.performance.clearMeasures(turboMeasure)
}

if ('getEntriesByName' in window.performance) {
  document.addEventListener('turbo:before-fetch-request', markTurboStart)
  document.addEventListener('turbo:render', trackTurboTiming)
}
"Ú// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

// Checks if two urls start with the same "/owner/repo" prefix.
function isSameRepo(url1: string, url2: string): boolean {
  const path1 = url1.split('/', 3).join('/')
  const path2 = url2.split('/', 3).join('/')
  return path1 === path2
}

// Disable cross-repo PJAX navigation
on('pjax:click', '#js-repo-pjax-container a[href]', function (event) {
  const url = (event.currentTarget as HTMLAnchorElement).pathname

  if (!isSameRepo(url, location.pathname)) {
    event.preventDefault()
  }
})

// Disable document download PJAX from /:owner/:repo/files/:id/:name.
on('pjax:click', '.js-comment-body', function (event) {
  const link = event.target
  if (link instanceof HTMLAnchorElement && link.pathname.split('/')[3] === 'files') {
    event.preventDefault()
  }
})
"µ// History back link
//
// Links tagged with "js-pjax-history-navigate" classname gain the behavior of popping the
// last item from the browser history stack if the link's href matches the URL of
// the last history item. This behavior is suitable for links whose purpose it so
// bring users back to the previous page.

import {getBackURL, getForwardURL} from '../../history'
import {completeProgressBar} from '../../soft-nav-helpers'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {isFeatureEnabled} from '../../features'

if (isFeatureEnabled('TURBO')) {
  ;(async () => {
    // okay to call `on` outside of global scope in this case as it's called conditionally to a feature flag
    // eslint-disable-next-line delegated-events/global-on
    on('click', '.js-turbo-history-navigate', function (ev) {
      const event = ev as MouseEvent

      if (!(event.currentTarget instanceof HTMLAnchorElement)) return
      // eslint-disable-next-line no-restricted-syntax
      if (event.shiftKey || event.metaKey || event.ctrlKey || event.altKey) return

      const backURL = getBackURL()
      const forwardURL = getForwardURL()

      if (backURL && event.currentTarget.href === backURL) {
        event.preventDefault()
        cancelNextTurboFrameFetchRequest(backURL)
        history.back()
      } else if (forwardURL && event.currentTarget.href === forwardURL) {
        event.preventDefault()
        cancelNextTurboFrameFetchRequest(forwardURL)
        history.forward()
      }
    })
  })()
} else {
  // okay to call `on` outside of global scope in this case as it's called conditionally to a feature flag
  // eslint-disable-next-line delegated-events/global-on
  on('pjax:click', '.js-pjax-history-navigate', function (event) {
    if (!(event.currentTarget instanceof HTMLAnchorElement)) return
    if (event.currentTarget.href === getBackURL()) {
      history.back()
      event.detail.relatedEvent.preventDefault()
      event.preventDefault()
    } else if (event.currentTarget.href === getForwardURL()) {
      history.forward()
      event.detail.relatedEvent.preventDefault()
      event.preventDefault()
    }
  })
}

function cancelNextTurboFrameFetchRequest(url: string) {
  document.addEventListener(
    'turbo:before-fetch-request',
    function (event) {
      const target = event.target as Element
      if (target?.tagName !== 'TURBO-FRAME') return

      const fetchUrl = (event as CustomEvent).detail.url.href
      if (url !== fetchUrl) return

      event.preventDefault()
      completeProgressBar()
    },
    {once: true}
  )
}
"ªexport function preserveScrollTo(element: Element) {
  if (element.getAttribute('data-pjax-preserve-scroll') != null) {
    return false
  } else {
    return 0
  }
}

export function detectContainer(target: Element): Element | null {
  let el: Element | null = target
  while (el) {
    const selector = el.getAttribute('data-pjax')
    if (selector && selector !== 'true') {
      return document.querySelector(selector)
    }
    el = el.parentElement && el.parentElement.closest('[data-pjax]')
  }

  return target.closest('[data-pjax-container]')
}
"¹import {detectContainer, preserveScrollTo} from './utils'
import {isFeatureEnabled} from '../../features'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import pjaxRequest from '../pjax'

on('click', '[data-pjax] a, a[data-pjax]', function (event) {
  const link = event.currentTarget
  if (link instanceof HTMLAnchorElement) {
    if (link.getAttribute('data-skip-pjax') != null) {
      return
    }
    if (link.getAttribute('data-remote') != null) {
      return
    }

    const container = detectContainer(link)
    if (container) {
      click(event, {
        container,
        scrollTo: preserveScrollTo(link)
      })
    }
  }
})

on('change', 'select[data-pjax]', function (event) {
  if (isFeatureEnabled('TURBO')) return

  const select = event.currentTarget as HTMLSelectElement
  const container = detectContainer(select)
  if (container) {
    pjaxRequest({url: select.value, container})
  }
})

function click(event: MouseEvent, options: {container: Element; scrollTo?: number | false}) {
  if (isFeatureEnabled('TURBO')) return

  // TODO: Refactor to use data-hotkey
  /* eslint eslint-comments/no-use: off */
  /* eslint-disable no-restricted-syntax */
  const link = event.currentTarget as HTMLAnchorElement

  // Middle click, cmd click, and ctrl click should open
  // links in a new tab as normal.
  if (event.button !== 0 || event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) return

  // Ignore cross origin links
  if (location.protocol !== link.protocol || location.hostname !== link.hostname) return

  // Ignore case when a hash is being tacked on the current URL
  if (link.href.indexOf('#') > -1 && stripHash(link) === stripHash(location)) return

  // Ignore event with default prevented
  if (event.defaultPrevented) return

  const opts = {
    url: link.href,
    target: link,
    ...options
  }

  const clickEvent = new CustomEvent('pjax:click', {
    bubbles: true,
    cancelable: true,
    detail: {options: opts, relatedEvent: event}
  })

  if (link.dispatchEvent(clickEvent)) {
    pjaxRequest(opts)
    event.preventDefault()
    link.dispatchEvent(new CustomEvent('pjax:clicked', {bubbles: true, cancelable: true, detail: {options: opts}}))
  }
  /* eslint-enable no-restricted-syntax */
}

// Return the `href` component of given URL object with the hash portion removed.
function stripHash(location: Location | HTMLAnchorElement): string {
  return location.href.replace(/#.*/, '')
}
"	import {detectContainer, preserveScrollTo} from './utils'
import pjaxRequest, {PjaxOptions} from '../pjax'
import {isFeatureEnabled} from '../../features'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {serialize} from '../../form'

on('submit', 'form[data-pjax]', function (event) {
  if (isFeatureEnabled('TURBO')) return

  const form = event.currentTarget as HTMLFormElement
  const container = detectContainer(form)

  if (!container) {
    return
  }

  const scrollTo = preserveScrollTo(form)

  const opts: PjaxOptions = {
    type: (form.method || 'GET').toUpperCase(),
    url: form.action,
    target: form,
    scrollTo,
    container
  }

  if (opts.type === 'GET') {
    // Can't handle file uploads, exit
    if (form.querySelector('input[type=file]')) {
      return
    }

    const url = parseURL(opts.url)
    url.search += (url.search ? '&' : '') + serialize(form)
    opts.url = url.toString()
  } else {
    opts.data = new FormData(form)
  }

  pjaxRequest(opts)
  event.preventDefault()
})

function parseURL(url: string): HTMLAnchorElement {
  const a = document.createElement('a')
  a.href = url
  return a
}
"¹// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

observe('body.js-print-popup', () => {
  window.print()
  setTimeout(window.close, 1000)
})
"¸// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

observe('poll-include-fragment[data-redirect-url]', function (el) {
  const url = el.getAttribute('data-redirect-url')!
  el.addEventListener('load', function () {
    window.location.href = url
  })
})

observe('poll-include-fragment[data-reload]', function (el) {
  el.addEventListener('load', function () {
    window.location.reload()
  })
})
"// Reports a proxy site and applies rudimentary obfuscation to the data that is sent.

import detectProxySite from '../proxy-site-detection'
import {reportError} from '../failbot'

// See lib/github/proxy_detection.rb
const ProxyDetectionParam = '$__'

const proxyPayload = document.querySelector('meta[name=js-proxy-site-detection-payload]')
const expectedHostname = document.querySelector('meta[name=expected-hostname]')

if (proxyPayload instanceof HTMLMetaElement && expectedHostname instanceof HTMLMetaElement) {
  if (detectProxySite(document)) {
    const data = {
      url: window.location.href,
      expectedHostname: expectedHostname.content,
      documentHostname: document.location.hostname,
      proxyPayload: proxyPayload.content
    }

    const error = new Error()
    const obj: {[key: string]: string} = {}
    obj[`${ProxyDetectionParam}`] = btoa(JSON.stringify(data))
    reportError(error, obj)
  }
}
 cþ/ /   Q u i c k   s u b m i t   u s i n g   #- E n t e r   o r   C t r l + E n t e r 
 / / 
 / /   W h e n   ` . j s - q u i c k - s u b m i t `   f i e l d   i s   f o c u s e d ,   #- E n t e r   o r   C t r l + E n t e r   w i l l   s u b m i t 
 / /   t h e   f o r m   i t   b e l o n g s   t o   u n l e s s   t h e   f i r s t   s u b m i t   b u t t o n   o f   t h a t   f o r m   i s   d i s a b l e d . 
 
 i m p o r t   { o n K e y }   f r o m   ' . . / o n f o c u s ' 
 i m p o r t   { r e q u e s t S u b m i t }   f r o m   ' . . / f o r m ' 
 
 o n K e y ( ' k e y d o w n ' ,   ' . j s - q u i c k - s u b m i t ' ,   f u n c t i o n   ( e v e n t :   K e y b o a r d E v e n t )   { 
     q u i c k S u b m i t ( e v e n t ) 
 } ) 
 
 f u n c t i o n   q u i c k S u b m i t ( e v e n t :   K e y b o a r d E v e n t )   { 
     / /   T O D O :   R e f a c t o r   t o   u s e   d a t a - h o t k e y 
     / *   e s l i n t   e s l i n t - c o m m e n t s / n o - u s e :   o f f   * / 
     / *   e s l i n t - d i s a b l e   n o - r e s t r i c t e d - s y n t a x   * / 
     c o n s t   f i e l d   =   e v e n t . t a r g e t   a s   H T M L I n p u t E l e m e n t   |   H T M L T e x t A r e a E l e m e n t 
 
     i f   ( ( e v e n t . c t r l K e y   | |   e v e n t . m e t a K e y )   & &   e v e n t . k e y   = = =   ' E n t e r ' )   { 
         c o n s t   f o r m   =   f i e l d . f o r m ! 
         c o n s t   b u t t o n   =   f o r m . q u e r y S e l e c t o r ( ' i n p u t [ t y p e = s u b m i t ] ,   b u t t o n [ t y p e = s u b m i t ] ' ) 
         i f   ( e v e n t . s h i f t K e y )   { 
             c o n s t   a l t B u t t o n   =   f o r m . q u e r y S e l e c t o r ( ' . j s - q u i c k - s u b m i t - a l t e r n a t i v e ' ) 
             i f   ( ( a l t B u t t o n   i n s t a n c e o f   H T M L I n p u t E l e m e n t   | |   a l t B u t t o n   i n s t a n c e o f   H T M L B u t t o n E l e m e n t )   & &   ! a l t B u t t o n . d i s a b l e d )   { 
                 r e q u e s t S u b m i t ( f o r m ,   a l t B u t t o n ) 
             } 
         }   e l s e   i f   ( b u t t o n   i n s t a n c e o f   H T M L I n p u t E l e m e n t   | |   b u t t o n   i n s t a n c e o f   H T M L B u t t o n E l e m e n t )   { 
             i f   ( ! b u t t o n . d i s a b l e d )   { 
                 r e q u e s t S u b m i t ( f o r m ) 
             } 
         }   e l s e   { 
             r e q u e s t S u b m i t ( f o r m ) 
         } 
         e v e n t . p r e v e n t D e f a u l t ( ) 
     } 
     / *   e s l i n t - e n a b l e   n o - r e s t r i c t e d - s y n t a x   * / 
 } 
 "ö2import {MarkdownQuote, Quote} from '@github/quote-selection'
import {debounce} from '@github/mini-throttle'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import visible from '../visible'

let activeSelection: SelectionContext | null

// Hide the "Quote reply" button on threads where there is no textarea to quote
// text into. This prevents it from showing up on locked threads.
observe('.js-comment-quote-reply', function (button) {
  ;(button as HTMLElement).hidden =
    button
      .closest('.js-quote-selection-container')
      ?.querySelector('.js-inline-comment-form-container textarea, .js-new-comment-form textarea') == null
})

function isHighlightContainer(el: Element): boolean {
  return el.nodeName === 'DIV' && el.classList.contains('highlight')
}

function hasContent(node: Node): boolean {
  return node.nodeName === 'IMG' || node.firstChild != null
}

const filters: {[key: string]: (arg0: HTMLElement) => string | HTMLElement} = {
  PRE(el) {
    const parent = el.parentElement
    if (parent && isHighlightContainer(parent)) {
      const match = parent.className.match(/highlight-source-(\S+)/)
      const flavor = match ? match[1] : ''
      const text = (el.textContent || '').replace(/\n+$/, '')
      el.textContent = `\`\`\`${flavor}\n${text}\n\`\`\``
      el.append('\n\n')
    }
    return el
  },
  A(el) {
    const text = el.textContent || ''
    if (el.classList.contains('user-mention') || el.classList.contains('team-mention')) {
      return text
    } else if (el.classList.contains('issue-link') && /^#\d+$/.test(text)) {
      return text
    } else {
      return el
    }
  },
  IMG(el) {
    const alt = el.getAttribute('alt')
    if (alt && el.classList.contains('emoji')) {
      return alt
    } else {
      return el
    }
  },
  DIV(el) {
    if (el.classList.contains('js-suggested-changes-blob')) {
      // skip quoting suggested changes widget
      el.remove()
    } else if (el.classList.contains('blob-wrapper-embedded')) {
      // handle embedded blob snippets
      const container = el.parentElement!
      const link = container.querySelector<HTMLAnchorElement>('a[href]')!
      const p = document.createElement('p')
      p.textContent = link.href
      container.replaceWith(p)
    }
    return el
  }
}

function insertMarkdownSyntax(root: DocumentFragment): void {
  const nodeIterator = document.createNodeIterator(root, NodeFilter.SHOW_ELEMENT, {
    acceptNode(node) {
      if (node.nodeName in filters && hasContent(node)) {
        return NodeFilter.FILTER_ACCEPT
      } else {
        return NodeFilter.FILTER_SKIP
      }
    }
  })
  const results: HTMLElement[] = []
  let node = nodeIterator.nextNode()

  while (node) {
    if (node instanceof HTMLElement) {
      results.push(node)
    }
    node = nodeIterator.nextNode()
  }

  // process deepest matches first
  results.reverse()

  for (const el of results) {
    el.replaceWith(filters[el.nodeName](el))
  }
}

on('click', '.js-comment-quote-reply', function ({isTrusted, currentTarget}) {
  const container = currentTarget.closest<HTMLElement>('.js-comment')!
  const commentBody = container.querySelector<HTMLElement>('.js-comment-body')!
  const commentBodyClone = container.querySelector<HTMLElement>('.js-comment-body')!.cloneNode(true)
  const quoteSelectionContainer = container.closest('.js-quote-selection-container')!
  // Remove elements that contain meta info and should not be present in the quoted text
  const ignorableElements = commentBody.querySelectorAll('button.js-convert-to-issue-button, span.js-clear')
  for (const el of ignorableElements) {
    el.remove()
  }
  let quote = new Quote()

  // User pressed `r` but has nothing selected
  if (!isTrusted && quote.range.collapsed) {
    return
  }

  if (quoteSelectionContainer.hasAttribute('data-quote-markdown')) {
    quote = new MarkdownQuote(
      quoteSelectionContainer.getAttribute('data-quote-markdown') || '',
      (fragment: DocumentFragment) => {
        const parent = quote.range.startContainer.parentElement
        const codeBlock = parent && parent.closest('pre')
        if (codeBlock instanceof HTMLElement) {
          const pp = codeBlock.parentElement
          if (pp && isHighlightContainer(pp)) {
            const div = document.createElement('div')
            div.className = pp.className
            div.appendChild(fragment)
            fragment.appendChild(div)
          }
        }
        insertMarkdownSyntax(fragment)
      }
    )
  }

  // If the user has selected text before clicking the dropdown, use that as the quote.
  // (Workaround for Safari clearing the selection just before <details> is opened).
  if (activeSelection && commentBody.contains(activeSelection.anchorNode)) {
    quote.range = activeSelection.range
  } else if (quote.range.collapsed) {
    quote.select(commentBody)
  }

  if (quote.closest('.js-quote-selection-container') !== quoteSelectionContainer) return

  // Capture the current range incase elements switch focus
  const range = quote.range

  quoteSelectionContainer.dispatchEvent(
    new CustomEvent('quote-selection', {
      bubbles: true,
      detail: quote
    })
  )

  // Replace the range for elements that changed focus
  quote.range = range

  for (const textarea of quoteSelectionContainer.querySelectorAll('textarea')) {
    if (visible(textarea)) {
      quote.insert(textarea)
      break
    }
  }

  // Restore the HTML to it's initial form. The ignorable elements had to be removed
  // So that the quote lib would not include then into the selection
  container.querySelector<HTMLElement>('.js-comment-body')!.replaceWith(commentBodyClone)
})

type SelectionContext = {
  anchorNode: Node | null
  range: Range
}

// Workaround for Safari clearing the selection just before a <details> element
// was activated: persist the previous selection and use its range when quoting.
let previousSelection: SelectionContext | null

document.addEventListener(
  'selectionchange',
  debounce(function () {
    const selection = window.getSelection()!
    let range
    try {
      range = selection.getRangeAt(0)
    } catch {
      previousSelection = null
      return
    }
    previousSelection = {
      anchorNode: selection.anchorNode,
      range
    }
  }, 100)
)
document.addEventListener(
  'toggle',
  () => {
    activeSelection = previousSelection
  },
  {capture: true}
)
"±// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {parseHTML} from '../parse-html'
import {remoteForm} from '@github/remote-form'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

/* eslint-disable-next-line compat/compat */
const resizeObserver = new ResizeObserver(entries => {
  for (const entry of entries) {
    if (entry.contentRect.height > 26) {
      hideReactionOverflow(entry.target as HTMLElement)
    }
  }
})

observe('.js-reactions-container', function (el) {
  resizeObserver.observe(el)
})

function hideReactionOverflow(reactionContainer: HTMLElement) {
  // 0.8 for a little buffer
  const availableWidth = reactionContainer.offsetWidth * 0.8
  const reactionButtons = reactionContainer.querySelectorAll<HTMLElement>('.js-reaction-group-button')
  const allReactionsPopover = reactionContainer.querySelector<HTMLElement>('.js-all-reactions-popover')

  let totalButtonWidth = 0
  for (const button of reactionButtons) {
    totalButtonWidth += button.clientWidth
  }
  totalButtonWidth += allReactionsPopover?.clientWidth || 0

  if (availableWidth < totalButtonWidth) {
    let remainingWidth = availableWidth

    if (allReactionsPopover) {
      allReactionsPopover.removeAttribute('hidden')
      remainingWidth -= allReactionsPopover.offsetWidth
    }

    for (const button of reactionButtons) {
      const buttonWidth = button.offsetWidth
      if (buttonWidth > remainingWidth) {
        button.setAttribute('hidden', 'hidden')
      } else {
        button.removeAttribute('hidden')
      }
      remainingWidth -= buttonWidth
    }
  }
}

remoteForm('.js-pick-reaction', async function (form, send) {
  const response = await send.json()

  const comment = form.closest<HTMLElement>('.js-comment')!
  const reactionsContainer = comment.querySelector<HTMLElement>('.js-reactions-container')!
  const reactionsHeader = comment.querySelector<HTMLElement>('.js-comment-header-reaction-button')!

  const newReactions = parseHTML(document, response.json['reactions_container'].trim())
  const newReactionButton = parseHTML(document, response.json['comment_header_reaction_button'].trim())
  reactionsContainer.replaceWith(newReactions)
  reactionsHeader.replaceWith(newReactionButton)
})

function showReactionContent(event: MouseEvent) {
  const target = event.target as HTMLElement

  const label = target.getAttribute('data-reaction-label')!
  const container = target.closest<HTMLElement>('.js-add-reaction-popover')!
  const description = container.querySelector<HTMLElement>('.js-reaction-description')!

  if (!description.hasAttribute('data-default-text')) {
    description.setAttribute('data-default-text', description.textContent || '')
  }

  description.textContent = label
}

function hideReactionContent(event: MouseEvent) {
  const container = (event.target as HTMLElement).closest<HTMLElement>('.js-add-reaction-popover')!
  const description = container.querySelector<HTMLElement>('.js-reaction-description')!

  const defaultText = description.getAttribute('data-default-text')
  if (defaultText) {
    description.textContent = defaultText
  }
}

on(
  'toggle',
  '.js-reaction-popover-container',
  function (event) {
    const isOpen = event.currentTarget.hasAttribute('open')
    for (const item of (event.target as Element).querySelectorAll<HTMLElement>('.js-reaction-option-item')) {
      if (isOpen) {
        item.addEventListener('mouseenter', showReactionContent)
        item.addEventListener('mouseleave', hideReactionContent)
      } else {
        item.removeEventListener('mouseenter', showReactionContent)
        item.removeEventListener('mouseleave', hideReactionContent)
      }
    }
  },
  {capture: true}
)
")// Remote
//
// Implements `data-remote` for forms.
//
//
// Markup
//
// `<form>`
//
// ``` definition-table
// Attribute - Description
//
// `data-remote`
//   Enables remote behavior on the element if set to anything.
//
// `method`
//   Changes the method of the AJAX request. Defaults to `"get"`. Maps to
//   jQuery's [type](http://api.jquery.com/jQuery.ajax/).
//
// `action`
//   URL for AJAX request. Defaults to the current url. Maps to jQuery's
//   [`url`](http://api.jquery.com/jQuery.ajax/).
//
// `data-type`
//   Specify the data type of the response. Can be `"xml"`, `"json"`,
//   `"script"`, or `"html"`. Defaults to jQuery's *"intelligent guess"*
//   from the response content type. Maps to jQuery's
//   [`dataType`](http://api.jquery.com/jQuery.ajax/).
// ```
//
// ``` html
// <form action="/comment" method="post" data-remote></form>
// ```
//
//
// Events
//
// Use delegated jQuery's global AJAX events to handle successful
// and error states. See jQuery's [AJAX event
// documentation](http://docs.jquery.com/Ajax_Events) for a complete
// reference.
//
// `deprecatedAjaxSuccess`
//
// This event is only called if the request was successful (no errors from the server, no errors with the data).
//
// ``` definition-table
// Property - Value
//
// Synchronicity  - Sync
// Bubbles        - Yes
// Cancelable     - No
// Target         - `form` element with `[data-remote]`
// ```
//
// `ajaxError`
//
// This event is only called if an error occurred with the request (you can never
// have both an error and a success callback with a request).
//
// ``` definition-table
// Property - Value
//
// Synchronicity  - Sync
// Bubbles        - Yes
// Cancelable     - No
// Target         - `form` element with `[data-remote]`
// Extra arguments
//   `status` - Status response number
//   `error` - Error message string
//   `text` - Response text string
// ```
//
// `deprecatedAjaxComplete`
//
// This event is called regardless of if the request was successful, or not. You
// will always receive a complete callback, even for synchronous requests.
//
// ``` definition-table
// Property - Value
//
// Synchronicity  - Sync
// Bubbles        - Yes
// Cancelable     - No
// Target         - `form` element with `[data-remote]`
// ```
//
//     on('deprecatedAjaxSend', '.new-comment', function(event) {
//        event.currentTarget.classList.add('loading')
//     })
//
//     on('deprecatedAjaxComplete', '.new-comment', function(event) {
//        event.currentTarget.classList.remove('loading')
//     })
//
//     on('deprecatedAjaxSuccess', '.new-comment', function (event) {
//        event.currentTarget.classList.add('success')
//     })
//
//     on('deprecatedAjaxError', '.new-comment', function (event) {
//       alert("Something went wrong!")
//     })
//
//
// Intercept all form submissions with data-remote and turn
// it into a XHR request instead.

import type {Kicker, SimpleRequest, SimpleResponse} from '@github/remote-form'
import {afterRemote, beforeRemote, remoteForm} from '@github/remote-form'
import {findPersistedSubmitButtonValue, persistSubmitButtonValue} from '../remote-submit'
// eslint-disable-next-line no-restricted-imports
import {fire, on} from 'delegated-events'
import verifySso from '../sso'

function submitWithLegacyEvents(form: HTMLFormElement, send: Kicker, req: SimpleRequest) {
  const dataType = form.getAttribute('data-type')
  if (dataType === 'json') {
    req.headers.set('Accept', 'application/json')
  }

  fire(form, 'deprecatedAjaxSend', {request: req})

  send
    .text()
    /* eslint-disable-next-line github/no-then */
    .catch(err => {
      if (err.response) {
        return err.response
      } else {
        throw err
      }
    })
    /* eslint-disable-next-line github/no-then */
    .then(
      (response: SimpleResponse) => {
        if (response.status < 300) {
          fire(form, 'deprecatedAjaxSuccess')
        } else {
          fire(form, 'deprecatedAjaxError', {error: response.statusText, status: response.status, text: response.text})
        }
      },
      err => {
        fire(form, 'deprecatedAjaxError', {error: err.message, status: 0, text: null})
      }
    )
    /* eslint-disable-next-line github/no-then */
    .then(() => {
      fire(form, 'deprecatedAjaxComplete')
    })
}

// Persist submit button value for ALL forms, regardless of whether they are
// ajax-enabled or not. The submit value is reset after either `deprecatedAjaxComplete`
// has fired or `remoteForm` has finished processing.
on(
  'click',
  ['form button:not([type])', 'form button[type=submit]', 'form input[type=submit]'].join(', '),
  function (event) {
    const button = event.currentTarget as HTMLButtonElement | HTMLInputElement
    const form = button.form
    if (form && !event.defaultPrevented) {
      persistSubmitButtonValue(button)
    }
  }
)

remoteForm('form[data-remote]', submitWithLegacyEvents)

// Restore forms after AJAX submissions
on('deprecatedAjaxComplete', 'form', function ({currentTarget}) {
  const el = findPersistedSubmitButtonValue(currentTarget as HTMLFormElement)
  if (el) el.remove()
})

afterRemote(form => {
  const button = findPersistedSubmitButtonValue(form)
  if (button) button.remove()
})

beforeRemote(verifySso)
"ð	// Removed Contents behavior
//
// When "has-removed-contents" is added to an Element, its contents are
// detached from the document and stored in memory. Once the class is removed,
// the original contents are automatically reinserted into the document.
//
// WARNING: Adding new content to an Element while it has its contents detatch
// has undefined behavior.
//
// This behavior is useful when working with form with multiple states. Using
// d-none is only presentational and doesn't exclude the form fields from
// being submitted or participating in validation requirements.

// eslint-disable-next-line no-restricted-imports
import {fire} from 'delegated-events'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

observe('.has-removed-contents', function () {
  let contents: ChildNode[]
  return {
    add(parent) {
      contents = Array.from(parent.childNodes)
      for (const el of contents) {
        parent.removeChild(el)
      }
      const form = parent.closest('form')
      if (form) fire(form, 'change')
    },
    remove(parent) {
      for (const el of contents) {
        parent.appendChild(el)
      }
      const form = parent.closest('form')
      if (form) fire(form, 'change')
    }
  }
})
 ci m p o r t   { T e m p l a t e R e s u l t ,   h t m l ,   r e n d e r }   f r o m   ' l i t - h t m l ' 
 / /   e s l i n t - d i s a b l e - n e x t - l i n e   n o - r e s t r i c t e d - i m p o r t s 
 i m p o r t   { o b s e r v e }   f r o m   ' s e l e c t o r - o b s e r v e r ' 
 / /   e s l i n t - d i s a b l e - n e x t - l i n e   n o - r e s t r i c t e d - i m p o r t s 
 i m p o r t   { o n }   f r o m   ' d e l e g a t e d - e v e n t s ' 
 
 i n t e r f a c e   C o l o r M o d e P a r a m   { 
     c o l o r _ m o d e :   O m i t < C o l o r M o d e s ,   ' a u t o ' > 
 } 
 
 e n u m   C o l o r M o d e s   { 
     A u t o   =   ' a u t o ' , 
     L i g h t   =   ' l i g h t ' , 
     D a r k   =   ' d a r k ' 
 } 
 
 / * * 
   *   g e t U s e r S y s t e m C o l o r M o d e   A t t e m p t s   t o   d e t e c t   t h e   c o l o r   m o d e   t h e   u s e r   h a s   s p e c i f i e d 
   *   i n   t h e i r   o p e r a t i n g   s y s t e m ' s   p r e f e r e n c e s . 
   *   D e f a u l t s   t o   ' l i g h t ' 
   *   @ r e t u r n s   O n e   o f   ' l i g h t '   o r   ' d a r k '   c o l o r   m o d e s . 
   * / 
 f u n c t i o n   g e t U s e r S y s t e m C o l o r M o d e ( )   { 
     i f   ( w i n d o w . m a t c h M e d i a ( ` ( p r e f e r s - c o l o r - s c h e m e :   $ { C o l o r M o d e s . D a r k } ) ` ) . m a t c h e s )   { 
         r e t u r n   C o l o r M o d e s . D a r k 
     } 
 
     r e t u r n   C o l o r M o d e s . L i g h t 
 } 
 
 / /   E n r i c h a b l e   M a r k d o w n   R e n d e r i n g : 
 / / 
 / /   W e   u s e   t h e   ` m a r k d o w n - e n r i c h m e n t `   t o   r e n d e r   c o d e   b l o c k s   i n   m a r k d o w n . 
 / /   T h e   C o d e R e n d e r S e r v i c e   i s   r e s p o n s i b l e   f o r   r e n d e r i n g   t h e   c o d e   b l o c k s   t o   h t m l   a n d 
 / /   t h i s   c o d e   w i l l   f i n d   t h o s e   b l o c k s   a n d   e n r i c h   t h e m   w i t h   t h e   c o d e   r e n d e r i n g   s e r v i c e   a p p r o p r i a t e 
 / /   f o r   t h e   l a n g u a g e . 
 / /   I f   w e ' r e   e n r i c h i n g   a   r a w   c o d e   b l o c k ,   w e   n e e d   t o   h i d e   t h e   o r i g i n a l 
 / /   c o d e   b l o c k   o n c e   t h e   i f r a m e   h a s   r e n d e r e d   s u c c e s s f u l l y 
 
 c o n s t   R E N D E R _ P L A I N T E X T _ S E L E C T O R   =   ' . j s - r e n d e r - p l a i n t e x t ' 
 e x p o r t   f u n c t i o n   m a r k d o w n E n r i c h m e n t S u c c e s s ( w h e r e :   E l e m e n t )   { 
     c o n s t   p a r e n t   =   w h e r e . c l o s e s t ( ' . j s - r e n d e r - n e e d s - e n r i c h m e n t ' ) 
     i f   ( ! p a r e n t )   { 
         r e t u r n 
     } 
 
     c o n s t   r a w C o d e B l o c k   =   p a r e n t . q u e r y S e l e c t o r ( R E N D E R _ P L A I N T E X T _ S E L E C T O R ) 
 
     i f   ( r a w C o d e B l o c k )   { 
         s e t C o d e B l o c k L o a d e r V i s i b i l i t y ( p a r e n t   a s   H T M L E l e m e n t ,   f a l s e ) 
     } 
 } 
 
 e x p o r t   f u n c t i o n   s h o w M a r k d o w n R e n d e r E r r o r ( p a r e n t :   H T M L E l e m e n t ,   t e m p l a t e :   T e m p l a t e R e s u l t )   { 
     s e t C o d e B l o c k L o a d e r V i s i b i l i t y ( p a r e n t ,   f a l s e ) 
     s e t R a w C o d e B l o c k V i s i b i l i t y ( p a r e n t ,   t r u e ) 
     p a r e n t . c l a s s L i s t . a d d ( ' r e n d e r - e r r o r ' ) 
 
     c o n s t   p l a i n t e x t T a r g e t   =   p a r e n t . q u e r y S e l e c t o r ( R E N D E R _ P L A I N T E X T _ S E L E C T O R ) 
     i f   ( ! p l a i n t e x t T a r g e t )   { 
         r e t u r n 
     } 
     p l a i n t e x t T a r g e t . c l a s s L i s t . r e m o v e ( ' r e n d e r - p l a i n t e x t - h i d d e n ' ) 
     c o n s t   p l a i n t e x t E l   =   p l a i n t e x t T a r g e t . q u e r y S e l e c t o r ( ' p r e ' )   a s   H T M L E l e m e n t 
 
     r e n d e r ( h t m l ` $ { t e m p l a t e }   $ { p l a i n t e x t E l } ` ,   p l a i n t e x t T a r g e t ) 
 } 
 
 / /   S h o w   t h e   s p i n n e r   o r   n o t   w h e n   e n r i c h i n g   a   c o d e   b l o c k . 
 f u n c t i o n   s e t C o d e B l o c k L o a d e r V i s i b i l i t y ( w h e r e :   H T M L E l e m e n t ,   l o a d e r V i s i b l e :   b o o l e a n )   { 
     c o n s t   l o a d e r   =   w h e r e . g e t E l e m e n t s B y C l a s s N a m e ( ' j s - r e n d e r - e n r i c h m e n t - l o a d e r ' ) [ 0 ]   a s   H T M L E l e m e n t 
     c o n s t   e x p a n d e r   =   w h e r e . g e t E l e m e n t s B y C l a s s N a m e ( ' r e n d e r - e x p a n d ' ) [ 0 ]   a s   H T M L E l e m e n t 
     i f   ( l o a d e r )   { 
         l o a d e r . h i d d e n   =   ! l o a d e r V i s i b l e 
     } 
     i f   ( e x p a n d e r )   { 
         e x p a n d e r . h i d d e n   =   l o a d e r V i s i b l e 
     } 
 } 
 
 f u n c t i o n   s e t R a w C o d e B l o c k V i s i b i l i t y ( w h e r e :   H T M L E l e m e n t ,   c o d e V i s i b l e :   b o o l e a n )   { 
     c o n s t   r a w C o d e B l o c k   =   w h e r e . q u e r y S e l e c t o r ( R E N D E R _ P L A I N T E X T _ S E L E C T O R )   a s   H T M L E l e m e n t 
 
     i f   ( c o d e V i s i b l e )   { 
         r a w C o d e B l o c k . c l a s s L i s t . r e m o v e ( ' r e n d e r - p l a i n t e x t - h i d d e n ' ) 
     }   e l s e   { 
         r a w C o d e B l o c k . c l a s s L i s t . a d d ( ' r e n d e r - p l a i n t e x t - h i d d e n ' ) 
     } 
 } 
 
 c l a s s   E n r i c h a b l e M a r k d o w n R e n d e r e r   { 
     e n r i c h m e n t T a r g e t :   H T M L E l e m e n t 
     e l :   H T M L E l e m e n t 
     i f r a m e U r l :   s t r i n g 
     i d e n t i f i e r :   s t r i n g 
     i f r a m e C o n t e n t T y p e :   s t r i n g 
     i f r a m e O r i g i n :   s t r i n g 
     i f r a m e C o n t e n t :   s t r i n g 
 
     c o n s t r u c t o r ( e l :   H T M L E l e m e n t )   { 
         t h i s . e l   =   e l 
         t h i s . e n r i c h m e n t T a r g e t   =   e l . g e t E l e m e n t s B y C l a s s N a m e ( ' j s - r e n d e r - e n r i c h m e n t - t a r g e t ' ) [ 0 ]   a s   H T M L E l e m e n t 
         t h i s . i f r a m e U r l   =   t h i s . g e t I f r a m e U r l ( ) 
         t h i s . i d e n t i f i e r   =   t h i s . e l . g e t A t t r i b u t e ( ' d a t a - i d e n t i t y ' ) ! 
         t h i s . i f r a m e C o n t e n t T y p e   =   t h i s . e l . g e t A t t r i b u t e ( ' d a t a - t y p e ' ) ! 
         t h i s . i f r a m e O r i g i n   =   n e w   U R L ( t h i s . i f r a m e U r l ,   w i n d o w . l o c a t i o n . o r i g i n ) . o r i g i n 
         t h i s . i f r a m e C o n t e n t   =   t h i s . e l . g e t A t t r i b u t e ( ' d a t a - c o n t e n t ' ) ! 
         / /   S e t u p   t h e   l o a d i n g   s t a t e   f o r   t h i s   c o d e   b l o c k   t o   s h o w   t h e   s p i n n e r 
         s e t C o d e B l o c k L o a d e r V i s i b i l i t y ( t h i s . e l ,   t r u e ) 
     } 
 
     e n r i c h ( )   { 
         c o n s t   e n r i c h e d   =   t h i s . c r e a t e D i a l o g ( ) 
         r e n d e r ( e n r i c h e d ,   t h i s . e n r i c h m e n t T a r g e t ) 
         t h i s . s e t u p M o d a l ( ) 
     } 
 
     p r i v a t e   g e t I f r a m e U r l ( )   { 
         c o n s t   b a s e U r l   =   t h i s . e l . g e t A t t r i b u t e ( ' d a t a - s r c ' ) ! 
         c o n s t   p a r a m s   =   { 
             . . . t h i s . c o l o r M o d e ( ) 
         } 
         c o n s t   q u e r y P a r a m s   =   O b j e c t . e n t r i e s ( p a r a m s ) 
             . m a p ( ( [ k e y ,   v a l ] )   = >   ` $ { k e y } = $ { v a l } ` ) 
             . j o i n ( ' & ' ) 
 
         r e t u r n   ` $ { b a s e U r l } ? $ { q u e r y P a r a m s } ` 
     } 
 
     / * * 
       *   c o l o r M o d e   q u e r i e s   t h e   D O M   f o r   t h e   u s e r ' s   p r e f e r r e d 
       *   c o l o r   m o d e   s e t t i n g      e i t h e r   ` d a r k ` ,   ` l i g h t ` ,   o r   ` a u t o ` .   A   v a l u e   o f 
       *   ` a u t o `   i n d i c a t e s   t h a t   t h e   c o l o r   m o d e   i s   d e r i v e d   f r o m   t h e   u s e r ' s 
       *   s y s t e m   p r e f e r e n c e s ,   w h i c h   t r i g g e r s   a   f u r t h e r   c h e c k . 
       * 
       *   @ r e t u r n s   C o l o r M o d e P a r a m 
       * / 
     p r i v a t e   c o l o r M o d e ( ) :   C o l o r M o d e P a r a m   { 
         l e t   c o l o r M o d e   =   d o c u m e n t . q u e r y S e l e c t o r ( ' h t m l ' ) ? . g e t A t t r i b u t e ( ' d a t a - c o l o r - m o d e ' ) 
 
         i f   ( c o l o r M o d e   = = =   C o l o r M o d e s . A u t o   | |   ! c o l o r M o d e )   { 
             c o l o r M o d e   =   g e t U s e r S y s t e m C o l o r M o d e ( ) 
         } 
 
         r e t u r n   { c o l o r _ m o d e :   c o l o r M o d e } 
     } 
     / /   W e   n e e d   s o m e   i n t e r a c t i o n s   i n   t h e   m o d a l   t o   a d d   t h e 
     / /   i f r a m e   t o   t h e   d i a l o g   w h e n   i t   i s   o p e n e d .   W e   t a g   t h e   i f r a m e 
     / /   w i t h   a   f u l l   s c r e e n   i d e n t i f i e r   s o   t h e   r e n d e r i n g   s e r v i c e   h a s   a 
     / /   u n i q u e   i d e n t i f i e r   f o r   t h e   i f r a m e . 
     p r i v a t e   s e t u p M o d a l ( )   { 
         c o n s t   i f r a m e   =   t h i s . g e n e r a t e I f r a m e C o d e ( ' - f u l l s c r e e n ' ) 
         c o n s t   d i a l o g E l   =   t h i s . e l . q u e r y S e l e c t o r ( ' . B o x - b o d y ' )   a s   H T M L E l e m e n t 
         c o n s t   d i a l o g B u t t o n   =   t h i s . e l . q u e r y S e l e c t o r ( ' . j s - f u l l - s c r e e n - r e n d e r ' )   a s   H T M L B u t t o n E l e m e n t 
         d i a l o g B u t t o n . a d d E v e n t L i s t e n e r ( ' c l i c k ' ,   ( )   = >   { 
             r e n d e r ( i f r a m e ,   d i a l o g E l ) 
         } ) 
     } 
 
     / /   T h i s   i s   a   d i a l o g   e l e m e n t   t o   a l l o w   t h e   u s e r   t o   s e e   t h e   f u l l   s c r e e n   r e n d e r i n g 
     / /   i t   c a l l s   o u t   t h e   i f r a m e   c o d e   t o   b e   r e n d e r e d   i n   t h e   n o r m a l   v i e w 
     p r i v a t e   c r e a t e D i a l o g ( )   { 
         c o n s t   i f r a m e D o m   =   t h i s . g e n e r a t e I f r a m e C o d e ( ) 
         r e t u r n   h t m l `   < d i v   c l a s s = " d - f l e x   f l e x - c o l u m n   f l e x - a u t o   j s - r e n d e r - b o x " > 
             < d e t a i l s   c l a s s = " d e t a i l s - r e s e t   d e t a i l s - o v e r l a y   d e t a i l s - o v e r l a y - d a r k " > 
                 < s u m m a r y   c l a s s = " b t n - s m   b t n   p o s i t i o n - a b s o l u t e   j s - f u l l - s c r e e n - r e n d e r   r e n d e r - e x p a n d "   a r i a - h a s p o p u p = " d i a l o g "   h i d d e n > 
                     < s v g 
                         w i d t h = " 1 6 " 
                         h e i g h t = " 1 6 " 
                         v i e w B o x = " 0   0   1 6   1 6 " 
                         f i l l = " c u r r e n t C o l o r " 
                         c l a s s = " o c t i c o n " 
                         s t y l e = " d i s p l a y : i n l i n e - b l o c k ; v e r t i c a l - a l i g n : t e x t - b o t t o m " 
                     > 
                         < p a t h 
                             f i l l - r u l e = " e v e n o d d " 
                             d = " M 3 . 7 2   3 . 7 2 a . 7 5 . 7 5   0   0 1 1 . 0 6   1 . 0 6 L 2 . 5 6   7 h 1 0 . 8 8 l - 2 . 2 2 - 2 . 2 2 a . 7 5 . 7 5   0   0 1 1 . 0 6 - 1 . 0 6 l 3 . 5   3 . 5 a . 7 5 . 7 5   0   0 1 0   1 . 0 6 l - 3 . 5   3 . 5 a . 7 5 . 7 5   0   1 1 - 1 . 0 6 - 1 . 0 6 l 2 . 2 2 - 2 . 2 2 H 2 . 5 6 l 2 . 2 2   2 . 2 2 a . 7 5 . 7 5   0   1 1 - 1 . 0 6   1 . 0 6 l - 3 . 5 - 3 . 5 a . 7 5 . 7 5   0   0 1 0 - 1 . 0 6 l 3 . 5 - 3 . 5 z " 
                         > < / p a t h > 
                     < / s v g > 
                 < / s u m m a r y > 
                 < d e t a i l s - d i a l o g   c l a s s = " B o x   B o x - - o v e r l a y   r e n d e r - f u l l - s c r e e n   d - f l e x   f l e x - c o l u m n   a n i m - f a d e - i n   f a s t " > 
                     < d i v > 
                         < b u t t o n 
                             a r i a - l a b e l = " C l o s e   d i a l o g " 
                             d a t a - c l o s e - d i a l o g = " " 
                             t y p e = " b u t t o n " 
                             d a t a - v i e w - c o m p o n e n t = " t r u e " 
                             c l a s s = " L i n k - - m u t e d   b t n - l i n k   p o s i t i o n - a b s o l u t e   r e n d e r - f u l l - s c r e e n - c l o s e " 
                         > 
                             < s v g 
                                 w i d t h = " 2 4 " 
                                 h e i g h t = " 2 4 " 
                                 v i e w B o x = " 0   0   2 4   2 4 " 
                                 f i l l = " c u r r e n t C o l o r " 
                                 s t y l e = " d i s p l a y : i n l i n e - b l o c k ; v e r t i c a l - a l i g n : t e x t - b o t t o m " 
                                 c l a s s = " o c t i c o n   o c t i c o n - x " 
                             > 
                                 < p a t h 
                                     f i l l - r u l e = " e v e n o d d " 
                                     d = " M 5 . 7 2   5 . 7 2 a . 7 5 . 7 5   0   0 1 1 . 0 6   0 L 1 2   1 0 . 9 4 l 5 . 2 2 - 5 . 2 2 a . 7 5 . 7 5   0   1 1 1 . 0 6   1 . 0 6 L 1 3 . 0 6   1 2 l 5 . 2 2   5 . 2 2 a . 7 5 . 7 5   0   1 1 - 1 . 0 6   1 . 0 6 L 1 2   1 3 . 0 6 l - 5 . 2 2   5 . 2 2 a . 7 5 . 7 5   0   0 1 - 1 . 0 6 - 1 . 0 6 L 1 0 . 9 4   1 2   5 . 7 2   6 . 7 8 a . 7 5 . 7 5   0   0 1 0 - 1 . 0 6 z " 
                                 > < / p a t h > 
                             < / s v g > 
                         < / b u t t o n > 
                         < d i v   c l a s s = " B o x - b o d y " > < / d i v > 
                     < / d i v > 
                 < / d e t a i l s - d i a l o g > 
             < / d e t a i l s > 
             $ { i f r a m e D o m } 
         < / d i v > ` 
     } 
 
     / /   G e n e r a t e   t h e   i f r a m e   c o d e   t o   b e   r e n d e r e d 
     p r i v a t e   g e n e r a t e I f r a m e C o d e ( i d e n t i t y P r e f i x   =   ' ' )   { 
         c o n s t   i f r a m e I d e n t i t y   =   t h i s . i d e n t i f i e r   +   i d e n t i t y P r e f i x 
         c o n s t   i f r a m e U r l   =   ` $ { t h i s . i f r a m e U r l } # $ { i f r a m e I d e n t i t y } ` 
 
         r e t u r n   h t m l ` 
             < d i v 
                 c l a s s = " r e n d e r - c o n t a i n e r   j s - r e n d e r - t a r g e t   p - 0 " 
                 d a t a - i d e n t i t y = " $ { i f r a m e I d e n t i t y } " 
                 d a t a - h o s t = " $ { t h i s . i f r a m e O r i g i n } " 
                 d a t a - t y p e = " $ { t h i s . i f r a m e C o n t e n t T y p e } " 
             > 
                 < i f r a m e 
                     c l a s s = " r e n d e r - v i e w e r " 
                     s r c = " $ { i f r a m e U r l } " 
                     n a m e = " $ { i f r a m e I d e n t i t y } " 
                     d a t a - c o n t e n t = " $ { t h i s . i f r a m e C o n t e n t } " 
                     s a n d b o x = " a l l o w - s c r i p t s   a l l o w - s a m e - o r i g i n   a l l o w - t o p - n a v i g a t i o n " 
                 > 
                 < / i f r a m e > 
             < / d i v > 
         ` 
     } 
 } 
 
 o b s e r v e ( ' . j s - r e n d e r - n e e d s - e n r i c h m e n t ' ,   f u n c t i o n   ( e l )   { 
     c o n s t   h t m l E l   =   e l   a s   H T M L E l e m e n t 
     c o n s t   e n r i c h e r   =   n e w   E n r i c h a b l e M a r k d o w n R e n d e r e r ( h t m l E l ) 
     e n r i c h e r . e n r i c h ( ) 
 } ) 
 
 / * * 
   *   T o g g l i n g   b a c k   a n d   f o r t h   b e t w e e n   t h e   ` p r e v i e w `   a n d   ` w r i t e `   t a b s   p r o d u c e s   j a n k   i n 
   *   t h e   f o r m   o f   a n   o c c a s i o n a l l y   v i s i b l e   f u l l y   r e n d e r e d   c h a r t .   T h i s   i s   b e c a u s e   w e   l e a v e   t h e 
   *   c h a r t   o n   t h e   p a g e   u n t i l   a   r e q u e s t   t o   r e g e n e r a t e   t h e   c h a r t   c a n   b e   m a d e . 
   * 
   *   S o ,   w e   a d d   a n   e v e n t   i n   ` p r e v i e w . t s `   w e   c a n   h o o k   i n t o , 
   *   a n d   c l e a r   o u t   t h e   p r e v i o u s l y   r e n d e r e d   c h a r t   b e f o r e   r e q u e s t i n g   a   n e w   o n e   f r o m   v i e w s c r e e n 
   * / 
 o n ( ' p r e v i e w : t o g g l e : o f f ' ,   ' . j s - p r e v i e w a b l e - c o m m e n t - f o r m ' ,   f u n c t i o n   ( e v e n t )   { 
     c o n s t   t a r g e t   =   e v e n t . c u r r e n t T a r g e t 
     c o n s t   h t m l E l   =   t a r g e t . q u e r y S e l e c t o r < H T M L E l e m e n t > ( ' . j s - r e n d e r - n e e d s - e n r i c h m e n t ' ) 
     c o n s t   e n r i c h T a r g e t   =   h t m l E l ? . q u e r y S e l e c t o r ( ' . j s - r e n d e r - e n r i c h m e n t - t a r g e t ' ) 
 
     i f   ( ! e n r i c h T a r g e t )   { 
         r e t u r n 
     } 
 
     e n r i c h T a r g e t . i n n e r H T M L   =   ' ' 
 } ) 
 
 o n ( ' p r e v i e w : r e n d e r e d ' ,   ' . j s - p r e v i e w a b l e - c o m m e n t - f o r m ' ,   f u n c t i o n   ( e v e n t )   { 
     c o n s t   t a r g e t   =   e v e n t . c u r r e n t T a r g e t 
     c o n s t   h t m l E l   =   t a r g e t . q u e r y S e l e c t o r < H T M L E l e m e n t > ( ' . j s - r e n d e r - n e e d s - e n r i c h m e n t ' ) 
     i f   ( h t m l E l )   { 
         s e t R a w C o d e B l o c k V i s i b i l i t y ( h t m l E l ,   f a l s e ) 
     } 
 } ) 
 
 e x p o r t   d e f a u l t   E n r i c h a b l e M a r k d o w n R e n d e r e r 
 ">import {TemplateResult, html, render} from 'lit-html'
import {markdownEnrichmentSuccess, showMarkdownRenderError} from './enrichable-markdown-render'

// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
import visible from '../visible'
interface RenderTiming {
  load?: number | null
  helloTimer?: number | null
  hello?: number | null
  loadTimer?: number | null
  untimed?: boolean
}

// These are the mutable state classes. They are to be wiped between transitions.
const stateClasses = ['is-render-pending', 'is-render-ready', 'is-render-loading', 'is-render-loaded']
// During a pjax navigation, we need to clear most of the mutable state classes, but preserve `is-render-pending`.
// We also want to clear out any of the failed state classes, since they prevent the user from viewing content
// which has otherwise rendered correctly
const pjaxStateClasses = [
  'is-render-ready',
  'is-render-loading',
  'is-render-loaded',
  'is-render-failed',
  'is-render-failed-fatally'
]
const timingData: WeakMap<Element, RenderTiming> = new WeakMap()
function resetTiming(where: Element) {
  const renderTiming = timingData.get(where)
  if (renderTiming == null) {
    return
  }
  renderTiming.load = renderTiming.hello = null
  if (renderTiming.helloTimer) {
    clearTimeout(renderTiming.helloTimer)
    renderTiming.helloTimer = null
  }
  if (renderTiming.loadTimer) {
    clearTimeout(renderTiming.loadTimer)
    renderTiming.loadTimer = null
  }
}

// Everything is broken, sink with the ship
function renderFailed(where: Element, msg = '') {
  where.classList.remove(...stateClasses)
  where.classList.add('is-render-failed')

  const errElement = renderError(msg)

  // determine if we're rendering a file or a code block
  const markdownRender = where.parentElement?.closest('.js-render-needs-enrichment') as HTMLElement
  if (markdownRender) {
    showMarkdownRenderError(markdownRender, errElement)
  } else {
    fileRenderError(where as HTMLElement, errElement)
  }
  resetTiming(where)
}

function fileRenderError(parent: HTMLElement, template: TemplateResult) {
  const child = parent.querySelector('.render-viewer-error')
  if (child) {
    child.remove()
    parent.classList.remove('render-container')
    render(template, parent)
  }
}

function renderError(msg: string) {
  let errMsg = html`<p>Unable to render code block</p>`
  if (msg !== '') {
    const msgLines = msg.split('\n')
    errMsg = html`<p><b>Error rendering embedded code</b></p>
      <p>${msgLines.map(line => html`${line}<br />`)}</p>`
  }
  return html`<div class="flash flash-error">${errMsg}</div>`
}

function timeoutWatchdog(where: Element, checkHello = false) {
  if (
    !visible(where as HTMLElement) ||
    where.classList.contains('is-render-ready') ||
    where.classList.contains('is-render-failed') ||
    where.classList.contains('is-render-failed-fatally') ||
    (checkHello && !timingData.get(where)?.hello)
  ) {
    return
  }

  renderFailed(where)
}

// Update each container with a potentially
// changed element every time a refresh or pjax
// triggers.
observe('.js-render-target', function (el) {
  const htmlEl = el as HTMLElement
  htmlEl.classList.remove(...pjaxStateClasses)
  htmlEl.style.height = 'auto'

  if (timingData.get(el)?.load) {
    return
  }

  resetTiming(el)

  if (timingData.get(el)) {
    return
  }

  timingData.set(el, {
    load: Date.now(),
    hello: null,
    helloTimer: window.setTimeout(timeoutWatchdog, 10_000, el, true),
    loadTimer: window.setTimeout(timeoutWatchdog, 45_000, el)
  })

  el.classList.add('is-render-automatic', 'is-render-requested')
})

interface RenderMessage {
  type: string
  body?: unknown
}

function postAsJson(renderWindow: Window | null | undefined, message: RenderMessage) {
  if (renderWindow && renderWindow.postMessage) {
    renderWindow.postMessage(JSON.stringify(message), '*')
  }
}

export function handleMessage(event: MessageEvent) {
  let result = event.data
  if (!result) return

  if (typeof result === 'string') {
    try {
      result = JSON.parse(result) as unknown
    } catch {
      // Ignore parse errors
      return
    }
  }

  if (result.type !== 'render') return

  if (typeof result.identity !== 'string') return
  const identity = result.identity

  if (typeof result.body !== 'string') return
  const body = result.body

  let container: HTMLElement | null = null
  for (const target of document.querySelectorAll<HTMLElement>('.js-render-target')) {
    if (target.getAttribute('data-identity') === identity) {
      container = target
      break
    }
  }

  if (!container) return

  if (event.origin !== container.getAttribute('data-host')) {
    return
  }

  const payload = result.payload != null ? result.payload : undefined
  const iframe = container.querySelector('iframe')
  const renderWindow = iframe?.contentWindow

  function postData() {
    const data = iframe?.getAttribute('data-content')
    if (!data) {
      return
    }
    const msg = {
      type: 'render:cmd',
      body: {
        cmd: 'code_rendering_service:data:ready',
        'code_rendering_service:data:ready': {
          data: JSON.parse(data).data,
          width: container?.getBoundingClientRect().width
        }
      }
    }
    postAsJson(renderWindow, msg)
  }

  switch (body) {
    case 'hello':
      {
        const renderTiming = timingData.get(container) || {
          untimed: true
        }

        renderTiming.hello = Date.now()

        const ackmsg = {
          type: 'render:cmd',
          body: {
            cmd: 'ack',
            ack: true
          }
        }

        const msg = {
          type: 'render:cmd',
          body: {
            cmd: 'branding',
            branding: false
          }
        }

        if (!renderWindow) return
        postAsJson(renderWindow, ackmsg)
        postAsJson(renderWindow, msg)
      }
      break
    case 'error':
      if (payload) {
        renderFailed(container, payload.error)
      } else {
        renderFailed(container)
      }
      break
    case 'error:fatal': {
      renderFailed(container)
      container.classList.add('is-render-failed-fatal')
      break
    }
    case 'error:invalid':
      renderFailed(container)
      container.classList.add('is-render-failed-invalid')
      break
    case 'loading':
      container.classList.remove(...stateClasses)
      container.classList.add('is-render-loading')
      break
    case 'loaded':
      container.classList.remove(...stateClasses)
      container.classList.add('is-render-loaded')
      break
    case 'ready':
      markdownEnrichmentSuccess(container)
      container.classList.remove(...stateClasses)
      container.classList.add('is-render-ready')

      if (payload && typeof payload.height === 'number') {
        container.style.height = `${payload.height}px`

        // If the URL contains an anchor tag, try not to disrupt the scroll position
        if (location.hash !== '') {
          window.dispatchEvent(new HashChangeEvent('hashchange'))
        }
      }

      break
    case 'resize':
      if (payload && typeof payload.height === 'number') {
        container.style.height = `${payload.height}px`
      }

      break
    case 'code_rendering_service:container:get_size':
      postAsJson(renderWindow, {
        type: 'render:cmd',
        body: {
          cmd: 'code_rendering_service:container:size',
          'code_rendering_service:container:size': {
            width: container?.getBoundingClientRect().width
          }
        }
      })
      break
    case 'code_rendering_service:markdown:get_data':
      if (!renderWindow) return
      postData()
      break
    default:
      break
  }
}

// Handle messages coming from the viewer iframe using `postMessage`.
// We throw away any message that doesn't look like it's coming from the render
// client.
window.addEventListener('message', handleMessage)
"import {remoteForm} from '@github/remote-form'

remoteForm('form[data-replace-remote-form]', async function (form, wants) {
  form.classList.remove('is-error')
  form.classList.add('is-loading')
  try {
    let target: Element = form

    const response = await wants.html()
    const container = form.closest('[data-replace-remote-form-target]')
    if (container) {
      const id = container.getAttribute('data-replace-remote-form-target')
      target = id ? document.getElementById(id)! : container
    }
    target.replaceWith(response.html)
  } catch (e) {
    form.classList.remove('is-loading')
    form.classList.add('is-error')
  }
})
"import {sendStats} from '../stats'

if (PerformanceObserver && (PerformanceObserver.supportedEntryTypes || []).includes('longtask')) {
  const observer = new PerformanceObserver(function (list) {
    const longTasks = list.getEntries().map(({name, duration}) => ({name, duration, url: window.location.href}))
    sendStats({longTasks})
  })
  observer.observe({entryTypes: ['longtask']})
}
"Üimport MarkdownToolbarElement from '@github/markdown-toolbar-element'
import {dialog} from '../details-dialog'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

const selectionEnds = new WeakMap()

function getTextarea(el: HTMLElement): HTMLTextAreaElement {
  return el.closest<MarkdownToolbarElement>('markdown-toolbar')!.field!
}

on('click', '.js-markdown-link-button', async function ({currentTarget}) {
  const template = document.querySelector<HTMLTemplateElement>('.js-markdown-link-dialog')!
  const content = template.content.cloneNode(true)
  if (!(content instanceof DocumentFragment)) return

  const dialogEl = await dialog({
    content,
    labelledBy: 'box-title'
  })
  if (!(currentTarget instanceof HTMLElement)) return
  selectionEnds.set(dialogEl, getTextarea(currentTarget).selectionEnd)
})

on('click', '.js-markdown-link-insert', ({currentTarget}) => {
  const container = currentTarget.closest<HTMLElement>('details-dialog')!
  const textarea = document.querySelector<HTMLTextAreaElement>(`#${currentTarget.getAttribute('data-for-textarea')!}`)!
  const selectionEnd = selectionEnds.get(container) || 0

  const href = container.querySelector<HTMLInputElement>('#js-dialog-link-href')!.value
  const text = container.querySelector<HTMLInputElement>('#js-dialog-link-text')!.value
  const link = `[${text}](${href}) `
  const before = textarea.value.slice(0, selectionEnd)
  const after = textarea.value.slice(selectionEnd)
  textarea.value = before + link + after
  textarea.focus()
  textarea.selectionStart = textarea.selectionEnd = selectionEnd + link.length
})
"import {eventToHotkeyString} from '@github/hotkey'
import {insertText} from '../text'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {onKey} from '../onfocus'

on(
  'details-menu-select',
  '.js-saved-reply-menu',
  function (event) {
    if (!(event.target instanceof Element)) return

    const body = event.detail.relatedTarget.querySelector('.js-saved-reply-body')

    // Since this details-menu-select can hold options which arent saved
    // replies, we guard to ensure that only saved replies are handled here.
    if (!body) return

    const text = (body.textContent || '').trim()
    const container = event.target.closest<HTMLElement>('.js-previewable-comment-form')!

    const comment = container.querySelector<HTMLTextAreaElement>('textarea.js-comment-field')!
    insertText(comment, text)
    setTimeout(() => comment.focus(), 0)
  },
  {capture: true}
)

onKey('keydown', '.js-saved-reply-shortcut-comment-field', function (event) {
  if (eventToHotkeyString(event) === 'Control+.') {
    const container = (event.target as Element).closest<HTMLElement>('.js-previewable-comment-form')!
    const menu = container.querySelector<HTMLElement>('.js-saved-reply-container')!
    menu.setAttribute('open', '')
    event.preventDefault()
  }
})

onKey('keydown', '.js-saved-reply-filter-input', function (event: KeyboardEvent) {
  // TODO: Refactor to use data-hotkey
  /* eslint eslint-comments/no-use: off */
  /* eslint-disable no-restricted-syntax */
  if (/^Control\+[1-9]$/.test(eventToHotkeyString(event))) {
    const container = (event.target as Element).closest<HTMLElement>('.js-saved-reply-container')!
    const replies = container.querySelectorAll('[role="menuitem"]')
    const savedReplyNumber = Number(event.key)
    const reply = replies[savedReplyNumber - 1]
    if (reply instanceof HTMLElement) {
      reply.click()
      event.preventDefault()
    }
  } else if (event.key === 'Enter') {
    const container = (event.target as Element).closest<HTMLElement>('.js-saved-reply-container')!
    const replies = container.querySelectorAll('[role="menuitem"]')

    if (replies.length > 0 && replies[0] instanceof HTMLButtonElement) {
      replies[0].click()
    }

    event.preventDefault()
  }
  /* eslint-enable no-restricted-syntax */
})
"ñimport type {BlobRange} from '../blob-anchor'
import {DOMRangeFromBlob} from '../blob-anchor'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
import {surroundContents} from '../range'
import {GetCharIndexFromBytePosition} from '../text'

function queryLineElement(snippet: Element, line: number) {
  return snippet.querySelector(`#LC${line}`)
}

function highlightRange(blobRange: BlobRange, snippet: Element, adjustStart: boolean, adjustEnd: boolean) {
  const range = DOMRangeFromBlob(blobRange, line => queryLineElement(snippet, line))
  if (!range) return

  if (adjustStart) {
    const adjustedStart = GetCharIndexFromBytePosition(range.startContainer.textContent!, range.startOffset)
    if (adjustedStart === -1) return
    range.setStart(range.startContainer, adjustedStart)
  }

  if (adjustEnd) {
    const adjustedEnd = GetCharIndexFromBytePosition(range.endContainer.textContent!, range.endOffset)
    if (adjustedEnd === -1) return
    range.setEnd(range.endContainer, adjustedEnd)
  }

  const span = document.createElement('span')
  const highlightClasses = ['text-bold', 'hx_keyword-hl', 'rounded-2', 'd-inline-block']

  span.classList.add(...highlightClasses)
  surroundContents(range, span)
}

export function highlightColumns(blobRange: BlobRange, snippet: Element) {
  if (blobRange.start.line !== blobRange.end.line) {
    // highlight first line, and adjust only the start as there may be Unicode characters
    // preceding the start column
    const startBlobRange = {
      start: {line: blobRange.start.line, column: blobRange.start.column},
      end: {line: blobRange.start.line, column: null}
    }
    highlightRange(startBlobRange, snippet, true, false)

    for (let i = blobRange.start.line + 1; i < blobRange.end.line; i += 1) {
      // highlight middle lines, and do not adjust anything since we're highlighting
      // the whole line
      const fullBlobRange = {
        start: {line: i, column: 0},
        end: {line: i, column: null}
      }
      highlightRange(fullBlobRange, snippet, false, false)
    }

    // highlight last line, and only adjust the end as there may be Unicode characters
    // in the middle of the match
    const endBlobRange = {
      start: {line: blobRange.end.line, column: 0},
      end: {line: blobRange.end.line, column: blobRange.end.column}
    }
    highlightRange(endBlobRange, snippet, false, true)
  } else {
    highlightRange(blobRange, snippet, true, true)
  }
}

export function parseColumnHighlightRange(snippet: Element): BlobRange | null {
  const startLine = parseInt(snippet.getAttribute('data-start-line')!)
  const endLine = parseInt(snippet.getAttribute('data-end-line')!)
  const startColumn = parseInt(snippet.getAttribute('data-start-column')!)
  // The end column is a special case, as 0 acts as a special value
  const dataEndColumn = parseInt(snippet.getAttribute('data-end-column')!)

  // Nothing to highlight if start and end lines and start and end cols are the
  // same, as column ranges are half-open
  if (startLine === endLine && startColumn === dataEndColumn) return null

  // 0 here indicates that no end column was provided, so the highlight should
  // continue to the end of the line.
  // DOMRangeFromBlob will interpret null in a similar way to this.
  const endColumn = dataEndColumn !== 0 ? dataEndColumn : null

  return {
    start: {line: startLine, column: startColumn},
    end: {line: endLine, column: endColumn}
  }
}

observe('.js-highlight-code-snippet-columns', function (snippet: Element) {
  const blobRange = parseColumnHighlightRange(snippet)
  if (blobRange !== null) {
    highlightColumns(blobRange, snippet)
  }
})
"Ï// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

on('click', '.js-segmented-nav-button', function (event) {
  event.preventDefault()
  const target = event.currentTarget

  const selectedTabSelector = target.getAttribute('data-selected-tab')!
  const navigationContainer = target.closest<HTMLElement>('.js-segmented-nav')!
  const container = navigationContainer.parentElement!

  for (const button of navigationContainer.querySelectorAll('.js-segmented-nav-button')) {
    button.classList.remove('selected')
  }

  target.classList.add('selected')

  for (const tab of container.querySelectorAll('.js-selected-nav-tab')) {
    if (tab.parentElement === container) {
      tab.classList.remove('active')
    }
  }

  document.querySelector<HTMLElement>(`.${selectedTabSelector}`)!.classList.add('active')
})
"Éimport {persistResumableFields, restoreResumableFields, setForm} from '@github/session-resume'
import {debounce} from '@github/mini-throttle'
import {getPageID} from '../session-resume-helpers'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

const debouncedRestoreResumableFields = debounce(function () {
  restoreResumableFields(getPageID())
}, 50)

/**
 * Returns true while turbo is showing a "preview" of the route from cache: in other words between
 * the time a route is visited and the time it is loaded
 * @returns boolean
 */
function isTurboRenderingCachePreview(): boolean {
  return document.querySelector('html')?.hasAttribute('data-turbo-preview') ?? false
}

// Session Resume.
//
// Annotate fields to be persisted on navigation away from the current page.
// Fields be automatically restored when the user revists the page again in
// their current browser session (excludes seperate tabs).
//
// Not design for persisted crash recovery.

// Listen for all form submit events and to see if their default submission
// behavior is invoked.
window.addEventListener('submit', setForm, {capture: true})

// Resume field content on regular page loads.
window.addEventListener('pageshow', function () {
  restoreResumableFields(getPageID())
})

// Resume field content on pjax page loads.
window.addEventListener('pjax:end', function () {
  restoreResumableFields(getPageID())
})

// Resume field content on elements that are added later
// We use a debounced version to avoid repeatedly calling it if multiple
// fields are added
observe('.js-session-resumable', function () {
  // we don't want to restore fields on turbo-cache previews as that empties the cache
  // causing the fields to be lost when turbo re-renders with the fetched page
  if (!isTurboRenderingCachePreview()) {
    debouncedRestoreResumableFields()
  }
})

// Persist resumable fields when page is unloaded
window.addEventListener('pagehide', function () {
  persistResumableFields(getPageID(), {selector: '.js-session-resumable'})
})

// Persist resumable fields before pjax swaps them out
window.addEventListener('pjax:beforeReplace', function (event) {
  const state = event.detail.previousState
  const url = state ? state.url : null

  if (url) {
    persistResumableFields(getPageID(new URL(url, window.location.origin)), {selector: '.js-session-resumable'})
  } else {
    const error = new Error('pjax:beforeReplace event.detail.previousState.url is undefined')
    setTimeout(function () {
      throw error
    })
  }
})

// preserve fields before navigating away
window.addEventListener('turbo:before-visit', function () {
  persistResumableFields(getPageID(), {selector: '.js-session-resumable'})
})

// restore fields once turbo navigation has finished
window.addEventListener('turbo:load', function () {
  restoreResumableFields(getPageID())
})
"°import {SOFT_NAV_STATE} from '../soft-nav-helpers'

// Deal with selected_link_to on repository and gist pages
function updateSelectedRepoTab() {
  const meta = document.querySelector('meta[name="selected-link"]')
  const selection = meta && meta.getAttribute('value')

  if (!selection) {
    return
  }
  for (const item of document.querySelectorAll('.js-sidenav-container-pjax .js-selected-navigation-item')) {
    const isSelected = (item.getAttribute('data-selected-links') || '').split(' ').indexOf(selection) >= 0
    isSelected ? item.setAttribute('aria-current', 'page') : item.removeAttribute('aria-current')
    item.classList.toggle('selected', isSelected)
  }
}

document.addEventListener('pjax:end', updateSelectedRepoTab)

document.addEventListener(SOFT_NAV_STATE.FRAME_UPDATE, updateSelectedRepoTab)
"Åimport {getItem, removeItem, setItem} from '../../session-storage'

type ShelfReferrerParams = {
  notification_referrer_id?: string
  notifications_before?: string
  notifications_after?: string
  notifications_query?: string
}

const shelfParams: Array<keyof ShelfReferrerParams> = [
  'notification_referrer_id',
  'notifications_before',
  'notifications_after',
  'notifications_query'
]

const sessionStorageKey = 'notification_shelf'

/*
 * Stores url params for the shelf in session storage if present, and returns
 * search params without any shelf params.
 */
export function storeAndStripShelfParams(
  searchParams: URLSearchParams,
  pathname: string | null = null
): URLSearchParams | null {
  if (searchParams.has('notification_referrer_id')) {
    storeShelfParams(searchParams, pathname)
    return deleteShelfParams(searchParams)
  }
  return null
}

/*
 * Loads the shelf params from sessionStorage if they are there and they match
 * the current pull request page, clear them otherwise.
 */
export function getStoredShelfParamsForCurrentPage(pathname: string | null = null): ShelfReferrerParams | null {
  // If the current page is not a pull request, then the stored data will
  // not match, so clear it and move on.
  const currentPullRequestPathname = getCurrentPullRequestPathname(pathname)
  if (!currentPullRequestPathname) {
    removeItem(sessionStorageKey)
    return null
  }

  try {
    const str = getItem(sessionStorageKey)
    if (!str) return null

    const stored = JSON.parse(str)
    if (!stored || !stored.pathname) throw new Error('Must have a pathname')

    if (stored.pathname !== currentPullRequestPathname) {
      throw new Error('Stored pathname does not match current pathname.')
    }

    const result: ShelfReferrerParams = {}

    for (const key of shelfParams) {
      result[key] = stored[key]
    }

    return result
  } catch (e) {
    removeItem(sessionStorageKey)
    return null
  }
}

function storeShelfParams(searchParams: URLSearchParams, pathname: string | null) {
  const pullRequestPathname = getCurrentPullRequestPathname(pathname)
  if (!pullRequestPathname) return

  const params: {[key: string]: string} = {
    pathname: pullRequestPathname
  }

  for (const key of shelfParams) {
    const value = searchParams.get(key)
    if (value) params[key] = value
  }

  setItem(sessionStorageKey, JSON.stringify(params))
}

function deleteShelfParams(searchParams: URLSearchParams): URLSearchParams {
  for (const key of shelfParams) {
    searchParams.delete(key)
  }
  return searchParams
}

/*
 * Returns the base pathname of the current page if it's a pull request.
 *
 * `/github/github/pull/123/files` -> `/github/github/pull/123`
 */
function getCurrentPullRequestPathname(pathname: string | null): string | null {
  pathname = pathname || window.location.pathname
  const pullRequestPathnameRegex = /^(\/[^/]+\/[^/]+\/pull\/[^/]+)/
  const match = pathname.match(pullRequestPathnameRegex)
  if (!match) return null

  return match[0]
}
"§import {getStoredShelfParamsForCurrentPage, storeAndStripShelfParams} from './notification-shelf-referrer-params'
import IncludeFragmentElement from '@github/include-fragment-element'
import type {Kicker} from '@github/remote-form'
import {remoteForm} from '@github/remote-form'
import {updateNotificationStates} from './update-notification-states'

// Perform an action and change the status of the notification shelf.
export async function remoteShelfActionForm() {
  return remoteForm('.js-notification-shelf .js-notification-action form', async function (form, wants) {
    const shouldRedirect = form.hasAttribute('data-redirect-to-inbox-on-submit')

    if (shouldRedirect) {
      await performRequest(wants)
      const inboxButton = document.querySelector<HTMLAnchorElement>('.js-notifications-back-to-inbox')!

      if (inboxButton) {
        inboxButton.click()
      }

      return
    }

    updateNotificationStates(form, form)
    await performRequest(wants)
  })
}

export function urlWithoutNotificationParameters() {
  const searchParams = new URLSearchParams(window.location.search)
  const cleanSearchParams = storeAndStripShelfParams(searchParams)

  if (cleanSearchParams) {
    const newUrl = new URL(window.location.href, window.location.origin)
    newUrl.search = cleanSearchParams.toString()
    return newUrl.toString()
  }
}

export function loadShelfFromStoredParams(includeFragmentEl: Element) {
  if (!(includeFragmentEl instanceof IncludeFragmentElement)) {
    return
  }

  const params = getStoredShelfParamsForCurrentPage()
  if (!params) return

  const baseUrl = includeFragmentEl.getAttribute('data-base-src')
  if (!baseUrl) return

  const shelfURL = new URL(baseUrl, window.location.origin)
  const searchParams = new URLSearchParams(shelfURL.search)

  for (const [key, value] of Object.entries(params)) {
    if (typeof value === 'string') searchParams.set(key, value)
  }
  shelfURL.search = searchParams.toString()
  includeFragmentEl.setAttribute('src', shelfURL.toString())
}

// Submits an AJAX request, but ignores any errors.
async function performRequest(wants: Kicker) {
  try {
    await wants.text()
  } catch (error) {
    // TODO show error message
  }
}
"import {
  loadShelfFromStoredParams,
  remoteShelfActionForm,
  urlWithoutNotificationParameters
} from './../notifications/v2/notification-shelf-helpers'
import {loaded} from '../document-ready'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {replaceState} from '../history'
import {requestSubmit} from '../form'
import {SOFT_NAV_STATE} from '../soft-nav-helpers'

remoteShelfActionForm()

// Remove the notification_referrer_id parameter from the url on page load and on Turbo loads
function removeNotificationParams() {
  const newUrl = urlWithoutNotificationParameters()
  if (newUrl) replaceState(null, '', newUrl)
}
removeNotificationParams()
document.addEventListener(SOFT_NAV_STATE.SUCCESS, removeNotificationParams)

observe('.js-notification-shelf-include-fragment', loadShelfFromStoredParams)

on('submit', '.js-mark-notification-form', async function (event) {
  const form = event.currentTarget as HTMLFormElement
  event.preventDefault()
  try {
    await fetch(form.action, {
      method: form.method,
      body: new FormData(form),
      headers: {
        Accept: 'application/json',
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
  } catch {
    // Ignore network errors
  }
})

// mark related notification as read
async function markNotificationAsRead() {
  await loaded

  const form = document.querySelector('.js-mark-notification-form')
  if (form instanceof HTMLFormElement) {
    requestSubmit(form)
  }
}

document.addEventListener(SOFT_NAV_STATE.SUCCESS, markNotificationAsRead)
markNotificationAsRead()
"ÿimport {onFocus, onKey} from '../onfocus'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

function isJumpToAvailable(field: Element): boolean {
  return !!field.closest('.js-jump-to-field')
}

function toggleSearchScope(field: HTMLElement, enabled: boolean) {
  // We don't want legacy search behaviour of changing scope on backspace when using Jump To.
  if (isJumpToAvailable(field)) {
    return
  }
  const form = document.querySelector<HTMLFormElement>('.js-site-search-form')!
  document.querySelector<HTMLElement>('.js-site-search')!.classList.toggle('scoped-search', enabled)

  let url
  let placeholder
  if (enabled) {
    url = form.getAttribute('data-scoped-search-url')!
    placeholder = field.getAttribute('data-scoped-placeholder')!
  } else {
    url = form.getAttribute('data-unscoped-search-url')!
    placeholder = field.getAttribute('data-unscoped-placeholder')!
  }

  form.setAttribute('action', url)
  field.setAttribute('placeholder', placeholder)
}

onKey('keyup', '.js-site-search-field', function (event: KeyboardEvent) {
  // TODO: Refactor to use data-hotkey
  /* eslint eslint-comments/no-use: off */
  /* eslint-disable no-restricted-syntax */
  const field = event.target as HTMLInputElement

  const emptyQuery = field.value.length === 0
  if (emptyQuery && event.key === 'Backspace' && field.classList.contains('is-clearable')) {
    toggleSearchScope(field, false)
  }
  if (emptyQuery && event.key === 'Escape') {
    toggleSearchScope(field, true)
  }
  field.classList.toggle('is-clearable', emptyQuery)
  /* eslint-enable no-restricted-syntax */
})

onFocus('.js-site-search-focus', function (field) {
  const container = field.closest<HTMLElement>('.js-chromeless-input-container')!
  container.classList.add('focus')

  // Restore scope on blur
  function blurHandler() {
    container.classList.remove('focus')
    if ((field as HTMLInputElement).value.length === 0 && field.classList.contains('js-site-search-field')) {
      toggleSearchScope(field, true)
    }
    field.removeEventListener('blur', blurHandler)
  }

  field.addEventListener('blur', blurHandler)
})

on('submit', '.js-site-search-form', function (event) {
  if (!(event.target instanceof Element)) return
  const input = event.target.querySelector<HTMLInputElement>('.js-site-search-type-field')!
  input.value = new URLSearchParams(window.location.search).get('type') || ''
})
"æ// Size to Fit textarea behavior
//
// Auto sizes any textareas marked with `.js-size-to-fit` to its text
// contents height.

// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
import subscribe from '@github/textarea-autosize'

observe('textarea.js-size-to-fit', {
  constructor: HTMLTextAreaElement,
  subscribe
})
"Ö	/**
 * Smooth scrolling anchor.
 *
 * Have an in-page anchor link and want the page to smoothly scroll to its destination? Look no further.
 *
 * Apply the `.js-smoothscroll-anchor` on the anchor tag to trigger smooth scrolling.
 *
 * This will override the default behavior of jumping the page to the element targeted by the hash in the `href`
 * and instead smoothly scroll to it. No additional CSS is required.
 *
 * @deprecated Replace this behavior with `scroll-behavior: smooth;`
 *   https://developer.mozilla.org/en-US/docs/Web/CSS/scroll-behavior.
 *
 * @example
 * ```html
 * <a href="#some-id" class="js-smoothscroll-anchor">Scroll to #some-id</a>
 * <div id="some-id" style="margin-top: 300px;">
 *   <h3>Scroll to me</h3>
 * </div>
 * ```
 */

import {findFragmentTarget} from '../fragment-target'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

on('click', '.js-smoothscroll-anchor', function (event) {
  const anchor = event.currentTarget
  if (!(anchor instanceof HTMLAnchorElement)) return

  const target = findFragmentTarget(document, anchor.hash)
  if (!target) return
  ;(target as HTMLElement).focus()

  target.scrollIntoView({behavior: 'smooth'})
  event.preventDefault()
})
"é// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

const hiddenTimePeriodOnScrollInMs = 1000

const abortControllers = new WeakMap()

const snippetClipboardCopyTemplate = document.querySelector<HTMLTemplateElement>('#snippet-clipboard-copy-button')

async function insertSnippetClipboardCopyButton(el: HTMLElement, signal: AbortSignal): Promise<void> {
  const clipboardContent = el.getAttribute('data-snippet-clipboard-copy-content')
  if (clipboardContent === null) return

  // Remove this attribute so that we don't add a second button.
  el.removeAttribute('data-snippet-clipboard-copy-content')

  if (!(snippetClipboardCopyTemplate instanceof HTMLTemplateElement)) return

  const documentFragment = snippetClipboardCopyTemplate.content.cloneNode(true) as DocumentFragment

  const clonedZeroClipboardContainer = documentFragment.children[0]
  if (!(clonedZeroClipboardContainer instanceof HTMLElement)) return

  const clipboardCopyElement = clonedZeroClipboardContainer.children[0]
  if (!(clipboardCopyElement instanceof HTMLElement)) return

  clipboardCopyElement.setAttribute('value', clipboardContent)

  document.addEventListener(
    'selectionchange',
    () => {
      const selection = document.getSelection()
      if (selection && el.contains(selection.anchorNode)) {
        const selectedText = selection?.toString()
        clipboardCopyElement.style.display = selectedText.trim() === '' ? 'inherit' : 'none'
      }
    },
    {signal}
  )

  const scrollableElement = el.querySelector('pre')
  if (scrollableElement !== null) {
    let timer: ReturnType<typeof setTimeout> | undefined

    /* eslint-disable-next-line github/prefer-observers */
    scrollableElement.addEventListener(
      'scroll',
      () => {
        if (timer) clearTimeout(timer)

        clipboardCopyElement.style.display = 'none'
        timer = setTimeout(() => {
          clipboardCopyElement.style.display = 'inherit'
        }, hiddenTimePeriodOnScrollInMs)
      },
      {signal}
    )
  }

  el.appendChild(clonedZeroClipboardContainer)
}

observe('[data-snippet-clipboard-copy-content]', {
  constructor: HTMLElement,
  add(el) {
    if (el.parentElement && el.parentElement.classList.contains('js-no-snippet-clipboard-copy')) return

    const abortController = new AbortController()
    abortControllers.set(el, abortController)

    insertSnippetClipboardCopyButton(el, abortController.signal)
  }
})

observe('.snippet-clipboard-content clipboard-copy', {
  constructor: HTMLElement,
  remove(el) {
    const controller = abortControllers.get(el)
    if (controller) {
      controller.abort()
    }
  }
})
"$// Social Buttons
//
// Behavior for the Watch, Fork, and Star buttons within repo nav.
//
// Expects the JSON response to a .js-social-form XHR request to be in this format:
//
// On success:
//
// { "count": "1,234" }
//
// Count is formatted with delimiters. The social count in any .js-social child of .js-social-container will be updated
// to the new value.
//
// If the form is annotated with the .js-deferred-toggler-target class, the .js-toggler container will have its state
// toggled after the successful response has arrived (and not optimistically as .js-toggler-target behaves).
//
// Any .js-social-updatable child of .js-social-container with a data-url will also be re-fetched and updated with new
// content.
//
// Failure cases:
//
// 409 Conflict - indicates that the user needs to confirm the social action in a dialog.
//
// {
//   "confirmationDialog": {
//     "templateSelector": "[CSS selector to find DOM element containing <template> for dialog contents]",
//     "inputs": { "arbitraryTemplateParts": "..." }
//   }
// }
//
// Any other 4xx or 5xx error will result in a generic global error being shown.

import type {SimpleResponse} from '@github/remote-form'
import {TemplateInstance} from '@github/template-parts'
import {dialog} from '../details-dialog'
// eslint-disable-next-line no-restricted-imports
import {fire} from 'delegated-events'
import {remoteForm} from '@github/remote-form'
import {showGlobalError} from './ajax-error'
import {updateContent} from '../updatable-content'

function handleSocialResponse(
  container: HTMLElement,
  newCount: string,
  isDeferredTogglerTarget: boolean
): Promise<void[]> {
  updateSocialCounts(container, newCount)
  if (isDeferredTogglerTarget) container.classList.toggle('on')

  const updatePromises = Array.from(container.querySelectorAll<HTMLElement>('.js-social-updatable'), updateContent)
  return Promise.all(updatePromises)
}

remoteForm('.js-social-form', async function (form, wants) {
  let response: SimpleResponse
  const container = form.closest<HTMLElement>('.js-social-container')
  const isDeferredTogglerTarget = form.classList.contains('js-deferred-toggler-target')

  try {
    response = await wants.json()

    if (container) await handleSocialResponse(container, response.json.count, isDeferredTogglerTarget)
  } catch (e) {
    // 409 Conflict: the user needs to accept a confirmation dialog. Find its template and trigger it.
    if (e.response?.status === 409 && e.response.json.confirmationDialog) {
      const dialogPayload = e.response.json.confirmationDialog
      const confirmationDialogTemplate = document.querySelector<HTMLTemplateElement>(dialogPayload.templateSelector)
      const confirmCsrfToken = form.querySelector<HTMLInputElement>('.js-confirm-csrf-token')?.value

      if (confirmationDialogTemplate instanceof HTMLTemplateElement && confirmCsrfToken) {
        const content = new TemplateInstance(confirmationDialogTemplate, {
          confirmUrl: form.action,
          confirmCsrfToken,
          ...(dialogPayload.inputs || {})
        })
        const dialogElement = await dialog({content})

        dialogElement.addEventListener('social-confirmation-form:success', async event => {
          if (!(event instanceof CustomEvent)) return
          if (container) await handleSocialResponse(container, event.detail.count, isDeferredTogglerTarget)
        })

        dialogElement.addEventListener('social-confirmation-form:error', () => {
          showGlobalError()
        })
      }
    } else {
      // If the social form is also a toggler, but *not* a deferred one, it was optimistically toggled on click. Because
      // the action failed, we need to toggle it back off here so it won't be in an incorrect state.
      if (container && !isDeferredTogglerTarget) container.classList.toggle('on')

      showGlobalError()
    }
  }
})

remoteForm('.js-social-confirmation-form', async function (form, wants) {
  try {
    const response = await wants.json()
    fire(form, 'social-confirmation-form:success', response.json)
  } catch {
    fire(form, 'social-confirmation-form:error')
  }
})

export function updateSocialCounts(container: HTMLElement, newCount: string) {
  for (const count of container.querySelectorAll('.js-social-count')) {
    count.textContent = newCount

    const singularSuffix = count.getAttribute('data-singular-suffix')
    const pluralSuffix = count.getAttribute('data-plural-suffix')
    const suffix = newCount === '1' ? singularSuffix : pluralSuffix

    if (suffix) {
      count.setAttribute('aria-label', `${newCount} ${suffix}`)
    }
  }
}
"û	import {AliveSession as BaseAliveSession} from '@github/alive-client'
import type {Notifier} from '@github/alive-client'
export class AliveSession<T> extends BaseAliveSession<T> {
  constructor(url: string, private refreshUrl: string, shared: boolean, notify: Notifier<T>) {
    super(url, () => this.getUrlFromRefreshUrl(), shared, notify)
  }

  private getUrlFromRefreshUrl() {
    return fetchRefreshUrl(this.refreshUrl)
  }
}

type PostUrl = {url?: string; token?: string}
async function fetchRefreshUrl(url: string): Promise<string | null> {
  const data = await fetchJSON<PostUrl>(url)
  return data && data.url && data.token ? post(data.url, data.token) : null
}

async function fetchJSON<T>(url: string): Promise<T | null> {
  const response = await fetch(url, {headers: {Accept: 'application/json'}})
  if (response.ok) {
    return response.json()
  } else if (response.status === 404) {
    return null
  } else {
    throw new Error('fetch error')
  }
}

async function post(url: string, csrf: string): Promise<string> {
  const response = await fetch(url, {
    method: 'POST',
    mode: 'same-origin',
    headers: {
      'Scoped-CSRF-Token': csrf
    }
  })
  if (response.ok) {
    return response.text()
  } else {
    throw new Error('fetch error')
  }
}
"import {Subscription} from '../subscription'

type IdleListener = (isIdle: boolean) => unknown

const idleListeners: IdleListener[] = []
const DEBOUNCE_UNTIL_IDLE = 30000
const DEBOUNCE_UNTIL_ACTIVE = 0 // If active, we want to send immediately
let idle = document.hidden // if the page is hidden on load, consider it idle immediately
let visibilityDebounceTimeout: ReturnType<typeof setTimeout> | undefined

export function addIdleStateListener(listener: IdleListener) {
  listener(idle)
  idleListeners.push(listener)

  return new Subscription(() => {
    const index = idleListeners.indexOf(listener)
    if (index !== -1) {
      idleListeners.splice(index, 1)
    }
  })
}

;(() => {
  // listen for visibility change events, which trigger the wait period for idle changes
  document.addEventListener('visibilitychange', () => {
    const pageIsHidden = document.hidden

    if (visibilityDebounceTimeout !== undefined) {
      // we were waiting to send an idle change, cancel the previous timeout and queue a new one
      clearTimeout(visibilityDebounceTimeout)
    }

    // When page visibility changes, wait a little bit before marking as idle in case visibility comes back
    const debouncePeriod = pageIsHidden ? DEBOUNCE_UNTIL_IDLE : DEBOUNCE_UNTIL_ACTIVE

    visibilityDebounceTimeout = setTimeout(() => {
      if (pageIsHidden === idle) {
        // idle hasn't changed, don't call any listeners
        return
      }

      idle = pageIsHidden
      visibilityDebounceTimeout = undefined

      // send current idle state to all listeners
      for (const idleListener of idleListeners) {
        idleListener(idle)
      }
    }, debouncePeriod)
  })
})()
"ãLimport type {AliveEvent, Metadata, MetadataUpdate, Notifier, Subscription} from '@github/alive-client'
import {IDLE_METADATA_KEY, PresenceMetadataSet, SubscriptionSet, Topic, isPresenceChannel} from '@github/alive-client'
import {compose, fromEvent} from '../subscription'

import {AliveSession} from '../alive-session'
import {addIdleStateListener} from '../alive/idle-state'
import {debounce} from '@github/mini-throttle'
import {isFeatureEnabled} from '../features'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
import {ready} from '../document-ready'
import safeStorage from '../safe-storage'
import {taskQueue} from '../eventloop-tasks'

function isSharedWorkerSupported(): boolean {
  return 'SharedWorker' in window && safeStorage('localStorage').getItem('bypassSharedWorker') !== 'true'
}

function workerSrc(): string | null {
  return document.head.querySelector<HTMLLinkElement>('link[rel=shared-web-socket-src]')?.href ?? null
}

function socketUrl(): string | null {
  return document.head.querySelector<HTMLLinkElement>('link[rel=shared-web-socket]')?.href ?? null
}

function socketRefreshUrl(): string | null {
  return (
    document.head.querySelector<HTMLLinkElement>('link[rel=shared-web-socket]')?.getAttribute('data-refresh-url') ??
    null
  )
}

function sessionIdentifier(): string | null {
  return (
    document.head.querySelector<HTMLLinkElement>('link[rel=shared-web-socket]')?.getAttribute('data-session-id') ?? null
  )
}

function subscriptions(el: Element): Array<Subscription<Element>> {
  return channels(el).map((topic: Topic) => ({subscriber: el, topic}))
}

export function channels(el: Element): Topic[] {
  const names = (el.getAttribute('data-channel') || '').trim().split(/\s+/)
  return names.map(Topic.parse).filter(isPresent)
}

function isPresent(value: Topic | null): value is Topic {
  return value != null
}

function notify(subscribers: Iterable<Element>, {channel, type, data}: AliveEvent) {
  for (const el of subscribers) {
    el.dispatchEvent(
      new CustomEvent(`socket:${type}`, {
        bubbles: false,
        cancelable: false,
        detail: {name: channel, data}
      })
    )
  }
}

class AliveSessionProxy {
  private worker: SharedWorker
  private subscriptions = new SubscriptionSet<Element>()
  private presenceMetadata = new PresenceMetadataSet<Element>()
  private notify: Notifier<Element>

  constructor(src: string, url: string, refreshUrl: string, sessionId: string, notifier: Notifier<Element>) {
    this.notify = notifier
    this.worker = new SharedWorker(src, `github-socket-worker-v2-${sessionId}`)
    this.worker.port.onmessage = ({data}) => this.receive(data)
    this.worker.port.postMessage({connect: {url, refreshUrl}})
  }

  subscribe(subs: Array<Subscription<Element>>) {
    const added = this.subscriptions.add(...subs)
    if (added.length) {
      this.worker.port.postMessage({subscribe: added})
    }

    // We may be adding a subscription to a presence channel which is already subscribed.
    // In this case, we need to explicitly ask the SharedWorker to send us the presence data.
    const addedChannels = new Set(added.map(topic => topic.name))
    const redundantPresenceChannels = subs.reduce((redundantChannels, subscription) => {
      const channel = subscription.topic.name

      if (isPresenceChannel(channel) && !addedChannels.has(channel)) {
        redundantChannels.add(channel)
      }

      return redundantChannels
    }, new Set<string>())

    if (redundantPresenceChannels.size) {
      this.worker.port.postMessage({requestPresence: Array.from(redundantPresenceChannels)})
    }
  }

  unsubscribeAll(...subscribers: Element[]) {
    const removed = this.subscriptions.drain(...subscribers)
    if (removed.length) {
      this.worker.port.postMessage({unsubscribe: removed})
    }

    const updatedPresenceChannels = this.presenceMetadata.removeSubscribers(subscribers)
    this.sendPresenceMetadataUpdate(updatedPresenceChannels)
  }

  updatePresenceMetadata(metadataUpdates: Array<MetadataUpdate<Element>>) {
    const updatedChannels = new Set<string>()

    for (const update of metadataUpdates) {
      // update the local metadata for this specific element
      this.presenceMetadata.setMetadata(update)
      updatedChannels.add(update.channelName)
    }

    // Send the full local metadata for these channels to the SharedWorker
    this.sendPresenceMetadataUpdate(updatedChannels)
  }

  sendPresenceMetadataUpdate(channelNames: Set<string>) {
    if (!channelNames.size) {
      return
    }

    const updatesForSharedWorker: Array<Omit<MetadataUpdate<Element>, 'subscriber'>> = []

    for (const channelName of channelNames) {
      // get all metadata for this channel (from all elements) to send to the SharedWorker
      updatesForSharedWorker.push({
        channelName,
        metadata: this.presenceMetadata.getChannelMetadata(channelName)
      })
    }

    // Send the full metadata updates to the SharedWorker
    this.worker.port.postMessage({updatePresenceMetadata: updatesForSharedWorker})
  }

  online() {
    this.worker.port.postMessage({online: true})
  }

  offline() {
    this.worker.port.postMessage({online: false})
  }

  hangup() {
    this.worker.port.postMessage({hangup: true})
  }

  private notifyPresenceDebouncedByChannel = new Map<string, Notifier<Element>>()
  private receive(event: AliveEvent) {
    const {channel} = event

    if (event.type === 'presence') {
      // There are times when we get a flood of messages from the SharedWorker, such as a tab that has been idle for a long time and then comes back to the foreground.
      // Since each presence message for a channel contains the full list of users, we can debounce the events and only notify subscribers with the last one
      let debouncedNotify = this.notifyPresenceDebouncedByChannel.get(channel)
      if (!debouncedNotify) {
        debouncedNotify = debounce((subscribers, debouncedEvent) => {
          this.notify(subscribers, debouncedEvent)
          this.notifyPresenceDebouncedByChannel.delete(channel)
        }, 100)
        this.notifyPresenceDebouncedByChannel.set(channel, debouncedNotify)
      }

      debouncedNotify(this.subscriptions.subscribers(channel), event)
      return
    }

    // For non-presence messages, we can send them through immediately since they may contain different messages/data
    this.notify(this.subscriptions.subscribers(channel), event)
  }
}

function connect() {
  const src = workerSrc()
  if (!src) return

  const url = socketUrl()
  if (!url) return

  const refreshUrl = socketRefreshUrl()
  if (!refreshUrl) return

  const sessionId = sessionIdentifier()
  if (!sessionId) return

  const createSession = () => {
    if (isSharedWorkerSupported()) {
      try {
        return new AliveSessionProxy(src, url, refreshUrl, sessionId, notify)
      } catch (_) {
        // ignore errors.  CSP will some times block SharedWorker creation. Fall back to standard AliveSession.
      }
    }

    return new AliveSession(url, refreshUrl, false, notify)
  }
  const session = createSession()

  type Subs = Array<Subscription<Element>>
  const queueSubscribe = taskQueue<Subs>(subs => session.subscribe(subs.flat()))
  const queueUnsubscribe = taskQueue<Element>(els => session.unsubscribeAll(...els))
  const queueMetadata = taskQueue<MetadataUpdate<Element>>(updates => session.updatePresenceMetadata(updates))

  observe('.js-socket-channel[data-channel]', {
    subscribe: el => {
      const elementSubscriptions = subscriptions(el)
      const presenceChannels = elementSubscriptions
        .map(subscription => subscription.topic.name)
        .filter(channelName => isPresenceChannel(channelName))

      let listenerSubscription = {
        unsubscribe() {
          // nothing to clean up by default.  This will be overridden if there are presence channels
        }
      }

      if (presenceChannels.length) {
        let latestMetadata: Metadata | undefined = undefined
        let latestIdle: boolean | undefined
        const queueMetadataOrIdleChange = () => {
          const metadata: Metadata[] = []

          // combine metadata and idle values
          if (latestMetadata) {
            metadata.push(latestMetadata)
          }
          if (latestIdle !== undefined) {
            metadata.push({[IDLE_METADATA_KEY]: latestIdle ? 1 : 0})
          }

          // Send the metadata to all presence channels on this element
          for (const channelName of presenceChannels) {
            queueMetadata({subscriber: el, channelName, metadata})
          }
        }

        listenerSubscription = compose(
          // listen for metadata updates emitted on the element
          fromEvent(el, 'socket:set-presence-metadata', (e: Event) => {
            const {detail} = e as CustomEvent
            latestMetadata = detail
            queueMetadataOrIdleChange()
          }),
          // listen for idle changes, which will cause us to send a metadata update
          addIdleStateListener(idle => {
            if (!isFeatureEnabled('PRESENCE_IDLE')) {
              return
            }
            latestIdle = idle
            queueMetadataOrIdleChange()
          })
        )
      }

      // Process normal subscriptions after setting up metadata listeners
      // This needs to come second so that idle state is ready when we subscribe
      queueSubscribe(elementSubscriptions)

      return listenerSubscription
    },
    remove: el => queueUnsubscribe(el)
  })

  window.addEventListener('online', () => session.online())
  window.addEventListener('offline', () => session.offline())
  window.addEventListener('pagehide', () => {
    if ('hangup' in session) session.hangup()
  })
}

;(async () => {
  await ready
  connect()
})()
"õimport type {AliveData, Topic} from '@github/alive-client'
import {channels} from './socket-channel'

type Entry = {name: string; data: AliveData; arrived: number}
const cache = new Map<string, Entry>()

function stale(topics: Topic[], since: number): Entry[] {
  const entries = []
  for (const topic of topics) {
    const entry = cache.get(topic.name)
    if (entry && entry.arrived > since) {
      entries.push(entry)
    }
  }
  return entries
}

function dispatch(container: Element, cachedAt: number) {
  for (const el of container.querySelectorAll('.js-socket-channel[data-channel]')) {
    for (const entry of stale(channels(el), cachedAt)) {
      el.dispatchEvent(
        new CustomEvent('socket:message', {
          bubbles: false,
          cancelable: false,
          detail: {name: entry.name, data: entry.data, cached: true}
        })
      )
    }
  }
}

function store(event: Event) {
  const {name, data, cached} = (event as CustomEvent).detail
  if (cached) return
  const entry = {name, data: {...data}, arrived: Date.now()}
  entry.data.wait = 0
  cache.set(name, entry)
}

// Cache socket messages for future delivery.
document.addEventListener('socket:message', store, {capture: true})

// Dispatch socket:message when elements are restored from PJAX cache.
document.addEventListener('pjax:popstate', function (event: Event) {
  const container = event.target as Element
  const cachedAt = (event as CustomEvent).detail.cachedAt
  if (cachedAt) setTimeout(() => dispatch(container, cachedAt))
})
"// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
import {requestSubmit} from '../form'

observe('form.js-auto-replay-enforced-sso-request', {
  constructor: HTMLFormElement,
  initialize(el) {
    requestSubmit(el)
  }
})
"«!import {fetchSafeDocumentFragment} from '../fetch'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import verifySsoSession from '../sso'

function updateStatusPosition(container: Element, menu: HTMLElement, details: Element) {
  const containerHeight = container.getBoundingClientRect().height
  const menuRect = menu.getBoundingClientRect()
  const iconRect = details.getBoundingClientRect()
  let top = iconRect.top
  // Ensure popover stays off the bottom of the page by at least 10 pixels
  if (top + menuRect.height + 10 >= containerHeight) {
    top = Math.max(containerHeight - menuRect.height - 10, 0)
  }
  let left = iconRect.right
  // Show popover to the left
  if (details.closest('.js-build-status-to-the-left') != null) {
    left = Math.max(iconRect.left - menuRect.width - 10, 0)
  }
  menu.style.top = `${top}px`
  menu.style.left = `${left}px`
  menu.style.right = 'auto'
}

on(
  'toggle',
  '.js-build-status .js-dropdown-details',
  function (event) {
    const details = event.currentTarget
    const menu = details.querySelector<HTMLElement>('.js-status-dropdown-menu')
    if (!menu) return

    function closeOnToggle() {
      if (!details.hasAttribute('open')) closeStatusPopover()
    }

    function closeOnScroll(scrollEvent: Event) {
      if (!menu!.contains(scrollEvent.target as Element)) closeStatusPopover()
    }

    function closeStatusPopover() {
      details.removeAttribute('open')
      /* eslint-disable-next-line github/no-d-none */
      menu!.classList.add('d-none')
      details.appendChild(menu!)
      details.removeEventListener('toggle', closeOnToggle)
      window.removeEventListener('scroll', closeOnScroll)
    }

    details.addEventListener('toggle', closeOnToggle)

    if (menu.classList.contains('js-close-menu-on-scroll')) {
      /* eslint-disable-next-line github/prefer-observers */
      window.addEventListener('scroll', closeOnScroll, {capture: true})
    }

    /* eslint-disable-next-line github/no-d-none */
    menu.classList.remove('d-none')
    menu.querySelector<HTMLElement>('.js-details-container')!.classList.add('open')
    if (menu.classList.contains('js-append-menu-to-body')) {
      // Move menu to body so it can overlay on top of other elements
      document.body.appendChild(menu)
      updateStatusPosition(document.body, menu, details)
    }
  },
  {capture: true}
)

async function loadStatus(el: Element) {
  const details = el.querySelector('.js-dropdown-details')
  const menu = el.querySelector('.js-status-dropdown-menu') || el.closest('.js-status-dropdown-menu')

  if (!(menu instanceof HTMLElement)) {
    // Status does not have an associated dropdown menu
    return
  }

  const loader = menu.querySelector('.js-status-loader')
  if (!loader) {
    return
  }

  const loadingArea = menu.querySelector<HTMLElement>('.js-status-loading')!
  const errorArea = menu.querySelector<HTMLElement>('.js-status-error')!

  const url = loader.getAttribute('data-contents-url')!

  /* eslint-disable-next-line github/no-d-none */
  loadingArea.classList.remove('d-none')
  /* eslint-disable-next-line github/no-d-none */
  errorArea.classList.add('d-none')

  let html
  try {
    await verifySsoSession()
    html = await fetchSafeDocumentFragment(document, url)
  } catch (error) {
    /* eslint-disable-next-line github/no-d-none */
    loadingArea.classList.add('d-none')
    /* eslint-disable-next-line github/no-d-none */
    errorArea.classList.remove('d-none')
  }

  if (html) {
    loader.replaceWith(html)
    menu.querySelector<HTMLElement>('.js-details-container')!.classList.add('open')
    if (details && menu.classList.contains('js-append-menu-to-body')) {
      updateStatusPosition(document.body, menu, details)
    }
  }
}

on('click', '.js-status-retry', ({currentTarget}) => {
  loadStatus(currentTarget)
})

function onMouseEnter(event: Event) {
  const currentTarget = event.currentTarget as Element
  loadStatus(currentTarget)
}

observe('.js-build-status', {
  add(el) {
    el.addEventListener('mouseenter', onMouseEnter, {once: true})
  },
  remove(el) {
    el.removeEventListener('mouseenter', onMouseEnter)
  }
})
"®import {fromEvent} from '../subscription'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {requestSubmit} from '../form'
import sudo from '../sudo'

on('click', 'button[data-sudo-required], summary[data-sudo-required]', checkSudo)
observe('form[data-sudo-required]', {
  constructor: HTMLFormElement,
  subscribe: form => fromEvent(form, 'submit', checkSudo)
})

async function checkSudo(event: Event) {
  const currentTarget = event.currentTarget
  if (!(currentTarget instanceof HTMLElement)) return

  event.stopPropagation()
  event.preventDefault()
  const sudoPassed = await sudo()

  if (sudoPassed) {
    currentTarget.removeAttribute('data-sudo-required')
    if (currentTarget instanceof HTMLFormElement) {
      requestSubmit(currentTarget)
    } else {
      currentTarget.click()
    }
  }
}
"òimport {compare, fuzzyScore} from '../../fuzzy-filter'
import {compose, fromEvent} from '../../subscription'
import {fetchSafeDocumentFragment} from '../../fetch'
import {filterSort} from '../../filter-sort'
import memoize from '@github/memoize'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

const selectors: {[key: string]: string} = {
  'actor:': 'ul.js-user-suggestions',
  'user:': 'ul.js-user-suggestions',
  'operation:': 'ul.js-operation-suggestions',
  'org:': 'ul.js-org-suggestions',
  'action:': 'ul.js-action-suggestions',
  'repo:': 'ul.js-repo-suggestions',
  'country:': 'ul.js-country-suggestions'
}

observe('text-expander[data-audit-url]', {
  subscribe: el =>
    compose(fromEvent(el, 'text-expander-change', onchange), fromEvent(el, 'text-expander-value', onvalue))
})

function onvalue(event: Event) {
  const detail = (event as CustomEvent).detail
  if (!isActivationKey(detail.key)) return
  const value = detail.item.getAttribute('data-value')!
  detail.value = `${detail.key}${value}`
}

function onchange(event: Event) {
  const {key, provide, text} = (event as CustomEvent).detail
  if (!isActivationKey(key)) return
  const menu = event.target as HTMLElement
  const url = menu.getAttribute('data-audit-url')!
  provide(auditMenu(url, key, text))
}

function search(items: Element[], searchQuery: string): Element[] {
  const query = searchQuery.toLowerCase()
  const key = (item: Element) => {
    const text = item.textContent!.toLowerCase().trim()
    const score = fuzzyScore(text, query)
    return score > 0 ? {score, text} : null
  }
  return query ? filterSort(items, key, compare) : items
}

const children = memoize((el: Element) => [...el.children], {hash: (el: Element) => el.className})

async function auditMenu(url: string, key: string, query: string): Promise<{fragment?: HTMLElement; matched: boolean}> {
  const lists = await cachedMenu(url)
  const list = lists.querySelector<HTMLElement>(selector(key))
  if (!list) return {matched: false}
  const results = search(children(list), query).slice(0, 5)
  const clone = list.cloneNode(false) as HTMLElement
  clone.innerHTML = ''
  for (const el of results) clone.append(el)
  return {fragment: clone, matched: results.length > 0}
}

function isActivationKey(key: string): boolean {
  return Object.getOwnPropertyNames(selectors).includes(key)
}

function selector(key: string): string {
  const found = selectors[key]
  if (!found) throw new Error(`Unknown audit log expander key: ${key}`)
  return found
}

async function fetchMenu(url: string): Promise<HTMLElement> {
  const fragment = await fetchSafeDocumentFragment(document, url)
  const root = document.createElement('div')
  root.append(fragment)
  return root
}
const cachedMenu = memoize(fetchMenu)
"÷import {compose, fromEvent} from '../../subscription'
import {compare} from '../../fuzzy-filter'
import {fetchSafeDocumentFragment} from '../../fetch'
import {filterSort} from '../../filter-sort'
import memoize from '@github/memoize'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

function getValue(el: Element): string | undefined | null {
  if (el.hasAttribute('data-use-colon-emoji')) {
    return el.getAttribute('data-value')
  }

  const emojiEl = el.firstElementChild
  if (emojiEl && 'G-EMOJI' === emojiEl.tagName && !emojiEl.firstElementChild) {
    return emojiEl.textContent
  } else {
    return el.getAttribute('data-value')
  }
}

function search(items: Element[], searchQuery: string): Element[] {
  const query = ` ${searchQuery.toLowerCase().replace(/_/g, ' ')}`
  const key = (item: Element) => {
    const text = item.getAttribute('data-emoji-name')!
    const score = emojiScore(emojiText(item), query)
    return score > 0 ? {score, text} : null
  }
  return filterSort(items, key, compare)
}

function emojiText(item: Element): string {
  const aliases = item.getAttribute('data-text')!.trim().toLowerCase().replace(/_/g, ' ')
  return ` ${aliases}`
}

function emojiScore(aliases: string, query: string): number {
  const score = aliases.indexOf(query)
  return score > -1 ? 1000 - score : 0
}

observe('text-expander[data-emoji-url]', {
  subscribe: el =>
    compose(fromEvent(el, 'text-expander-change', onchange), fromEvent(el, 'text-expander-value', onvalue))
})

function onvalue(event: Event) {
  const detail = (event as CustomEvent).detail
  if (detail.key !== ':') return
  detail.value = getValue(detail.item)
}

function onchange(event: Event) {
  const {key, provide, text} = (event as CustomEvent).detail
  if (key !== ':') return
  const menu = event.target as Element
  const url = menu.getAttribute('data-emoji-url')!
  provide(emojiMenu(url, text))
}

async function emojiMenu(url: string, query: string): Promise<{fragment: HTMLElement; matched: boolean}> {
  const [list, children] = await cachedEmoji(url)
  const results = search(children, query).slice(0, 5)
  list.innerHTML = ''
  for (const el of results) list.append(el)
  return {fragment: list, matched: results.length > 0}
}

async function fetchEmoji(url: string): Promise<[HTMLElement, Element[]]> {
  const fragment = await fetchSafeDocumentFragment(document, url)
  const root = fragment.firstElementChild as HTMLElement
  return [root, [...root.children]]
}
const cachedEmoji = memoize(fetchEmoji)
"%import {compare, fuzzyScore} from '../../fuzzy-filter'
import {compose, fromEvent} from '../../subscription'
import {html, render, unsafeHTML} from '@github/jtml'

import TextExpanderElement from '@github/text-expander-element'
import {filterSort} from '../../filter-sort'
import memoize from '@github/memoize'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
import {parseHTML} from '../../parse-html'

interface Data {
  suggestions: SuggestionData[]
  icons: Icons
}

interface SuggestionData {
  id: number
  number: number
  title: string
  type: string
}

interface Icons {
  [key: string]: string
}

function asText(item: SuggestionData): string {
  return `${item.number} ${item.title.trim().toLowerCase()}`
}

function search(items: SuggestionData[], query: string): SuggestionData[] {
  if (!query) return items
  const re = new RegExp(`\\b${escapeRegExp(query)}`)
  const hashedScore = /^\d+$/.test(query)
    ? (text: string) => issueNumberScore(text, re)
    : (text: string) => fuzzyScore(text, query)
  const key = (item: SuggestionData) => {
    const text = asText(item)
    const score = hashedScore(text)
    return score > 0 ? {score, text} : null
  }
  return filterSort(items, key, compare)
}

function escapeRegExp(regex: string): string {
  return regex.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')
}

// Returns a score that gets higher as the query that matches a number starting
// on a word boundary is found earlier in the string.
function issueNumberScore(text: string, query: RegExp): number {
  const score = text.search(query)
  if (score > -1) {
    return 1000 - score
  } else {
    return 0
  }
}

function renderResults(issues: SuggestionData[], container: HTMLElement, icons: Icons): void {
  const itemsTemplate = (items: SuggestionData[]) => html`
    <ul role="listbox" class="suggester-container suggester suggestions list-style-none position-absolute">
      ${items.map(itemTemplate)}
    </ul>
  `

  const itemTemplate = (item: SuggestionData) => {
    const icon = item.type in icons ? parseHTML(document, icons[item.type]) : ''
    return html`
      <li class="markdown-title" role="option" id="suggester-issue-${item.id}" data-value="${item.number}">
        <span class="d-inline-block mr-1">${icon}</span>
        <small>#${item.number}</small> ${
          // eslint-disable-next-line no-restricted-syntax
          unsafeHTML(item.title)
        }
      </li>
    `
  }

  render(itemsTemplate(issues), container)
}

observe('text-expander[data-issue-url]', {
  subscribe: el => {
    const subscriptions = [
      fromEvent(el, 'text-expander-change', onchange),
      fromEvent(el, 'text-expander-value', onvalue),
      fromEvent(el, 'keydown', onkeydown),
      fromEvent(el, 'click', onclick)
    ]

    return compose(...subscriptions)
  }
})

function onvalue(event: Event) {
  const detail = (event as CustomEvent).detail
  if (detail.key !== '#') return
  const value = detail.item.getAttribute('data-value')!
  detail.value = `#${value}`
}

function onchange(event: Event) {
  const {key, provide, text} = (event as CustomEvent).detail
  if (key !== '#') return
  if (text === '#') {
    hideSuggestions(event.target)
    return
  }

  const menu = event.target as Element
  const url = menu.getAttribute('data-issue-url')!
  provide(issueMenu(url, text))
}

function hideSuggestions(target: EventTarget | null) {
  if (!target) return

  const textExpander = (target as HTMLElement).closest('text-expander') as TextExpanderElement
  if (textExpander) {
    textExpander.dismiss()
  }
}

function onclick(event: Event) {
  hideSuggestions(event.target)
}

function onkeydown(event: Event) {
  const specialKeys = ['ArrowRight', 'ArrowLeft']
  const {key} = event as KeyboardEvent
  if (specialKeys.indexOf(key) < 0) return

  hideSuggestions(event.target)
}

async function issueMenu(url: string, query: string): Promise<{fragment: HTMLElement; matched: boolean}> {
  const data: Data = await cachedJSON(url)
  const list = document.createElement('div')
  const results = search(data.suggestions, query).slice(0, 5)
  renderResults(results, list, data.icons)
  const root = list.firstElementChild as HTMLElement
  return {fragment: root, matched: results.length > 0}
}

const cachedJSON = memoize(async function <T>(url: RequestInfo): Promise<T> {
  const response = await self.fetch(url, {
    headers: {
      'X-Requested-With': 'XMLHttpRequest',
      Accept: 'application/json'
    }
  })
  if (!response.ok) {
    const responseError = new Error()
    const statusText = response.statusText ? ` ${response.statusText}` : ''
    responseError.message = `HTTP ${response.status}${statusText}`
    throw responseError
  }
  return response.json()
})
")import {compose, fromEvent} from '../../subscription'
import {html, render} from '@github/jtml'
import {compare} from '../../fuzzy-filter'
import {filterSort} from '../../filter-sort'
import memoize from '@github/memoize'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

interface UserData {
  login: string
  type: string
  id: string
  name: string
  description: string
  participant?: boolean
}

function asText(item: UserData): string {
  return item.description
    ? `${item.name} ${item.description}`.trim().toLowerCase() // team
    : `${item.login} ${item.name}`.trim().toLowerCase() // user
}

function search(items: UserData[], query: string): UserData[] {
  if (!query) return items
  const scorer = fuzzyScorer(query)
  const key = (item: UserData) => {
    const text = asText(item)
    const score = scorer(text, item.participant)
    return score > 0 ? {score, text} : null
  }
  return filterSort(items, key, compare)
}

function renderResults(usersAndTeams: UserData[], container: HTMLElement): void {
  const itemsTemplate = (items: UserData[]) => html`
    <ul role="listbox" class="suggester-container suggester suggestions list-style-none position-absolute">
      ${items.map(itemTemplate)}
    </ul>
  `

  const itemTemplate = (item: UserData) => {
    const name = item.type === 'user' ? item.login : item.name
    const desc = item.type === 'user' ? item.name : item.description
    return html`
      <li role="option" id="suggester-${item.id}-${item.type}-${name}" data-value="${name}">
        <span>${name}</span>
        <small>${desc}</small>
      </li>
    `
  }

  render(itemsTemplate(usersAndTeams), container)
}

function fuzzyScorer(query: string): (text: string, participant?: boolean) => number {
  if (!query) return () => 2.0
  const queryChars = query.toLowerCase().split('')
  return (text: string, participant?: boolean): number => {
    if (!text) return 0.0
    const match = shortestMatch(text, queryChars)
    if (!match) return 0.0
    const value = query.length / (match[1] as number)
    const score = value / ((match[0] as number) / 2 + 1)
    if (participant) return score + 1
    return score
  }
}

// Get the shortest match (least distance between start and end index) for all
// the query characters in the given text.
//
// Returns an array in format [firstIndex, matchLength, [matchIndexes]]
function shortestMatch(text: string, queryChars: string[]): Array<number | number[]> | null {
  let indexes
  let j
  let len
  let match
  const starts = allIndexesOf(text, queryChars[0])
  if (starts.length === 0) {
    return null
  }
  if (queryChars.length === 1) {
    return [starts[0], 1, []]
  }
  match = null
  for (j = 0, len = starts.length; j < len; j++) {
    const start = starts[j]
    if (!(indexes = indexesOfChars(text, queryChars, start + 1))) {
      continue
    }
    const length = indexes[indexes.length - 1] - start
    if (!match || length < match[1]) {
      match = [start, length, indexes]
    }
  }
  return match
}

// Find all indexes of character inside a string.
function allIndexesOf(string: string, char: string) {
  let index = 0
  const results1 = []
  while ((index = string.indexOf(char, index)) > -1) {
    results1.push(index++)
  }
  return results1
}

// Find all indexes of characters of query string in order.
function indexesOfChars(string: string, chars: string[], startingIndex: number): number[] | undefined {
  let index = startingIndex
  const indexes = []
  for (let i = 1; i < chars.length; i += 1) {
    index = string.indexOf(chars[i], index)
    if (index === -1) return
    indexes.push(index++)
  }
  return indexes
}

observe('text-expander[data-mention-url]', {
  subscribe: el =>
    compose(fromEvent(el, 'text-expander-change', onchange), fromEvent(el, 'text-expander-value', onvalue))
})

function onvalue(event: Event) {
  const detail = (event as CustomEvent).detail
  if (detail.key !== '@') return
  const login = detail.item.getAttribute('data-value')!
  detail.value = `@${login}`
}

function onchange(event: Event) {
  const {key, provide, text} = (event as CustomEvent).detail
  if (key !== '@') return
  // do not allow multi-word mentions
  if (text?.split(' ').length > 1) return
  const menu = event.target as Element
  const url = menu.getAttribute('data-mention-url')!
  provide(mentionMenu(url, text))
}

async function mentionMenu(url: string, query: string): Promise<{fragment: HTMLElement; matched: boolean}> {
  const data: UserData[] = await cachedJSON(url)
  const list = document.createElement('div')
  const results = search(data, query).slice(0, 5)
  renderResults(results, list)
  const root = list.firstElementChild as HTMLElement
  return {fragment: root, matched: results.length > 0}
}

const cachedJSON = memoize(async function <T>(url: RequestInfo): Promise<T> {
  const response = await self.fetch(url, {
    headers: {
      'X-Requested-With': 'XMLHttpRequest',
      Accept: 'application/json'
    }
  })
  if (!response.ok) {
    const responseError = new Error()
    const statusText = response.statusText ? ` ${response.statusText}` : ''
    responseError.message = `HTTP ${response.status}${statusText}`
    throw responseError
  }
  return response.json()
})
"ç// eslint-disable-next-line no-restricted-imports
import {fire, on} from 'delegated-events'

// Handle "Other" text input for the early access survey.
//
// field - The field.
// isOther - If true then the "Other" input will be set to required, and focussed.
function handleOther(field: Element, isOther: boolean) {
  const question = field.closest<HTMLElement>('.js-survey-question-form')!
  const otherInput = question.querySelector<HTMLInputElement>('input.js-survey-other-text')!
  const isOtherSelected = isOther && !question.classList.contains('is-other-selected')

  question.classList.toggle('is-other-selected', isOtherSelected)
  otherInput.hidden = !isOther
  if (isOtherSelected) {
    otherInput.required = true
    otherInput.focus()
  } else {
    otherInput.required = false
  }
  fire(otherInput, 'change')
}

on('change', 'input.js-survey-radio', function ({currentTarget}) {
  handleOther(currentTarget, currentTarget.classList.contains('js-survey-radio-other'))
})

on('change', 'input.js-survey-checkbox-enable-submit', function ({currentTarget}) {
  const checked = (currentTarget as HTMLInputElement).checked
  const submitButton = currentTarget
    .closest<HTMLElement>('form')
    ?.querySelector<HTMLButtonElement>('button[type=submit]')

  submitButton!.disabled = !checked
})

on('change', 'input.js-survey-contact-checkbox', function (event: Event) {
  const currentTarget = event.currentTarget as HTMLInputElement
  const question = currentTarget.closest<HTMLElement>('.js-survey-question-form')!
  const hiddenInput = question.querySelector<HTMLElement>('.js-survey-contact-checkbox-hidden')!
  if (currentTarget.checked) {
    hiddenInput.setAttribute('disabled', 'true')
  } else {
    hiddenInput.removeAttribute('disabled')
  }
})
"×// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

on(
  'details-menu-selected',
  '.js-sync-select-menu-text',
  function (event) {
    const button = document.querySelector<HTMLElement>('.js-sync-select-menu-button')!
    const text = (event.detail.relatedTarget as Element).querySelector<HTMLElement>(
      'span[data-menu-button-text]'
    )!.textContent
    button.textContent = text
    button.focus()
  },
  {capture: true}
)
"// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

on('click', 'tab-container [role="tab"]', function (event) {
  const {currentTarget} = event

  const menu = currentTarget.closest<HTMLElement>('tab-container')!
  const filter = menu.querySelector('.js-filterable-field, [data-filter-placeholder-input]')
  if (filter instanceof HTMLInputElement) {
    const placeholder = currentTarget.getAttribute('data-filter-placeholder')
    if (placeholder) {
      filter.setAttribute('placeholder', placeholder)
    }
    filter.focus()
  }
})

on('tab-container-changed', 'tab-container', function (event) {
  const panel = event.detail.relatedTarget
  const url = panel.getAttribute('data-fragment-url')
  const includeFragment = panel.querySelector('include-fragment')
  if (url && includeFragment && !includeFragment.hasAttribute('src')) {
    includeFragment.src = url
  }
})
"ûimport {preservePosition} from 'scroll-anchoring'
import {replaceState} from '../history'

document.addEventListener('keydown', (event: KeyboardEvent) => {
  // TODO: Refactor to use data-hotkey
  /* eslint eslint-comments/no-use: off */
  /* eslint-disable no-restricted-syntax */
  if (event.key !== 'Escape') return
  if (event.target !== document.body) return

  const element = document.querySelector('.js-targetable-element:target')
  if (!element) return

  preservePosition(element, () => {
    // Clear the `:target` element
    window.location.hash = ''
    // Clear the hash part of the URL
    replaceState(window.history.state, '', window.location.pathname + window.location.search)
  })
  /* eslint-enable no-restricted-syntax */
})

document.addEventListener('click', (event: MouseEvent) => {
  // Return early if there is no highlighted element
  const highlightedElement = document.querySelector('.js-targetable-element:target')
  if (!highlightedElement) return

  // Don't mess with the URL if we clicked on a link
  if (event.target instanceof HTMLAnchorElement) return

  // Don't do anything if the user clicked on the already highlighted element
  if (!(event.target instanceof HTMLElement)) return
  if (highlightedElement.contains(event.target)) return

  preservePosition(highlightedElement, () => {
    // Clear the `:target` element
    window.location.hash = ''
    // Clear the hash part of the URL
    replaceState(window.history.state, '', window.location.pathname + window.location.search)
  })
})
"³// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

// Load team members to display in the mention's tooltip from the server on hover.
async function members(event: Event) {
  const target = event.currentTarget as HTMLElement
  if (teamHovercardEnabled(target)) {
    target.classList.remove('tooltipped')
    return
  }
  const url = target.getAttribute('data-url')
  if (!url) return

  const response = await fetch(url, {headers: {Accept: 'application/json'}})
  if (!response.ok) return
  const data = (await response.json()) as {total: number; members: string[]}

  const id = target.getAttribute('data-id')!
  const mentions = document.querySelectorAll(`.js-team-mention[data-id='${id}']`)
  for (const el of mentions) {
    el.removeAttribute('data-url')
  }

  try {
    if (data.total === 0) {
      // eslint-disable-next-line i18n-text/no-en
      data.members.push('This team has no members')
    } else if (data.total > data.members.length) {
      data.members.push(`${data.total - data.members.length} more`)
    }
    tip(mentions, sentence(data.members))
  } catch (error) {
    const status = error.response ? error.response.status : 500
    const message = target.getAttribute(status === 404 ? 'data-permission-text' : 'data-error-text')!
    tip(mentions, message)
  }
}

// Add a tooltip to the elements. Adds the text just before the tooltip classes so
// the tooltip appears fully formed on mouse hover.
function tip(elements: NodeList, text: string): void {
  for (const el of elements) {
    if (!(el instanceof HTMLElement)) continue
    el.setAttribute('aria-label', text)
    el.classList.add('tooltipped', 'tooltipped-s', 'tooltipped-multiline')
  }
}

// Comma separate a list of strings with `and` at the end, like
// Rails' to_sentence.
function sentence(xs: string[]): string {
  if ('ListFormat' in Intl) {
    const lists = new Intl.ListFormat()
    return lists.format(xs)
  }

  if (xs.length === 0) {
    return ''
  } else if (xs.length === 1) {
    return xs[0]
  } else if (xs.length === 2) {
    return xs.join(' and ')
  } else {
    const last = xs[xs.length - 1]
    return xs.slice(0, -1).concat(`and ${last}`).join(', ')
  }
}

function teamHovercardEnabled(element: HTMLElement): boolean {
  return !!element.getAttribute('data-hovercard-url') && !!element.closest('[data-team-hovercards-enabled]')
}

observe('.js-team-mention', function (el) {
  el.addEventListener('mouseenter', members)
})
"// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {remoteForm} from '@github/remote-form'

interface Request {
  url: string
  headers: Headers
}

function getTimelineLastModified(): string | null {
  const marker = document.querySelector('.js-timeline-marker')
  return marker != null ? marker.getAttribute('data-last-modified') : null
}

// Add the X-Timeline-Last-Modified header to the request based on the
// the last modified time from the timeline marker element.
function addTimelineLastModifiedHeader(request: Request) {
  if (isCrossDomain(request) || isPjax(request)) {
    return
  }

  const lastModified = getTimelineLastModified()
  if (lastModified) {
    request.headers.set('X-Timeline-Last-Modified', lastModified)
  }
}

function isPjax(request: Request): boolean {
  return request.headers.get('X-PJAX') === 'true'
}

function isCrossDomain(request: Request): boolean {
  let requestURL
  try {
    // eslint-disable-next-line no-restricted-syntax
    requestURL = new URL(request.url)
  } catch (urlError) {
    return true
  }
  return requestURL.host !== window.location.host
}

remoteForm('.js-needs-timeline-marker-header', function (form, wants, request) {
  addTimelineLastModifiedHeader(request)
})

on('deprecatedAjaxSend', '[data-remote]', function (event) {
  const {request} = event.detail
  addTimelineLastModifiedHeader(request)
})
"7import {isDetailsTargetExpanded, toggleDetailsTarget} from '../details'
import {fetchSafeDocumentFragment} from '../../fetch'
import hashChange from '../hash-change'
import {loadDeferredContent} from '../include-fragment'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

const SCROLL_WAIT_MEDIA_TIMEOUT = 5000
const COMMENT_IMAGE = '.js-comment-body img'
const COMMENT_VIDEO = '.js-comment-body video'

hashChange(function () {
  focusOrLoadElement()
})

observe('.js-timeline-progressive-focus-container', function (container) {
  const anchor = urlAnchor()
  if (!anchor) return

  const pullTimeline = document.querySelector<HTMLElement>('.js-pull-discussion-timeline')
  if (pullTimeline) return

  const target = document.getElementById(anchor)

  if (target && container.contains(target)) {
    focusElement(target)
  }
})

function focusOrLoadElement(shouldLoadElement = true): void {
  const anchor = urlAnchor()
  if (!anchor) return

  const target = document.getElementById(anchor)
  if (target) {
    focusElement(target)
  } else {
    if (loadComments(anchor)) return

    const loader = document.querySelector<HTMLElement>('#js-timeline-progressive-loader')

    if (loader && shouldLoadElement) {
      loadElement(anchor, loader)
    }
  }
}

function loadComments(anchor: string): boolean {
  return (
    loadResolvedComments(anchor) ||
    loadHiddenComments(anchor, '.js-thread-hidden-comment-ids') ||
    loadHiddenComments(anchor, '.js-review-hidden-comment-ids')
  )
}

function loadResolvedComments(anchor: string): boolean {
  const commentContainer = findCommentContainer(anchor, '.js-comment-container')
  if (!commentContainer) return false

  loadDeferredContent(commentContainer)
  return true
}

function loadHiddenComments(anchor: string, selector: string): boolean {
  const commentContainer = findCommentContainer(anchor, selector)
  if (!commentContainer) return false

  commentContainer.addEventListener('page:loaded', function () {
    focusOrLoadElement()
  })
  commentContainer.querySelector<HTMLButtonElement>('button[type=submit]')!.click()
  return true
}

function findCommentContainer(anchor: string, selector: string): Element | null {
  const commentContainers = document.querySelectorAll(selector)

  for (const commentContainer of commentContainers) {
    const threadCommentIds = commentContainer.getAttribute('data-hidden-comment-ids')

    if (threadCommentIds) {
      const commentIds = threadCommentIds.split(',')
      const anchorCommentId = anchor.match(/\d+/g)?.[0]

      if (anchorCommentId && commentIds.includes(anchorCommentId)) {
        return commentContainer
      }
    }
  }
  return null
}

observe('.js-inline-comments-container', function (container) {
  const anchor = urlAnchor()
  if (!anchor) return

  const target = document.getElementById(anchor)

  if (target && container.contains(target)) {
    focusElement(target)
  }
})

// adds support for deep-link loading discussion comments when the comment thread is nested
observe('#js-discussions-timeline-anchor-loader', {
  constructor: HTMLElement,
  add: element => {
    const existingProgressiveLoader = document.querySelector('#js-timeline-progressive-loader')
    if (existingProgressiveLoader) return

    const anchor = urlAnchor()
    if (!anchor) return

    const target = document.getElementById(anchor)
    if (!target) {
      loadElement(anchor, element)
    }
  }
})

// resolves when comment body videos have loaded enough data to render the preview image
async function videosReady(): Promise<unknown> {
  const videos: NodeListOf<HTMLVideoElement> = document.querySelectorAll(COMMENT_VIDEO)
  const videoLoads = Array.from(videos).map(v => {
    return new Promise<HTMLVideoElement>(resolve => {
      if (v.readyState >= v.HAVE_METADATA) {
        resolve(v)
      } else {
        // don't wait forever :)
        const timeout = setTimeout(() => resolve(v), SCROLL_WAIT_MEDIA_TIMEOUT)
        const done = () => {
          clearTimeout(timeout)
          resolve(v)
        }
        v.addEventListener('loadeddata', () => {
          if (v.readyState >= v.HAVE_METADATA) done()
        })
        v.addEventListener('error', () => done())
      }
    })
  })
  return Promise.all(videoLoads)
}

// resolves when comment body images are loaded
async function imagesReady(): Promise<unknown> {
  const images: NodeListOf<HTMLImageElement> = document.querySelectorAll(COMMENT_IMAGE)
  const imageLoads = Array.from(images).map(i => {
    new Promise<HTMLImageElement>(resolve => {
      if (i.complete) {
        resolve(i)
      } else {
        const timeout = setTimeout(() => resolve(i), SCROLL_WAIT_MEDIA_TIMEOUT)
        const done = () => {
          clearTimeout(timeout)
          resolve(i)
        }
        i.addEventListener('load', () => done())
        i.addEventListener('error', () => done())
      }
    })
  })
  return Promise.all(imageLoads)
}

async function mediaLoaded(): Promise<unknown> {
  return Promise.all([videosReady(), imagesReady()])
}

async function focusElement(element: HTMLElement): Promise<void> {
  await mediaLoaded()
  expandDetailsIfPresent(element)
  const link = element.querySelector<HTMLElement>(`[href='#${element.id}']`)
  if (link) {
    const oldValue = link.getAttribute('data-turbo')
    link.setAttribute('data-turbo', 'false')
    link.click()
    if (oldValue === null) {
      link.removeAttribute('data-turbo')
    } else {
      link.setAttribute('data-turbo', oldValue)
    }
  }
}

async function loadElement(anchor: string, loader: HTMLElement): Promise<void> {
  if (!loader) return

  const path = loader.getAttribute('data-timeline-item-src')
  if (!path) return

  const url = new URL(path, window.location.origin)
  const params = new URLSearchParams(url.search.slice(1))
  params.append('anchor', anchor)
  url.search = params.toString()

  let html
  try {
    html = await fetchSafeDocumentFragment(document, url.toString())
  } catch (err) {
    return
  }

  const newTimelineItem = html.querySelector('.js-timeline-item')
  if (!newTimelineItem) return

  const gid = newTimelineItem.getAttribute('data-gid')
  if (!gid) return

  const currentTimelineItem = document.querySelector(`.js-timeline-item[data-gid='${gid}']`)

  if (currentTimelineItem) {
    currentTimelineItem.replaceWith(newTimelineItem)

    focusOrLoadElement(false)
  } else {
    const container = document.getElementById('js-progressive-timeline-item-container')
    if (container) container.replaceWith(html)
    focusOrLoadElement(false)
  }
}

function expandDetailsIfPresent(element: HTMLElement): void {
  const detailsContainer = element.closest<HTMLElement>('details, .js-details-container')
  if (!detailsContainer) return
  if (detailsContainer.nodeName === 'DETAILS') {
    detailsContainer.setAttribute('open', 'open')
  } else if (!isDetailsTargetExpanded(detailsContainer)) {
    toggleDetailsTarget(detailsContainer)
  }
}

function urlAnchor(): string {
  return window.location.hash.slice(1)
}
"öimport {announceFromElement} from '../../aria-live'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

observe('.js-discussion', announceTimelineEvents)

function announceTimelineEvents() {
  let existingTimelineItems: WeakSet<Element> = new WeakSet()
  setExistingTimelineItems()

  document.addEventListener('pjax:end', setExistingTimelineItems)
  document.addEventListener('turbo:load', setExistingTimelineItems)

  observe('.js-timeline-item', el => {
    if (!(el instanceof HTMLElement)) return
    if (existingTimelineItems.has(el)) return

    announceFromElement(el)
  })

  function setExistingTimelineItems() {
    existingTimelineItems = new WeakSet(document.querySelectorAll('.js-timeline-item'))
  }
}
"¶import {getCLS, getFCP, getFID, getLCP, getTTFB} from 'web-vitals'
import type {Metric} from 'web-vitals'
import {loaded} from '../document-ready'
import {sendStats} from '../stats'

function sendVitals(metric: Metric) {
  const {name, value} = metric
  const stat: PlatformBrowserPerformanceWebVitalTiming = {name: window.location.href}
  switch (name) {
    case 'CLS':
      stat.cls = value
      break
    case 'FCP':
      stat.fcp = value
      break
    case 'FID':
      stat.fid = value
      break
    case 'LCP':
      stat.lcp = value
      break
    case 'TTFB':
      stat.ttfb = value
      break
  }
  sendStats({webVitalTimings: [stat]})

  updateStaffBar(name, value)
}

function updateStaffBar(name: string, value: number) {
  const staffBarContainer = document.querySelector('#staff-bar-web-vitals')
  const metricContainer = staffBarContainer?.querySelector(`[data-metric=${name.toLowerCase()}]`)

  if (!metricContainer) {
    return
  }

  metricContainer.textContent = value.toPrecision(6)
}

function isTimingSuppported(): boolean {
  return !!(window.performance && window.performance.timing && window.performance.getEntriesByType)
}

async function sendTimingResults() {
  if (!isTimingSuppported()) return

  await loaded
  await new Promise(resolve => setTimeout(resolve))

  const resourceTimings = window.performance.getEntriesByType('resource')
  if (resourceTimings.length) {
    sendStats({resourceTimings})
  }

  const navigationTimings = window.performance.getEntriesByType('navigation')
  if (navigationTimings.length) {
    sendStats({navigationTimings})
  }
}

sendTimingResults()
getCLS(sendVitals)
getFCP(sendVitals)
getFID(sendVitals)
getLCP(sendVitals)
getTTFB(sendVitals)
"¶// Toggler Behavior
//
// target    - Element with a ".js-toggler-target" class name, clicking
//             triggers toggle.
// container - Element with a ".js-toggler-container" class name,
//             contains one or more targets.
//
// The toggle state is defined as "off" or "on". A ".on" class name is
// added to the container when the state is "on". ".on" is removed if
// the state is "off".
//
// Some extra AJAX states are available if any target makes use of
// `data-remote`.
//
// loading - Added to the container before the request is sent and
//           after it finishes.
// success - Added to the container after a successful response
//           returns.
// error   - Added to the container after any bad responses.
//
// Examples
//
//   .starring-container .unstarred { display: block; }
//   .starring-container.on .unstarred { display: none; }
//   .starring-container .starred { display: none; }
//   .starring-container.on .starred { display: block; }
//
//   <div class="js-toggler-container starring-container">
//     <button type="button" href="#" class="starred js-toggler-target">Unstar repository</button>
//     <button type="button" class="unstarred js-toggler-target">Star repository</button>
//   </div>
//

// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {remoteForm} from '@github/remote-form'

on('click', '.js-toggler-container .js-toggler-target', function (event) {
  // Ignore right-click events.
  if (event.button !== 0) return

  const container = event.currentTarget.closest('.js-toggler-container')
  if (container) container.classList.toggle('on')
})

remoteForm('.js-toggler-container', async (form, wants) => {
  form.classList.remove('success', 'error')
  form.classList.add('loading')

  try {
    await wants.text()
    form.classList.add('success')
  } catch (responseError) {
    form.classList.add('error')
  } finally {
    form.classList.remove('loading')
  }
})
"ãimport {ready} from '../document-ready'
;(async function () {
  if ('serviceWorker' in navigator) {
    await ready
    const serviceWorkerPath = document.querySelector<HTMLLinkElement>('link[rel="service-worker-src"]')?.href
    if (serviceWorkerPath) {
      navigator.serviceWorker.register(serviceWorkerPath, {scope: '/'})
    } else {
      await unregisterAllServiceWorkers()
    }
  }
})()

async function unregisterAllServiceWorkers() {
  let registrations: readonly ServiceWorkerRegistration[] = []
  try {
    registrations = await navigator.serviceWorker.getRegistrations()
  } catch (error) {
    if (error.name === 'SecurityError') return
  }

  for (const registration of registrations) {
    registration.unregister()
  }
}
"ÉAimport {
  endSoftNav,
  hasSoftNavFailure,
  inSoftNavigation,
  setSoftNavFailReason,
  softNavFailed,
  softNavInitial,
  softNavSucceeded,
  startSoftNav,
  SOFT_NAV_STATE
} from '../soft-nav-helpers'
import {isFeatureEnabled} from '../features'

import {getStoredShelfParamsForCurrentPage} from '../notifications/v2/notification-shelf-referrer-params'

interface ProgressBar {
  setValue(n: number): void
  hide(): void
  show(): void
}
interface BrowserAdapter {
  progressBar: ProgressBar
}
interface HeadSnapshot {
  detailsByOuterHTML: {
    [outerHTML: string]: {
      tracked: boolean
      elements: Element[]
    }
  }
}

if (isFeatureEnabled('TURBO')) {
  ;(async () => {
    const {PageRenderer, session, navigator} = await import('@manuelpuyol/turbo')
    const adapter = session.adapter as typeof session.adapter & BrowserAdapter

    function beginProgressBar() {
      adapter.progressBar.setValue(0)
      adapter.progressBar.show()
    }

    function completeProgressBar() {
      adapter.progressBar.setValue(1)
      adapter.progressBar.hide()
    }

    document.addEventListener('turbo:before-fetch-request', event => {
      const frame = event.target as Element
      if (frame?.tagName === 'TURBO-FRAME') {
        beginProgressBar()
      }

      // attach a Turbo specific header for visit requests so the server can track Turbo usage
      if (frame?.tagName === 'HTML') {
        const ev = event as CustomEvent
        ev.detail.fetchOptions.headers['Turbo-Visit'] = 'true'
      }

      // pass the notifications params through turbo requests so we properly show the shelf
      const params = getStoredShelfParamsForCurrentPage(event.detail.url.pathname)
      if (params) {
        const newParams = new URLSearchParams(event.detail.url.search)
        for (const [key, value] of Object.entries<string>(params)) {
          if (value) {
            newParams.set(key, value)
          }
        }
        event.detail.url.search = newParams.toString()
      }
    })

    document.addEventListener('turbo:frame-render', event => {
      const frame = event.target
      if ((frame as Element)?.tagName === 'TURBO-FRAME') {
        completeProgressBar()
      }
    })

    document.addEventListener(SOFT_NAV_STATE.START, beginProgressBar)
    document.addEventListener(SOFT_NAV_STATE.END, completeProgressBar)

    // get the reason why a Turbo request had to be reloaded so we can report metrics
    // eslint-disable-next-line @typescript-eslint/ban-ts-comment
    // @ts-ignore
    const originalTrackedElementsAreIdentical = Object.getOwnPropertyDescriptor(PageRenderer.prototype, 'reloadReason')
      .get!
    Object.defineProperty(PageRenderer.prototype, 'reloadReason', {
      get() {
        const reloadReason = originalTrackedElementsAreIdentical.call(this)

        if (reloadReason.reason !== 'tracked_element_mismatch') {
          return reloadReason
        }

        const currentTracked = Object.fromEntries(getSnapshotSignatures(this.currentHeadSnapshot))
        const changedKeys = []

        for (const [key, value] of getSnapshotSignatures(this.newHeadSnapshot)) {
          if (currentTracked[key] !== value) {
            changedKeys.push(key.replace(/^x-/, '').replaceAll('-', '_'))
          }
        }

        return {
          reason: `tracked_element_mismatch-${changedKeys.join('-')}`
        }
      }
    })

    function* getSnapshotSignatures(snapshot: HeadSnapshot): IterableIterator<[string, string]> {
      for (const detail of Object.values(snapshot.detailsByOuterHTML)) {
        if (detail.tracked) {
          for (const element of detail.elements) {
            if (element instanceof HTMLMetaElement && element.getAttribute('http-equiv')) {
              yield [element.getAttribute('http-equiv') || '', element.getAttribute('content') || '']
            }
          }
        }
      }
    }

    type State = Record<string, unknown> & {
      turbo?: {restorationIdentifier: string}
    }

    // keep Turbo's history up to date with the browser's in case code calls native history API's directly
    function patchHistoryApi(name: 'replaceState' | 'pushState') {
      const oldHistory = history[name]

      history[name] = function (this: History, state?: State, unused?: string, url?: string | URL | null) {
        // we need to merge the state from turbo with the state given to pushState in case others are adding data to the state
        function oldHistoryWithMergedState(
          this: History,
          turboState: State,
          turboUnused: string,
          turboUrl?: string | URL | null
        ) {
          oldHistory.call(this, {...state, ...turboState}, turboUnused, turboUrl)
        }

        navigator.history.update(
          oldHistoryWithMergedState,
          new URL(url || location.href, location.href),
          state?.turbo?.restorationIdentifier
        )
      }
    }

    patchHistoryApi('replaceState')
    patchHistoryApi('pushState')
  })()

  const isHashNavigation = (currentUrl: string, targetUrl: string): boolean => {
    const current = new URL(currentUrl, window.location.origin)
    const target = new URL(targetUrl, window.location.origin)

    return (
      Boolean(target.hash) &&
      current.hash !== target.hash &&
      current.host === target.host &&
      current.pathname === target.pathname &&
      current.search === target.search
    )
  }

  document.addEventListener('turbo:click', function (event) {
    if (!(event.target instanceof HTMLElement)) return

    const el = event.target.closest('[data-turbo-frame]')
    if (el instanceof HTMLElement) {
      event.target.setAttribute('data-turbo-frame', el.getAttribute('data-turbo-frame') || '')
    }

    if (!(event instanceof CustomEvent)) return
    // https://github.com/hotwired/turbo/issues/539
    // If we are doing a hash navigation, we want to prevent Turbo from performing a visit
    // so it won't mess with focus styles.
    if (isHashNavigation(location.href, event.detail.url)) {
      event.preventDefault()
    }
  })

  // copy over new attributes on <html> to the existing page
  document.addEventListener('turbo:before-render', event => {
    if (!(event instanceof CustomEvent)) return

    const newDocument = event.detail.newBody.ownerDocument.documentElement
    const currentDocument = document.documentElement

    for (const attr of currentDocument.attributes) {
      if (!newDocument.hasAttribute(attr.nodeName) && attr.nodeName !== 'aria-busy') {
        currentDocument.removeAttribute(attr.nodeName)
      }
    }

    for (const attr of newDocument.attributes) {
      if (currentDocument.getAttribute(attr.nodeName) !== attr.nodeValue) {
        currentDocument.setAttribute(attr.nodeName, attr.nodeValue!)
      }
    }
  })

  document.addEventListener('turbo:visit', startSoftNav)
  document.addEventListener('turbo:render', endSoftNav)
  document.addEventListener('beforeunload', endSoftNav)

  // record success or failure of navs
  document.addEventListener('turbo:load', event => {
    const isHardLoad = Object.keys((event as CustomEvent).detail.timing).length === 0
    if (!isHardLoad) {
      softNavSucceeded()
    } else if (hasSoftNavFailure() || inSoftNavigation()) {
      softNavFailed()
    } else {
      softNavInitial()
    }
  })

  // Emulate `onbeforeunload` event handler for Turbo navigations to
  // support warning a user about losing unsaved content
  document.addEventListener('turbo:before-visit', function (event) {
    const unloadMessage = window.onbeforeunload?.(event)
    if (unloadMessage) {
      const navigate = confirm(unloadMessage)
      if (navigate) {
        window.onbeforeunload = null
      } else {
        event.preventDefault()
      }
    }
  })

  // set the failure reason when we get a reload
  document.addEventListener('turbo:reload', function (event) {
    if (!(event instanceof CustomEvent)) return

    setSoftNavFailReason(event.detail.reason)
  })

  // When navigating to a page with a hash param, we first load the page
  // and then emulate a click to the link with the hash. Since this counts
  // as a same-page hash navigation, Turbo will not cause a second load.
  document.addEventListener(SOFT_NAV_STATE.SUCCESS, () => {
    if (location.hash === '') return

    const a = document.createElement('a')
    a.href = `#${location.hash.slice(1)}`
    a.click()
  })
}
"¨#import {isFeatureEnabled} from '../features'
import {ready} from '../document-ready'
import {SOFT_NAV_STATE} from '../soft-nav-helpers'

if (isFeatureEnabled('TURBO')) {
  interface Node {
    title: string | null | undefined
    scripts: HTMLScriptElement[]
    stylesheets: HTMLLinkElement[]
    transients: Element[]
  }
  const turboHeadCache: {[key: string]: Node} = {}

  const getTurboCacheNode = (html: Document): Node => {
    const head = html.querySelector('[data-turbo-head]') || html.head

    return {
      title: head.querySelector('title')?.textContent,
      scripts: [...html.querySelectorAll('script')],
      stylesheets: [...html.querySelectorAll<HTMLLinkElement>('link[rel=stylesheet]')],
      transients: [...head.querySelectorAll('[data-pjax-transient]')]
    }
  }

  ;(async () => {
    await ready
    turboHeadCache[document.location.href] = getTurboCacheNode(document)
  })()

  let visitTarget: string
  let frameNavigation = false

  // Since `frame-render` is triggered before the URL is changed, we need to keep track
  // of the target URL somehow. So we use the `turbo:visit` event to do that.
  document.addEventListener('turbo:visit', event => {
    if (!(event instanceof CustomEvent)) return

    visitTarget = event.detail.url
  })

  // During the frame-render event, we have access to the response HTML. We can use that
  // to update the page's cache with the new head, scripts, stylesheets, and transients.
  // We DON'T update the elements here, since Turbo will restore elements from its snapshot
  // which doesn't include elements that aren't part of the frame.
  document.addEventListener('turbo:frame-render', async event => {
    frameNavigation = true
    const responseHTML = await (event as CustomEvent).detail.fetchResponse.responseHTML
    const parsedHTML = new DOMParser().parseFromString(responseHTML, 'text/html')

    replaceElements(parsedHTML)
    turboHeadCache[visitTarget] = getTurboCacheNode(parsedHTML)
  })

  // At this point, Turbo finished updating things from its snapshot, so we can manually
  // updates whatever is necessary from the navigation.
  document.addEventListener(SOFT_NAV_STATE.SUCCESS, () => {
    if (!frameNavigation) return

    frameNavigation = false
    replaceTitle()
    replaceTransientTags()
    addNewStylesheets()
    addNewScripts()
    document.dispatchEvent(new CustomEvent(SOFT_NAV_STATE.FRAME_UPDATE))
  })

  const replaceElements = (html: Document) => {
    const newElements = html.querySelectorAll('[data-turbo-replace]')
    const oldElements = [...document.querySelectorAll('[data-turbo-replace]')]

    for (const newElement of newElements) {
      const oldElement = oldElements.find(el => el.id === newElement.id)

      if (oldElement) {
        oldElement.replaceWith(newElement)
      }
    }
  }

  const replaceTitle = () => {
    const title = turboHeadCache[document.location.href]?.title

    if (title) {
      document.title = title
    }
  }

  // Replace all `data-pjax-transient` elements
  const replaceTransientTags = () => {
    const cached = turboHeadCache[document.location.href]?.transients
    if (!cached) return

    for (const el of document.querySelectorAll('head [data-pjax-transient]')) {
      el.remove()
    }

    for (const el of cached) {
      // title, scripts and stylesheets have their own logic to be added
      // so here we'll only deal with the rest of the transient elements
      // This is just a safeguard in case someone adds `data-pjax-transient`
      // to one of those elements.
      if (!el.matches('title, script, link[rel=stylesheet]')) {
        el.setAttribute('data-pjax-transient', '')
        document.head.append(el)
      }
    }
  }

  const addNewStylesheets = () => {
    const cached = turboHeadCache[document.location.href]?.stylesheets
    if (!cached) return

    // Only add stylesheets that aren't already in the page
    for (const el of cached) {
      if (
        !document.head.querySelector(
          `link[href="${el.getAttribute('href')}"],
           link[data-href="${el.getAttribute('data-href')}"]`
        )
      ) {
        document.head.append(el)
      }
    }
  }

  const addNewScripts = () => {
    const cached = turboHeadCache[document.location.href]?.scripts
    if (!cached) return

    // Only add scripts that aren't already in the page
    for (const el of cached) {
      if (!document.head.querySelector(`script[src="${el.getAttribute('src')}"]`)) {
        document.head.append(el)
      }
    }
  }
}
"çexport default function timezone(): string | void {
  if ('Intl' in window) {
    try {
      const format = new window.Intl.DateTimeFormat()
      return format.resolvedOptions().timeZone
    } catch {
      // ignore
    }
  }
}
"Ìimport {setCookie} from '../cookies'
import timezone from '../timezone'

window.requestIdleCallback(() => {
  const value = timezone()
  if (value) {
    setCookie('tz', encodeURIComponent(value))
  }
})
cª[i m p o r t   { a t t r ,   c o n t r o l l e r ,   t a r g e t ,   t a r g e t s }   f r o m   ' @ g i t h u b / c a t a l y s t ' 
 i m p o r t   { g e t ,   s u p p o r t e d }   f r o m   ' @ g i t h u b / w e b a u t h n - j s o n ' 
 i m p o r t   t y p e   { C r e d e n t i a l R e q u e s t O p t i o n s J S O N }   f r o m   ' @ g i t h u b / w e b a u t h n - j s o n ' 
 i m p o r t   { r e q u e s t S u b m i t }   f r o m   ' . . / f o r m ' 
 
 e n u m   S t a t e   { 
     I n i t i a l i z i n g   =   ' i n i t i a l i z i n g ' , 
     U n s u p p o r t e d   =   ' u n s u p p o r t e d ' , 
     R e a d y   =   ' r e a d y ' , 
     W a i t i n g   =   ' w a i t i n g ' , 
     E r r o r   =   ' e r r o r ' , 
     S u b m i t t i n g   =   ' s u b m i t t i n g ' 
 } 
 
 @ c o n t r o l l e r 
 e x p o r t   c l a s s   W e b a u t h n G e t E l e m e n t   e x t e n d s   H T M L E l e m e n t   { 
     s t a t e :   S t a t e   =   S t a t e . I n i t i a l i z i n g 
     @ t a r g e t   b u t t o n :   H T M L B u t t o n E l e m e n t 
     / /   ` m e s s a g e s `   c o n t a i n s   a l l   t h e   m e s s a g e   e l e m e n t s . 
     @ t a r g e t s   m e s s a g e s :   H T M L E l e m e n t [ ] 
     @ t a r g e t   u n s u p p o r t e d M e s s a g e :   H T M L E l e m e n t 
     @ t a r g e t   w a i t i n g M e s s a g e :   H T M L E l e m e n t 
     @ t a r g e t   e r r o r M e s s a g e :   H T M L E l e m e n t 
 
     @ a t t r   j s o n   =   ' ' 
     / /   W e   c a n ' t   c a l l   t h i s   ` a u t o f o c u s ` ,   s i n c e   t h a t ' s   a l r e a d y   a n   ` H T M L E l e m e n t `   p r o p e r t y . 
     @ a t t r   a u t o f o c u s W h e n R e a d y   =   f a l s e 
     @ a t t r   a u t o P r o m p t   =   f a l s e 
 
     p r i v a t e   o r i g i n a l B u t t o n T e x t :   s t r i n g   |   n u l l 
     p r i v a t e   h a s E r r o r e d   =   f a l s e 
 
     c o n n e c t e d C a l l b a c k ( ) :   v o i d   { 
         t h i s . o r i g i n a l B u t t o n T e x t   =   t h i s . b u t t o n . t e x t C o n t e n t 
         t h i s . s e t S t a t e ( s u p p o r t e d ( )   ?   S t a t e . R e a d y   :   S t a t e . U n s u p p o r t e d ) 
 
         i f   ( t h i s . a u t o P r o m p t )   { 
             t h i s . p r o m p t ( u n d e f i n e d ,   t r u e ) 
         } 
     } 
 
     s e t S t a t e ( s t a t e :   S t a t e ) :   v o i d   { 
         / /   R e s e t   t o   d e f a u l t s 
         t h i s . b u t t o n . t e x t C o n t e n t   =   t h i s . h a s E r r o r e d   ?   t h i s . b u t t o n . g e t A t t r i b u t e ( ' d a t a - r e t r y - m e s s a g e ' )   :   t h i s . o r i g i n a l B u t t o n T e x t 
         t h i s . b u t t o n . d i s a b l e d   =   f a l s e 
         t h i s . b u t t o n . h i d d e n   =   f a l s e 
         f o r   ( c o n s t   e l e m   o f   t h i s . m e s s a g e s )   { 
             e l e m . h i d d e n   =   t r u e 
         } 
 
         s w i t c h   ( s t a t e )   { 
             c a s e   S t a t e . I n i t i a l i z i n g : 
                 t h i s . b u t t o n . d i s a b l e d   =   t r u e 
                 b r e a k 
             c a s e   S t a t e . U n s u p p o r t e d : 
                 t h i s . b u t t o n . d i s a b l e d   =   t r u e 
                 t h i s . u n s u p p o r t e d M e s s a g e . h i d d e n   =   f a l s e 
                 b r e a k 
             c a s e   S t a t e . R e a d y : 
                 i f   ( t h i s . a u t o f o c u s W h e n R e a d y )   { 
                     t h i s . b u t t o n . f o c u s ( ) 
                 } 
                 b r e a k 
             c a s e   S t a t e . W a i t i n g : 
                 t h i s . w a i t i n g M e s s a g e . h i d d e n   =   f a l s e 
                 t h i s . b u t t o n . h i d d e n   =   t r u e 
                 b r e a k 
             c a s e   S t a t e . E r r o r : 
                 t h i s . e r r o r M e s s a g e . h i d d e n   =   f a l s e 
                 b r e a k 
             c a s e   S t a t e . S u b m i t t i n g : 
                 t h i s . b u t t o n . t e x t C o n t e n t   =   ' V e r i f y i n g & ' 
                 t h i s . b u t t o n . d i s a b l e d   =   t r u e 
                 b r e a k 
             d e f a u l t : 
                 t h r o w   n e w   E r r o r ( ' i n v a l i d   s t a t e ' ) 
         } 
 
         t h i s . s t a t e   =   s t a t e 
     } 
 
     / /   s i l e n t _ u n l e s s _ s u c c e s s :   d o n ' t   s h o w   w a i t i n g   o r   e r r o r   s t a t u s .   T h i s   i s   f o r   a u t o m a t i c a l l y   a t t e m p t i n g   a   p r o m p t   a t 
     / /   p a g e / m o d a l   l o a d   t i m e ,   w i t h o u t   s h o w i n g   c o n f u s i n g   U I   i f   t h e   b r o w s e r   r e j e c t s   t h e   a t t e m p t   d u e   t o   a   m i s s i n g   u s e r 
     / /   g e s t u r e .   M o s t   b r o w s e r s   a l l o w   a t   l e a s t   o n e   s u c h   p r o m p t   p e r   p a g e   l o a d ,   b u t   w e   c a n ' t   r e l y   o n   i t .   I n   t h e o r y   w e   c o u l d 
     / /   t r y   t o   s h o w   a n   e r r o r   t o   t h e   u s e r   d e p e n d i n g   o n   t h e   ` g e t `   r e j e c t i o n ,   b u t   t h e   s p e c   i s   s t i l l   i n   f l u x   a n d   b r o w s e r s 
     / /   c o n s t a n t l y   c h a n g e   t h e i r   m i n d   ( a n d   h a v e   b u g s ) .   S o   w e   e r r   o n   t h e   s i d e   o f   n o t   s h o w i n g   a n   e r r o r . 
     a s y n c   p r o m p t ( e v e n t ? :   E v e n t ,   s i l e n t _ u n l e s s _ s u c c e s s ? :   b o o l e a n ) :   P r o m i s e < v o i d >   { 
         e v e n t ? . p r e v e n t D e f a u l t ( )   / /   p r e v e n t   d e f a u l t   p a g e   f o r m   s u b m i s s i o n 
         t h i s . d i s p a t c h E v e n t ( n e w   C u s t o m E v e n t ( ' w e b a u t h n - g e t - p r o m p t ' ) ) 
         t r y   { 
             i f   ( ! s i l e n t _ u n l e s s _ s u c c e s s )   { 
                 t h i s . s e t S t a t e ( S t a t e . W a i t i n g ) 
             } 
 
             c o n s t   j s o n :   C r e d e n t i a l R e q u e s t O p t i o n s J S O N   =   J S O N . p a r s e ( t h i s . j s o n ) 
             c o n s t   s i g n R e s p o n s e   =   a w a i t   g e t ( j s o n ) 
             t h i s . s e t S t a t e ( S t a t e . S u b m i t t i n g ) 
 
             / /   E a c h   ` < w e b a u t h n - g e t > `   e l e m e n t   i s   c u r r e n t l y   e m b e d d e d   i n   a   f o r m   ( n o t 
             / /   t h e   o t h e r   w a y   a r o u n d ) ,   s o   w e   h a v e   t o   q u e r y   f o r   f o r   t h e   f o r m   o u t s i d e   o f   i t . 
             c o n s t   f o r m   =   t h i s . c l o s e s t < H T M L F o r m E l e m e n t > ( ' . j s - w e b a u t h n - f o r m ' ) ! 
             c o n s t   r e s p o n s e F i e l d   =   f o r m . q u e r y S e l e c t o r < H T M L I n p u t E l e m e n t > ( ' . j s - w e b a u t h n - r e s p o n s e ' ) ! 
             r e s p o n s e F i e l d . v a l u e   =   J S O N . s t r i n g i f y ( s i g n R e s p o n s e ) 
             r e q u e s t S u b m i t ( f o r m ) 
         }   c a t c h   ( e r r o r )   { 
             i f   ( ! s i l e n t _ u n l e s s _ s u c c e s s )   { 
                 t h i s . h a s E r r o r e d   =   t r u e 
                 t h i s . s e t S t a t e ( S t a t e . E r r o r ) 
                 t h r o w   e r r o r 
             } 
         } 
     } 
 } 
 
 e n u m   S u d o P a s s w o r d E l e m e n t S t a t e   { 
     I n i t i a l i z i n g   =   ' i n i t i a l i z i n g ' , 
     S h o w i n g F o r m   =   ' s h o w i n g - f o r m ' , 
     S h o w i n g R e v e a l e r   =   ' s h o w i n g - r e v e a l e r ' 
 } 
 
 @ c o n t r o l l e r 
 e x p o r t   c l a s s   S u d o P a s s w o r d E l e m e n t   e x t e n d s   H T M L E l e m e n t   { 
     @ a t t r   s t a t e :   S u d o P a s s w o r d E l e m e n t S t a t e   =   S u d o P a s s w o r d E l e m e n t S t a t e . S h o w i n g F o r m 
 
     @ t a r g e t   r e v e a l e r :   H T M L E l e m e n t 
     @ t a r g e t   f o r m :   H T M L E l e m e n t 
     @ t a r g e t   p a s s w o r d F i e l d :   H T M L I n p u t E l e m e n t 
 
     / /   N o t e :   T h e   f o r m   i s   r e v e a l e d   i n   t h e   D O M   b y   d e f a u l t ,   b e c a u s e   w e   w a n t   t o   m a k e 
     / /   s u r e   t h a t   t h e   f o r m   l o a d s   w h e n   J S   i s   n o t   w o r k i n g . 
     c o n n e c t e d C a l l b a c k ( ) :   v o i d   { 
         / /   U p d a t e   t h e   D O M   f r o m   i t s   d e f a u l t   ( s h o w i n g   t h e   p a s s w o r d   f o r ,   i n   c a s e   J S 
         / /   d o e s n ' t   w o r k )   t o   t h e   i n i t i a l   s t a t e . 
         t h i s . s e t S t a t e ( t h i s . s t a t e ) 
     } 
 
     s e t S t a t e ( s t a t e :   S u d o P a s s w o r d E l e m e n t S t a t e ) :   v o i d   { 
         / /   R e s e t   t o   d e f a u l t s 
         t h i s . r e v e a l e r . h i d d e n   =   t r u e 
         t h i s . f o r m . h i d d e n   =   f a l s e 
 
         s w i t c h   ( s t a t e )   { 
             c a s e   S u d o P a s s w o r d E l e m e n t S t a t e . I n i t i a l i z i n g : 
                 b r e a k 
             c a s e   S u d o P a s s w o r d E l e m e n t S t a t e . S h o w i n g F o r m : 
                 t h i s . d i s p a t c h E v e n t ( n e w   C u s t o m E v e n t ( ' s u d o - p a s s w o r d - s h o w i n g - f o r m ' ) ) 
                 b r e a k 
             c a s e   S u d o P a s s w o r d E l e m e n t S t a t e . S h o w i n g R e v e a l e r : 
                 t h i s . r e v e a l e r . h i d d e n   =   f a l s e 
                 t h i s . f o r m . h i d d e n   =   t r u e 
                 b r e a k 
             d e f a u l t : 
                 t h r o w   n e w   E r r o r ( ' i n v a l i d   s t a t e ' ) 
         } 
 
         t h i s . s t a t e   =   s t a t e 
     } 
 
     r e v e a l ( ) :   v o i d   { 
         t h i s . s e t S t a t e ( S u d o P a s s w o r d E l e m e n t S t a t e . S h o w i n g F o r m ) 
     } 
 } 
 
 @ c o n t r o l l e r 
 e x p o r t   c l a s s   S u d o A u t h E l e m e n t   e x t e n d s   H T M L E l e m e n t   { 
     / /   ` < w e b a u t h n - g e t > `   i s   o n l y   i n   t h e   D O M   i f   t h e   u s e r   h a s   h a s   a   n e c e s s a r y 
     / /   r e g i s t r a t i o n . 
     @ t a r g e t   w e b a u t h n G e t :   W e b a u t h n G e t E l e m e n t 
     @ t a r g e t   s u d o P a s s w o r d :   S u d o P a s s w o r d E l e m e n t 
 
     c o n n e c t e d C a l l b a c k ( ) :   v o i d   { 
         t h i s . w e b a u t h n G e t ? . a d d E v e n t L i s t e n e r ( ' w e b a u t h n - g e t - p r o m p t ' ,   ( )   = >   { 
             t h i s . s u d o P a s s w o r d . s e t S t a t e ( S u d o P a s s w o r d E l e m e n t S t a t e . S h o w i n g R e v e a l e r ) 
         } ) 
 
         t h i s . s u d o P a s s w o r d . a d d E v e n t L i s t e n e r ( ' s u d o - p a s s w o r d - s h o w i n g - f o r m ' ,   ( )   = >   { 
             t h i s . w e b a u t h n G e t ? . s e t S t a t e ( S t a t e . R e a d y ) 
             t h i s . s u d o P a s s w o r d . p a s s w o r d F i e l d . f o c u s ( ) 
         } ) 
     } 
 } 
 "Êimport {fromEvent} from '../subscription'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
import {requestSubmit} from '../form'

let unreadCount = 0

function markThreadAsRead() {
  if (!document.hasFocus()) return
  const form = document.querySelector('.js-timeline-marker-form')
  if (form && form instanceof HTMLFormElement) requestSubmit(form)
}

const observer =
  'IntersectionObserver' in window
    ? new IntersectionObserver(
        function (entries) {
          for (const entry of entries) {
            if (entry.isIntersecting) {
              clearUnread(entry.target)
            }
          }
        },
        {
          root: null,
          rootMargin: '0px',
          threshold: 1.0
        }
      )
    : null

observe('.js-unread-item', {
  constructor: HTMLElement,
  add(el) {
    unreadCount++
    if (observer) {
      observer.observe(el)
    }
  },
  remove(el) {
    unreadCount--
    if (observer) {
      observer.unobserve(el)
    }
    if (unreadCount === 0) {
      markThreadAsRead()
    }
  }
})

function clearUnread(el: Element) {
  el.classList.remove('js-unread-item', 'unread-item')
}

// Mark any unread comments as read if the user has marked the thread as read
// in another tab or remotely via email notification.
observe('.js-discussion[data-channel-target]', {
  subscribe: el =>
    fromEvent(el, 'socket:message', function (event: Event) {
      const target = event.target as Element
      const data = (event as CustomEvent).detail.data
      if (target.getAttribute('data-channel-target') === data.gid) {
        for (const item of document.querySelectorAll('.js-unread-item')) {
          clearUnread(item)
        }
      }
    })
})
"¸// Unread Item Counter
//
// Keeps count of how many unread items are present throughout the page. The
// count is reflected in the page title automatically.
//
// To increase or decrease the page title counter, it's as simple as adding or
// removing the `.js-unread-item` class from an element. The counter is reset and
// the page title is cleared when there are no more elements with the
// `.js-unread-item` class present.
//
// Markup
//
// ``` html
// <div class="comment js-comment js-unread-item">
//   :metal:
// </div>
// ```
//

// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

let unreadCounter = 0
const titleRe = /^\(\d+\)\s+/

function updateTitle() {
  const prefix = unreadCounter ? `(${unreadCounter}) ` : ''
  if (document.title.match(titleRe)) {
    document.title = document.title.replace(titleRe, prefix)
  } else {
    document.title = `${prefix}${document.title}`
  }
}

observe('.js-unread-item', {
  add() {
    unreadCounter++
    updateTitle()
  },
  remove() {
    unreadCounter--
    updateTitle()
  }
})
"³//
// Updatable Content
//
// Markup
//
//     <div class="js-socket-channel js-updatable-content"
//          data-channel="pull:123"
//          data-url="/pull/123?partial=commits">
//     </div>
//

import {fromEvent} from '../subscription'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
import {updateContent} from '../updatable-content'

observe('.js-socket-channel.js-updatable-content', {
  subscribe: el =>
    fromEvent(el, 'socket:message', function (event: Event) {
      const {gid, wait} = (event as CustomEvent).detail.data
      const container = event.target as HTMLElement
      const target = gid ? findByGid(container, gid) : container
      if (target) setTimeout(updateContent, wait || 0, target)
    })
})

function findByGid(root: HTMLElement, gid: string): HTMLElement | null {
  if (root.getAttribute('data-gid') === gid) return root
  for (const el of root.querySelectorAll<HTMLElement>(`[data-url][data-gid]`)) {
    if (el.getAttribute('data-gid') === gid) {
      return el
    }
  }
  return null
}
"import {registerStaleRecords, replaceContent} from '../updatable-content'
import {ready} from '../document-ready'
import {replaceState} from '../history'

async function reapplyPreviouslyUpdatedContent() {
  if (!history.state || !history.state.staleRecords) return
  await ready
  for (const url in history.state.staleRecords) {
    for (const urlTarget of document.querySelectorAll(
      `.js-updatable-content [data-url='${url}'], .js-updatable-content[data-url='${url}']`
    )) {
      const data = history.state.staleRecords[url]
      if (urlTarget instanceof HTMLElement) replaceContent(urlTarget, data, true)
    }
  }
  replaceState(null, '', location.href)
}

window.addEventListener('pagehide', registerStaleRecords)

try {
  reapplyPreviouslyUpdatedContent()
} catch {
  // ignore
}
"ðimport {dialog} from '../details-dialog'
import {fetchSafeDocumentFragment} from '../fetch'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

on('upload:setup', '.js-upload-avatar-image', function (event) {
  const {form} = event.detail
  const orgId = event.currentTarget.getAttribute('data-alambic-organization')
  const ownerType = event.currentTarget.getAttribute('data-alambic-owner-type')
  const ownerId = event.currentTarget.getAttribute('data-alambic-owner-id')
  if (orgId) {
    form.append('organization_id', orgId)
  }
  if (ownerType) {
    form.append('owner_type', ownerType)
  }
  if (ownerId) {
    form.append('owner_id', ownerId)
  }
})

on('upload:complete', '.js-upload-avatar-image', function (event) {
  const {attachment} = event.detail
  const url = `/settings/avatars/${attachment.id}`
  dialog({content: fetchSafeDocumentFragment(document, url), detailsClass: 'upload-avatar-details'})
})

on('dialog:remove', '.upload-avatar-details', async function (element) {
  const cropForm = element.currentTarget.querySelector('#avatar-crop-form')!
  const id = cropForm.getAttribute('data-alambic-avatar-id')!
  const url = `/settings/avatars/${id}?op=destroy`

  const csrfToken = element.currentTarget.querySelector('.js-avatar-post-csrf')!.getAttribute('value')!

  const request = new Request(url, {
    method: 'POST',
    headers: {
      'Scoped-CSRF-Token': csrfToken,
      'X-Requested-With': 'XMLHttpRequest'
    }
  })

  await self.fetch(request)
})
"Ñ// Support linking to named anchors in user content
//
// Named elements in user content are prefixed with "user-content-" to prevent
// DOM clobbering. This allows users to link to the unprefixed named anchors by
// listening for hashchange and, when when no elements with an ID or name of the
// given hash exist, looks for an element with a prefixed name.
//
// See https://github.com/github/github/issues/23103 for more information.

import {decodeFragmentValue, findElementByFragmentName} from '../fragment-target'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {ready} from '../document-ready'
import {scrollIntoView} from '../sticky-scroll-into-view'

function hashchange() {
  if (document.querySelector(':target')) {
    return
  }
  const hash = decodeFragmentValue(location.hash).toLowerCase()
  const target = findElementByFragmentName(document, `user-content-${hash}`)
  if (target) {
    scrollIntoView(target)
  }
}

// Scroll to anchor when clicked on page.
window.addEventListener('hashchange', hashchange)

// Scroll to anchor on pjax navigation
document.addEventListener('pjax:success', hashchange)

// Scroll to anchor on page load.
;(async function () {
  await ready
  hashchange()
})()

// Scroll to anchor when clicking on a link that has the exact same fragment
// identifier as already present in the URL. This won't trigger `hashchange`,
// so we need to scroll manually.
on('click', 'a[href]', function (event) {
  const {currentTarget} = event
  if (!(currentTarget instanceof HTMLAnchorElement)) return

  if (currentTarget.href === location.href && location.hash.length > 1) {
    setTimeout(function () {
      if (!event.defaultPrevented) hashchange()
    })
  }
})
"import {fromEvent} from '../subscription'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

async function load(event: Event) {
  const container = event.currentTarget as HTMLElement
  const {init} = await import('../user-status-submit')
  init(container)
}

observe('.js-user-status-container', {
  subscribe: el => fromEvent(el, 'click', load, {once: true})
})
"ül// User list dialogs
//
// Handle user list creation, deletion, and editing.

// eslint-disable-next-line no-restricted-imports
import {fire, on} from 'delegated-events'
import type {SimpleResponse} from '@github/remote-form'
import {TemplateInstance} from '@github/template-parts'
import {dialog} from '../details-dialog'
import {hasDirtyFields} from '../has-interactions'
import {onInput} from '../onfocus'
import {parseHTML} from '../parse-html'
import {remoteForm} from '@github/remote-form'
import {requestSubmit} from '../form'
import {showGlobalError} from './ajax-error'
import {updateContent} from '../updatable-content'
import {updateSocialCounts} from './social'

// Communicate a generic error, not associated with a specific attribute, to the user. This is used if the
// server does something unexpected, like returning a 500 error or reporting an unrecognized attribute.
function setFlashError(form: HTMLFormElement, message?: string) {
  const flash = form.querySelector<HTMLElement>('.js-user-list-base')
  if (flash) {
    flash.textContent = message || flash.getAttribute('data-generic-message')
    flash.hidden = false
  }
}

// Clear any validation errors from the form. If a specific formGroup is provided, only clear errors from that
// group. Otherwise, clear errors from all groups. In either case, flash errors should be cleared as well.
function resetValidation(form: HTMLFormElement, formGroup?: HTMLElement) {
  const container = formGroup || form
  const notes = container.querySelectorAll<HTMLElement>('.js-user-list-error')
  for (const note of notes) {
    note.hidden = true
  }

  const groups = formGroup ? [formGroup] : form.querySelectorAll<HTMLElement>('.errored.js-user-list-input-container')
  for (const group of groups) {
    group.classList.remove('errored')
  }

  const flash = form.querySelector<HTMLElement>('.js-user-list-base')
  if (flash) {
    flash.hidden = true
  }
}

// Wire up remote form submission. Clear preexisting validation errors from the form, submit it with XHR, and interpret
// the server's response. On success, reload the page. On failure, attempt to interpret the response as validation
// errors and display them next to the appropriate inputs.
remoteForm('.js-user-list-form', async function (form, wants) {
  resetValidation(form)

  const submitButton = form.querySelector<HTMLButtonElement>('[data-submitting-message]')
  const originalButtonText = submitButton?.textContent
  if (submitButton) {
    // We can't use data-disable-with here because the button is re-enabled immediately after the response is received,
    // but before we have a chance to handle it and redirect or swap out the form contents. This results in a
    // disorienting jitter.
    submitButton.textContent = submitButton.getAttribute('data-submitting-message')
    submitButton.disabled = true
  }

  for (const input of form.querySelectorAll<HTMLInputElement>('.js-user-list-input')) {
    input.disabled = true
  }

  try {
    const response = await wants.html()

    // Let a containing element determine how to handle the response.
    fire(form, 'user-list-form:success', response.html)
  } catch (error) {
    if (error.response?.status === 422) {
      form.replaceWith(error.response.html)
    } else {
      setFlashError(form)

      if (submitButton) {
        if (originalButtonText) submitButton.textContent = originalButtonText
        submitButton.disabled = false
      }

      for (const input of form.querySelectorAll<HTMLInputElement>('.js-user-list-input')) {
        input.disabled = false
      }
    }
  }
})

on('user-list-form:success', '.js-follow-list', event => {
  const responseBody = event.detail
  const targetUrl =
    responseBody instanceof DocumentFragment ? responseBody.querySelector<HTMLElement>('.js-target-url') : null
  if (targetUrl?.textContent) {
    location.href = targetUrl.textContent
  } else {
    location.reload()
  }
})

// Dismiss a validation error from a form input when you start changing it.
function clearErrorsFromInput(event: Event) {
  if (!(event.currentTarget instanceof HTMLElement)) {
    return
  }

  const form = event.currentTarget.closest<HTMLFormElement>('.js-user-list-form')
  const formGroup = event.currentTarget.closest<HTMLElement>('.js-user-list-input-container')
  if (form && formGroup) {
    resetValidation(form, formGroup)
  }
}

onInput('.js-user-list-form input', clearErrorsFromInput)
onInput('.js-user-list-form textarea', clearErrorsFromInput)

// Unhide the .note element containing the validation error reported by <auto-check> when there's an error to show.
on('auto-check-error', '.js-user-list-form input', function (event) {
  const formGroup = event.currentTarget.closest<HTMLElement>('.js-user-list-input-container')
  const note = formGroup?.querySelector<HTMLElement>('.js-user-list-error')
  if (note) {
    note.hidden = false
  }
})

// Star button UserList menu

// Given a collection of UserList menu root elements, construct a map grouping them by the repository ID each
// corresponds to.
function groupRootsByRepositoryId(roots: Iterable<HTMLElement>): Map<string, HTMLElement[]> {
  const rootsByRepositoryId = new Map<string, HTMLElement[]>()
  for (const root of roots) {
    const repositoryId = root
      .querySelector<HTMLInputElement>('.js-user-lists-create-trigger')
      ?.getAttribute('data-repository-id')
    if (repositoryId) {
      const existingRoots = rootsByRepositoryId.get(repositoryId)
      if (existingRoots) {
        existingRoots.push(root)
      } else {
        rootsByRepositoryId.set(repositoryId, [root])
      }
    }
  }
  return rootsByRepositoryId
}

// Perform a POST request to the batch-render endpoint to render a collection of UserList menus corresponding to the
// repositories. Asynchronously returns a Map<repository ID> => rendered HTML generated for that repository.
//
// Rejects its promise on network errors, but returns an empty map on server errors.
async function requestMenuBatchRender(
  batchUpdateUrl: string,
  csrfToken: string,
  repositoryIds: Iterable<string>
): Promise<Map<string, DocumentFragment>> {
  const postData = new FormData()

  // eslint-disable-next-line github/authenticity-token
  postData.set('authenticity_token', csrfToken)
  for (const repositoryId of repositoryIds) {
    postData.append('repository_ids[]', repositoryId)
  }

  const response = await fetch(batchUpdateUrl, {
    method: 'POST',
    body: postData,
    headers: {
      Accept: 'application/json',
      'X-Requested-With': 'XMLHttpRequest'
    }
  })

  const updatedMenuContents = new Map<string, DocumentFragment>()
  if (response.ok) {
    const json = await response.json()
    for (const key in json) {
      updatedMenuContents.set(key, parseHTML(document, json[key]))
    }
  }
  return updatedMenuContents
}

// Replace the contents of UserList menus in the DOM with the updated, rendered HTML generated for each by the batch
// render endpoint.
function replaceUserListMenuRoots(
  renderedMenuContents: Map<string, DocumentFragment>,
  rootsByRepositoryId: Map<string, HTMLElement[]>
) {
  for (const [repositoryId, updatedMenu] of renderedMenuContents.entries()) {
    const matchingRoots = rootsByRepositoryId.get(repositoryId) || []
    for (const root of matchingRoots) {
      root.replaceWith(matchingRoots.length === 1 ? updatedMenu : updatedMenu.cloneNode(true))
    }
  }
}

// Perform a single request to replace all UserList menus currently present in the DOM with updated versions from the
// server.
//
// Expects a response in form of:
//
// {
//   "<repo id 0>": "<div> <!-- markup for menu for repo 0 --></div>",
//   "<repo id 1>": "<div> <!-- markup for menu for repo 1 --></div>",
//   "<repo id 2>": "<div> <!-- markup for menu for repo 2 --></div>"
// }
async function updateAllUserListMenus() {
  const roots = document.querySelectorAll<HTMLElement>('.js-user-list-menu-content-root')
  if (roots.length === 0) return

  const batchUpdateUrl = roots[0].getAttribute('data-batch-update-url')
  if (!batchUpdateUrl) return

  const csrfToken = roots[0].querySelector<HTMLInputElement>('.js-user-list-batch-update-csrf')?.value
  if (!csrfToken) return

  const rootsByRepositoryId = groupRootsByRepositoryId(roots)
  const repositoryIds = rootsByRepositoryId.keys()
  const renderedMenuContents = await requestMenuBatchRender(batchUpdateUrl, csrfToken, repositoryIds)
  if (renderedMenuContents.size > 0) {
    replaceUserListMenuRoots(renderedMenuContents, rootsByRepositoryId)
  }
}

function requestUserListMenuFormSubmit(form: HTMLFormElement) {
  const promise = new Promise<void>((resolve, reject) => {
    form.addEventListener('user-list-menu-form:success', () => resolve())
    form.addEventListener('user-list-menu-form:error', error => reject(error))
  })
  requestSubmit(form)
  return promise
}

function submitUserListFormOnToggle(event: Event) {
  const detailsElement = event.target
  if (!(detailsElement instanceof HTMLDetailsElement)) return
  if (detailsElement.hasAttribute('open')) return

  const form = detailsElement.querySelector<HTMLFormElement>('.js-user-list-menu-form')
  if (form && hasDirtyFields(form)) requestSubmit(form)

  const triggerText = detailsElement.querySelector('.js-user-list-create-trigger-text')
  if (triggerText) triggerText.textContent = ''
}

on('toggle', '.js-user-list-menu', submitUserListFormOnToggle, {capture: true})

onInput('.js-user-lists-menu-filter', (event: Event) => {
  const target = event.currentTarget as HTMLInputElement
  const value = target.value.trim()
  const root = target.closest('.js-user-list-menu-content-root')
  const triggerText = root?.querySelector('.js-user-list-create-trigger-text')

  if (!triggerText) return
  triggerText.textContent = value ? `"${value}"` : ''
})

remoteForm('.js-user-list-menu-form', async function (form, wants) {
  let response: SimpleResponse
  try {
    response = await wants.json()
  } catch (error) {
    showGlobalError()
    fire(form, 'user-list-menu-form:error', error)
    return
  }

  // Update the star button state and counts if necessary.
  // We only update the star count if the repo was just starred. Otherwise the count could jump every time you dismiss
  // the menu, which would be jarring.
  if (response.json.didStar) {
    const togglerContainer = form.closest<HTMLElement>('.js-toggler-container')
    if (togglerContainer) togglerContainer.classList.add('on')

    const starCount = response.json.starCount
    if (starCount) {
      const socialContainer = form.closest<HTMLElement>('.js-social-container')
      if (socialContainer) updateSocialCounts(socialContainer, starCount)
    }
  }

  const menuContentRoot = form.closest<HTMLElement>('.js-user-list-menu-content-root[data-update-after-submit]')
  if (menuContentRoot) {
    // Reset checkbox state before potentially calling updateContent() to avoid the checkboxes being detected as "dirty"
    // and terminating the update. They'll be checked in the updated content, assuming the repo was in fact added
    // successfully.
    for (const input of form.querySelectorAll<HTMLInputElement>('.js-user-list-menu-item')) {
      input.checked = input.defaultChecked
    }
  }

  if (response.json.didCreate) {
    // There's a new UserList to include in the menus now. Let's batch-update them all.
    await updateAllUserListMenus()
  } else if (menuContentRoot) {
    // Otherwise, only update our local menu.
    await updateContent(menuContentRoot)
  }

  fire(form, 'user-list-menu-form:success')
})

// Delete dialog

on('click', '.js-user-list-delete-confirmation-trigger', event => {
  const {currentTarget} = event
  const templateID = currentTarget.getAttribute('data-template-id')
  if (!templateID) return

  const template = document.getElementById(templateID)
  if (!template || !(template instanceof HTMLTemplateElement)) return

  const editDialog = currentTarget.closest<HTMLDetailsElement>('.js-edit-user-list-dialog')
  if (editDialog) {
    editDialog.open = false
  }
  const content = template.content.cloneNode(true)
  const labelledBy = template.getAttribute('data-labelledby')!

  dialog({content, labelledBy})
})

// Create dialog

on('click', '.js-user-lists-create-trigger', async function (event) {
  const {currentTarget} = event
  const template = document.querySelector<HTMLTemplateElement>('.js-user-list-create-dialog-template')
  const repositoryId = event.currentTarget.getAttribute('data-repository-id')
  const userListMenuRoot = currentTarget.closest<HTMLElement>('.js-user-list-menu-content-root')
  const filter = userListMenuRoot?.querySelector<HTMLInputElement>('.js-user-lists-menu-filter')
  const placeholderName = filter?.value.trim()

  if (!template || !(template instanceof HTMLTemplateElement) || !repositoryId) {
    // No template rendered on the page, or malformed button markup.
    // Disable the button as something marginally better than silently doing nothing.
    if (currentTarget instanceof HTMLButtonElement) {
      currentTarget.disabled = true
    }
    return
  }

  const label = template.getAttribute('data-label')!

  // Submit the form first if there are any dirty fields.
  if (userListMenuRoot && hasDirtyFields(userListMenuRoot)) {
    const userListMenuForm = userListMenuRoot.querySelector<HTMLFormElement>('.js-user-list-menu-form')
    if (userListMenuForm) await requestUserListMenuFormSubmit(userListMenuForm)
  }

  const content = new TemplateInstance(template, {repositoryId, placeholderName})
  const dialogElement = await dialog({content, label})

  dialogElement.addEventListener('user-list-form:success', async () => {
    // Update all currently loaded user list menu contents to include the created list.
    await updateAllUserListMenus()

    // Then, dismiss the dialog.
    const detailsElement = dialogElement.closest<HTMLDetailsElement>('details')
    if (detailsElement) detailsElement.open = false
  })
})
"üimport {hasDirtyFields} from '../has-interactions'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

// Add the 'data-warn-unsaved-changes' attribute to any form/container element
// and it will be monitored for changes. If the user attempts to
// navigate away from the page without first saving their changes, an alert
// will warn them.
observe('[data-warn-unsaved-changes]', {
  add(container) {
    container.addEventListener('input', prepareUnsavedChangesWarning)
    container.addEventListener('change', prepareUnsavedChangesWarning)
    container.addEventListener('submit', disableSaveChangesReminder)

    const dialog = container.closest('details-dialog')
    if (dialog) {
      dialog.closest<HTMLElement>('details')!.addEventListener('toggle', disableSaveChangesReminderOnClosedDialogs)
      dialog.addEventListener('details-dialog-close', promptOnDialogClosing)
    }
  },
  remove(container) {
    container.removeEventListener('input', prepareUnsavedChangesWarning)
    container.removeEventListener('change', prepareUnsavedChangesWarning)
    container.removeEventListener('submit', disableSaveChangesReminder)

    const dialog = container.closest('details-dialog')
    if (dialog) {
      dialog.closest<HTMLElement>('details')!.removeEventListener('toggle', disableSaveChangesReminderOnClosedDialogs)
      dialog.removeEventListener('details-dialog-close', promptOnDialogClosing)
      disableSaveChangesReminder()
    }
  }
})

function prepareUnsavedChangesWarning(event: Event) {
  const currentTarget = event.currentTarget as Element

  if (hasDirtyFields(currentTarget)) {
    enableSaveChangesReminder(currentTarget)
  } else {
    disableSaveChangesReminder()
  }
}

function enableSaveChangesReminder(container: Element) {
  // This message is ignored by most browsers.
  // eslint-disable-next-line i18n-text/no-en
  const message = container.getAttribute('data-warn-unsaved-changes') || 'Changes you made may not be saved.'

  window.onbeforeunload = function (event: BeforeUnloadEvent): string {
    event.returnValue = message
    return message
  }
}

function disableSaveChangesReminder() {
  window.onbeforeunload = null
}

function disableSaveChangesReminderOnClosedDialogs({currentTarget}: Event) {
  if (!(currentTarget as Element).hasAttribute('open')) {
    disableSaveChangesReminder()
  }
}

function promptOnDialogClosing(event: Event) {
  const dialog = event.currentTarget as Element
  const details = dialog.closest('details[open]')
  if (!details) {
    return
  }

  let confirmed = true
  const confirmationForms = dialog.querySelectorAll<HTMLFormElement>('form[data-warn-unsaved-changes]')
  for (const form of confirmationForms) {
    if (hasDirtyFields(form)) {
      const message = form.getAttribute('data-warn-unsaved-changes')!
      confirmed = confirm(message)
      break
    }
  }

  if (!confirmed) {
    event.preventDefault()
  }
}
"Ì// Perform CSS transition once
//
// Examples
//
//   .foo.will-transition-once {
//     transition: color ...;
//   }
//
//   .foo.is-successful {
//     background: green;
//   }
//

import {fromEvent} from '../subscription'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

observe('.will-transition-once', {
  constructor: HTMLElement,
  subscribe: el => fromEvent(el, 'transitionend', onTransitionEnd)
})

function onTransitionEnd(event: Event) {
  const target = event.target as Element
  target.classList.remove('will-transition-once')
}
"»import {fromEvent} from '../subscription'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

// Load issue/PR/discussion references to display the title for the tooltip from the server on hover.
// If hovercards are enabled for the referenced type on this part of the DOM,
// this behavior is bypassed in favor of the hovercard.
async function issueLabel(event: Event) {
  const currentTarget = event.currentTarget as HTMLElement
  const url = currentTarget.getAttribute('data-url')
  if (!url || isHovercardEnabled(currentTarget)) {
    return
  }

  const id = currentTarget.getAttribute('data-id') || ''
  const text = currentTarget.textContent
  const elements = document.querySelectorAll(`.js-issue-link[data-id='${id}']`)

  for (const el of elements) {
    el.removeAttribute('data-url')
  }

  try {
    const titleUrl = `${url}/title`
    const response = await fetch(titleUrl, {
      headers: {
        'X-Requested-With': 'XMLHttpRequest',
        Accept: 'application/json'
      }
    })
    if (!response.ok) {
      const responseError = new Error()
      const statusText = response.statusText ? ` ${response.statusText}` : ''
      responseError.message = `HTTP ${response.status}${statusText}`
      throw responseError
    }
    const data = await response.json()
    setLabel(elements, `${text}, ${data.title}`)
  } catch (error) {
    const status = (error.response != null ? error.response.status : undefined) || 500

    const message = (() => {
      switch (status) {
        case 404:
          return currentTarget.getAttribute('data-permission-text')
        default:
          return currentTarget.getAttribute('data-error-text')
      }
    })()

    setLabel(elements, message || '')
  }
}

function setLabel(elements: NodeList, text: string) {
  for (const el of elements) {
    if (!(el instanceof HTMLElement)) continue
    el.classList.add('tooltipped', 'tooltipped-ne')
    el.setAttribute('aria-label', text)
  }
}

function isHovercardEnabled(element: HTMLElement): boolean {
  const hovercardType = element.getAttribute('data-hovercard-type')
  switch (hovercardType) {
    case 'issue':
    case 'pull_request':
      return !!element.closest('[data-issue-and-pr-hovercards-enabled]')
    case 'discussion':
      return !!element.closest('[data-discussion-hovercards-enabled]')
    default:
      return false
  }
}

observe('.js-issue-link', {
  subscribe: el => fromEvent(el, 'mouseenter', issueLabel)
})
"¥// eslint-disable-next-line no-restricted-imports
import {fire, on} from 'delegated-events'
import {onFocus, onInput, onKey} from '../onfocus'
import {resetCharactersRemainingCounts, updateInputRemainingCharacters} from '../behaviors/characters-remaining'
import {RGB} from 'color-convert/conversions'
import {changeValue} from '../form'
import convert from 'color-convert'
import {debounce} from '@github/mini-throttle'
import {dialog} from '../details-dialog'
import {fetchSafeDocumentFragment} from '../fetch'
import {getUtf8StringLength} from '../text'
import {remoteForm} from '@github/remote-form'
import {toggleDetailsTarget} from '../behaviors/details'

function randomRGBColor(): RGB {
  return [
    Math.floor(Math.random() * (255 - 0) + 0),
    Math.floor(Math.random() * (255 - 0) + 0),
    Math.floor(Math.random() * (255 - 0) + 0)
  ]
}

// Given a button element and a hex color code, this will style the button and
// the octicon within it based on the given color.
function setColorSwatch(colorButton: HTMLButtonElement, rgb: RGB) {
  const hsl = convert.rgb.hsl(rgb)
  colorButton.style.setProperty('--label-r', rgb[0].toString())
  colorButton.style.setProperty('--label-g', rgb[1].toString())
  colorButton.style.setProperty('--label-b', rgb[2].toString())

  colorButton.style.setProperty('--label-h', hsl[0].toString())
  colorButton.style.setProperty('--label-s', hsl[1].toString())
  colorButton.style.setProperty('--label-l', hsl[2].toString())
}

// Fill the color input field in the 'new label' modal when a button is clicked.
// Sets the color of the button that acts as the preview of the chosen color.
function setInputColorFromButton(clickedButton: HTMLButtonElement, rgb: RGB) {
  // eslint-disable-next-line github/no-blur
  clickedButton.blur()

  const container = clickedButton.closest<HTMLElement>('form')!

  const colorInput = container.querySelector<HTMLInputElement>('.js-new-label-color-input')!
  changeValue(colorInput, `#${convert.rgb.hex(rgb)}`)

  const colorButton = container.querySelector<HTMLButtonElement>('.js-new-label-color')!
  setColorSwatch(colorButton, rgb)
}

function addErrorToField(errorEl: HTMLElement, errorMessage: string) {
  const container = errorEl.closest<HTMLElement>('.js-label-error-container')!
  container.classList.add('errored')
  errorEl.textContent = errorMessage
  errorEl.hidden = false
}

function removeErrorFromField(errorEl: HTMLElement) {
  const container = errorEl.closest<HTMLElement>('.js-label-error-container')!
  container.classList.remove('errored')
  errorEl.hidden = true
}

function showOrHideLabelError(errorSelector: string, form: HTMLFormElement, errorMessages?: string[] | null) {
  const errorEl = form.querySelector<HTMLElement>(errorSelector)
  if (!errorEl) {
    return
  }

  if (errorMessages) {
    addErrorToField(errorEl, errorMessages[0])
  } else {
    removeErrorFromField(errorEl)
  }
}

interface labelError {
  name?: string[]
  description?: string[]
  color?: string[]
}

function showLabelErrors(form: HTMLFormElement, json: labelError) {
  showOrHideLabelError('.js-label-name-error', form, json.name)
  showOrHideLabelError('.js-label-description-error', form, json.description)
  showOrHideLabelError('.js-label-color-error', form, json.color)
}

function hideLabelErrors(form: HTMLFormElement) {
  showOrHideLabelError('.js-label-name-error', form, null)
  showOrHideLabelError('.js-label-description-error', form, null)
  showOrHideLabelError('.js-label-color-error', form, null)
}

function labelPreviewUrl(
  baseUrl: string,
  name: string,
  color: string,
  description: string | null,
  labelID: string | null
): string {
  const url = new URL(`${baseUrl}${encodeURIComponent(name)}`, window.location.origin)
  const params = new URLSearchParams(url.search.slice(1))
  params.append('color', color)
  if (description) {
    params.append('description', description)
  }
  if (labelID) {
    params.append('id', labelID)
  }
  url.search = params.toString()
  return url.toString()
}

function labelDescriptionFrom(form: HTMLFormElement): string | null {
  let description = null
  const descriptionInput = form.querySelector('.js-new-label-description-input')
  if (descriptionInput instanceof HTMLInputElement && descriptionInput.value.trim().length > 0) {
    description = descriptionInput.value.trim()
  }
  return description
}

function labelColorFrom(form: HTMLFormElement): string {
  const colorInput = form.querySelector<HTMLInputElement>('.js-new-label-color-input')!
  if (colorInput.checkValidity()) {
    return colorInput.value.trim().replace(/^#/, '')
  }
  return 'ededed'
}

function labelNameFrom(form: HTMLFormElement, previewArea: HTMLElement): string {
  const nameInput = form.querySelector<HTMLInputElement>('.js-new-label-name-input')!
  let name = nameInput.value.trim()
  if (name.length < 1) {
    name = previewArea.getAttribute('data-default-name')!
  }
  return name
}

async function updateLabelPreview(startEl: HTMLElement) {
  const previewContainer = startEl.closest('.js-label-preview-container')
  if (!previewContainer) {
    return
  }

  const form = startEl.closest<HTMLFormElement>('.js-label-form')!
  const fullErrorMessageEl = form.querySelector<HTMLElement>('.js-new-label-error')
  const labelID = form.getAttribute('data-label-id')
  const previewArea = previewContainer.querySelector<HTMLElement>('.js-label-preview')!
  const name = labelNameFrom(form, previewArea)

  // Default case of "Label preview" is also counted as 'invalid' but we still want to update the preview.
  if (!form.checkValidity() && name !== 'Label preview') {
    return
  }

  const color = labelColorFrom(form)
  const description = labelDescriptionFrom(form)

  const urlTemplate = previewArea.getAttribute('data-url-template')!
  const url = labelPreviewUrl(urlTemplate, name, color, description, labelID)

  if (previewContainer.hasAttribute('data-last-preview-url')) {
    const lastPreviewUrl = previewContainer.getAttribute('data-last-preview-url')!
    if (url === lastPreviewUrl) {
      return
    }
  }

  let fragment
  try {
    fragment = await fetchSafeDocumentFragment(document, url)
  } catch (error) {
    const json = await error.response.json()
    showLabelErrors(form, json)

    if (fullErrorMessageEl) {
      fullErrorMessageEl.textContent = json.message
      fullErrorMessageEl.hidden = false
    }

    return
  }

  if (fullErrorMessageEl) {
    fullErrorMessageEl.textContent = ''
    fullErrorMessageEl.hidden = true
  }

  hideLabelErrors(form)

  previewArea.innerHTML = ''
  previewArea.appendChild(fragment)
  previewContainer.setAttribute('data-last-preview-url', url)
}

function onLabelFormInputChange(event: Event) {
  updateLabelPreview(event.target as HTMLInputElement)
}

function toggleBlankSlate(el: Element, show: boolean) {
  const detailsContainer = el.closest<HTMLElement>('.js-details-container')!
  detailsContainer.classList.toggle('is-empty', show)
}

function updateCount(delta: number) {
  const counter = document.querySelector<HTMLElement>('.js-labels-count')!
  const oldCount = Number(counter.textContent!)
  const newCount = oldCount + delta
  counter.textContent = newCount.toString()

  const label = document.querySelector<HTMLElement>('.js-labels-label')!
  label.textContent = label.getAttribute(newCount === 1 ? 'data-singular-string' : 'data-plural-string')
  return newCount
}

// Update the preview text of the new label based on what the user types in the
// label filter input.
onInput('.js-label-filter-field', function (event) {
  const filterInput = event.target as HTMLInputElement
  const container = filterInput.closest<HTMLElement>('details-menu')!
  const labelNameEl = container.querySelector('.js-new-label-name')
  if (!labelNameEl) {
    return
  }
  const labelName = filterInput.value.trim()
  labelNameEl.textContent = labelName
})

// As the user filters existing labels, make sure the 'Add new label' and 'Edit labels'
// links are visible as appropriate.
on('filterable:change', '.js-filterable-issue-labels', function (event) {
  const menu = event.currentTarget.closest<HTMLElement>('details-menu')!
  const addLabelButton = menu.querySelector<HTMLElement>('.js-add-label-button')
  if (!addLabelButton) return

  const filterInput = event.detail.inputField
  const newLabelName = filterInput.value.trim().toLowerCase()

  // TODO This could use namedItems.
  let matchingExistingLabel = false
  for (const input of menu.querySelectorAll('input[data-label-name]')) {
    const labelName = input.getAttribute('data-label-name') || ''
    if (labelName.toLowerCase() === newLabelName) {
      matchingExistingLabel = true
      break
    }
  }

  addLabelButton.hidden = newLabelName.length === 0 || matchingExistingLabel
})

// Show the color swatches when the user focuses the color input field.
onFocus('.js-new-label-color-input', function (input) {
  const container = input.closest<HTMLElement>('form')!
  const swatchesContainer = container.querySelector<HTMLElement>('.js-new-label-swatches')!
  swatchesContainer.hidden = false

  input.addEventListener(
    'blur',
    function () {
      swatchesContainer.hidden = true
    },
    {once: true}
  )
})

// Update the color swatch as the user types new hex color codes manually into
// the input.
onInput('.js-new-label-color-input', function (event) {
  const input = event.target as HTMLInputElement
  let color = input.value.trim()
  if (color.length < 1) {
    return
  }

  if (color.indexOf('#') !== 0) {
    color = `#${color}`
    input.value = color
  }

  if (input.checkValidity()) {
    input.classList.remove('color-fg-danger')
    const container = input.closest<HTMLElement>('form')!
    const colorButton = container.querySelector<HTMLButtonElement>('.js-new-label-color')!
    setColorSwatch(colorButton, convert.hex.rgb(color))
  } else {
    input.classList.add('color-fg-danger')
  }
})

// Disable save button as the user types if they enter an invalid hex color code.
onKey('keyup', '.js-new-label-color-input', function (event) {
  const input = event.target as HTMLInputElement
  let color = input.value.trim()

  if (color.indexOf('#') !== 0) {
    color = `#${color}`
    input.value = color
  }

  if (input.checkValidity()) {
    const container = input.closest<HTMLElement>('form')!
    const colorButton = container.querySelector<HTMLButtonElement>('.js-new-label-color')!
    setColorSwatch(colorButton, convert.hex.rgb(color))
  }
  fire(input, 'change', false)

  const form = input.closest<HTMLFormElement>('form')!
  hideLabelErrors(form)
})

onKey('keyup', '.js-new-label-description-input', function (event) {
  const input = event.target as HTMLInputElement
  const form = input.form!
  hideLabelErrors(form)
})

onKey('keyup', '.js-new-label-color-input', function (event) {
  const input = event.target as HTMLInputElement
  const form = input.form!
  hideLabelErrors(form)
})

// Get a random color for the new label when the user hits the button that acts as
// a preview of the selected color.
on('click', '.js-new-label-color', async function (event) {
  const colorButton = event.currentTarget as HTMLButtonElement
  const rgb = randomRGBColor()
  setInputColorFromButton(colorButton, rgb)
  updateLabelPreview(colorButton)
})

// Choose one of the predefined colors when it's clicked.
on('mousedown', '.js-new-label-color-swatch', function (event) {
  const swatchButton = event.currentTarget as HTMLButtonElement
  const color = swatchButton.getAttribute('data-color')!
  setInputColorFromButton(swatchButton, convert.hex.rgb(color))
  updateLabelPreview(swatchButton)

  const swatchesContainer = swatchButton.closest<HTMLElement>('.js-new-label-swatches')!
  swatchesContainer.hidden = true
})

on(
  'toggle',
  '.js-new-label-modal',
  function (event) {
    if ((event.target as Element).hasAttribute('open')) {
      initLabelModal(event.target as Element)
    }
  },
  {capture: true}
)

// When the new label form is displayed in the modal, set the label and its color
// in the form fields. Also update the color of the color swatch.
async function initLabelModal(modal: Element) {
  const labelNameInput = modal.querySelector<HTMLInputElement>('.js-new-label-name-input')
  if (!labelNameInput) return

  const colorInput = modal.querySelector<HTMLInputElement>('.js-new-label-color-input')!
  const rgb = randomRGBColor()
  const hex = `#${convert.rgb.hex(rgb)}`
  colorInput.value = hex
  const colorButton = modal.querySelector<HTMLButtonElement>('.js-new-label-color')!
  setColorSwatch(colorButton, rgb)

  const labelNameEl = document.querySelector<HTMLElement>('.js-new-label-name')!
  const labelName = labelNameEl.textContent!
  changeValue(labelNameInput, labelName)
  updateInputRemainingCharacters(labelNameInput)

  updateLabelPreview(colorButton)
}

// When the user creates a new label, close the modal containing the 'new label'
// form. Also update the list of available labels to choose from, so the user
// can immediately apply their new label.
remoteForm('.js-new-label-modal-form', async function (form, wants) {
  const errorEl = form.querySelector<HTMLElement>('.js-new-label-error')!

  let response
  try {
    response = await wants.html()
  } catch (error) {
    const json = error.response.json
    errorEl.textContent = json.message
    errorEl.hidden = false
  }

  if (!response) {
    return
  }

  errorEl.hidden = true // Hide error message for the form

  // close modal containing the label form
  document.querySelector<HTMLElement>('.js-new-label-modal')!.removeAttribute('open')

  const menuContent = document.querySelector<HTMLElement>('.js-issue-labels-menu-content')!
  const list = menuContent.querySelector<HTMLElement>('.js-filterable-issue-labels')!
  const input = response.html.querySelector('input')
  list.prepend(response.html)
  // A selected menu item is inserted programmatically so we need to trigger a
  // change event, which when trigger a details-menu-selected event.
  if (input) input.dispatchEvent(new Event('change', {bubbles: true}))

  const field = menuContent.querySelector<HTMLInputElement>('.js-label-filter-field')!
  field.value = field.defaultValue
  field.focus()
})

// New and Edit remote form
// Click "Cancel" leaves "edit mode"
on('click', '.js-edit-label-cancel', function (event) {
  const form = (event.target as Element).closest<HTMLFormElement>('form')!
  hideLabelErrors(form)
  form.reset()

  // Grab the color we just resetted to and set the background color of the
  // refresh button to that color since resetting the form doesn't do that for us
  const colorInput = form.querySelector<HTMLInputElement>('.js-new-label-color-input')!
  const color = colorInput.value
  const refreshButton = form.querySelector<HTMLButtonElement>('.js-new-label-color')!
  setColorSwatch(refreshButton, convert.hex.rgb(color))

  resetCharactersRemainingCounts(form)
  updateLabelPreview(colorInput)

  // If editing an existing label, hide the form on Cancel:
  const item = event.currentTarget.closest('.js-labels-list-item')
  if (item) {
    const editForm = item.querySelector<HTMLElement>('.js-update-label')!
    /* eslint-disable-next-line github/no-d-none */
    editForm.classList.add('d-none')

    const labelPreview = item.querySelector('.js-label-preview')
    if (labelPreview) {
      /* eslint-disable-next-line github/no-d-none */
      labelPreview.classList.add('d-none')

      const labelLink = item.querySelector<HTMLElement>('.js-label-link')!
      /* eslint-disable-next-line github/no-d-none */
      labelLink.classList.remove('d-none')
    }

    const elementsToShow = item.querySelectorAll<HTMLElement>('.js-hide-on-label-edit')
    for (const el of elementsToShow) {
      el.hidden = !el.hidden
    }
  }
})

// Replace item row with contents from server on Edit
remoteForm('.js-update-label', async function (form, wants) {
  let response

  try {
    response = await wants.html()
  } catch (error) {
    const json = error.response.json
    showLabelErrors(form, json)
    return
  }

  hideLabelErrors(form)

  const item = form.closest<HTMLElement>('.js-labels-list-item')!
  item.replaceWith(response.html)
})

// Add new label to list and clear out the form
remoteForm('.js-create-label', async function (form, wants) {
  let response

  try {
    response = await wants.html()
  } catch (error) {
    const json = error.response.json
    showLabelErrors(form, json)
    return
  }

  form.reset()
  hideLabelErrors(form)

  document.querySelector<HTMLElement>('.js-label-list')!.prepend(response.html)

  updateCount(+1)

  toggleBlankSlate(form, false)

  const colorButton = form.querySelector<HTMLButtonElement>('.js-new-label-color')!
  const rgb = randomRGBColor()
  setInputColorFromButton(colorButton, rgb)
  updateLabelPreview(form.querySelector<HTMLInputElement>('.js-new-label-name-input')!)

  resetCharactersRemainingCounts(form)

  const detailsContainer = form.closest('.js-details-container')
  if (detailsContainer instanceof HTMLElement) {
    toggleDetailsTarget(detailsContainer)
  }
})

// Click 'New label' button
on('click', '.js-details-target-new-label', function () {
  const createForm = document.querySelector<HTMLElement>('.js-create-label')!
  const nameInput = createForm.querySelector<HTMLInputElement>('.js-new-label-name-input')!
  nameInput.focus()
})

// Click "Edit" enters "edit mode"
on('click', '.js-edit-label', function (event) {
  const item = event.currentTarget.closest<HTMLElement>('.js-labels-list-item')!
  const editForm = item.querySelector<HTMLElement>('.js-update-label')!
  /* eslint-disable-next-line github/no-d-none */
  editForm.classList.remove('d-none')
  const nameInput = editForm.querySelector<HTMLInputElement>('.js-new-label-name-input')!
  nameInput.focus()

  const labelPreview = item.querySelector('.js-label-preview')
  if (labelPreview) {
    /* eslint-disable-next-line github/no-d-none */
    labelPreview.classList.remove('d-none')

    const labelLink = item.querySelector<HTMLElement>('.js-label-link')!
    /* eslint-disable-next-line github/no-d-none */
    labelLink.classList.add('d-none')
  }

  const elementsToHide = item.querySelectorAll<HTMLElement>('.js-hide-on-label-edit')
  for (const el of elementsToHide) {
    el.hidden = !el.hidden
  }
})

// Delete remote form
remoteForm('.js-delete-label', async function (form, wants) {
  const row = form.closest<HTMLElement>('.js-labels-list-item')!
  row.querySelector<HTMLElement>('.js-label-delete-spinner')!.hidden = false
  await wants.text()
  const newCount = updateCount(-1)
  toggleBlankSlate(form, newCount === 0)
  row.remove()
})

const delayedOnLabelFormInputChange = debounce(onLabelFormInputChange, 500)

// Handle the user typing in label fields:
on('suggester:complete', '.js-new-label-name-input', delayedOnLabelFormInputChange)
onInput('.js-new-label-name-input', delayedOnLabelFormInputChange)
onInput('.js-new-label-description-input', delayedOnLabelFormInputChange)
onInput('.js-new-label-color-input', delayedOnLabelFormInputChange)

// Limit length of label names in the way Rails does with model validations; allows emoji:
onKey('keypress', '.js-new-label-name-input', function (event) {
  const input = event.target as HTMLInputElement
  const limit = parseInt(input.getAttribute('data-maxlength')!)

  if (getUtf8StringLength(input.value) >= limit) {
    event.preventDefault()
  }
})

// Exclude labels on the issues page label filter
on('click', '.js-issues-label-select-menu-item', function (event) {
  /* eslint eslint-comments/no-use: off */
  /* eslint-disable no-restricted-syntax */
  if (!event.altKey && !event.shiftKey) return

  event.preventDefault()
  event.stopPropagation()

  if (event.altKey) {
    window.location.href = event.currentTarget.getAttribute('data-excluded-url')!
  }

  // Users can shift click to add more labels to a group
  if (event.shiftKey) {
    window.location.href = event.currentTarget.getAttribute('data-included-url')!
  }
  /* eslint-enable no-restricted-syntax */
})

onKey('keydown', '.js-issues-label-select-menu-item', function (event: KeyboardEvent) {
  // TODO: Refactor to use data-hotkey
  /* eslint eslint-comments/no-use: off */
  /* eslint-disable no-restricted-syntax */
  if (event.key !== 'Enter') return
  if (!event.altKey && !event.shiftKey) return

  const anchor = event.currentTarget
  event.preventDefault()
  event.stopPropagation()
  if (anchor instanceof HTMLAnchorElement) {
    if (event.altKey) {
      window.location.href = anchor.getAttribute('data-excluded-url')!
    }

    if (event.shiftKey) {
      window.location.href = anchor.getAttribute('data-included-url')!
    }
  }
  /* eslint-enable no-restricted-syntax */
})

on(
  'click',
  '.js-open-label-creation-modal',
  async function (event) {
    // Prevent menu from closing
    event.stopImmediatePropagation()
    const modal = await dialog({
      content: document.querySelector<HTMLTemplateElement>('.js-label-creation-template')!.content.cloneNode(true),
      detailsClass: 'js-new-label-modal'
    })
    initLabelModal(modal)
  },
  {capture: true}
)
"«	// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

// Show/hide event settings when the user's overall thread subscription option changes.
on('change', '.js-thread-notification-setting', toggleEventSettings)

// Validate event settings when the user's event selection changes.
on('change', '.js-custom-thread-notification-option', toggleEventSettings)

// Show/hide event settings when the user dismisses the form.
on('reset', '.js-custom-thread-settings-form', toggleEventSettings)

function toggleEventSettings() {
  const eventSettingsVisible = document.querySelector<HTMLInputElement>('.js-reveal-custom-thread-settings')!.checked
  const noEventSelected = !document.querySelector('.js-custom-thread-notification-option:checked')

  const eventSettingsContainer = document.querySelector<HTMLElement>('.js-custom-thread-settings')!
  const checkbox = document.querySelector<HTMLInputElement>('[data-custom-option-required-text]')!
  const message =
    eventSettingsVisible && noEventSelected ? checkbox.getAttribute('data-custom-option-required-text')! : ''

  checkbox.setCustomValidity(message)
  eventSettingsContainer.hidden = !eventSettingsVisible
}
"$import {controller, target} from '@github/catalyst'

/**
 * CollapsibleSidebarWidget creates a widget in the sidebar of which
 * content is collapsible and is loaded upon opening.
 *
 * Four classes must be set, they are scoped to the HTML element <collapsible-sidebar-widget>
 *  - .collapsible-sidebar-widget-button (the button toggling open/close state)
 *  - .collapsible-sidebar-widget-content (the inner HTML to load)
 *  - .collapsible-sidebar-widget-loader (the element that is shown while loading)
 *  - .collapsible-sidebar-widget-indicator (the element that indicates open/close)
 *
 * One class is optional
 * - .collapsible-sidebar-widget-active-hidden (hides an element when the content is open)
 *
 * Notice: This is not done in pure CSS, because we need to guard
 * the loading of the content.
 *
 * @example
 * ```html
 * <collapsible-sidebar-widget url="/your/url">
 *  <div>
 *   <button type="button" class="collapsible-sidebar-widget-button" data-action="mousedown:collapsible-sidebar-widget#onMouseDown keydown:collapsible-sidebar-widget#onKeyDown">Open</button>
 *    <svg xmlns="http://www.w3.org/2000/svg" class="collapsible-sidebar-widget-indicator" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M12.78 6.22a.75.75 0 010 1.06l-4.25 4.25a.75.75 0 01-1.06 0L3.22 7.28a.75.75 0 011.06-1.06L8 9.94l3.72-3.72a.75.75 0 011.06 0z"></path></svg>
 *    <svg class="collapsible-sidebar-widget-loader anim-rotate" viewBox="0 0 16 16" fill="none" width="16" height="16" ><circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke"></circle><path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke"></path></svg>
 *    <div class="collapsible-sidebar-widget-active-hidden">Hidden content when active</div>
 *   </button>
 *   <div class="collapsible-sidebar-widget-content" data-target="collapsible-sidebar-widget.collapsible">Lorem Ipsum</div>
 *  </div>
 * </collapsible-sidebar-widget>
 * ```
 */
@controller
class CollapsibleSidebarWidgetElement extends HTMLElement {
  @target collapsible: HTMLElement

  pendingRequest: AbortController | null

  get activeClass(): string {
    return this.getAttribute('active-class') || 'collapsible-sidebar-widget-active'
  }

  get loadingClass(): string {
    return this.getAttribute('loading-class') || 'collapsible-sidebar-widget-loading'
  }

  get url(): string {
    return this.getAttribute('url') || ''
  }

  get isOpen(): boolean {
    return this.hasAttribute('open')
  }

  set isOpen(open: boolean) {
    open ? this.setAttribute('open', '') : this.removeAttribute('open')
  }

  /* eslint-disable-next-line custom-elements/no-method-prefixed-with-on */
  onKeyDown(e: KeyboardEvent) {
    if (e.code === 'Enter' || e.code === 'Space') {
      e.preventDefault()

      return this.load()
    }
  }

  /* eslint-disable-next-line custom-elements/no-method-prefixed-with-on */
  onMouseDown(e: MouseEvent) {
    e.preventDefault()

    return this.load()
  }

  load() {
    if (this.pendingRequest) {
      return this.pendingRequest.abort()
    }

    if (!this.collapsible.hasAttribute('loaded')) {
      this.setLoading()

      return this.updateCollapsible()
    }

    if (!this.isOpen) {
      return this.setOpen()
    }

    return this.setClose()
  }

  setLoading() {
    this.classList.add(this.loadingClass)
    this.classList.remove(this.activeClass)
  }

  setOpen() {
    this.classList.add(this.activeClass)
    this.classList.remove(this.loadingClass)
    this.isOpen = true
  }

  setClose() {
    this.classList.remove(this.activeClass)
    this.classList.remove(this.loadingClass)
    this.isOpen = false
  }

  handleAbort() {
    this.pendingRequest = null
    this.setClose()
  }

  async updateCollapsible() {
    try {
      this.pendingRequest = new AbortController()
      this.pendingRequest.signal.addEventListener('abort', () => this.handleAbort())

      const response = await fetch(this.url, {
        signal: this.pendingRequest?.signal,
        headers: {
          Accept: 'text/html',
          'X-Requested-With': 'XMLHttpRequest'
        }
      })
      this.pendingRequest = null

      if (!response.ok) {
        return this.setClose()
      }

      const content = await response.text()
      this.collapsible.innerHTML = content
      this.collapsible.setAttribute('loaded', '')

      this.setOpen()
    } catch {
      // The errors are not yet surfaced.
      this.pendingRequest = null
      return this.setClose()
    }
  }
}
".import {attr, controller, target, targets} from '@github/catalyst'

/**
 * A web component that allows inline editing of <input> fields.
 * The fields work without an outer <form>.
 *
 * @type HTMLElement
 * @example
 * ```html
 * <sidebar-memex-input data-url="http://localhost" data-csrf="1234567890" data-column="1">
 *  <input type="date name="memexProjectColumnValues[][value]" value="" data-target="sidebar-memex-input.read" data-action=" blur:sidebar-memex-input#onBlur keydown:sidebar-memex-input#onKeyDown disabled />
 * </sidebar-memex-input>
 * ```
 */
@controller
class SidebarMemexInputElement extends HTMLElement {
  @attr url = ''
  @attr csrf = ''
  @attr instrument = ''
  @attr column = 1

  @targets inputs: NodeListOf<HTMLInputElement>
  @target read: HTMLInputElement
  @target write: HTMLElement
  @targets parameters: NodeListOf<HTMLInputElement>

  get isDisabled(): boolean {
    return this.read?.hasAttribute('disabled')
  }

  set hasErrored(value: boolean) {
    value ? this.setAttribute('errored', '') : this.removeAttribute('errored')
  }

  set disabled(value: boolean) {
    value ? this.setAttribute('disabled', '') : this.removeAttribute('disabled')
  }

  get hasExpanded(): boolean {
    return this.read.getAttribute('aria-expanded') === 'true'
  }

  connectedCallback() {
    this.disabled = this.read?.disabled ?? true

    // this is a hack, until the dropdown has been refactored
    /* eslint-disable-next-line custom-elements/no-dom-traversal-in-connectedcallback */
    if (this.querySelector('details') !== null) {
      this.classList.toggle('no-pointer')
    }
  }

  handleDetailsSelect(e: Event) {
    const custom = e as CustomEvent
    const details = e.target as HTMLElement
    const el = custom.detail?.relatedTarget as HTMLElement
    const opened = details.closest('details')
    const button = opened?.querySelector('[data-menu-button]')

    if (el.getAttribute('aria-checked') === 'true') {
      el.setAttribute('aria-checked', 'false')
      e.preventDefault()

      for (const input of this.inputs) {
        if (el.contains(input)) {
          this.updateCell(input.name, '')

          if (button?.innerHTML) {
            button.innerHTML = input.placeholder
          }

          break
        }
      }

      opened?.removeAttribute('open')
    }
  }

  handleDetailsSelected(e: Event) {
    const custom = e as CustomEvent
    const el = custom.detail?.relatedTarget as HTMLElement
    for (const input of this.inputs) {
      if (el.contains(input)) {
        this.updateCell(input.name, input.value)
        break
      }
    }
  }

  mouseDownFocus(e: Event) {
    if (!this.isDisabled) {
      return
    }

    this.onFocus(e)
  }

  keyDownFocus(e: KeyboardEvent) {
    if (e.code === 'Enter' || e.code === 'Space') {
      if (this.read !== document.activeElement) {
        this.onFocus(e)
      }
    }
  }

  /* eslint-disable-next-line custom-elements/no-method-prefixed-with-on */
  onChange(e: Event) {
    const el = e.target as HTMLElement
    if (el.getAttribute('type') === 'date') {
      return
    }

    this.updateCell(this.read?.name, this.read?.value)
  }

  /* eslint-disable-next-line custom-elements/no-method-prefixed-with-on */
  onFocus(e: KeyboardEvent | Event) {
    e.preventDefault()

    this.disabled = false
    this.read.disabled = false
    this.read.focus()
  }

  /* eslint-disable-next-line custom-elements/no-method-prefixed-with-on */
  onBlur(e: Event) {
    if (this.hasExpanded) {
      e.preventDefault()
      return
    }

    const el = e.target as HTMLElement
    if (el.getAttribute('type') === 'date') {
      this.updateCell(this.read?.name, this.read?.value)
    }

    this.read.disabled = true
    this.disabled = true
  }

  /* eslint-disable-next-line custom-elements/no-method-prefixed-with-on */
  onKeyDown(e: KeyboardEvent) {
    if (e.code === 'Enter' || e.code === 'Tab') {
      e.preventDefault()
      e.stopPropagation()

      if (this.hasExpanded) {
        return
      }

      // eslint-disable-next-line github/no-blur
      this.read.blur()
    }
  }

  async updateCell(name = '', value = '') {
    const data = new FormData()
    data.set(name, value)
    data.set('ui', this.instrument)

    for (const input of this.parameters) {
      data.set(input.name, input.value)
    }

    const format = Intl.DateTimeFormat('en-US', {
      month: 'short',
      day: 'numeric',
      year: 'numeric',
      timeZone: 'UTC'
    })

    try {
      // this is an opportunistic update
      if (this.write) {
        const update = this.read.value
        const formatted = this.read.type === 'date' && update ? format.format(Date.parse(update)) : update
        this.write.textContent = update ? formatted : this.read.placeholder
      }

      const response = await fetch(this.url, {
        method: 'PUT',
        body: data,
        headers: {
          Accept: 'application/json',
          'X-Requested-With': 'XMLHttpRequest',
          'Scoped-CSRF-Token': `${this.csrf}`
        }
      })

      if (!response.ok) {
        throw new Error('connection error')
      }

      // if there is no target to update,
      // break here and leave the opportunistic update of the field
      if (!this.write) {
        return
      }

      // this is the reconciliation
      const content = await response.json()
      const column = content['memexProjectItem']['memexProjectColumnValues'].find(
        (e: Record<string, unknown>) => e['memexProjectColumnId'] === Number(this.column)
      )

      const commit = column['value']
      const update = this.read.type === 'date' ? Date.parse(commit['value']) : commit['html']
      const formatted = this.read.type === 'date' && update ? format.format(update) : update
      this.write.innerHTML = value ? formatted : this.read.placeholder
    } catch (e) {
      this.hasErrored = true
    }
  }
}
"»yimport '../notifications/configure-thread-subscription-dialog'
import './sidebar-widget'
import './sidebar-memex-input'

import {getPageID} from '../session-resume-helpers'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'
import {parseHTML} from '../parse-html'
import {remoteForm} from '@github/remote-form'
import {requestSubmit} from '../form'

function submitForm(form: Element, skipTeamsCheck = false) {
  if (skipTeamsCheck || !reviewerTeamsCheckRequired(form)) {
    if (form instanceof HTMLFormElement) {
      requestSubmit(form)
    } else {
      previewSubmit(form)
    }
  }
}

function submitOnMenuClose(event: Event) {
  const currentTarget = event.currentTarget as Element
  const form = currentTarget.closest('.js-issue-sidebar-form') || currentTarget.querySelector('.js-issue-sidebar-form')
  submitForm(form!)
}

// On item selection, submit the form
on(
  'details-menu-selected',
  '.js-discussion-sidebar-menu',
  function (event) {
    const item = event.detail.relatedTarget
    const menu = event.currentTarget
    const form = item.closest('.js-issue-sidebar-form')
    const multiple = menu.hasAttribute('data-multiple')

    if (item.hasAttribute('data-clear-assignees')) {
      const selectedInputs = menu.querySelectorAll<HTMLInputElement>('input[name="issue[user_assignee_ids][]"]:checked')
      for (const el of selectedInputs) {
        el.disabled = false
        el.checked = false
      }

      submitForm(form)
    } else if (multiple) {
      menu.closest<HTMLElement>('details')!.addEventListener('toggle', submitOnMenuClose, {once: true})
    } else {
      submitForm(form)
    }
  },
  {capture: true}
)

function updateSidebar(container: Element, html: string) {
  container.replaceWith(parseHTML(document, html))
}

function returnFocusToTrigger(menuTriggerId: string) {
  const currentSidebarTriggerEl = document.querySelector<HTMLElement>(`[data-menu-trigger="${menuTriggerId}"]`)

  // Returns focus to triggering element after HTML is replaced
  currentSidebarTriggerEl?.focus()
}

// TODO Replace with data-replace-remote-form behavior.
remoteForm('.js-issue-sidebar-form', async function (form, wants) {
  const response = await wants.html()
  // Gets the specific sidebar element (i.e. assignees, labels) before the HTML is replaced inside
  const currentSidebarItemEl = form.closest<HTMLElement>('.js-discussion-sidebar-item')
  // Gets the unique ID of the current sidebar element to use to reference the trigger
  const currentSidebarDetailsId = currentSidebarItemEl?.querySelector<HTMLElement>('.select-menu')?.getAttribute('id')

  currentSidebarItemEl!.replaceWith(response.html)

  if (currentSidebarDetailsId) returnFocusToTrigger(currentSidebarDetailsId)
})

// Prevent suggested reviewer button on new pull request form from submitting the main form.
on('click', 'div.js-issue-sidebar-form .js-suggested-reviewer', function (event) {
  const button = event.currentTarget as HTMLButtonElement

  const form = button.closest<HTMLElement>('.js-issue-sidebar-form')!
  previewSubmit(form, 'post', {name: button.name, value: button.value})
  event.preventDefault()
})

// Prevent "assign yourself" button on the issue#new form from submitting the main form.
on('click', 'div.js-issue-sidebar-form .js-issue-assign-self', function (event) {
  const button = event.currentTarget as HTMLButtonElement

  const form = button.closest<HTMLElement>('.js-issue-sidebar-form')!
  previewSubmit(form, 'post', {name: button.name, value: button.value})
  button.remove()
  // do not persist in the UI
  document.querySelector('form#new_issue .is-submit-button-value')?.remove()
  event.preventDefault()
})

// Allow "unassign me" to submit form with method DELETE
on('click', '.js-issue-unassign-self', function (event) {
  const form = event.currentTarget.closest<HTMLElement>('.js-issue-sidebar-form')!
  previewSubmit(form, 'delete')
  event.preventDefault()
})

remoteForm('.js-pages-preview-toggle-form', async function (form, wants) {
  const response = await wants.json()
  form.querySelector<HTMLElement>('button.btn')!.textContent = response.json.new_button_value
})

function getCacheKey(el: Element, pageId: string) {
  const formName = el.getAttribute('data-cache-name')
  return `${pageId}:sidebar:${formName}`
}

function cacheValues(form: Element, formData: FormData, cacheKey: string) {
  const formName = form.getAttribute('data-cache-name')
  if (!formName) return

  const data: Array<[string, FormDataEntryValue]> = []
  for (const [key, value] of formData.entries()) {
    if (key.indexOf(formName) === -1) continue
    data.push([key, value])
  }

  const updated = data.filter(datum => datum[1] !== '')
  if (updated.length > 0) {
    sessionStorage.setItem(cacheKey, JSON.stringify(updated))
  } else {
    sessionStorage.removeItem(cacheKey)
  }
}

const hasFired = new Set<string>()
function clearHasFired() {
  hasFired.clear()
}

async function restoreCachedValues(el: Element, cacheKey: string) {
  const formName = el.getAttribute('data-cache-name')
  const cache = sessionStorage.getItem(cacheKey)
  if (!formName || !cache || hasFired.has(formName)) return
  hasFired.add(formName)
  const formData: Array<[string, FormDataEntryValue]> = JSON.parse(cache)
  const inputs: HTMLInputElement[] = []
  for (const [key, value] of formData) {
    // Only cache string values
    if (Object.prototype.toString.call(value) !== '[object String]') continue

    const newInput = document.createElement('input')
    newInput.type = 'hidden'
    // The guard clause above ensures that this is a string, but the TS complier doesn't know that.
    newInput.value = value as string
    newInput.name = key
    el.appendChild(newInput)
    inputs.push(newInput)
  }
  try {
    await requestPreview(el)
    for (const input of inputs) {
      input.remove()
    }
  } catch (error) {
    hasFired.delete(formName)
  }
}

let isSubmitting = false
function cacheValuesOnHide(form: Element, cacheKey: string) {
  if (isSubmitting) return

  const body = scopedFormData(form)
  cacheValues(form, body, cacheKey)
  clearHasFired()
}

observe('[data-cacher]', {
  add(el) {
    const cacheKey = getCacheKey(el, getPageID())
    restoreCachedValues(el, cacheKey)
    window.addEventListener('pagehide', () => cacheValuesOnHide(el, cacheKey))
    window.addEventListener('pjax:beforeReplace', () => cacheValuesOnHide(el, cacheKey))
    window.addEventListener('turbo:before-visit', () => cacheValuesOnHide(el, cacheKey))
    window.addEventListener(
      'submit',
      event => {
        if (!event.defaultPrevented) {
          isSubmitting = true
          // Defer the write operation to the next tick
          setTimeout(() => {
            for (const key of Object.keys(sessionStorage)) {
              if (key.indexOf(cacheKey) === -1) continue
              sessionStorage.removeItem(key)
              clearHasFired()
            }
          }, 0)
        }
      },
      {capture: true}
    )
  }
})

// Submit dummy sidebar preview "form".
//
// form - DIV element tagged with .js-issue-sidebar-form
// extra - Array of extra form data to pass along
async function previewSubmit(form: Element, method = 'post', extra?: {name: string; value: string}) {
  await requestPreview(form, method, extra)
  // Gets the specific sidebar element (i.e. assignees, labels) before the HTML is replaced inside
  const currentSidebarItemEl = form.closest<HTMLElement>('.js-discussion-sidebar-item')
  // Gets the unique ID of the current sidebar element to use to reference the trigger
  const currentSidebarDetailsId = currentSidebarItemEl?.querySelector<HTMLElement>('.select-menu')?.getAttribute('id')

  if (currentSidebarDetailsId) returnFocusToTrigger(currentSidebarDetailsId)
}

async function requestPreview(form: Element, method = 'post', extra?: {name: string; value: string}) {
  const body = scopedFormData(form)
  if (extra) {
    body.append(extra.name, extra.value)
  }

  const url = form.getAttribute('data-url')!
  if (!url) return

  const token = form.querySelector<HTMLInputElement>('.js-data-url-csrf')!

  const response = await fetch(url, {
    method,
    body: method === 'delete' ? '' : body,
    mode: 'same-origin',
    headers: {
      'Scoped-CSRF-Token': token.value,
      'X-Requested-With': 'XMLHttpRequest'
    }
  })
  if (!response.ok) {
    return
  }
  const html = await response.text()
  updateSidebar(form.closest<HTMLElement>('.js-discussion-sidebar-item')!, html)
}

// Returns true (and triggers a reviewer check for "notification spam") if the
// form (or div, in new PRs) contains at least one new review request for a team
function reviewerTeamsCheckRequired(form: Element) {
  // We only care about reviewers...
  const url = form.getAttribute('data-reviewers-team-size-check-url')
  if (!url) return false

  // ...and whether there is at least one newly-selected team
  const previouslyRequestedTeams = [...document.querySelectorAll<HTMLElement>('.js-reviewer-team')].map(elem =>
    elem.getAttribute('data-id')
  )
  const formData = form instanceof HTMLFormElement ? new FormData(form) : scopedFormData(form)
  const allSelectedTeams = new URLSearchParams(formData as FormData & Record<string, string>).getAll(
    'reviewer_team_ids[]'
  )
  const newlySelectedTeams = allSelectedTeams.filter(team => !previouslyRequestedTeams.includes(team))
  if (newlySelectedTeams.length === 0) return false

  const params = new URLSearchParams(newlySelectedTeams.map(s => ['reviewer_team_ids[]', s]))
  triggerTeamReviewerCheck(form, `${url}?${params}`)
  return true
}

// Asks the server if any of the newly-selected teams is too large;
// show the dialog if so, move on and request reviews otherwise.
async function triggerTeamReviewerCheck(form: Element, reviewerCheckUrl: string) {
  const response = await fetch(reviewerCheckUrl)
  if (!response.ok) {
    return
  }

  const dialogHtml = await response.text()
  if (dialogHtml.match(/[^\w-]js-large-team[^\w-]/)) {
    showTeamReviewerConfirmationDialog(form, dialogHtml)
  } else {
    submitForm(form, true)
    return
  }
}

// Shows dialog that requests confirmation for review requests to large teams
function showTeamReviewerConfirmationDialog(form: Element, dialogHtml: string) {
  // Add dialog to DOM
  const container = form.querySelector<HTMLElement>('.js-large-teams-check-warning-container')!
  while (container.firstChild) {
    container.removeChild(container.firstChild)
  }
  container.appendChild(parseHTML(document, dialogHtml))

  // Wire dialog actions and open it
  const dialog = container.querySelector<HTMLDetailsElement>('details')!
  function dialogAction(event: Event) {
    if (!(event.target instanceof Element)) return
    dialog.open = false
    // Unless the user explicitly confirms, un-select the large teams before submitting
    if (!event.target.classList.contains('js-large-teams-confirm-button')) {
      const reviewerInputs = form.querySelectorAll<HTMLInputElement>("input[name='reviewer_team_ids[]']")
      for (const reviewerInput of reviewerInputs) {
        if (container.querySelector(`.js-large-team[data-id='${reviewerInput.value}']`)) {
          reviewerInput.checked = false
        }
      }
    }
    submitForm(form, true)
    event.preventDefault()
  }
  container
    .querySelector<HTMLElement>('.js-large-teams-confirm-button')!
    .addEventListener('click', dialogAction, {once: true})
  container
    .querySelector<HTMLElement>('.js-large-teams-cancel-button')!
    .addEventListener('click', dialogAction, {once: true})
  dialog.addEventListener('details-dialog-close', dialogAction, {once: true})
  dialog.open = true
}

on('click', 'div.js-project-column-menu-container .js-project-column-menu-item button', async function (event) {
  const currentTarget = event.currentTarget
  updateProjectColumnMenuSummary(currentTarget)
  const moveUrl = currentTarget.getAttribute('data-url')!
  const token = currentTarget.parentElement!.querySelector<HTMLInputElement>('.js-data-url-csrf')!
  const cardId = currentTarget.getAttribute('data-card-id')!
  const form = new FormData()

  form.append('card_id', cardId)
  form.append('use_automation_prioritization', 'true')

  event.preventDefault()
  const response = await fetch(moveUrl, {
    method: 'PUT',
    mode: 'same-origin',
    body: form,
    headers: {
      'Scoped-CSRF-Token': token.value,
      'X-Requested-With': 'XMLHttpRequest'
    }
  })
  if (!response.ok) {
    return
  }
  // blur any active elements if they are contained within the detail
  // to allow update-content to reload the dropdown
  const activeElement = document.activeElement as HTMLElement
  const container = currentTarget.closest<HTMLElement>('.js-project-column-menu-dropdown')!
  if (activeElement && container.contains(activeElement)) {
    try {
      // eslint-disable-next-line github/no-blur
      activeElement.blur()
    } catch (e) {
      // ignore
    }
  }
})

function updateProjectColumnMenuSummary(element: Element) {
  const dropdown = element.closest<HTMLElement>('.js-project-column-menu-dropdown')!
  const summary = dropdown.querySelector<HTMLElement>('.js-project-column-menu-summary')!
  const columnName = element.getAttribute('data-column-name')!

  summary.textContent = columnName
}

on('click', '.js-prompt-dismiss', function (event) {
  event.currentTarget.closest<HTMLElement>('.js-prompt')!.remove()
})

// Similar to serializeArray, but maybe scoped to a non-form.
//
// container - Element contained by a form to serialize the child fields for
function scopedFormData(container: Element): FormData {
  const form = container.closest<HTMLFormElement>('form')!
  if (!form) return new FormData()
  const formData = new FormData(form)
  const params = formData.entries()
  const results = new FormData()
  for (const [name, value] of params) {
    if (form.contains(findParam(form, name, value.toString()))) {
      results.append(name, value)
    }
  }
  return results
}

function findParam(form: HTMLFormElement, name: string, value: string): Element | null {
  for (const el of form.elements) {
    if (el instanceof HTMLInputElement || el instanceof HTMLTextAreaElement || el instanceof HTMLButtonElement) {
      if (el.name === name && el.value === value) {
        return el
      }
    }
  }
  return null
}

on('click', '.js-convert-to-draft', function (event) {
  const convertToDraftUrl = event.currentTarget.getAttribute('data-url')!
  const token = event.currentTarget.parentElement!.querySelector<HTMLInputElement>('.js-data-url-csrf')!

  fetch(convertToDraftUrl, {
    method: 'POST',
    mode: 'same-origin',
    headers: {
      'Scoped-CSRF-Token': token.value,
      'X-Requested-With': 'XMLHttpRequest'
    }
  })
})

on('click', 'div.js-restore-item', async function (event) {
  const unarchiveItemUrl = event.currentTarget.getAttribute('data-url')!
  const projectItemID = event.currentTarget.getAttribute('data-column')!
  const token = event.currentTarget.querySelector<HTMLInputElement>('.js-data-url-csrf')!
  const form = new FormData()

  form.set('memexProjectItemIds[]', projectItemID)

  const result = await fetch(unarchiveItemUrl, {
    method: 'PUT',
    mode: 'same-origin',
    body: form,
    headers: {
      'Scoped-CSRF-Token': token.value,
      'X-Requested-With': 'XMLHttpRequest'
    }
  })

  if (!result.ok) {
    throw new Error('connection error')
  }

  submitOnMenuClose(event)
})
"®import {ready} from './document-ready'

let container: HTMLElement | null = null

;(async function () {
  await ready
  createNoticeContainer()
})()

// Announce an element's text to the screen reader.
export function announceFromElement(el: HTMLElement) {
  announce(getTextContent(el))
}

// Announce message update to screen reader.
export function announce(message: string) {
  if (!container) return
  // Clear content first in case the new notice content is the same as the last
  container.textContent = ''
  container.textContent = message
}

// Get the global screen reader notice container.
function createNoticeContainer() {
  container = document.createElement('div')
  container.setAttribute('aria-live', 'polite')
  container.classList.add('sr-only')
  document.body.append(container)
}

// Gets the trimmed text content of an element.
function getTextContent(el: HTMLElement): string {
  // innerText does not contain hidden text
  /* eslint-disable-next-line github/no-innerText */
  return (el.getAttribute('aria-label') || el.innerText || '').trim()
}
"¢type AutoFlushingQueueEntry<ElementType> = [ElementType, string]
class AutoFlushingQueue<ElementType = HTMLElement> {
  timeout: number
  limit: number
  elements: Array<AutoFlushingQueueEntry<ElementType>> = []
  timer: number | null = null
  callbacks: Array<(elementsToFlush: Array<AutoFlushingQueueEntry<ElementType>>) => Promise<void>> = []
  index: number

  constructor(timeout = 50, limit = 30) {
    this.timeout = timeout // flush timeout in milliseconds
    this.limit = limit // max number of elements before autoflushing
    this.index = 0
  }

  push(element: ElementType): string {
    const key = `item-${this.index++}`

    if (this.timer) {
      window.clearTimeout(this.timer)
      this.timer = null
    }
    if (this.elements.length >= this.limit) {
      this.flush()
    }

    this.timer = window.setTimeout(() => {
      this.timer = null
      this.flush()
    }, this.timeout)

    this.elements.push([element, key])
    return key
  }

  onFlush(callback: (elementsToFlush: Array<AutoFlushingQueueEntry<ElementType>>) => Promise<void>): void {
    this.callbacks.push(callback)
  }

  private async flush(): Promise<void> {
    const elementsToFlush = this.elements.splice(0, this.limit)
    if (elementsToFlush.length === 0) return

    await Promise.all(this.callbacks.map(callback => callback(elementsToFlush)))
  }
}

interface HTMLElementWithInputs extends HTMLElement {
  inputs: HTMLInputElement[]
}

export class BatchLoader<ResponseType> {
  autoFlushingQueue: AutoFlushingQueue<HTMLElementWithInputs>
  url: string
  callbacks: Map<string, (value: ResponseType) => void>
  validate: (value: unknown) => asserts value is ResponseType

  constructor(url: string, validator: (value: unknown) => asserts value is ResponseType) {
    this.url = url
    this.callbacks = new Map()
    this.autoFlushingQueue = new AutoFlushingQueue()
    this.autoFlushingQueue.onFlush(async elements => {
      this.load(elements)
    })
    this.validate = validator
  }

  loadInBatch(element: HTMLElementWithInputs): Promise<ResponseType> {
    const key = this.autoFlushingQueue.push(element)
    return new Promise(resolve => this.callbacks.set(key, resolve))
  }

  async load(elements: Array<AutoFlushingQueueEntry<HTMLElementWithInputs>>) {
    const elementsByKey = new Map<string, HTMLElementWithInputs>()

    for (const [batchElement, key] of elements) {
      elementsByKey.set(key, batchElement)
    }

    const consolidatedData = new FormData()
    consolidatedData.set('_method', 'GET')

    for (const [key, batchElement] of elementsByKey.entries()) {
      for (const input of batchElement.inputs) {
        consolidatedData.append(`items[${key}][${input.name}]`, input.value)
      }
    }

    const response = await fetch(this.url, {
      method: 'POST',
      body: consolidatedData,
      headers: {
        Accept: 'application/json',
        'X-Requested-With': 'XMLHttpRequest'
      }
    })

    if (response.ok) {
      const json = await response.json()

      if (!json || typeof json !== 'object' || Array.isArray(json)) {
        throw new Error('Malformed batch response')
      }

      for (const key in json) {
        const callback = this.callbacks.get(key)
        if (callback) {
          const value = json[key]
          this.validate(value)
          callback(value)
        }
      }
    }
  }
}
 c2/ /   B a t c h   D e f e r r e d   C o n t e n t   B e h a v i o r 
 / / 
 / /   A u t o m a t i c a l l y   f e t c h e s   c o n t e n t   f o r   m u l t i p l e   p l a c e h o l d e r s   w i t h   a   s i n g l e   r e q u e s t . 
 / /   P l a c e h o l d e r s   a r e   r e p r e s e n t e d   a s   < b a t c h - d e f e r r e d - c o n t e n t > ' s   s o   t h a t   p e r - p l a c e h o l d e r   a r g u m e n t s   c a n   b e 
 / /   p a s s e d   a l o n g   t o   t h e   b a c k e n d   f o r   r e n d e r i n g .   O n c e   t h e   r e s p o n s e   i s   r e c e i v e d ,   e a c h   p l a c e h o l d e r 
 / /   w i l l   b e   r e p l a c e d   w i t h   i t ' s   r e l e v a n t   c o n t e n t . 
 / / 
 / /   B a t c h i n g   i s   h a n d l e d   b y   a n   a u t o f l u s h i n g   q u e u e .   O n c e   a n   u p p e r   l i m i t   ( d e f a u l t   3 0 )   o f   p l a c e h o l d e r s 
 / /   a r e   f o u n d ,   o r   n e w   p l a c e h o l d e r s   s t o p   b e i n g   a d d e d   t o   t h e   q u e u e ,   a f t e r   a   t i m e o u t   ( d e f a u l t   5 0 m s ) , 
 / /   a   s i n g l e   r e q u e s t   w i l l   b e   m a d e   t o   f e t c h   t h e   c o n t e n t   f o r   t h o s e   i t e m s . 
 / / 
 / /   E x a m p l e   M a r k u p 
 / / 
 / /       < b a t c h - d e f e r r e d - c o n t e n t   d a t a - u r l = " / m y / b a t c h e d / c o n t e n t / e n d p o i n t " > 
 / /           < i n p u t   d a t a - t a r g e t s = " b a t c h - d e f e r r e d - c o n t e n t . i n p u t s "   t y p e = " h i d d e n "   n a m e = " r e p o _ i d "   v a l u e = " 4 2 " > 
 / /           < i n p u t   d a t a - t a r g e t s = " b a t c h - d e f e r r e d - c o n t e n t . i n p u t s "   t y p e = " h i d d e n "   n a m e = " c o m m i t _ o i d "   v a l u e = " a b c d e f 0 " > 
 / /       < / b a t c h - d e f e r r e d - c o n t e n t > 
 / /       & 
 / /       < b a t c h - d e f e r r e d - c o n t e n t   d a t a - u r l = " / m y / b a t c h e d / c o n t e n t / e n d p o i n t " > 
 / /           < i n p u t   d a t a - t a r g e t s = " b a t c h - d e f e r r e d - c o n t e n t . i n p u t s "   t y p e = " h i d d e n "   n a m e = " r e p o _ i d "   v a l u e = " 8 8 " > 
 / /           < i n p u t   d a t a - t a r g e t s = " b a t c h - d e f e r r e d - c o n t e n t . i n p u t s "   t y p e = " h i d d e n "   n a m e = " c o m m i t _ o i d "   v a l u e = " f 0 0 0 0 0 1 " > 
 / /       < / b a t c h - d e f e r r e d - c o n t e n t > 
 / / 
 / /   E x a m p l e   R e q u e s t 
 / / 
 / /       P O S T   / m y / b a t c h e d / c o n t e n t / e n d p o i n t 
 / /       B O D Y   { 
 / /           i t e m s :   { 
 / /               i t e m - 0 :   { r e p o _ i d :   4 2 ,   c o m m i t _ o i d :   " a b c d e f 0 " } , 
 / /               i t e m - 1 :   { r e p o _ i d :   8 8 ,   c o m m i t _ o i d :   " f 0 0 0 0 0 1 " } , 
 / /           } 
 / /       } 
 / / 
 / /   E x a m p l e   R e s p o n s e 
 / / 
 / /       C o n t e n t - T y p e :   a p p l i c a t i o n / j s o n 
 / /       B O D Y   { 
 / /           i t e m - 0 :   " < d i v > S o m e   m a r k u p < / d i v > " , 
 / /           i t e m - 1 :   " < d i v > M o r e   m a r k u p < / d i v > " , 
 / /       } 
 
 i m p o r t   { c o n t r o l l e r ,   t a r g e t s }   f r o m   ' @ g i t h u b / c a t a l y s t ' 
 i m p o r t   { p a r s e H T M L }   f r o m   ' . . / p a r s e - h t m l ' 
 i m p o r t   { B a t c h L o a d e r }   f r o m   ' . / b a t c h - d e f e r r e d - c o n t e n t / b a t c h - l o a d e r ' 
 
 e x p o r t   a b s t r a c t   c l a s s   B a s e B a t c h D e f e r r e d C o n t e n t E l e m e n t < R e s p o n s e T y p e >   e x t e n d s   H T M L E l e m e n t   { 
     i n p u t s :   H T M L I n p u t E l e m e n t [ ] 
     b a t c h L o a d e r s :   M a p < s t r i n g ,   B a t c h L o a d e r < R e s p o n s e T y p e > > 
 
     a b s t r a c t   u p d a t e ( c o n t e n t :   R e s p o n s e T y p e ) :   v o i d 
     a b s t r a c t   v a l i d a t e ( v a l u e :   u n k n o w n ) :   a s s e r t s   v a l u e   i s   R e s p o n s e T y p e 
 
     a s y n c   c o n n e c t e d C a l l b a c k ( )   { 
         c o n s t   c o n t e n t   =   a w a i t   t h i s . b a t c h L o a d e r . l o a d I n B a t c h ( t h i s ) 
         t h i s . u p d a t e ( c o n t e n t ) 
     } 
 
     g e t   b a t c h L o a d e r ( ) :   B a t c h L o a d e r < R e s p o n s e T y p e >   { 
         c o n s t   u r l   =   t h i s . g e t A t t r i b u t e ( ' d a t a - u r l ' ) 
 
         i f   ( ! u r l )   { 
             t h r o w   n e w   E r r o r ( ` $ { t h i s . t a g N a m e }   e l e m e n t   r e q u i r e s   a   d a t a - u r l   a t t r i b u t e ` ) 
         } 
 
         l e t   l o a d e r   =   t h i s . b a t c h L o a d e r s . g e t ( u r l ) 
         i f   ( ! l o a d e r )   { 
             l o a d e r   =   n e w   B a t c h L o a d e r ( u r l ,   ( v a l u e :   u n k n o w n )   = >   t h i s . v a l i d a t e ( v a l u e ) ) 
             t h i s . b a t c h L o a d e r s . s e t ( u r l ,   l o a d e r ) 
         } 
         r e t u r n   l o a d e r 
     } 
 } 
 
 c o n s t   b a t c h D e f e r r e d C o n t e n t L o a d e r s :   M a p < s t r i n g ,   B a t c h L o a d e r < s t r i n g > >   =   n e w   M a p ( ) 
 
 @ c o n t r o l l e r 
 c l a s s   B a t c h D e f e r r e d C o n t e n t E l e m e n t   e x t e n d s   B a s e B a t c h D e f e r r e d C o n t e n t E l e m e n t < s t r i n g >   { 
     @ t a r g e t s   i n p u t s :   H T M L I n p u t E l e m e n t [ ] 
 
     b a t c h L o a d e r s   =   b a t c h D e f e r r e d C o n t e n t L o a d e r s 
 
     v a l i d a t e ( v a l u e :   u n k n o w n ) :   a s s e r t s   v a l u e   i s   s t r i n g   { 
         i f   ( t y p e o f   v a l u e   ! = =   ' s t r i n g ' )   { 
             t h r o w   n e w   E r r o r ( ' B a t c h   d e f e r r e d   c o n t e n t   w a s   n o t   a   s t r i n g ' ) 
         } 
     } 
 
     u p d a t e ( c o n t e n t :   s t r i n g ) :   v o i d   { 
         c o n s t   d o c F r a g m e n t   =   p a r s e H T M L ( d o c u m e n t ,   c o n t e n t ) 
         t h i s . r e p l a c e W i t h ( d o c F r a g m e n t ) 
     } 
 } 
 "¥let lastActiveElement: Element | null
let currentInputIsMouse = false

function setClass() {
  lastActiveElement = document.activeElement
  if (document.body) {
    document.body.classList.toggle('intent-mouse', currentInputIsMouse)
  }
}

// Use mousedown event to make sure outline is remove for holding and dragging
document.addEventListener(
  'mousedown',
  function () {
    currentInputIsMouse = true
    if (lastActiveElement === document.activeElement) setClass()
  },
  {capture: true}
)

document.addEventListener(
  'keydown',
  function () {
    currentInputIsMouse = false
  },
  {capture: true}
)

document.addEventListener('focusin', setClass, {capture: true})
"Åimport {getUtf8StringLength} from '../text'
import {onFocus} from '../onfocus'

function showRemainingCharacterCount(value: string, limit: number, field: HTMLTextAreaElement | HTMLInputElement) {
  const container = field.closest('.js-characters-remaining-container')
  if (!container) {
    return
  }

  const remainingEl = container.querySelector<HTMLElement>('.js-characters-remaining')!
  const suffix = String(remainingEl.getAttribute('data-suffix'))
  const valueLength = getUtf8StringLength(value)
  const remainingCount = limit - valueLength

  if (remainingCount <= 20) {
    remainingEl.textContent = `${remainingCount} ${suffix}`
    remainingEl.classList.toggle('color-fg-danger', remainingCount <= 5)
    remainingEl.hidden = false
  } else {
    remainingEl.hidden = true
  }
}

function getFieldLimit(input: HTMLTextAreaElement | HTMLInputElement): number {
  if (input.hasAttribute('data-maxlength')) {
    return parseInt(input.getAttribute('data-maxlength') || '')
  }

  return input.maxLength
}

export function hasExceededCharacterLimit(input: HTMLTextAreaElement | HTMLInputElement): boolean {
  const limit = getFieldLimit(input)
  const valueLength = getUtf8StringLength(input.value)
  const remainingCount = limit - valueLength

  return remainingCount < 0
}

export function updateInputRemainingCharacters(input: HTMLTextAreaElement | HTMLInputElement) {
  const limit = getFieldLimit(input)
  showRemainingCharacterCount(input.value, limit, input)
}

export function resetCharactersRemainingCounts(container: Element) {
  const charContainers = container.querySelectorAll('.js-characters-remaining-container')

  for (const charContainer of charContainers) {
    const input = charContainer.querySelector<HTMLInputElement>('.js-characters-remaining-field')!
    updateInputRemainingCharacters(input)
  }
}

onFocus('.js-characters-remaining-field', function (input) {
  function onInput() {
    if (input instanceof HTMLInputElement || input instanceof HTMLTextAreaElement) {
      updateInputRemainingCharacters(input)
    }
  }
  onInput()

  input.addEventListener('input', onInput)
  input.addEventListener(
    'blur',
    () => {
      input.removeEventListener('input', onInput)
    },
    {once: true}
  )
})
"Ç// Commenting: Edit and delete buttons

// eslint-disable-next-line no-restricted-imports
import {fire, on} from 'delegated-events'
import IncludeFragmentElement from '@github/include-fragment-element'

import {dialog} from '../../details-dialog'
import {fetchSafeDocumentFragment} from '../../fetch'
import {fromEvent} from '../../subscription'
import {hasDirtyFields} from '../../has-interactions'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
import {remoteForm} from '@github/remote-form'
import {updateContent} from '../../updatable-content'

let bodyErrors: string[] = []

// Preload the edit form fragment when the dropdown menu is loaded
observe('.js-comment-header-actions-deferred-include-fragment', {
  subscribe: el =>
    fromEvent(
      el,
      'loadstart',
      () => {
        const container = el.closest<HTMLElement>('.js-comment')!
        loadEditFormDeferredIncludeFragment(container)
      },
      {capture: false, once: true}
    )
})

// If the comment contains a task list we need to immediately load the edit form
// because it's used to decide if the user can edit tasks in the list or not
observe('.js-comment .contains-task-list', {
  add: el => {
    const container = el.closest<HTMLElement>('.js-comment')!
    loadEditFormDeferredIncludeFragment(container)
  }
})

// Edit button
on('click', '.js-comment-edit-button', function (event) {
  const container = event.currentTarget.closest<HTMLElement>('.js-comment')!
  container.classList.add('is-comment-editing')

  // Focus on the edit form when it is loaded
  const editFormIncludeFragment = findEditFormDeferredIncludeFragment(container)
  if (!editFormIncludeFragment) {
    // Edit form is already loaded into the DOM so just focus on it
    focusEditForm(container)
  } else {
    // If an <include-fragment> exists, wait till it's loaded before focusing
    editFormIncludeFragment.addEventListener('include-fragment-replaced', () => focusEditForm(container), {once: true})
  }

  const dropdown = event.currentTarget.closest('.js-dropdown-details')
  if (dropdown) {
    dropdown.removeAttribute('open')
  }
})

function focusEditForm(container: HTMLElement) {
  container.querySelector<HTMLElement>('.js-write-tab')!.click()
  const field = container.querySelector<HTMLElement>('.js-comment-field')!
  ;(field as HTMLTextAreaElement).focus()
  // Trigger size-to-fit (see #15696)
  fire(field, 'change')
}

function findEditFormDeferredIncludeFragment(container: HTMLElement) {
  return container.querySelector<IncludeFragmentElement>('.js-comment-edit-form-deferred-include-fragment')
}

// By default the edit form include fragment is set to `loading=lazy` to avoid triggering
// loading on pageload, however sometimes we want to pre-emptively load it
function loadEditFormDeferredIncludeFragment(container: HTMLElement) {
  findEditFormDeferredIncludeFragment(container)?.setAttribute('loading', 'eager')
}

// Show minimize form button
on('click', '.js-comment-hide-button', function (event) {
  const comment = event.currentTarget.closest<HTMLElement>('.js-comment')!
  toggleMinimizeError(comment, false)
  const minimizeForm = comment.querySelector('.js-minimize-comment')
  /* eslint-disable-next-line github/no-d-none */
  if (minimizeForm) minimizeForm.classList.remove('d-none')

  const dropdown = event.currentTarget.closest('.js-dropdown-details')
  if (dropdown) {
    dropdown.removeAttribute('open')
  }
})

// Hide minimize form button
on('click', '.js-comment-hide-minimize-form', function (event) {
  const minimizeForm = event.currentTarget.closest<HTMLElement>('.js-minimize-comment')!
  /* eslint-disable-next-line github/no-d-none */
  minimizeForm.classList.add('d-none')
})

// Comment Cancel button
export function handleCommentCancelButtonClick(event: Event & {currentTarget: Element}) {
  const form = event.currentTarget.closest<HTMLFormElement>('form')!
  const confirmText = event.currentTarget.getAttribute('data-confirm-text')!
  if (hasDirtyFields(form) && !confirm(confirmText)) {
    return false
  }

  for (const field of form.querySelectorAll('input, textarea')) {
    const fieldEl = field as HTMLInputElement | HTMLTextAreaElement
    fieldEl.value = fieldEl.defaultValue

    if (fieldEl.classList.contains('session-resumable-canceled')) {
      fieldEl.classList.add('js-session-resumable')
      fieldEl.classList.remove('session-resumable-canceled')
    }
  }

  const comment = event.currentTarget.closest('.js-comment')
  if (comment) {
    comment.classList.remove('is-comment-editing')
  }

  return true
}
on('click', '.js-comment-cancel-button', handleCommentCancelButtonClick)

// Issue edit cancel
on('click', '.js-cancel-issue-edit', function (event) {
  const container = event.currentTarget.closest<HTMLElement>('.js-details-container')!
  container.querySelector<HTMLElement>('.js-comment-form-error')!.hidden = true
})

// Show loading state for updating, deleting, minimizing, and unminimizing
// Add version so server can decide if we're working with fresh data
remoteForm(
  '.js-comment-delete, .js-comment .js-comment-update, .js-issue-update, .js-comment-minimize, .js-comment-unminimize',
  function (form, wants, request) {
    const comment = form.closest<HTMLElement>('.js-comment')!
    comment.classList.add('is-comment-loading')
    const bodyVersion = comment.getAttribute('data-body-version')
    if (bodyVersion) {
      request.headers.set('X-Body-Version', bodyVersion)
    }
  }
)

// Rejected updates that are stale freezes the form and shows an error.
// See AbstractRepositoryController#render_stale_error for stale error response.
remoteForm('.js-comment .js-comment-update', async function (form, wants) {
  let response
  const comment = form.closest<HTMLElement>('.js-comment')!
  const updateError = comment.querySelector('.js-comment-update-error')
  const bodyError = comment.querySelector('.js-comment-body-error')
  if (updateError instanceof HTMLElement) {
    updateError.hidden = true
  }
  if (bodyError instanceof HTMLElement) {
    bodyError.hidden = true
  }
  bodyErrors = []

  try {
    response = await wants.json()
  } catch (error) {
    if (error.response.status === 422) {
      const data = JSON.parse(error.response.text)

      if (data.errors) {
        if (updateError instanceof HTMLElement) {
          // eslint-disable-next-line i18n-text/no-en
          updateError.textContent = `There was an error posting your comment: ${data.errors.join(', ')}`
          updateError.hidden = false
        }
        return
      }
    } else {
      throw error
    }
  }

  if (!response) return
  const data = response.json

  if (data.errors && data.errors.length > 0) {
    bodyErrors = data.errors
    showBodyErrors(bodyError as HTMLElement)
  }

  const commentBody = comment.querySelector('.js-comment-body')
  if (commentBody && data.body) {
    commentBody.innerHTML = data.body
  }

  comment.setAttribute('data-body-version', data.newBodyVersion)
  const bodyVersionInput = comment.querySelector('.js-body-version')
  if (bodyVersionInput instanceof HTMLInputElement) {
    bodyVersionInput.value = data.newBodyVersion
  }

  const discussionPoll = comment.querySelector('.js-discussion-poll')
  if (discussionPoll && data.poll) {
    discussionPoll.innerHTML = data.poll
  }

  for (const field of comment.querySelectorAll('input, textarea')) {
    const fieldEl = field as HTMLInputElement | HTMLTextAreaElement
    fieldEl.defaultValue = fieldEl.value
  }

  // If the comment was previously stale, remove the warning as it is now fresh
  comment.classList.remove('is-comment-stale', 'is-comment-editing')

  const edits = comment.querySelector('.js-comment-edit-history')
  if (edits) {
    const html = await fetchSafeDocumentFragment(document, data.editUrl)
    edits.innerHTML = ''
    edits.append(html)
  }
})

// this block will show the error block if there were errors on body modification
observe('.js-comment-body-error', {
  add: el => {
    if (bodyErrors && bodyErrors.length > 0) {
      showBodyErrors(el as HTMLElement)
    }
  }
})

function showBodyErrors(el: HTMLElement) {
  const ol = el.querySelector('ol')
  if (ol) {
    ol.innerHTML = ''
    const items = bodyErrors.map(e => {
      const li = document.createElement('li')
      li.textContent = e
      return li
    })
    for (const li of items) {
      ol.appendChild(li)
    }
  }
  el.hidden = false
}

// Hide loading state for updating, deleting, minimizing, and unminimizing
remoteForm(
  '.js-comment .js-comment-delete, .js-comment .js-comment-update, .js-comment-minimize, .js-comment-unminimize',
  async function (form, wants) {
    const comment = form.closest<HTMLElement>('.js-comment')!
    try {
      await wants.text()
    } catch (error) {
      if (error.response.status === 422) {
        let data
        try {
          data = JSON.parse(error.response.text)
        } catch (e) {
          // Do nothing
        }

        if (data && data.stale) comment.classList.add('is-comment-stale')
      } else {
        throw error
      }
    }

    comment.classList.remove('is-comment-loading')
  }
)

function toggleMinimizeError(comment: HTMLElement, errored: boolean) {
  const minimizeError = comment.querySelector<HTMLElement>('.js-comment-show-on-error')
  if (minimizeError) {
    minimizeError.hidden = !errored
  }
  const minimizeForm = comment.querySelector<HTMLElement>('.js-comment-hide-on-error')
  if (minimizeForm) {
    minimizeForm.hidden = errored
  }
}

remoteForm('.js-timeline-comment-unminimize, .js-timeline-comment-minimize', async function (form, wants) {
  const comment = form.closest<HTMLElement>('.js-minimize-container')!
  try {
    const response = await wants.html()
    comment.replaceWith(response.html)
  } catch (error) {
    toggleMinimizeError(comment, true)
  }
})

remoteForm('.js-discussion-comment-unminimize, .js-discussion-comment-minimize', async function (form, wants) {
  const comment = form.closest<HTMLElement>('.js-discussion-comment')!
  const minimizeError = comment.querySelector<HTMLElement>('.js-discussion-comment-error')
  if (minimizeError) {
    minimizeError.hidden = true
  }

  try {
    const response = await wants.html()
    comment.replaceWith(response.html)
  } catch (error) {
    if (error.response.status >= 400 && error.response.status < 500) {
      if (error.response.html) {
        const errorMessage = error.response.html.querySelector('.js-discussion-comment')!.getAttribute('data-error')!
        if (minimizeError instanceof HTMLElement) {
          minimizeError.textContent = errorMessage
          minimizeError.hidden = false
        }
      }
    } else {
      throw error
    }
  }
})

// Remove comment if deleted successfully
remoteForm('.js-comment-delete', async function (form, wants) {
  await wants.json()
  let container = form.closest('.js-comment-delete-container')

  if (!container) {
    container = form.closest('.js-comment-container') || form.closest('.js-line-comments')

    if (container && container.querySelectorAll('.js-comment').length !== 1) {
      container = form.closest<HTMLElement>('.js-comment')!
    }
  }

  const thread = container?.closest('.js-comment-container') || container?.closest('.js-line-comments')

  container?.remove()

  if (thread && thread.querySelectorAll('.js-comment').length === 1) {
    for (const x of thread.querySelectorAll('.js-delete-on-last-reply-deleted')) {
      x.remove()
    }
  }
})

// Update issue/PR/discussion title if successful
remoteForm('.js-issue-update', async function (form, wants) {
  const container = form.closest<HTMLElement>('.js-details-container')!
  const errorDisplay = container.querySelector<HTMLElement>('.js-comment-form-error')!

  let response
  try {
    response = await wants.json()
  } catch (error) {
    // eslint-disable-next-line i18n-text/no-en
    errorDisplay.textContent = error.response?.json?.errors?.[0] || 'Something went wrong. Please try again.'
    errorDisplay.hidden = false
  }

  if (!response) return

  container.classList.remove('open')
  errorDisplay.hidden = true
  const data = response.json
  if (data.issue_title != null) {
    container.querySelector<HTMLElement>('.js-issue-title')!.textContent = data.issue_title
    const issuesContainer = container.closest('.js-issues-results')
    if (issuesContainer) {
      if (issuesContainer.querySelector('.js-merge-pr.is-merging')) {
        const mergeField = issuesContainer.querySelector('.js-merge-pull-request textarea')
        if (mergeField instanceof HTMLTextAreaElement && mergeField.value === mergeField.defaultValue) {
          mergeField.value = mergeField.defaultValue = data.issue_title
        }
      } else if (issuesContainer.querySelector('.js-merge-pr.is-squashing')) {
        const mergeField = issuesContainer.querySelector('.js-merge-pull-request .js-merge-title')
        if (mergeField instanceof HTMLInputElement && mergeField.value === mergeField.defaultValue) {
          mergeField.value = mergeField.defaultValue = data.default_squash_commit_title
        }
      }

      const mergeButton = issuesContainer.querySelector('button[value=merge]')
      if (mergeButton) {
        mergeButton.setAttribute('data-input-message-value', data.issue_title)
      }

      const squashInput = issuesContainer.querySelector('button[value=squash]')
      if (squashInput) {
        squashInput.setAttribute('data-input-title-value', data.default_squash_commit_title)
      }
    }
  }
  document.title = data.page_title
  for (const field of form.elements) {
    if (field instanceof HTMLInputElement || field instanceof HTMLTextAreaElement) {
      field.defaultValue = field.value
    }
  }
})

// Hide comment if minimized successfully
remoteForm('.js-comment-minimize', async function (form, wants) {
  await wants.json()
  const comment = form.closest<HTMLElement>('.js-comment')!

  const minimizeForm = comment.querySelector('.js-minimize-comment')

  if (minimizeForm && minimizeForm.classList.contains('js-update-minimized-content')) {
    const submitButton = form.querySelector<HTMLInputElement | HTMLButtonElement>(
      'input[type=submit], button[type=submit]'
    )

    if (submitButton) {
      submitButton.classList.add('disabled')
    }
    const updatableCommentContainer = comment.closest<HTMLElement>('.js-comment-container')
    if (updatableCommentContainer) {
      await updateContent(updatableCommentContainer)
    }
  } else {
    /* eslint-disable-next-line github/no-d-none */
    if (minimizeForm) minimizeForm.classList.add('d-none')
    const unminimizedComment = form.closest<HTMLElement>('.unminimized-comment')!
    /* eslint-disable-next-line github/no-d-none */
    unminimizedComment.classList.add('d-none')
    unminimizedComment.classList.remove('js-comment')

    const commentGroup = form.closest<HTMLElement>('.js-minimizable-comment-group')!
    const minimizedComment = commentGroup.querySelector('.minimized-comment')
    /* eslint-disable-next-line github/no-d-none */
    if (minimizedComment) minimizedComment.classList.remove('d-none')
    if (minimizedComment) minimizedComment.classList.add('js-comment')
  }
})

// Show comment if unminimized successfully
remoteForm('.js-comment-unminimize', async function (form, wants) {
  await wants.json()
  const commentGroup = form.closest<HTMLElement>('.js-minimizable-comment-group')!
  const unminimizedComment = commentGroup.querySelector('.unminimized-comment')
  const minimizedComment = commentGroup.querySelector('.minimized-comment')

  if (unminimizedComment) {
    /* eslint-disable-next-line github/no-d-none */
    unminimizedComment.classList.remove('d-none')
    unminimizedComment.classList.add('js-comment')

    /* eslint-disable-next-line github/no-d-none */
    if (minimizedComment) minimizedComment.classList.add('d-none')
    if (minimizedComment) minimizedComment.classList.remove('js-comment')
  } else {
    // if the unminimizedComment is not present at this point,
    // try to fetch it from the server
    if (minimizedComment) {
      const actionForm = minimizedComment.querySelector('.timeline-comment-actions')
      // hide form while waiting for updated content
      /* eslint-disable-next-line github/no-d-none */
      if (actionForm) actionForm.classList.add('d-none')
      minimizedComment.classList.remove('js-comment')
    }

    const updatableCommentContainer = commentGroup.closest<HTMLElement>('.js-comment-container')!
    await updateContent(updatableCommentContainer)
  }
})

on(
  'details-menu-select',
  '.js-comment-edit-history-menu',
  event => {
    const url = (event as CustomEvent).detail.relatedTarget.getAttribute('data-edit-history-url')
    if (!url) return
    // Prevent menu from closing
    event.preventDefault()
    const content = fetchSafeDocumentFragment(document, url)
    dialog({content, dialogClass: 'Box-overlay--wide'})
  },
  {capture: true}
)
"// Confirm
//
// Prompts native confirm dialog before activating link.
//
// data-confirm - Message to pass to confirm().
//
//   <button type="submit" data-confirm="Are you sure?">Delete</a>

document.addEventListener(
  'click',
  function (event) {
    if (!(event.target instanceof Element)) return

    const selector =
      'a[data-confirm], input[type=submit][data-confirm], input[type=checkbox][data-confirm], button[data-confirm]'

    const currentTarget = event.target.closest(selector)
    if (!currentTarget) return

    const message = currentTarget.getAttribute('data-confirm')
    if (!message) return

    if (
      currentTarget instanceof HTMLInputElement &&
      currentTarget.hasAttribute('data-confirm-checked') &&
      !currentTarget.checked
    ) {
      return
    }

    if (!confirm(message)) {
      event.stopImmediatePropagation()
      event.preventDefault()
    }
  },
  true
)
"// Variant on the native `hashchange` event with extra features:
//
// * Guarantees that handlers run on DOMContentLoaded, or immediately if page has
//   already loaded;
// * If the anchor references an element by id, the `data.target` property of the
//   argument passed to handlers will be a reference to that DOM element.
//
// Each handler will be invoked with a `data` object containing properties:
//
// * `oldURL` - String URL prior to the hash change, or `null` on initial page load;
// * `newURL` - String URL after hash change, or current page URL;
// * `target` - DOM element whose id matches the anchor value, or `null`.
//
// Examples
//
// ```js
// // Redirect old anchor issue urls
// hashChange((data) => {
//   const m = data.newURL.match(/\/issues#issue\/(\d+)$/)
//   if (m) window.location = data.newURL.replace(/\/?#issue\/.+/, "/#{m[1]}")
// })
//
// // Ensure that the referenced comment's parent container is visible
// hashChange((data) => {
//   const container = data.target && data.target.closest('.js-comments-container')
//   if (container) container.classList.remove('d-none')
// })
// ```

import {ready} from '../document-ready'

const handlers: HashChangeListener[] = []
let ran = 0

type HashChangeListener = (opts: {oldURL: string | null; newURL: string; target?: Element | null}) => unknown

export default function hashChange(handler: HashChangeListener) {
  ;(async function () {
    handlers.push(handler)
    await ready
    runRemainingHandlers()
  })()
}

hashChange.clear = () => {
  handlers.length = ran = 0
}

function runRemainingHandlers() {
  const index = ran
  ran = handlers.length
  runHandlers(handlers.slice(index), null, window.location.href)
}

function runHandlers(handlersToRun: HashChangeListener[], oldURL: string | null, newURL: string) {
  const id = window.location.hash.slice(1)
  const target = id ? document.getElementById(id) : null
  const data = {oldURL, newURL, target}

  for (const fn of handlersToRun) {
    fn.call(null, data)
  }
}

// Track ieOldURL manually to work around an open IE bug where the hashchange
// event does not have oldURL or newURL attributes. See
// https://connect.microsoft.com/IE/feedback/details/828283/implement-hashchangeevent-oldurl-and-newurl
let ieOldURL = window.location.href
window.addEventListener('popstate', function () {
  ieOldURL = window.location.href
})

window.addEventListener('hashchange', function (event) {
  const newURL = window.location.href
  try {
    runHandlers(handlers, event.oldURL || ieOldURL, newURL)
  } finally {
    ieOldURL = newURL
  }
})

let pjaxOldURL: string | null = null
document.addEventListener('pjax:start', function () {
  pjaxOldURL = window.location.href
})

document.addEventListener('pjax:end', function () {
  runHandlers(handlers, pjaxOldURL, window.location.href)
})
"µ%import {onFocus, onInput} from '../onfocus'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

const supportedFields = [
  'input[pattern]',
  'input[required]',
  'textarea[required]',
  'input[data-required-change]',
  'textarea[data-required-change]',
  'input[data-required-value]',
  'textarea[data-required-value]'
].join(',')

type Field = HTMLInputElement | HTMLTextAreaElement

function checkValidityForRequiredValueField(field: Field) {
  const requiredValue = field.getAttribute('data-required-value')!
  const prefix = field.getAttribute('data-required-value-prefix')

  if (field.value === requiredValue) {
    field.setCustomValidity('')
  } else {
    let message = requiredValue
    if (prefix) {
      message = prefix + message
    }
    field.setCustomValidity(message)
  }
}

onInput('[data-required-value]', function (event) {
  const field = event.currentTarget as Field
  checkValidityForRequiredValueField(field)
})

on('change', '[data-required-value]', function (event) {
  const field = event.currentTarget as Field
  checkValidityForRequiredValueField(field)

  // We need to call validate since we don't fire a `change` event on the form
  // when session-resume dumps the text back into the field.
  validate(field.form!)
})

onInput('[data-required-trimmed]', function (event) {
  const field = event.currentTarget as Field
  if (field.value.trim() === '') {
    field.setCustomValidity(field.getAttribute('data-required-trimmed')!)
  } else {
    field.setCustomValidity('')
  }
})

on('change', '[data-required-trimmed]', function (event) {
  const field = event.currentTarget as Field
  if (field.value.trim() === '') {
    field.setCustomValidity(field.getAttribute('data-required-trimmed')!)
  } else {
    field.setCustomValidity('')
  }

  // We need to call validate since we don't fire a `change` event on the form
  // when session-resume dumps the text back into the field.
  validate(field.form!)
})

// Observe required fields and validate form when their validation state
// changes.
onFocus(supportedFields, field => {
  let previousValid = (field as Field).checkValidity()
  function inputHandler() {
    const currentValid = (field as Field).checkValidity()
    if (currentValid !== previousValid && (field as Field).form) {
      validate((field as Field).form!)
    }
    previousValid = currentValid
  }

  field.addEventListener('input', inputHandler)
  field.addEventListener('blur', function blurHandler() {
    field.removeEventListener('input', inputHandler)
    field.removeEventListener('blur', blurHandler)
  })
})

const installedForms = new WeakMap()

// Install validation handlers on a form.
function installHandlers(form: HTMLFormElement) {
  if (installedForms.get(form)) return
  form.addEventListener('change', () => validate(form))
  installedForms.set(form, true)
}

// Validate a form or input.
export function validate(form: HTMLInputElement | HTMLFormElement) {
  const validity = form.checkValidity()
  for (const button of form.querySelectorAll<HTMLButtonElement>('button[data-disable-invalid]')) {
    button.disabled = !validity
  }
}

observe('button[data-disable-invalid]', {
  constructor: HTMLButtonElement,
  initialize(button) {
    const form = button.form
    if (form) {
      installHandlers(form)
      button.disabled = !form.checkValidity()
    }
  }
})

// A custom attribute similar to `required`, but only passes validation once
// the value of the field has changed from its initial value.
observe('input[data-required-change], textarea[data-required-change]', function (element) {
  const field = element as Field
  const radioInputDefault =
    field.type === 'radio' && field.form ? (field.form.elements.namedItem(field.name) as RadioNodeList).value : null

  // Custom Validity Event Handler.
  function customValidity(event?: Event) {
    const form = field.form!
    if (event && field.type === 'radio' && form && radioInputDefault) {
      for (const radio of form.elements.namedItem(field.name) as RadioNodeList) {
        if (radio instanceof HTMLInputElement) {
          radio.setCustomValidity(field.value === radioInputDefault ? 'unchanged' : '')
        }
      }
    } else {
      field.setCustomValidity(field.value === (radioInputDefault || field.defaultValue) ? 'unchanged' : '')
    }
  }

  field.addEventListener('input', customValidity)
  field.addEventListener('change', customValidity)
  customValidity()

  if (field.form) {
    validate(field.form)
  }
})

document.addEventListener('reset', function (event: Event) {
  if (event.target instanceof HTMLFormElement) {
    const form = event.target
    setTimeout(() => validate(form))
  }
})
"þ// Ignore pjax if window.onbeforeunload is set, since we may not be able to
// safely navigate away from the current page.
document.addEventListener('pjax:click', function (event) {
  if (window.onbeforeunload) {
    return event.preventDefault()
  }
})
"ûimport {fromEvent} from '../subscription'
import {loaded} from '../document-ready'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'
import {positionedOffset} from '../dimensions'

observe('.js-responsive-underlinenav', {
  constructor: HTMLElement,
  subscribe: nav => {
    asyncCalculateVisibility(nav)
    return fromEvent(window, 'resize', () => calculateVisibility(nav))
  }
})

export async function asyncCalculateVisibility(nav: HTMLElement) {
  await loaded
  calculateVisibility(nav)
}

function toggleItem(item: HTMLElement, hidden: boolean) {
  // Set visibility to hidden, instead of .hidden attribute
  // so we can still calculate distance accurately
  item.style.visibility = hidden ? 'hidden' : ''
  // Get tab-item name, if present, so we can match it up with the dropdown menu
  const itemName = item.getAttribute('data-tab-item')
  if (itemName) {
    const itemToHide = document.querySelector<HTMLElement>(`[data-menu-item=${itemName}]`)
    if (itemToHide instanceof HTMLElement) {
      itemToHide.hidden = !hidden
    }
  }
}

function calculateVisibility(nav: HTMLElement) {
  const items = nav.querySelectorAll<HTMLElement>('.js-responsive-underlinenav-item')
  const overflowContainer = nav.querySelector<HTMLElement>('.js-responsive-underlinenav-overflow')!
  const overflowOffset = positionedOffset(overflowContainer, nav)
  if (!overflowOffset) {
    return
  }

  let anyHidden = false
  for (const item of items) {
    const itemOffset = positionedOffset(item, nav)
    if (itemOffset) {
      const hidden = itemOffset.left + item.offsetWidth >= overflowOffset.left
      toggleItem(item, hidden)
      anyHidden = anyHidden || hidden
    }
  }
  overflowContainer.style.visibility = anyHidden ? '' : 'hidden'
}
"Í// Detects signout/signin events via `flash[:stale_session_signedin]` and
// notifies other browser tabs so that they can:
//
// 1. display the "You signed out in another tab" banner; and
// 2. disable pjaxing and form submission.
//
// On browsers that don't support BroadcastChannel, the `logged-in`
// localStorage key is used to send messages between tabs.

function sessionChanged(loggedIn: string) {
  const flash = document.querySelector<HTMLElement>('.js-stale-session-flash')!
  const flashSignedIn = flash.querySelector<HTMLElement>('.js-stale-session-flash-signed-in')!
  const flashSignedOut = flash.querySelector<HTMLElement>('.js-stale-session-flash-signed-out')!

  flash.hidden = false
  flashSignedIn.hidden = loggedIn === 'false'
  flashSignedOut.hidden = loggedIn === 'true'

  window.addEventListener('popstate', function (event: PopStateEvent) {
    if (event.state && event.state.container != null) {
      location.reload()
    }
  })

  document.addEventListener('submit', function (event: Event) {
    event.preventDefault()
  })
}

let bc
if (typeof BroadcastChannel === 'function') {
  try {
    bc = new BroadcastChannel('stale-session')
    bc.onmessage = event => {
      if (typeof event.data === 'string') sessionChanged(event.data)
    }
  } catch {
    // ignore
  }
}
if (!bc) {
  let postingMessage = false

  bc = {
    postMessage(message: string) {
      postingMessage = true
      try {
        window.localStorage.setItem('logged-in', message)
      } finally {
        postingMessage = false
      }
    }
  }

  window.addEventListener('storage', function (event) {
    /* eslint eslint-comments/no-use: off */
    /* eslint-disable no-restricted-syntax */
    if (!postingMessage && event.storageArea === window.localStorage && event.key === 'logged-in') {
      try {
        if (event.newValue === 'true' || event.newValue === 'false') {
          sessionChanged(event.newValue)
        }
      } finally {
        window.localStorage.removeItem(event.key)
      }
    }
    /* eslint-enable no-restricted-syntax */
  })
}

const element = document.querySelector('.js-stale-session-flash[data-signedin]')
if (element) {
  const value = element.getAttribute('data-signedin') || ''
  bc.postMessage(value)
}
"þ>// Populate a form input from a suggested list of tags.
//
// Markup example:
//
//    <!-- Tag input container -->
//    <div class="tag-input-container js-tag-input-container">
//
//      <!-- Tag <input> wrapper -->
//      <div class="tag-input js-tag-input-wrapper">
//
//        <!-- List of selected tags -->
//        <ul class="js-tag-input-selected-tags">
//
//          <!-- Template used to generate new selected tags -->
//          <li class="js-tag-input-tag js-template d-none">
//            <span class="js-placeholder-tag-name"></span>
//            <a class="remove js-remove" tabindex="-1">&times;</a>
//            <input type="hidden" name="attribute[]" value="tag-value">
//          </li>
//
//          <!-- List of pre-selected tags (optional) -->
//          <li class="js-tag-input-tag">
//            <span class="js-tag-input-tag-name">ruby-on-rails</span>
//            <a class="remove js-remove" tabindex="-1">&times;</a>
//            <input type="hidden" name="attribute[]" value="ruby-on-rails">
//          </li>
//        </ul>
//
//        <auto-complete src="<%= url %>" for="popup">
//          <input type="text" class="tag-input-inner" autocomplete="off" autofocus>
//          <div class="js-navigation-container js-active-navigation-container">
//            <ul class="suggester" id="popup"></ul>
//          </div>
//        </auto-complete>
//      </div>
//    </div>
//

import AutocompleteElement from '@github/auto-complete-element'
import {eventToHotkeyString} from '@github/hotkey'
// eslint-disable-next-line no-restricted-imports
import {fire} from 'delegated-events'
// eslint-disable-next-line no-restricted-imports
import {observe} from 'selector-observer'

interface TagInputOptions {
  container: HTMLElement
  selections: HTMLElement
  inputWrap: HTMLElement
  input: HTMLInputElement
  tagTemplate: HTMLElement
  autoComplete: AutocompleteElement
  multiTagInput: boolean
}

class TagInput {
  container: HTMLElement
  selections: HTMLElement
  inputWrap: HTMLElement
  input: HTMLInputElement
  form: HTMLFormElement
  tagTemplate: HTMLElement
  autoComplete: AutocompleteElement
  multiTagInput: boolean

  constructor(options: TagInputOptions) {
    this.container = options.container
    this.selections = options.selections
    this.inputWrap = options.inputWrap
    this.input = options.input
    this.tagTemplate = options.tagTemplate
    this.form = this.input.form!
    this.autoComplete = options.autoComplete
    this.multiTagInput = options.multiTagInput
  }

  // Bind a tag input to the DOM.
  setup() {
    this.container.addEventListener('click', (event: MouseEvent) => {
      const target = event.target as Element
      if (target.closest('.js-remove')) {
        this.removeTag(event)
      } else {
        this.onFocus()
      }
    })
    this.input.addEventListener('focus', this.onFocus.bind(this))
    this.input.addEventListener('blur', this.onBlur.bind(this))
    this.input.addEventListener('keydown', this.onKeyDown.bind(this))
    this.form.addEventListener('submit', this.onSubmit.bind(this))

    this.autoComplete.addEventListener('auto-complete-change', () => {
      this.selectTag(this.autoComplete.value)
    })
  }

  // Make the tag input container look like a focused input.
  onFocus() {
    this.inputWrap.classList.add('focus')
    if (this.input !== document.activeElement) this.input.focus()
  }

  // Make the tag input container *not* look like a focused input. Also submit
  // the form if there is text in the input and the suggester is hidden.
  onBlur() {
    this.inputWrap.classList.remove('focus')
    if (!this.autoComplete.open) {
      this.onSubmit()
    }
  }

  // Taggify the last thing the user typed in case they didn't hit Enter, Tab,
  // or a comma before clicking the form's submit button.
  onSubmit() {
    if (this.input.value) {
      this.selectTag(this.input.value)
      this.autoComplete.open = false
    }
  }

  onKeyDown(event: KeyboardEvent) {
    switch (eventToHotkeyString(event)) {
      case 'Backspace':
        this.onBackspace()
        break
      case 'Enter':
      case 'Tab':
        this.taggifyValueWhenSuggesterHidden(event)
        break
      case ',':
      case ' ': // (Space)
        this.taggifyValue(event)
        break
    }
  }

  // Taggifies the entered value when the suggester is not visible. Called after an Enter
  // or Tab is entered.
  taggifyValueWhenSuggesterHidden(event: Event) {
    if (!this.autoComplete.open && this.input.value) {
      event.preventDefault()
      this.selectTag(this.input.value)
    }
  }

  // Taggifies the entered value if it exists; called after a comma or space is entered.
  taggifyValue(event: Event) {
    if (this.input.value) {
      event.preventDefault()
      this.selectTag(this.input.value)
      this.autoComplete.open = false
    }
  }

  // Add a new tag to the list of selections if it has not already been added.
  selectTag(text: string) {
    const tags = this.normalizeTag(text)
    const selections = this.selectedTags()

    let tagsAdded = false
    for (let i = 0; i < tags.length; i++) {
      const tag = tags[i]
      if (selections.indexOf(tag) < 0) {
        this.selections.appendChild(this.templateTag(tag))
        tagsAdded = true
      }
    }

    if (tagsAdded) {
      this.input.value = ''
      fire(this.form, 'tags:changed')
    }
  }

  // Remove a tag from the list of selections.
  removeTag(event: Event) {
    const target = event.target as Element
    event.preventDefault()
    const inputTag = target.closest<HTMLElement>('.js-tag-input-tag')!
    inputTag.remove()
    fire(this.form, 'tags:changed')
  }

  // Generate a new tag Node.
  templateTag(tag: string): Element {
    const el = this.tagTemplate.cloneNode(true) as Element

    el.querySelector<HTMLInputElement>('input')!.value = tag
    const tagName = el.querySelector<HTMLElement>('.js-placeholder-tag-name')!
    tagName.replaceWith(tag)
    /* eslint-disable-next-line github/no-d-none */
    el.classList.remove('d-none', 'js-template')

    return el
  }

  // Sanitize user input to remove invalid tag characters.
  normalizeTag(text: string): string[] {
    const sanitizedText = text.toLowerCase().trim()

    if (!sanitizedText) return []
    if (this.multiTagInput) return sanitizedText.split(/[\s,']+/)

    return [sanitizedText.replace(/[\s,']+/g, '-')]
  }

  // Remove a tag on backspace if the input is empty.
  onBackspace() {
    if (!this.input.value) {
      const lastSelection = this.selections.querySelector('li:last-child .js-remove')
      if (lastSelection instanceof HTMLElement) lastSelection.click()
    }
  }

  // Map matched input content to a suggester query.
  selectedTags(): string[] {
    const inputs = this.selections.querySelectorAll<HTMLInputElement>('input')
    return Array.from(inputs)
      .map(el => el.value)
      .filter(value => value.length > 0)
  }
}

observe('.js-tag-input-container', {
  constructor: HTMLElement,
  initialize(el) {
    new TagInput({
      container: el,
      inputWrap: el.querySelector<HTMLElement>('.js-tag-input-wrapper')!,
      input: el.querySelector<HTMLInputElement>('input[type="text"], input:not([type])')!,
      selections: el.querySelector<HTMLElement>('.js-tag-input-selected-tags')!,
      tagTemplate: el.querySelector<HTMLElement>('.js-template')!,
      autoComplete: el.querySelector<AutocompleteElement>('auto-complete')!,
      multiTagInput: false
    }).setup()
  }
})

observe('.js-multi-tag-input-container', {
  constructor: HTMLElement,
  initialize(el) {
    new TagInput({
      container: el,
      inputWrap: el.querySelector<HTMLElement>('.js-tag-input-wrapper')!,
      input: el.querySelector<HTMLInputElement>('input[type="text"], input:not([type])')!,
      selections: el.querySelector<HTMLElement>('.js-tag-input-selected-tags')!,
      tagTemplate: el.querySelector<HTMLElement>('.js-template')!,
      autoComplete: el.querySelector<AutocompleteElement>('auto-complete')!,
      multiTagInput: true
    }).setup()
  }
})
"àfunction supportsUserSelectContain() {
  const el = document.createElement('div')
  el.style.cssText = '-ms-user-select: element; user-select: contain;'
  return (
    el.style.getPropertyValue('-ms-user-select') === 'element' ||
    el.style.getPropertyValue('-ms-user-select') === 'contain' ||
    el.style.getPropertyValue('user-select') === 'contain'
  )
}
function handleUserSelectContain(event: Event) {
  if (!(event.target instanceof Element)) return
  const currentTarget = event.target.closest('.user-select-contain')
  if (!currentTarget) return

  const selection = window.getSelection()
  if (!selection) return
  if (!selection.rangeCount) return
  if (!selection.rangeCount || selection.type !== 'Range') return

  const container = selection.getRangeAt(0).commonAncestorContainer
  if (currentTarget.contains(container)) return
  selection.selectAllChildren(currentTarget)
}

if (!supportsUserSelectContain()) {
  document.addEventListener('click', handleUserSelectContain)
}
"ø8interface BlobOffset {
  // Line number
  // Lines start at 1.
  line: number

  // Optional column number.
  // Like lines, columns are 1-indexed.
  column: number | null
}

export interface BlobRange {
  // Starting offset of range.
  start: BlobOffset

  // End offset of range.
  // End offset may be the same as the start. This indicates a collapsed range.
  // Should always be initialized to a value that is equal or greater than the
  // start range such the range is always in ascending order. Reversed ranges
  // have undefined behavior.
  end: BlobOffset
}

// Inverse of `formatBlobRange`.
//
// Examples
//
//   parseBlobRange("#L3")
//   // => {start: {line: 3}}
//
//   parseBlobRange("L3-L5")
//   // => {start: {line: 3}, end: {line: 5}}
//
//   parseBlobRange("")
//   // => null
export function parseBlobRange(str: string): BlobRange | undefined {
  const lines = str.match(/#?(?:L)(\d+)((?:C)(\d+))?/g)
  if (!lines) {
    return
  } else if (lines.length === 1) {
    const offset = parseBlobOffset(lines[0])
    if (!offset) return
    return Object.freeze({start: offset, end: offset})
  } else if (lines.length === 2) {
    const startOffset = parseBlobOffset(lines[0])
    const endOffset = parseBlobOffset(lines[1])
    if (!startOffset || !endOffset) return

    return ascendingBlobRange(
      Object.freeze({
        start: startOffset,
        end: endOffset
      })
    )
  } else {
    return
  }
}

// Inverse of `parseBlobRange`.
//
// Examples
//
//   formatBlobRange({start: {line: 3}})
//   // => "L3"
//
//   formatBlobRange({start: {line: 3}, end: {line: 5}})
//   // => "L3-L5"
//
//   formatBlobRange({start: {line: 3, column: 1}, end: {line: 5, column: 5}})
//   // => "L3C1-L5C5"
export function formatBlobRange(blobRange: BlobRange): string {
  const {start, end} = ascendingBlobRange(blobRange)

  if (start.column != null && end.column != null) {
    return `L${start.line}C${start.column}-L${end.line}C${end.column}`
  } else if (start.line === end.line) {
    return `L${start.line}`
  } else {
    return `L${start.line}-L${end.line}`
  }
}

// Returns a String containing the file prefix with trailing dash.
//
// Examples
//
//   parseAnchorPrefix("#file-zshrc-L3")
//   // => "file-zshrc-"
//
//   parseAnchorPrefix("file-zshrc-L3-L5")
//   // => "file-zshrc-"
//
//   parseAnchorPrefix("")
//   // => ""
function parseAnchorPrefix(str: string): string {
  const match = str.match(/(file-.+?-)L\d+?/i)
  return match ? match[1] : ''
}

export type AnchorInfo = {
  blobRange: BlobRange
  anchorPrefix: string
}

// Examples
//
//   parseFileAnchor("#file-zshrc-L3")
//   // => { blobRange: {start: {line: 3}}, anchorPrefix: "file-zshrc-" }
//
//   parseFileAnchor("file-zshrc-L3-L5")
//   // => { blobRange: {start: {line: 3}, end: {line: 5}}, anchorPrefix: "file-zshrc-" }
//
//   parseFileAnchor("")
//   // => { blobRange: null, anchorPrefix: undefined }
export function parseFileAnchor(str: string): AnchorInfo {
  const blobRange = parseBlobRange(str)!
  const anchorPrefix = parseAnchorPrefix(str)
  return {blobRange, anchorPrefix}
}

// Formats line number range pair as an anchor String.
//
// Examples
//
//   formatBlobRangeAnchor({blobRange: {start: {line: 3}}, anchorPrefix: ""})
//   // => "#L3"
//
//   formatBlobRangeAnchor({blobRange: {start: {line: 3}}, anchorPrefix: "file-zshrc-"})
//   // => "#file-zshrc-L3"
//
//   formatBlobRangeAnchor({blobRange: {start: {line: 3}, end: {line: 5}}, anchorPrefix: ""})
//   // => "#L3-L5"
//
//   formatBlobRangeAnchor({blobRange: {start: {line: 3, column: 1}, end: {line: 5, column: 5}}, anchorPrefix: ""})
//   // => "#L3C1-L5C5"
//
//   formatBlobRangeAnchor({blobRange: {start: {line: 3}, end: {line: 5}}, anchorPrefix: "file-zshrc-"})
//   // => "#file-zshrc-L3-L5"
//
//   formatBlobRangeAnchor({blobRange: null, anchorPrefix: ""})
//   // => "#"
//
//   formatBlobRangeAnchor({blobRange: null, anchorPrefix: "file-zshrc-"})
//   // => "#"
export function formatBlobRangeAnchor({anchorPrefix, blobRange}: AnchorInfo): string {
  if (!blobRange) return '#'
  return `#${anchorPrefix}${formatBlobRange(blobRange)}`
}

function parseBlobOffset(str: string): BlobOffset | null {
  const lineMatch = str.match(/L(\d+)/)
  const columnMatch = str.match(/C(\d+)/)
  if (lineMatch) {
    return Object.freeze({
      line: parseInt(lineMatch[1]),
      column: columnMatch ? parseInt(columnMatch[1]) : null
    })
  } else {
    return null
  }
}

export function DOMRangeFromBlob(
  blobRange: BlobRange,
  getLineElement: (line: number) => Node | null
): Range | undefined {
  const [startContainer, _startOffset] = findRangeOffset(blobRange.start, true, getLineElement)
  const [endContainer, _endOffset] = findRangeOffset(blobRange.end, false, getLineElement)
  if (!startContainer || !endContainer) return

  // Treat -1 as full line selection
  let startOffset = _startOffset
  let endOffset = _endOffset
  if (startOffset === -1) startOffset = 0
  if (endOffset === -1) endOffset = endContainer.childNodes.length
  if (!startContainer.ownerDocument) throw new Error(`DOMRange needs to be inside document`)

  const range = startContainer.ownerDocument.createRange()
  range.setStart(startContainer, startOffset)
  range.setEnd(endContainer, endOffset)
  return range
}

function findRangeOffset(
  offset: BlobOffset,
  lookAhead: boolean,
  getLineElement: (n: number) => Node | null
): [Node | null, number] {
  const error: [null, number] = [null, 0]

  const lineElement = getLineElement(offset.line)
  if (!lineElement) return error

  if (offset.column == null) {
    return [lineElement, -1]
  }

  let column = offset.column - 1

  const textNodes = getAllTextNodes(lineElement)
  for (let i = 0; i < textNodes.length; i++) {
    const textNode = textNodes[i]

    // TODO: length might be buggy with emoji
    const nextC = column - (textNode.textContent || '').length

    if (nextC === 0) {
      const nextTextNode = textNodes[i + 1]
      if (lookAhead && nextTextNode) {
        return [nextTextNode, 0]
      } else {
        return [textNode, column]
      }
    } else if (nextC < 0) {
      return [textNode, column]
    }

    column = nextC
  }

  return error
}

// Get a flat list of text nodes in depth first order.
function getAllTextNodes(el: Node): Node[] {
  if (el.nodeType === Node.TEXT_NODE) {
    return [el]
  }
  if (!el.childNodes || !el.childNodes.length) return []
  let list: Node[] = []
  for (const node of el.childNodes) {
    list = list.concat(getAllTextNodes(node))
  }
  return list
}

// Sorts range start and end offsets to be in ascending order.
function ascendingBlobRange(range: BlobRange): BlobRange {
  const offsets = [range.start, range.end]
  offsets.sort(compareBlobOffsets)

  if (offsets[0] === range.start && offsets[1] === range.end) {
    return range
  } else {
    return Object.freeze({
      start: offsets[0],
      end: offsets[1]
    })
  }
}

// Compare line offsets. May be used with Array.sort
function compareBlobOffsets(a: BlobOffset, b: BlobOffset): number {
  if (a.line === b.line && a.column === b.column) {
    return 0
  } else if (a.line === b.line && typeof a.column === 'number' && typeof b.column === 'number') {
    return a.column - b.column
  } else {
    return a.line - b.line
  }
}
"import type {CodeEditor} from './editor/code-editor'
// eslint-disable-next-line no-restricted-imports
import {on} from 'delegated-events'

const editors: WeakMap<HTMLElement, CodeEditor> = new WeakMap()

export function getCodeEditor(el: HTMLElement): CodeEditor | undefined {
  return editors.get(el)
}

export async function getAsyncCodeEditor(el: HTMLElement): Promise<CodeEditor> {
  return editors.get(el) || onEditorFromEvent(await nextEvent(el, 'codeEditor:ready'))
}

function onEditorFromEvent(event: Event): CodeEditor {
  if (!(event instanceof CustomEvent)) throw new Error('assert: event is not a CustomEvent')
  const editor: CodeEditor = event.detail.editor
  if (!event.target) throw new Error('assert: event.target is null')
  editors.set(event.target as HTMLElement, editor)
  return editor
}

on('codeEditor:ready', '.js-code-editor', onEditorFromEvent)

function nextEvent(target: EventTarget, event: string): Promise<Event> {
  return new Promise(resolve => {
    target.addEventListener(event, resolve, {once: true})
  })
}
"¹interface Cookie {
  key: string
  value: string
}

/**
 * Get a cookie by name.
 * @param name
 * @returns a cookie object or undefined if not found.
 */
export function getCookie(name: string): Cookie | undefined {
  return getCookies(name)[0]
}

/**
 * Get all cookies by name.
 * @param name
 * @returns
 */
export function getCookies(name: string): Cookie[] {
  const cookies = []
  for (const cookie of readCookies()) {
    const [key, value] = cookie.trim().split('=')
    if (name === key && typeof value !== 'undefined') {
      cookies.push({key, value})
    }
  }
  return cookies
}

function readCookies(): string[] {
  try {
    return document.cookie.split(';')
  } catch {
    // Cookie access disabled.
    return []
  }
}

/**
 * Set a new cookie with sensible defaults like secure.
 * @param name
 * @param value
 * @param expiration
 * @param strictDomain
 * @param samesite
 */
export function setCookie(
  name: string,
  value: string,
  expiration: string | null = null,
  strictDomain = false,
  samesite = 'lax'
) {
  let domain = document.domain
  if (domain == null) {
    throw new Error('Unable to get document domain')
  }

  // Share cookies with test environments.
  if (domain.endsWith('.github.com')) {
    domain = 'github.com'
  }

  const secure = location.protocol === 'https:' ? '; secure' : ''
  const expire = expiration ? `; expires=${expiration}` : ''
  if (strictDomain === false) {
    domain = `.${domain}`
  }
  try {
    document.cookie = `${name}=${value}; path=/; domain=${domain}${expire}${secure}; samesite=${samesite}`
  } catch {
    // Cookie access disabled.
  }
}

/**
 * Delete a given cookie with sensible defaults like secure.
 * This sets the expires value to a second ago to delete the cookie.
 * @param name
 * @param strictDomain
 */
export function deleteCookie(name: string, strictDomain = false) {
  let domain = document.domain
  if (domain == null) {
    throw new Error('Unable to get document domain')
  }

  // Share cookies with test environments.
  if (domain.endsWith('.github.com')) {
    domain = 'github.com'
  }

  const time = new Date().getTime()
  const expiration = new Date(time - 1).toUTCString()
  const secure = location.protocol === 'https:' ? '; secure' : ''
  const expire = `; expires=${expiration}`
  if (strictDomain === false) {
    domain = `.${domain}`
  }
  try {
    document.cookie = `${name}=''; path=/; domain=${domain}${expire}${secure}`
  } catch {
    // Cookie access disabled.
  }
}
"6type Dimensions = {
  top: number
  left: number
  bottom: number
  right: number
  height?: number
  width?: number
}

type Offset = {
  top: number
  left: number
}

// Returns the current coordinates of the element relative to the document.
export function offset(element: HTMLElement): Offset {
  const rect = element.getBoundingClientRect()
  return {
    top: rect.top + window.pageYOffset,
    left: rect.left + window.pageXOffset
  }
}

// Get the closest ancestor element that has a scroll overflow.
//
// Will walk up the DOM from the element until it reaches an element with
// overflow scroll. Basically, an element that can have scroll bars.
export function overflowParent(targetElement: HTMLElement): HTMLElement | null | undefined {
  let element = targetElement
  const document = element.ownerDocument
  if (!document) {
    return
  }

  if (!element.offsetParent) {
    return
  }

  /* eslint-disable-next-line @typescript-eslint/ban-ts-comment */
  // @ts-ignore
  const HTMLElement = document.defaultView.HTMLElement

  if (element === document.body) {
    return
  }

  while (element !== document.body) {
    if (element.parentElement instanceof HTMLElement) {
      element = element.parentElement!
    } else {
      return
    }

    const {position, overflowY, overflowX} = getComputedStyle(element)
    if (
      position === 'fixed' ||
      overflowY === 'auto' ||
      overflowX === 'auto' ||
      overflowY === 'scroll' ||
      overflowX === 'scroll'
    ) {
      break
    }
  }

  return element instanceof Document ? null : element
}

// Returns overflow/scroll offset relative to the container.
//
// Get element overflow offset.
//
// This value is useful for figuring out if the element is outside the
// scrollbars of the container. If `top` is negative, the top of the
// element is above the scroll view. If `bottom` is negative, the
// bottom of the element is below the scroll view.
//
// +--------------------+.
// | (outside viewport) |
// +--------------------+ -|
// |          |         |  |
// |    top > |         |  |
// |          |         |  | h
// |          |         |  | e
// |  v left  V right v |  | i
// |-----> Element <----|  | g
// |          ^         |  | h
// |          |         |  | t
// | bottom > |         |  |
// |          |         |  |
// +--------------------+ -|
// | (outside viewport) |
// +--------------------+.
//
// //=> {top: 100, left: 100, bottom: 800, right: 800, height: 1000, width 1000}.
export function overflowOffset(
  element: HTMLElement,
  targetContainer: Document | HTMLElement | null
): Dimensions | undefined {
  let container = targetContainer
  const document = element.ownerDocument
  if (!document) {
    return
  }

  const documentElement = document.documentElement
  if (!documentElement) {
    return
  }

  if (element === documentElement) {
    return
  }

  const elementOffset = positionedOffset(element, container)
  if (!elementOffset) {
    return
  }

  container = elementOffset._container

  const scroll =
    container === document.documentElement && document.defaultView
      ? {
          top: document.defaultView.pageYOffset,
          left: document.defaultView.pageXOffset
        }
      : {
          top: container.scrollTop,
          left: container.scrollLeft
        }

  const top = elementOffset.top - scroll.top
  const left = elementOffset.left - scroll.left
  const height = container.clientHeight
  const width = container.clientWidth
  const bottom = height - (top + element.offsetHeight)
  const right = width - (left + element.offsetWidth)
  return {top, left, bottom, right, height, width}
}

// Returns position offset relative to the container.
//
// Measures the number of pixels from the top of the container to the
// top of the element and the number of pixels from the bottom of the
// containers full scroll height to the bottom of the element. If
// container is `body`, this is the same as $(element).offset().
//
//     +---------------------+ -|
//     |  outside | viewport |  |
//     +----------|----------+  |
//     |          |          |  |
//     |    top > |          |  |
//     |          |          |  | h
//     |          |          |  | e
//     |  v left  V right v  |  | i
//     |-----> Element <-----|  | g
//     |          ^          |  | h
//     |          |          |  | t
//     | bottom > |          |  |
//     |          |          |  |
//     +----------|----------+  |
//     |  outside | viewport |  |
//     +---------------------+ -|
//
//   {top: 100, left: 100, bottom: 800, right: 800}.
//
// Get element positioned offset.
//
// This value is useful for assigning to `scrollTop` to scroll to the item.
export function positionedOffset(
  targetElement: HTMLElement,
  container: HTMLElement | Document | Window | null
): (Dimensions & {_container: HTMLElement}) | undefined {
  let element = targetElement
  const document = element.ownerDocument
  if (!document) {
    return
  }

  const documentElement = document.documentElement
  if (!documentElement) {
    return
  }

  /* eslint-disable-next-line @typescript-eslint/ban-ts-comment */
  // @ts-ignore
  const HTMLElement = document.defaultView.HTMLElement

  let top = 0
  let left = 0
  const height = element.offsetHeight
  const width = element.offsetWidth

  while (!(element === document.body || element === container)) {
    top += element.offsetTop || 0
    left += element.offsetLeft || 0

    if (element.offsetParent instanceof HTMLElement) {
      element = element.offsetParent!
    } else {
      return
    }
  }

  let scrollHeight
  let scrollWidth
  let measuredContainer: HTMLElement

  if (
    !container ||
    container === document ||
    container === document.defaultView ||
    container === document.documentElement ||
    container === document.body
  ) {
    measuredContainer = documentElement
    scrollHeight = getDocumentHeight(document.body, documentElement)
    scrollWidth = getDocumentWidth(document.body, documentElement)
  } else if (container instanceof HTMLElement) {
    measuredContainer = container
    scrollHeight = container.scrollHeight
    scrollWidth = container.scrollWidth
  } else {
    return
  }

  const bottom = scrollHeight - (top + height)
  const right = scrollWidth - (left + width)
  return {top, left, bottom, right, _container: measuredContainer}
}

function getDocumentHeight(documentBody: HTMLElement, documentElement: HTMLElement): number {
  return Math.max(
    documentBody.scrollHeight,
    documentElement.scrollHeight,
    documentBody.offsetHeight,
    documentElement.offsetHeight,
    documentElement.clientHeight
  )
}

function getDocumentWidth(documentBody: HTMLElement, documentElement: HTMLElement): number {
  return Math.max(
    documentBody.scrollWidth,
    documentElement.scrollWidth,
    documentBody.offsetWidth,
    documentElement.offsetWidth,
    documentElement.clientWidth
  )
}
"// This is a simple function that just returns Promise.resolve() It is used in instances when we want to queue a
// microtask before moving onto the next operation, but want to do so in a very explicit manner: `await microtask`
// looks a lot clearer in intent than `await void 0` or `await Promise.resolve()`.
//
// You would want to use `await microtask()` if you have something that needs to be done very urgently, but still
// needs to be done asynchronously. This will _not_ yield to the browser for any UI updates or wait for idle, instead
// it queues a task in the "microtask" which is run immediately after the current stack. Use this sparingly. This
// will likely delay subsequent code for 0-10ms.
export function microtask(): Promise<void> {
  return Promise.resolve()
}

// This function simply Promisifies requestAnimationFrame so it is awaitable.
//
// You would want to use `await animationFrame()` if you're happy to yield to the browser to complete any UI updates
// before calling your next piece of code. This is useful if - for example - you need to wait for scroll events,
// or CSS transitions or something. This will likely delay subsequent code for 16ms or so - much longer (30-60ms)
// if the tab is not focussed.
export function animationFrame(): Promise<number> {
  return new Promise(window.requestAnimationFrame)
}

// Rejects a promise after a timeout has elapsed. The promise is never
// successfully fulfilled.
//
// Examples
//
//   try {
//     const value = await Promise.race([timeout(100), somethingSlow()])
//     console.log('Slow operation finished within the timeout', value)
//   } catch (e) {
//     console.log('Slow operation did not finish', e)
//   }
//
// Returns a rejected Promise rejected after a timeout.
export async function timeout(ms: number, signal?: AbortSignal): Promise<void> {
  let id
  const done = new Promise<void>((resolve, reject) => {
    id = self.setTimeout(() => reject(new Error('timeout')), ms)
  })
  if (!signal) return done
  try {
    await Promise.race([done, whenAborted(signal)])
  } catch (e) {
    self.clearTimeout(id)
    throw e
  }
}

// Fulfills a promise after a timeout has elapsed. The promise is never rejected.
//
// Examples
//
//   step1()
//   await wait(100)
//   step2()
//
// Returns a Promise fulfilled after a timeout.
export async function wait(ms: number, signal?: AbortSignal): Promise<void> {
  let id
  const done = new Promise<void>(resolve => {
    id = self.setTimeout(resolve, ms)
  })
  if (!signal) return done
  try {
    await Promise.race([done, whenAborted(signal)])
  } catch (e) {
    self.clearTimeout(id)
    throw e
  }
}

function whenAborted(signal: AbortSignal): Promise<never> {
  return new Promise((resolve, reject) => {
    const error = new Error('aborted')
    error.name = 'AbortError'
    if (signal.aborted) {
      reject(error)
    } else {
      signal.addEventListener('abort', () => reject(error))
    }
  })
}

export function taskQueue<T>(fn: (values: T[]) => unknown): (value: T) => void {
  const queue: T[] = []
  return function (value: T) {
    queue.push(value)
    if (queue.length === 1) {
      queueMicrotask(() => {
        const values = [...queue]
        queue.length = 0
        fn(values)
      })
    }
  }
}

/**
 * Run a callback some time after the next browser paint. This is main useful for timing statistics
 * where you care about the amount of time it takes to actually paint the page
 *
 * Note: This is not gauranteed to run _immediately_ after the next paint, just _some time after_ the next paint.
 */
export async function afterNextPaint(callback: () => void) {
  // wait until next animation frame, which will be just before painting
  requestAnimationFrame(() => {
    // use setTimeout to queue a task.  This will be run _some time after_ the paint finishes
    setTimeout(callback)
  })
}
"±// Report uncaught JS errors to Sentry
//   https://sentry.io/github/github-js

import {SOFT_NAV_STATE, getSoftNavReferrer} from './soft-nav-helpers'
import detectProxySite from './proxy-site-detection'
import {getOrCreateClientId} from '@github/hydro-analytics-client'
import {isSupported} from '@github/browser-support'
import {parse} from 'stacktrace-parser'
import {requestUri} from './analytics-overrides'
import {isFeatureEnabled} from './features'

let extensionErrors = false
let errorsReported = 0
const loadTime = Date.now()

type ErrorContext = {
  message?: string
}

// @deprecated Re-throw the caught exception instead.
export function reportError(error: Error, context: ErrorContext = {}) {
  if (error && error.name !== 'AbortError') {
    report(errorContext(formatError(error), context))
  }
}

// Report context info to Sentry.
async function report(context: PlatformReportBrowserErrorInput) {
  if (!reportable()) return

  const url = document.head?.querySelector<HTMLMetaElement>('meta[name="browser-errors-url"]')?.content
  if (!url) return

  if (isExtensionError(context.error.stacktrace)) {
    extensionErrors = true
    return
  }

  errorsReported++

  try {
    await fetch(url, {method: 'post', body: JSON.stringify(context)})
  } catch {
    // Error reporting failed so do nothing.
  }
}

function formatError(error: Error): PlatformJavascriptError {
  return {type: error.name, value: error.message, stacktrace: stacktrace(error)}
}

function errorContext(error: PlatformJavascriptError, context: ErrorContext = {}): PlatformReportBrowserErrorInput {
  return Object.assign(
    {
      error,
      sanitizedUrl: requestUri() || window.location.href,
      readyState: document.readyState,
      referrer: getSoftNavReferrer(),
      timeSinceLoad: Math.round(Date.now() - loadTime),
      user: pageUser() || undefined,
      turbo: isFeatureEnabled('TURBO')
    },
    context
  )
}

export function stacktrace(error: Error): PlatformStackframe[] {
  return parse(error.stack || '').map(frame => ({
    filename: frame.file || '',
    function: String(frame.methodName),
    lineno: (frame.lineNumber || 0).toString(),
    colno: (frame.column || 0).toString()
  }))
}

const extensions = /(chrome|moz|safari)-extension:\/\//

// Does this stack trace contain frames from browser extensions?
function isExtensionError(stack: PlatformStackframe[]): boolean {
  return stack.some(frame => extensions.test(frame.filename) || extensions.test(frame.function))
}

export function pageUser() {
  const login = document.head?.querySelector<HTMLMetaElement>('meta[name="user-login"]')?.content
  if (login) return login

  const clientId = getOrCreateClientId()
  return `anonymous-${clientId}`
}

let unloaded = false
window.addEventListener('pageshow', () => (unloaded = false))
window.addEventListener('pagehide', () => (unloaded = true))

document.addEventListener(SOFT_NAV_STATE.ERROR, event => {
  report(
    errorContext({
      type: 'SoftNavError',
      value: (event as CustomEvent).detail,
      stacktrace: stacktrace(new Error())
    })
  )
})

function reportable() {
  return !unloaded && !extensionErrors && errorsReported < 10 && isSupported() && !detectProxySite(document)
}

if (typeof BroadcastChannel === 'function') {
  const sharedWorkerErrorChannel = new BroadcastChannel('shared-worker-error')
  sharedWorkerErrorChannel.addEventListener('message', event => {
    // SharedWorker will emit a formatted error
    reportError(event.data.error)
  })
}
"Õexport function* filterMap<T, U>(items: T[], map: (item: T) => U | null | undefined): Iterable<U> {
  for (const item of items) {
    const value = map(item)
    if (value != null) {
      yield value
    }
  }
}
"¦import {filterMap} from './iterables'

type Comparator<T> = (a: T, b: T) => number

export function filterSort<T, K>(items: T[], map: (item: T) => K | null | undefined, compare: Comparator<K>): T[] {
  const sortKey = (item: T): [T, K] | null => {
    const key = map(item)
    return key != null ? [item, key] : null
  }
  return [...filterMap(items, sortKey)].sort((a, b) => compare(a[1], b[1])).map(([item]) => item)
}
"ö$// Example
// ```js
//     fuzzyScore("foo.html", "foo")
//     // => 0.6458333333333334
// ```
//
// ```js
//     // Compute re once
//     re = fuzzyRegexp("foo")
//     fuzzyScore("foo.html", re)
//     fuzzyScore("bar.html", re)
//     // => 0.6458333333333334
// ```
//
// Returns a number between 0 and 1. 0 being the worst match and 1
// being an exact match.
export function fuzzyScore(string: string, query: string): number {
  let score = stringScore(string, query)
  if (score && query.indexOf('/') === -1) {
    const basename = string.substring(string.lastIndexOf('/') + 1)
    score += stringScore(basename, query)
  }
  return score
}

// Create a regexp that can be used to fuzzy match a given string. Any
// special regexp characters in the input string will be escaped
// correctly.
//
// A query of "bar" becomes /(.*)(b)([^a]*?)(a)([^r]*?)(r)(.*?)/.
//
// /
//  (.*)     whatever's before the first b
//  (b)      grab the first b of bar
//  ([^a]*?) take everything up to the a of bar
//  (a)      take the a of bar
//  ([^r]*?) take everything up to the r of bar
//  (r)      take the r of bar
//  (.*?)    take the rest of the string
// /
export function fuzzyRegexp(query: string): RegExp {
  const chars = query.toLowerCase().split('')

  let regex = ''

  for (let i = 0; i < chars.length; i++) {
    const char = chars[i]
    // must escape these chars so we match literals
    const c = char.replace(/[\\^$*+?.()|[\]{}]/g, '\\$&')
    if (i === 0) {
      // for the first we want to greedily match anything, which pushes
      // the first match as late as possible in the string
      regex += `(.*)(${c})`
    } else {
      regex += `([^${c}]*?)(${c})`
    }
  }
  return new RegExp(`${regex}(.*?)$`, 'i')
}

export function fuzzyHighlightElement(content: Element, text?: string, textRe?: RegExp): void {
  if (text) {
    const matches = content.innerHTML.trim().match(textRe || fuzzyRegexp(text))
    if (!matches) return

    let open = false
    const html = []
    for (let i = 1; i < matches.length; ++i) {
      const m = matches[i]
      if (!m) continue

      if (i % 2 === 0) {
        if (!open) {
          // eslint-disable-next-line github/unescaped-html-literal
          html.push('<mark>')
          open = true
        }
      } else if (open) {
        html.push('</mark>')
        open = false
      }
      html.push(m)
    }
    content.innerHTML = html.join('')
  } else {
    const html = content.innerHTML.trim()
    const clean = html.replace(/<\/?mark>/g, '')
    if (html !== clean) {
      content.innerHTML = clean
    }
  }
}

// string_score.js: Quicksilver-like string scoring algorithm.
//  https://raw.github.com/joshaven/string_score/master/coffee/string_score.coffee
//
// Copyright (C) 2009-2011 Joshaven Potter <yourtech@gmail.com>
// Copyright (C) 2010-2011 Yesudeep Mangalapilly <yesudeep@gmail.com>
// MIT license: http://www.opensource.org/licenses/mit-license.php
//
// A string score implementation.
function stringScore(originalString: string, abbreviation: string): number {
  let string = originalString
  if (string === abbreviation) {
    return 1.0
  }
  const stringLength = string.length
  let totalCharacterScore = 0.0
  let shouldAwardCommonPrefixBonus = 0
  for (let i = 0; i < abbreviation.length; i++) {
    const c = abbreviation[i]
    const indexCLowercase = string.indexOf(c.toLowerCase())
    const indexCUppercase = string.indexOf(c.toUpperCase())
    const minIndex = Math.min(indexCLowercase, indexCUppercase)
    const indexInString = minIndex > -1 ? minIndex : Math.max(indexCLowercase, indexCUppercase)
    if (indexInString === -1) {
      return 0.0
    }
    totalCharacterScore += 0.1
    if (string[indexInString] === c) {
      totalCharacterScore += 0.1
    }
    if (indexInString === 0) {
      totalCharacterScore += 0.8
      if (i === 0) {
        shouldAwardCommonPrefixBonus = 1
      }
    }
    if (string.charAt(indexInString - 1) === ' ') {
      totalCharacterScore += 0.8
    }
    string = string.substring(indexInString + 1, stringLength)
  }
  const abbreviationLength = abbreviation.length
  const abbreviationScore = totalCharacterScore / abbreviationLength
  let finalScore = (abbreviationScore * (abbreviationLength / stringLength) + abbreviationScore) / 2
  if (shouldAwardCommonPrefixBonus && finalScore + 0.1 < 1) {
    finalScore += 0.1
  }
  return finalScore
}

export type TextScore = {score: number; text: string}
export function compare(a: TextScore, b: TextScore): -1 | 0 | 1 {
  if (a.score > b.score) {
    return -1
  } else if (a.score < b.score) {
    return 1
  } else if (a.text < b.text) {
    return -1
  } else if (a.text > b.text) {
    return 1
  } else {
    return 0
  }
}
"¸Iimport {score as fuzzyScore, hasMatch, positions} from 'fzy.js'

const getScore = (value: string, text: string, minScore: number) => {
  if (!hasMatch(value, text)) return -Infinity
  const score = fuzzyScore(value, text)
  if (score < minScore) return -Infinity
  return score
}
const highlightElement = (node: HTMLElement, value: string, text: string) => {
  node.innerHTML = ''

  let lastPosition = 0
  for (const i of positions(value, text)) {
    const slice = text.slice(lastPosition, i)
    if (slice !== '') {
      node.appendChild(document.createTextNode(text.slice(lastPosition, i)))
    }
    lastPosition = i + 1
    const mark = document.createElement('mark')
    mark.textContent = text[i]
    node.appendChild(mark)
  }

  node.appendChild(document.createTextNode(text.slice(lastPosition)))
}

interface sortAbort {
  aborted: boolean
}
const sorting: WeakMap<FuzzyListElement, sortAbort> = new WeakMap()

type FuzzyListLazyRenderCallback = (text: string) => Node
interface state {
  timer: number | null
  handler: MutationObserver
  items: Set<Node>
  lazyItems: Map<string, FuzzyListLazyRenderCallback>
}
const states: WeakMap<FuzzyListElement, state> = new WeakMap()

const textCache: WeakMap<Node, string> = new WeakMap()
const getTextCache = (item: Node) => {
  if (!textCache.has(item) && item instanceof HTMLElement) {
    const value = (item.getAttribute('data-value') || item.textContent || '').trim()
    textCache.set(item, value)
    return value
  }
  return textCache.get(item) || ''
}

class FuzzyListElement extends HTMLElement {
  connectedCallback() {
    /* eslint-disable-next-line custom-elements/no-dom-traversal-in-connectedcallback */
    const list = this.querySelector('ul')
    if (!list) return

    /* eslint-disable-next-line custom-elements/no-dom-traversal-in-connectedcallback */
    const items = new Set(list.querySelectorAll('li'))

    /* eslint-disable-next-line custom-elements/no-dom-traversal-in-connectedcallback */
    const inputEl = this.querySelector('input')
    if (inputEl instanceof HTMLInputElement) {
      inputEl.addEventListener('input', () => {
        this.value = inputEl.value
      })
    }

    const handler = new MutationObserver(mutations => {
      let update = false
      for (const mutation of mutations) {
        if (mutation.type === 'childList' && mutation.addedNodes.length) {
          for (const item of mutation.addedNodes) {
            if (item instanceof HTMLLIElement && !items.has(item)) {
              const text = getTextCache(item)
              update = update || hasMatch(this.value, text)
              items.add(item)
            }
          }
        }
      }
      if (update) this.sort()
    })
    handler.observe(list, {childList: true})

    const state = {handler, items, lazyItems: new Map(), timer: null}
    states.set(this, state)
  }

  disconnectedCallback() {
    const state = states.get(this)
    if (state) {
      state.handler.disconnect()
      states.delete(this)
    }
  }

  addLazyItems(dataset: string[], render: FuzzyListLazyRenderCallback) {
    const state = states.get(this)
    if (!state) return
    const {lazyItems} = state
    const {value} = this
    let update = false
    for (const item of dataset) {
      lazyItems.set(item, render)
      update = update || (Boolean(value) && hasMatch(value, item))
    }
    if (update) this.sort()
  }

  sort() {
    const oldSortAbort = sorting.get(this)
    if (oldSortAbort) oldSortAbort.aborted = true
    const sortAbort = {aborted: false}
    sorting.set(this, sortAbort)
    const {minScore, markSelector, maxMatches, value} = this
    const state = states.get(this)
    if (!state) return
    if (!this.dispatchEvent(new CustomEvent('fuzzy-list-will-sort', {cancelable: true, detail: value}))) return
    const {items, lazyItems} = state
    const shouldMark = this.hasAttribute('mark-selector')

    const list = this.querySelector('ul')
    if (!list) return

    const itemsToRender: Array<
      {render: FuzzyListLazyRenderCallback; text: string; score: number} | {item: Node; score: number}
    > = []

    if (value) {
      for (const item of items) {
        const text = getTextCache(item)
        const score = getScore(value, text, minScore)
        if (score === -Infinity) continue
        itemsToRender.push({item, score})
      }
      for (const [text, render] of lazyItems) {
        const score = getScore(value, text, minScore)
        if (score === -Infinity) continue
        itemsToRender.push({text, render, score})
      }
      itemsToRender.sort((a, b) => b.score - a.score).splice(maxMatches)
    } else {
      let i = itemsToRender.length
      for (const item of items) {
        if (i >= maxMatches) break
        itemsToRender.push({item, score: 1})
        i += 1
      }
      for (const [text, render] of lazyItems) {
        if (i >= maxMatches) break
        itemsToRender.push({text, render, score: 1})
        i += 1
      }
    }

    requestAnimationFrame(() => {
      if (sortAbort.aborted) return

      // Store a reference to the checked input (if there is one) as when we
      // append other (stale) items they could be checked, and we want to keep
      // the originally checked item as the only checked item
      const checkedInputBeforeFilter = list.querySelector('input[type="radio"]:checked')

      list.innerHTML = ''
      let offset = 0

      const nextBatch = () => {
        if (sortAbort.aborted) return
        const end = Math.min(itemsToRender.length, offset + 100)
        const fragment = document.createDocumentFragment()
        for (let i = offset; i < end; i += 1) {
          const itemToRender = itemsToRender[i]
          let item = null
          if ('render' in itemToRender && 'text' in itemToRender) {
            const {render, text} = itemToRender
            item = render(text)
            items.add(item)
            textCache.set(item, text)
            lazyItems.delete(text)
          } else if ('item' in itemToRender) {
            item = itemToRender.item
          }
          if (item instanceof HTMLElement) {
            if (shouldMark) {
              highlightElement(
                markSelector ? item.querySelector(markSelector) || item : item,
                shouldMark ? value : '',
                getTextCache(item)
              )
            }
            fragment.appendChild(item)
          }
        }
        offset = end

        // Loop through all items that are about to be rendered - if there are
        // any radios that are checked that conflict with the one checked item,
        // then reset them to unchecked state
        let inputStateReset = false
        if (checkedInputBeforeFilter instanceof HTMLInputElement) {
          for (const checkedInput of fragment.querySelectorAll('input[type="radio"]:checked')) {
            if (checkedInput instanceof HTMLInputElement && checkedInput.value !== checkedInputBeforeFilter.value) {
              checkedInput.checked = false
              inputStateReset = true
            }
          }
        }

        list.appendChild(fragment)

        // If any checked items were changed then a change event should be
        // fired to let other observers know
        if (checkedInputBeforeFilter && inputStateReset) {
          checkedInputBeforeFilter.dispatchEvent(new Event('change', {bubbles: true}))
        }

        if (end < itemsToRender.length) {
          requestAnimationFrame(nextBatch)
        } else {
          list.hidden = itemsToRender.length === 0
          const emptyEl = this.querySelector<HTMLElement>('[data-fuzzy-list-show-on-empty]')
          if (emptyEl) {
            emptyEl.hidden = itemsToRender.length > 0
          }

          this.dispatchEvent(new CustomEvent('fuzzy-list-sorted', {detail: itemsToRender.length}))
        }
      }

      nextBatch()
    })
  }

  get value(): string {
    return this.getAttribute('value') || ''
  }

  set value(value: string) {
    this.setAttribute('value', value)
  }

  get markSelector(): string {
    return this.getAttribute('mark-selector') || ''
  }

  set markSelector(value: string) {
    if (value) {
      this.setAttribute('mark-selector', value)
    } else {
      this.removeAttribute('mark-selector')
    }
  }

  get minScore(): number {
    return Number(this.getAttribute('min-score') || 0)
  }

  set minScore(value: number) {
    if (Number.isNaN(value)) return
    this.setAttribute('min-score', String(value))
  }

  get maxMatches(): number {
    return Number(this.getAttribute('max-matches') || Infinity)
  }

  set maxMatches(value: number) {
    if (Number.isNaN(value)) return
    this.setAttribute('max-matches', String(value))
  }

  static get observedAttributes(): string[] {
    return ['value', 'mark-selector', 'min-score', 'max-matches']
  }

  attributeChangedCallback(name: string, oldValue: string, newValue: string) {
    if (oldValue === newValue) return
    const state = states.get(this)
    if (!state) return
    if (state.timer) window.clearTimeout(state.timer)
    state.timer = window.setTimeout(() => this.sort(), 100)
  }
}

export default FuzzyListElement

if (!window.customElements.get('fuzzy-list')) {
  window.FuzzyListElement = FuzzyListElement
  window.customElements.define('fuzzy-list', FuzzyListElement)
}

declare global {
  interface Window {
    FuzzyListElement: typeof FuzzyListElement
  }
}
"õimport {AnalyticsClient, getOptionsFromMeta} from '@github/hydro-analytics-client'
import type {Context} from '@github/hydro-analytics-client'

const dimensionPrefix = 'dimension_'
let hydroAnalyticsClient: AnalyticsClient | undefined

const MARKETING_PARAMS = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content', 'scid']

try {
  const options = getOptionsFromMeta('octolytics')

  // Remove the base context because meta tags can change as the user navigates with Turbo
  // These will be folded in for each event & page view
  delete options.baseContext

  hydroAnalyticsClient = new AnalyticsClient(options)
} catch (_) {
  // Failed to get options from meta tags.  This most likely means analytics are disabled.
}

function extendBaseContext(context?: Context) {
  const baseContext = getOptionsFromMeta('octolytics').baseContext || {}

  if (baseContext) {
    delete baseContext.app_id
    delete baseContext.event_url
    delete baseContext.host

    for (const key in baseContext) {
      // some octolytics meta tags are prefixed with dimension-, which we don't need with the new hydro-analytics-client
      if (key.startsWith(dimensionPrefix)) {
        baseContext[key.replace(dimensionPrefix, '')] = baseContext[key]
        delete baseContext[key]
      }
    }
  }

  const visitorMeta = document.querySelector<HTMLMetaElement>('meta[name=visitor-payload]')
  if (visitorMeta) {
    const visitorHash = JSON.parse(atob(visitorMeta.content))
    Object.assign(baseContext, visitorHash)
  }

  const urlParams = new URLSearchParams(window.location.search)
  for (const [key, value] of urlParams) {
    if (MARKETING_PARAMS.includes(key.toLowerCase())) {
      baseContext[key] = value
    }
  }

  return Object.assign(baseContext, context)
}

export function sendPageView(context?: Context) {
  hydroAnalyticsClient?.sendPageView(extendBaseContext(context))
}

export function sendEvent(type: string, context: Record<string, string | number | boolean | undefined | null>) {
  const service = document.head?.querySelector<HTMLMetaElement>('meta[name="current-catalog-service"]')?.content

  const cleanContext: Context = service ? {service} : {}

  for (const [key, value] of Object.entries(context)) {
    if (value !== undefined && value !== null) {
      cleanContext[key] = `${value}`
    }
  }

  hydroAnalyticsClient?.sendEvent(type || 'unknown', extendBaseContext(cleanContext))
}
"÷	import {sendStats} from './stats'

export function sendData(hydroEventPayload: string, hydroEventHmac: string, hydroClientContext: string): void {
  const data = {
    hydroEventPayload,
    hydroEventHmac,
    visitorPayload: '',
    visitorHmac: '',
    hydroClientContext
  }

  const visitorPayload = document.querySelector('meta[name=visitor-payload]')
  if (visitorPayload instanceof HTMLMetaElement) {
    data['visitorPayload'] = visitorPayload.content
  }
  const visitorHmac = document.querySelector('meta[name=visitor-hmac]') || ''
  if (visitorHmac instanceof HTMLMetaElement) {
    data['visitorHmac'] = visitorHmac.content
  }

  sendStats(data, true)
}

export function trackView(el: HTMLElement) {
  const payload = el.getAttribute('data-hydro-view') || ''
  const hmac = el.getAttribute('data-hydro-view-hmac') || ''
  const hydroClientContext = el.getAttribute('data-hydro-client-context') || ''
  sendData(payload, hmac, hydroClientContext)
}

export function sendHydroEvent(el: HTMLElement) {
  const payload = el.getAttribute('data-hydro-click-payload') || ''
  const hmac = el.getAttribute('data-hydro-click-hmac') || ''
  const hydroClientContext = el.getAttribute('data-hydro-client-context') || ''
  sendData(payload, hmac, hydroClientContext)
}
" import type {PageViews} from './page-views'

const FEATURE_WEIGHTS = {frequency: 0.6, recency: 0.4}

function sortBy<T>(items: T[], map: (item: T) => number): T[] {
  return items.sort((a, b) => map(a) - map(b))
}

type Scorer = (pageKey: string) => number
export function scorer(pageViews: PageViews): Scorer {
  const frequencies = frequencyMap(pageViews)
  const recencies = recencyMap(pageViews)
  return function (pageKey: string): number {
    return score(frequencies.get(pageKey) || 0, recencies.get(pageKey) || 0)
  }
}

function score(frequency: number, recency: number): number {
  return frequency * FEATURE_WEIGHTS.frequency + recency * FEATURE_WEIGHTS.recency
}

// Scores a relative frequency in the interval [0, 1] where higher means more frequent.
function frequencyMap(pageViews: PageViews): Map<string, number> {
  const totalVisits = [...Object.values(pageViews)].reduce((total, view) => total + view.visitCount, 0)
  return new Map(Object.keys(pageViews).map(pageKey => [pageKey, pageViews[pageKey].visitCount / totalVisits]))
}

// Scores a relative recency value in the interval [0, 1] where higher means more recent.
function recencyMap(pageViews: PageViews): Map<string, number> {
  const recencyList = sortBy([...Object.keys(pageViews)], key => pageViews[key].lastVisitedAt)
  const totalUniqueVisits = recencyList.length
  return new Map(recencyList.map((key, index) => [key, (index + 1) / totalUniqueVisits]))
}
"×#import {scorer} from './ranking'
export {scorer} from './ranking'

type PageViewSummary = {
  lastVisitedAt: number
  visitCount: number
}

export type PageViews = {[page_key: string]: PageViewSummary}

const TEAM_PAGE_REGEX = /^\/orgs\/([a-z0-9-]+)\/teams\/([\w-]+)/

// Of course this list is incomplete, but it should be good enough for the purposes of this prototype.
const REPOSITORY_PAGE_REGEXES = [
  // This will overcount some things, but since every page view is ultimately compared to entities
  // we can jump to it should be fine. Of course if we ever tried to add users or orgs to this it
  // would break.
  /^\/([^/]+)\/([^/]+)\/?$/,

  /^\/([^/]+)\/([^/]+)\/blob/,
  /^\/([^/]+)\/([^/]+)\/tree/,
  /^\/([^/]+)\/([^/]+)\/issues/,
  /^\/([^/]+)\/([^/]+)\/pulls?/,
  /^\/([^/]+)\/([^/]+)\/pulse/
]

const PROJECT_PAGE_REGEXES = [
  ['organization', /^\/orgs\/([a-z0-9-]+)\/projects\/([0-9-]+)/],
  ['repository', /^\/([^/]+)\/([^/]+)\/projects\/([0-9-]+)/]
]

const MAX_PAGE_VIEWS_TO_STORE_IN_LOCAL_STORAGE = 100

export function logPageView(path: string) {
  const teamPageMatch = path.match(TEAM_PAGE_REGEX)
  if (teamPageMatch) {
    logPageViewByKey(buildTeamKey(teamPageMatch[1], teamPageMatch[2]))
    return
  }

  let projectPageMatch
  for (let i = 0, len = PROJECT_PAGE_REGEXES.length; i < len; i++) {
    const [ownerType, projectRegex] = PROJECT_PAGE_REGEXES[i]
    projectPageMatch = path.match(projectRegex)
    if (projectPageMatch) {
      let ownerSlug: string | null = null
      let number: string | null = null
      switch (ownerType) {
        case 'organization':
          ownerSlug = projectPageMatch[1]
          number = projectPageMatch[2]
          break
        case 'repository':
          ownerSlug = `${projectPageMatch[1]}/${projectPageMatch[2]}`
          number = projectPageMatch[3]
          break
        default:
        // Should never get here.
      }
      if (ownerSlug && number) {
        logPageViewByKey(buildProjectKey(ownerSlug, number))
      }
      return
    }
  }

  let repositoryPageMatch
  for (let i = 0, len = REPOSITORY_PAGE_REGEXES.length; i < len; i++) {
    repositoryPageMatch = path.match(REPOSITORY_PAGE_REGEXES[i])
    if (repositoryPageMatch) {
      logPageViewByKey(buildRepositoryKey(repositoryPageMatch[1], repositoryPageMatch[2]))
      return
    }
  }
}

// Limits localStorage entries to 100 MAX_PAGE_VIEWS_TO_STORE_IN_LOCAL_STORAGE
function limitedPageViews(pageViews: PageViews) {
  const keys = Object.keys(pageViews)
  if (keys.length <= MAX_PAGE_VIEWS_TO_STORE_IN_LOCAL_STORAGE) {
    return pageViews
  }
  const scorePage = scorer(pageViews)
  const ranked = keys.sort((a, b) => scorePage(b) - scorePage(a)).slice(0, MAX_PAGE_VIEWS_TO_STORE_IN_LOCAL_STORAGE / 2)
  return Object.fromEntries(ranked.map(key => [key, pageViews[key]]))
}

function logPageViewByKey(key: string) {
  const views = getPageViewsMap()
  const now = currentEpochTimeInSeconds()
  const hit = views[key] || {lastVisitedAt: now, visitCount: 0}
  hit.visitCount += 1
  hit.lastVisitedAt = now
  views[key] = hit
  setPageViewsMap(limitedPageViews(views))
}

function currentEpochTimeInSeconds(): number {
  return Math.floor(Date.now() / 1000)
}

export function buildTeamKey(organizationLogin: string, teamSlug: string): string {
  return `team:${organizationLogin}/${teamSlug}`
}

export function buildRepositoryKey(ownerLogin: string, name: string): string {
  return `repository:${ownerLogin}/${name}`
}

export function buildProjectKey(ownerSlug: string, number: string): string {
  return `project:${ownerSlug}/${number}`
}

const PAGE_VIEW_KEY_REGEX = /^(team|repository|project):[^/]+\/[^/]+(\/([^/]+))?$/
const VIEWS_KEY = 'jump_to:page_views'

function setPageViewsMap(views: PageViews) {
  setItem(VIEWS_KEY, JSON.stringify(views))
}

export function getPageViewsMap(): PageViews {
  const rawData = getItem(VIEWS_KEY)
  if (!rawData) return {}

  let json
  try {
    json = JSON.parse(rawData)
  } catch {
    // Clear localStorage since we know it's bad
    setPageViewsMap({})
    return {}
  }

  const pageViewMap: PageViews = {}
  for (const key in json) {
    if (key.match(PAGE_VIEW_KEY_REGEX)) {
      pageViewMap[key] = json[key]
    }
  }
  return pageViewMap
}

function setItem(key: string, value: string) {
  try {
    window.localStorage.setItem(key, value)
  } catch {
    // Storage quota exceeded.
  }
}

function getItem(key: string): string | null {
  try {
    return window.localStorage.getItem(key)
  } catch {
    // Storage unavailable.
    return null
  }
}
"Ô/*
 * Applies state updates from a form (e.g. Mark as read/archive/unsubscribe/star) to the element
 * that represents the notification (e.g. The notification item in the list view, or the
 * notification shelf on an Issue page).
 */
export function updateNotificationStates(element: HTMLElement, form: HTMLFormElement) {
  const notification = element.closest<HTMLElement>('[data-notification-id]')!

  // Toggles read/unread/archive status
  if (form.hasAttribute('data-status')) {
    toggleNotificationStatus(notification, form.getAttribute('data-status')!)
  }

  // Toggles subscribed/unsubscribed status
  if (form.hasAttribute('data-subscription-status')) {
    toggleNotificationSubscriptionStatus(notification, form.getAttribute('data-subscription-status')!)
  }

  // Toggles starred/unstarred status
  if (form.hasAttribute('data-starred-status')) {
    toggleNotificationStarredStatus(notification, form.getAttribute('data-starred-status')!)
  }
}

function toggleNotificationStatus(notification: HTMLElement, status: string) {
  notification.classList.toggle('notification-archived', status === 'archived')
  notification.classList.toggle('notification-unread', status === 'unread')
  notification.classList.toggle('notification-read', status === 'read')
}

function toggleNotificationSubscriptionStatus(notification: HTMLElement, status: string) {
  notification.classList.toggle('notification-unsubscribed', status === 'unsubscribed')
}

function toggleNotificationStarredStatus(notification: HTMLElement, status: string) {
  notification.classList.toggle('notification-starred', status === 'starred')
}
"Á// More robust version of Range.surroundContents().
export function surroundContents(range: Range, newNode: Node) {
  newNode.appendChild(range.extractContents())
  range.insertNode(newNode)
}
"// Gets the current page's id for persisting fields.
//
// The value can be overridden by providing a normalized value in a meta tag.
//
//   <meta name="session-resume-id" content="/github/github/issues/123">.
//
// Defaults to the current url path.
export function getPageID(url?: URL): string {
  const location = url || window.location

  const metaTag = document.head && document.head.querySelector('meta[name=session-resume-id]')
  const id = metaTag instanceof HTMLMetaElement && metaTag.content

  return id || location.pathname
}
"¢import {dialog} from './details-dialog'
import {fetchSafeDocumentFragment} from './fetch'
import {remoteForm} from '@github/remote-form'
import {webauthnSupportLevel} from './webauthn-support-level'

let sudoPromptExist = false

/**
 * Take a URL and add webauthn params to it.
 *
 * @param {string} oldURL - The old URL.
 * @returns {string} - The new URL with added params.
 */
function urlWithParams(oldURL: string): string {
  const newURL = new URL(oldURL, window.location.origin)
  const params = new URLSearchParams(newURL.search.slice(1))
  params.set('webauthn-support', webauthnSupportLevel())
  newURL.search = params.toString()
  return newURL.toString()
}

async function loadPromptTemplate(): Promise<HTMLTemplateElement> {
  const link = document.querySelector<HTMLLinkElement>('link[rel=sudo-modal]')!
  const template = document.querySelector('.js-sudo-prompt')
  if (template instanceof HTMLTemplateElement) {
    return template
  } else if (link) {
    const fragment = await fetchSafeDocumentFragment(document, urlWithParams(link.href))
    document.body.appendChild(fragment)
    return document.querySelector<HTMLTemplateElement>('.js-sudo-prompt')!
  } else {
    throw new Error("couldn't load sudo prompt")
  }
}

let succeeded = false

/**
 * Provide a sudo prompt, and return when it has been filled in or dismissed.
 *
 * @returns {Promise<boolean>} - Resolves to `true` if the user successfully authed with sudo.
 */
async function sudoPrompt(): Promise<boolean> {
  if (sudoPromptExist) return false
  sudoPromptExist = true
  succeeded = false
  const template = await loadPromptTemplate()
  const content = template.content.cloneNode(true)
  const prompt = await dialog({content})
  await new Promise<void>(resolve => {
    prompt.addEventListener(
      'dialog:remove',
      function () {
        sudoPromptExist = false
        resolve()
      },
      {once: true}
    )
  })
  return succeeded
}

remoteForm('.js-sudo-form', async function (form, wants) {
  try {
    await wants.text()
  } catch (error) {
    if (!error.response) throw error
    let errorMessage
    switch (error.response.status) {
      case 401:
        // eslint-disable-next-line i18n-text/no-en
        errorMessage = 'Incorrect password.'
        break
      case 429:
        // eslint-disable-next-line i18n-text/no-en
        errorMessage = 'Too many password attempts. Please wait and try again later.'
        break
      default:
        // eslint-disable-next-line i18n-text/no-en
        errorMessage = 'Failed to receive a response. Please try again later.'
    }

    form.querySelector<HTMLElement>('.js-sudo-error')!.textContent = errorMessage
    form.querySelector<HTMLElement>('.js-sudo-error')!.hidden = false
    form.querySelector<HTMLInputElement>('.js-sudo-password')!.value = ''

    return
  }
  succeeded = true
  form.closest<HTMLElement>('details')!.removeAttribute('open')
})

/**
 * Check if user is in sudo mode. If not, show a sudo prompt.
 *
 * @returns {Promise<boolean>} - Will be `true` if user is in or got in sudo mode after prompt.
 */
export default async function triggerSudoPrompt(): Promise<boolean> {
  const response = await fetch('/sessions/in_sudo', {
    headers: {accept: 'application/json', 'X-Requested-With': 'XMLHttpRequest'}
  })
  if (response.ok) {
    const sudoResponse = await response.text()
    if (sudoResponse === 'true') {
      return true
    } else {
      return sudoPrompt()
    }
  }
  return sudoPrompt()
}
cb/ /   G e t s   t h e   l e n g t h   o f   c o d e - p o i n t s   f r o m   a   S t r i n g . 
 / / 
 / /   T h i s   i s   d i f f e r e n t   t o   ` s t r i n g . l e n g t h `   w h i c h   r e t u r n s   t h e   a m o u n t   o f   u t f - 8 
 / /   b y t e s ,   w h i c h   i s   a   d i f f e r e n t   m e t r i c   a s   -   f o r   e x a m p l e   -   t h e   p o o   e m o j i   i s   2 
 / /   u t f - 8   b y t e s ,   b u t   1   u n i c o d e   c o d e   p o i n t . 
 / / 
 / /   S e e   h t t p : / / b l o g . j o n n e w . c o m / p o s t s / p o o - d o t - l e n g t h - e q u a l s - t w o   f o r   m o r e . 
 e x p o r t   f u n c t i o n   g e t U t f 8 S t r i n g L e n g t h ( s t r :   s t r i n g ) :   n u m b e r   { 
     c o n s t   j o i n e r   =   ' \ u 2 0 0 D ' 
     c o n s t   s p l i t   =   s t r . s p l i t ( j o i n e r ) 
     l e t   c o u n t   =   0 
 
     f o r   ( c o n s t   s   o f   s p l i t )   { 
         / /   r e m o v i n g   t h e   v a r i a t i o n   s e l e c t o r s 
         c o n s t   n u m   =   A r r a y . f r o m ( s . s p l i t ( / [ \ u f e 0 0 - \ u f e 0 f ] / ) . j o i n ( ' ' ) ) . l e n g t h 
         c o u n t   + =   n u m 
     } 
 
     / /   a s s u m i n g   t h e   j o i n e r s   a r e   u s e d   a p p r o p r i a t e l y 
     r e t u r n   c o u n t   /   s p l i t . l e n g t h 
 } 
 / * * 
   *   R e p l a c e   t e x t   i n   a   t e x t a r e a   w i t h   a   n e w   s t r i n g   a n d 
   *   p l a c e   t h e   c u r s o r   a t   t h e   s e l e c t i o n E n d   p o s i t i o n . 
   *   @ p a r a m   t e x t a r e a   a n   ` < i n p u t > `   o r   ` < t e x t a r e a > `   e l e m e n t 
   *   @ p a r a m   o l d T e x t   T h e   t e x t   t o   r e p l a c e 
   *   @ p a r a m   n e w T e x t   T h e   n e w   t e x t   t o   r e p l a c e   w i t h 
   *   @ r e t u r n s   T h e   n e w   t e x t 
   * / 
 e x p o r t   f u n c t i o n   r e p l a c e T e x t ( 
     t e x t a r e a :   H T M L I n p u t E l e m e n t   |   H T M L T e x t A r e a E l e m e n t , 
     o l d T e x t :   s t r i n g , 
     n e w T e x t :   s t r i n g 
 ) :   s t r i n g   { 
     l e t   b e g i n n i n g   =   t e x t a r e a . v a l u e . s u b s t r i n g ( 0 ,   t e x t a r e a . s e l e c t i o n E n d   | |   0 ) 
     l e t   r e m a i n i n g   =   t e x t a r e a . v a l u e . s u b s t r i n g ( t e x t a r e a . s e l e c t i o n E n d   | |   0 ) 
     b e g i n n i n g   =   b e g i n n i n g . r e p l a c e ( o l d T e x t ,   n e w T e x t ) 
     r e m a i n i n g   =   r e m a i n i n g . r e p l a c e ( o l d T e x t ,   n e w T e x t ) 
 
     s e t T e x t a r e a V a l u e A n d C u r s o r ( t e x t a r e a ,   b e g i n n i n g   +   r e m a i n i n g ,   b e g i n n i n g . l e n g t h ) 
 
     r e t u r n   n e w T e x t 
 } 
 
 / * * 
   *   R e p l a c e   s e l e c t e d   t e x t   i n   a   t e x t a r e a   w i t h   a   n e w   s t r i n g . 
   *   I f   t h e   s e l e c t i o n   i s   e m p t y ,   t h e   o l d   t e x t   i s   r e p l a c e d   b y   t h e 
   *   n e w   t e x t   i n   t h e   w h o l e   t e x t a r e a . 
   *   @ p a r a m   t e x t a r e a   a n   ` < i n p u t > `   o r   ` < t e x t a r e a > `   e l e m e n t 
   *   @ p a r a m   o l d T e x t   T h e   t e x t   t o   r e p l a c e 
   *   @ p a r a m   n e w T e x t   T h e   n e w   t e x t   t o   r e p l a c e   w i t h 
   *   @ r e t u r n s   T h e   n e w   t e x t 
   * / 
 e x p o r t   f u n c t i o n   r e p l a c e S e l e c t i o n ( 
     t e x t a r e a :   H T M L I n p u t E l e m e n t   |   H T M L T e x t A r e a E l e m e n t , 
     o l d T e x t :   s t r i n g , 
     n e w T e x t :   s t r i n g 
 ) :   s t r i n g   { 
     i f   ( t e x t a r e a . s e l e c t i o n S t a r t   = = =   n u l l   | |   t e x t a r e a . s e l e c t i o n E n d   = = =   n u l l )   { 
         r e t u r n   r e p l a c e T e x t ( t e x t a r e a ,   o l d T e x t ,   n e w T e x t ) 
     } 
     c o n s t   b e g i n n i n g   =   t e x t a r e a . v a l u e . s u b s t r i n g ( 0 ,   t e x t a r e a . s e l e c t i o n S t a r t ) 
     c o n s t   r e m a i n i n g   =   t e x t a r e a . v a l u e . s u b s t r i n g ( t e x t a r e a . s e l e c t i o n E n d ) 
 
     s e t T e x t a r e a V a l u e A n d C u r s o r ( t e x t a r e a ,   b e g i n n i n g   +   n e w T e x t   +   r e m a i n i n g ,   b e g i n n i n g . l e n g t h ) 
 
     r e t u r n   n e w T e x t 
 } 
 
 t y p e   I n s e r t O p t i o n s   =   { 
     a p p e n d N e w l i n e ? :   b o o l e a n 
 } 
 / * * 
   *   I n s e r t s   t e x t   i n t o   a   t e x t   i n p u t   a n d   m o v e s   t h e   c u r s o r   a p p r o p r i a t e l y . 
   *   I f   t h e   c u r s o r   h a p p e n s   t o   b e   i n   t h e   m i d d l e   o f   a   l i n e ,   o r   t h e   t e x t a r e a   i s n ' t   e m p t y , 
   *   w e   a d d   a   n e w l i n e   c h a r a c t e r   b e f o r e   t h e   i n s e r t e d   t e x t .   W e   a l s o   a d v a n c e   t h e   c u r s o r 
   *   a p p r o p r i a t e l y 
   *   @ p a r a m   t e x t a r e a   a n   ` < i n p u t > `   o r   ` < t e x t a r e a > `   e l e m e n t 
   *   @ p a r a m   t e x t   T h e   t e x t   t o   a d d 
   *   @ p a r a m   a p p e n d N e w l i n e   o p t i o n a l l y   a d d s   a   ` \ n `   c h a r a c t e r   a f t e r   ` t e x t ` 
   * / 
 e x p o r t   f u n c t i o n   i n s e r t T e x t ( 
     t e x t a r e a :   H T M L I n p u t E l e m e n t   |   H T M L T e x t A r e a E l e m e n t , 
     t e x t :   s t r i n g , 
     o p t i o n s :   I n s e r t O p t i o n s   =   { } 
 ) :   s t r i n g   { 
     c o n s t   p o i n t   =   t e x t a r e a . s e l e c t i o n E n d   | |   0 
     c o n s t   b e g i n n i n g   =   t e x t a r e a . v a l u e . s u b s t r i n g ( 0 ,   p o i n t ) 
     c o n s t   r e m a i n i n g   =   t e x t a r e a . v a l u e . s u b s t r i n g ( p o i n t ) 
     c o n s t   n e w l i n e   =   t e x t a r e a . v a l u e   = = =   ' '   | |   b e g i n n i n g . m a t c h ( / \ n $ / )   ?   ' '   :   ' \ n ' 
     c o n s t   t r a i l i n g N e w l i n e   =   o p t i o n s . a p p e n d N e w l i n e   ?   ' \ n '   :   ' ' 
     c o n s t   i n s e r t e d T e x t   =   n e w l i n e   +   t e x t   +   t r a i l i n g N e w l i n e 
 
     t e x t a r e a . v a l u e   =   b e g i n n i n g   +   i n s e r t e d T e x t   +   r e m a i n i n g 
     c o n s t   n e w P o i n t   =   p o i n t   +   i n s e r t e d T e x t . l e n g t h 
     t e x t a r e a . s e l e c t i o n S t a r t   =   n e w P o i n t 
     t e x t a r e a . s e l e c t i o n E n d   =   n e w P o i n t 
     t e x t a r e a . d i s p a t c h E v e n t ( n e w   C u s t o m E v e n t ( ' c h a n g e ' ,   { b u b b l e s :   t r u e ,   c a n c e l a b l e :   f a l s e } ) ) 
     t e x t a r e a . f o c u s ( ) 
     r e t u r n   i n s e r t e d T e x t 
 } 
 
 / * * 
   *   H e l p e r   f u n c t i o n   t o   s e t   t h e   v a l u e   o f   a   t e x t a r e a   a n d   m o v e   t h e   c u r s o r   t o   a   g i v e n   p o s i t i o n . 
   *   E m i t s   a   ` c h a n g e `   e v e n t . 
   *   @ p a r a m   t e x t a r e a   a n   ` < i n p u t > `   o r   ` < t e x t a r e a > `   e l e m e n t 
   *   @ p a r a m   v a l u e   T h e   n e w   v a l u e 
   *   @ p a r a m   c u r s o r   T h e   p o s i t i o n   t o   m o v e   t h e   c u r s o r   t o 
   * / 
 f u n c t i o n   s e t T e x t a r e a V a l u e A n d C u r s o r ( t e x t a r e a :   H T M L I n p u t E l e m e n t   |   H T M L T e x t A r e a E l e m e n t ,   v a l u e :   s t r i n g ,   c u r s o r :   n u m b e r )   { 
     t e x t a r e a . v a l u e   =   v a l u e 
     t e x t a r e a . s e l e c t i o n S t a r t   =   c u r s o r 
     t e x t a r e a . s e l e c t i o n E n d   =   c u r s o r 
     t e x t a r e a . d i s p a t c h E v e n t ( n e w   C u s t o m E v e n t ( ' c h a n g e ' ,   { b u b b l e s :   t r u e ,   c a n c e l a b l e :   f a l s e } ) ) 
 } 
 
 / /   R e t u r n s   t h e   c h a r a c t e r   i n d e x   f o r   a   g i v e n   b y t e   p o s i t i o n ,   t a k i n g   c h a r a c t e r   e n c o d i n g   i n t o   a c c o u n t 
 / /   E x a m p l e   u s a g e   f o r   t h i s   m e t h o d :   h i g h l i g h i n g   t e x t   i n   a   t e x t a r e a   t h a t   m a y   c o n t a i n   n o n - U T F 8   c h a r a c t e r s 
 / / 
 / /   F o r   c o n t e x t ,   i n   J a v a s c r i p t ,   s t r i n g s   a r e   U T F 1 6 .   H o w e v e r ,   C o d e m i r r o r   u s e s   s i m p l e   J a v a s c r i p t 
 / /   i n d e x i n g ,   t h a t   i s n ' t   U n i c o d e   a w a r e .   T h i s   l e a d s   t o   i n c o r r e c t   h i g h l i g h t i n g . 
 / / 
 / /   F o r   e x a m p l e ,   ' =Ø©Ü'   i s   r e p r e s e n t e d   a s   4   b y t e s .   I n   J a v a s c r i p t ,   i t   h a s   l e n g t h   2 
 / /   a n d   i s   c o m p o s e d   o f   a   s u r r o g a t e   p a i r   ( 2   c o d e   p o i n t s ) .   ' =Ø©Ü' . l e n g t h   i s   2 . 
 / /   G i v e n   t e x t   s t r i n g   s u c h   a s   ' h e l l o   =Ø©Ü  w o r l d ' ,   t h i s   w o u l d   b e   r e p r e s e n t e d   i n   h e x   a s : 
 / /   % % % % % % % % %,% % % % % % % % % % % % % % % % % % % % % % % % % %,% % % % % % % % % % % % % % % % % % % % % % % % % %,% % % % % % % % %,% % % % % % % % %%
 / /   %0 0 0 0 0 0 0 0 %  6 8   6 5   6 c   6 c   6 f   2 0   f 0   9 f   
%  9 2   a 9   2 0   7 7   6 f   7 2   6 c   6 4   %h e l l o   × × 
%× ×   w o r l d %
 / /   % % % % % % % % %4% % % % % % % % % % % % % % % % % % % % % % % % % %4% % % % % % % % % % % % % % % % % % % % % % % % % %4% % % % % % % % %4% % % % % % % % %%
 / /   T h e   s t r i n g   ' w o r l d '   a p p e a r s   a t   b y t e   p o s i t i o n s   ( 1 1 ,   1 6 ) ,   b u t   i n   J a v a s c r i p t   ` s t r . s l i c e ( 1 1 ,   1 6 ) `   r e t u r n s   ' r l d ' . 
 / /   T h e   c o r r e c t   p o s i t i o n   i n   J a v a s c r i p t ,   a n d   c o d e m i r r o r ,   w o u l d   b e :   ( 9 ,   1 4 ) . 
 / / 
 / /   W h e n   e n c o d e d   u s i n g   ` T e x t E n c o d e r # e n c o d e I n t o `   w i t h   ' =Ø©Ü' ,   w e ' d   g e t   a n   o b j e c t   w i t h 
 / /   t h e   f o l l o w i n g   p r o p e r t i e s :   { w r i t t e n :   4 ,   r e a d :   2 } .   T h i s   d i s c r e p a n c y   i n f o r m s   u s 
 / /   t h a t   w e   n e e d   t o   o f f s e t   t h e   s t a r t   a n d   e n d   p o s i t i o n s   b y   2 . 
 e x p o r t   f u n c t i o n   G e t C h a r I n d e x F r o m B y t e P o s i t i o n ( s t r :   s t r i n g ,   p o s :   n u m b e r ) :   n u m b e r   { 
     / /   T h e   s t r i n g   i t e r a t o r   [ . . . s t r ]   i s   u n i c o d e   a w a r e ,   a n d   a l l o w s   u s   t o   c o r r e c t l y 
     / /   i t e r a t e   o v e r   e a c h   g r a p h e m e   i n   t h e   s t r i n g .   I t e r a t i n g   o v e r   ` s t r [ i ] `   w o u l d 
     / /   n o t   w o r k ,   a s   i t   s e p a r a t e s   t h e   a s t r a l   s y m b o l   i n t o   e a c h   o f   i t s   s u r r o g a t e s . 
     c o n s t   c o n t e n t s   =   [ . . . s t r ] 
     c o n s t   e n c o d e r   =   n e w   T e x t E n c o d e r ( ) 
 
     / /   A s t r a l   c o d e   p o i n t s   i n   J a v a s c r i p t   a r e   a   s u r r o g a t e   p a i r   o f   2   U T F 1 6   c o d e   u n i t s ,   o r   4   b y t e s 
     c o n s t   u 8 a r r a y   =   n e w   U i n t 8 A r r a y ( 4 ) 
 
     f o r   ( l e t   i   =   0 ;   i   <   c o n t e n t s . l e n g t h ;   i + + )   { 
         c o n s t   c h a r   =   c o n t e n t s [ i ] 
         c o n s t   { w r i t t e n ,   r e a d }   =   e n c o d e r . e n c o d e I n t o ( c h a r ,   u 8 a r r a y ) ! 
         i f   ( ! w r i t t e n   | |   ! r e a d )   { 
             r e t u r n   - 1 
         } 
         c o n s t   d i f f   =   w r i t t e n   -   r e a d 
         i f   ( d i f f   = = =   0 )   { 
             c o n t i n u e 
         } 
 
         i f   ( i   <   p o s )   { 
             p o s   - =   d i f f 
         } 
 
         i f   ( i   > =   p o s )   { 
             b r e a k 
         } 
     } 
 
     r e t u r n   p o s 
 } 
 "ûtype TextField = HTMLInputElement | HTMLTextAreaElement

/**
 * Throttled Input event.
 *
 * Delays firing `input` event until user is done typing.
 *
 * Details.
 *
 * Never fires while a key is down, waits for the next keyup.
 *   NOTE: Native OSX text fields won't repeat keys. FF will repeat key while held down.
 *
 * Never fires for selection changes (pressing left or right keys to move the cursor).
 */

const throttledInputEvents: WeakMap<
  HTMLElement,
  {
    keypressed: boolean
    inputed: boolean
    timer: number | null | undefined
    listener: ThrottledHandler
    wait: number
  }
> = new WeakMap()

function schedule(element: TextField) {
  const events = throttledInputEvents.get(element)
  if (!events) return
  if (events.timer != null) clearTimeout(events.timer)

  events.timer = window.setTimeout(() => {
    if (events.timer != null) events.timer = null
    events.inputed = false
    events.listener.call(null, element)
  }, events.wait)
}

function onKeydownInput(event: Event) {
  const currentTarget = event.currentTarget as TextField
  const events = throttledInputEvents.get(currentTarget)
  if (!events) return
  events.keypressed = true
  if (events.timer != null) {
    clearTimeout(events.timer)
  }
}

function onKeyupInput(event: Event) {
  const currentTarget = event.currentTarget as TextField
  const events = throttledInputEvents.get(currentTarget)
  if (!events) return
  events.keypressed = false
  if (events.inputed) {
    schedule(currentTarget)
  }
}

function onInputInput(event: Event) {
  const currentTarget = event.currentTarget as TextField
  const events = throttledInputEvents.get(currentTarget)
  if (!events) return
  events.inputed = true
  if (!events.keypressed) {
    schedule(currentTarget)
  }
}

type ThrottledHandler = (arg0: TextField) => unknown

export function addThrottledInputEventListener(
  target: TextField,
  listener: ThrottledHandler,
  options: {wait: number | null} = {wait: null}
) {
  throttledInputEvents.set(target, {
    keypressed: false,
    inputed: false,
    timer: undefined,
    listener,
    wait: options.wait != null ? options.wait : 100
  })

  target.addEventListener('keydown', onKeydownInput)
  target.addEventListener('keyup', onKeyupInput)
  target.addEventListener('input', onInputInput)
}

export function removeThrottledInputEventListener(target: TextField, listener: ThrottledHandler) {
  target.removeEventListener('keydown', onKeydownInput)
  target.removeEventListener('keyup', onKeyupInput)
  target.removeEventListener('input', onInputInput)

  const events = throttledInputEvents.get(target)
  if (events) {
    if (events.timer != null && events.listener === listener) {
      clearTimeout(events.timer)
    }
    throttledInputEvents.delete(target)
  }
}

export function dispatchThrottledInputEvent(target: TextField) {
  const events = throttledInputEvents.get(target)
  if (events) events.listener.call(null, target)
}
"ø// Due to the way `visible` is implemented, it causes the browser to
// perform a full page reflow, it lays out all elements again, when called. This
// is one of the most time consuming operations the browser can perform, so it
// affects perceived page load times.
//
// The preferred way to determine element visibility is check for the presence
// of the `hidden` attribute: `if (el.hidden) ...` and `el.hidden = false`.
//
// More info: https://github.com/github/eslint-plugin-github/blob/master/docs/rules/no-d-none.md.
//
// We would ideally like to remove the `visible` function and consistently
// use the `hidden` attribute.
//
// Returns true if the element is hidden.
function hidden(element: HTMLElement): boolean {
  return element.offsetWidth <= 0 && element.offsetHeight <= 0
}

export default function visible(element: HTMLElement): boolean {
  return !hidden(element)
}
"¿import {supported as webauthnSupported} from '@github/webauthn-json'

// Note: the default feedback value stored in the form is 'unknown', but that
// should not be used unless the JS fails to run.
type WebauthnSupportLevel = 'supported' | 'unsupported'

// Calculates a string value to send to the server.
export function webauthnSupportLevel(): WebauthnSupportLevel {
  return webauthnSupported() ? 'supported' : 'unsupported'
}

// Calculates a string value to send to the server.
export async function iuvpaaSupportLevel(): Promise<WebauthnSupportLevel> {
  if (await window.PublicKeyCredential?.isUserVerifyingPlatformAuthenticatorAvailable()) {
    return 'supported'
  }
  return 'unsupported'
}
$ À"
sourceRoot" {"
mapLoadURL"Dhttps://github.githubassets.com/assets/behaviors-5b4026bd04f9.js.map{